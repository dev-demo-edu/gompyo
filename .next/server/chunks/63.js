"use strict";exports.id=63,exports.ids=[63],exports.modules={1836:(e,t,a)=>{a.d(t,{A:()=>w});var r=a(38054),n=a(50023),o=a(11417),i=a(28644),s=a(21790),c=a(24507),l=a(41886),d=a(58883),m=a(6784),u=a(21073),p=a(20144),g=a(96874),h=a(48981),y=a(60727),P=a(18927),C=a(81660),v=a(49116);function A(e){return(0,v.Ay)("MuiMenuItem",e)}let b=(0,C.A)("MuiMenuItem",["root","focusVisible","dense","disabled","divider","gutters","selected"]);var f=a(11432);let D=["autoFocus","component","dense","divider","disableGutters","focusVisibleClassName","role","tabIndex","className"],T=e=>{let{disabled:t,dense:a,divider:r,disableGutters:o,selected:i,classes:c}=e,l=(0,s.A)({root:["root",a&&"dense",t&&"disabled",!o&&"gutters",r&&"divider",i&&"selected"]},A,c);return(0,n.A)({},c,l)},I=(0,l.Ay)(u.A,{shouldForwardProp:e=>(0,l.ep)(e)||"classes"===e,name:"MuiMenuItem",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:a}=e;return[t.root,a.dense&&t.dense,a.divider&&t.divider,!a.disableGutters&&t.gutters]}})(({theme:e,ownerState:t})=>(0,n.A)({},e.typography.body1,{display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minHeight:48,paddingTop:6,paddingBottom:6,boxSizing:"border-box",whiteSpace:"nowrap"},!t.disableGutters&&{paddingLeft:16,paddingRight:16},t.divider&&{borderBottom:`1px solid ${(e.vars||e).palette.divider}`,backgroundClip:"padding-box"},{"&:hover":{textDecoration:"none",backgroundColor:(e.vars||e).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${b.selected}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:(0,c.X4)(e.palette.primary.main,e.palette.action.selectedOpacity),[`&.${b.focusVisible}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.focusOpacity}))`:(0,c.X4)(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.focusOpacity)}},[`&.${b.selected}:hover`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.hoverOpacity}))`:(0,c.X4)(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:(0,c.X4)(e.palette.primary.main,e.palette.action.selectedOpacity)}},[`&.${b.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`&.${b.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity},[`& + .${h.A.root}`]:{marginTop:e.spacing(1),marginBottom:e.spacing(1)},[`& + .${h.A.inset}`]:{marginLeft:52},[`& .${P.A.root}`]:{marginTop:0,marginBottom:0},[`& .${P.A.inset}`]:{paddingLeft:36},[`& .${y.A.root}`]:{minWidth:36}},!t.dense&&{[e.breakpoints.up("sm")]:{minHeight:"auto"}},t.dense&&(0,n.A)({minHeight:32,paddingTop:4,paddingBottom:4},e.typography.body2,{[`& .${y.A.root} svg`]:{fontSize:"1.25rem"}}))),w=o.forwardRef(function(e,t){let a;let s=(0,d.A)({props:e,name:"MuiMenuItem"}),{autoFocus:c=!1,component:l="li",dense:u=!1,divider:h=!1,disableGutters:y=!1,focusVisibleClassName:P,role:C="menuitem",tabIndex:v,className:A}=s,b=(0,r.A)(s,D),w=o.useContext(m.A),F=o.useMemo(()=>({dense:u||w.dense||!1,disableGutters:y}),[w.dense,u,y]),x=o.useRef(null);(0,p.A)(()=>{c&&x.current&&x.current.focus()},[c]);let R=(0,n.A)({},s,{dense:F.dense,divider:h,disableGutters:y}),N=T(s),k=(0,g.A)(x,t);return s.disabled||(a=void 0!==v?v:-1),(0,f.jsx)(m.A.Provider,{value:F,children:(0,f.jsx)(I,(0,n.A)({ref:k,role:C,tabIndex:a,component:l,focusVisibleClassName:(0,i.A)(N.focusVisible,P),className:(0,i.A)(N.root,A)},b,{ownerState:R,classes:N}))})})},18971:(e,t,a)=>{a.d(t,{o:()=>v,q:()=>C});var r=a(17464);a(55414);var n=a(13913),o=a(8613),i=a(26763),s=a(70954),c=a(70564),l=a(37988),d=a(22168),m=a(26647),u=a(5485),p=a(22327),g=a(54022),h=a(21316),y=a(10854),P=a(73103);async function C(e,t){try{console.log("계약 정보 저장 시작:",e),console.log("화물 정보 저장 시작:",t);let a=(0,i.Ak)(),r=(0,i.Ak)();try{let[t]=await n.db.insert(o.contracts).values({id:a,contractNumber:e.contractNumber,contractDate:e.contractDate,exporter:e.exporter,importerId:e.importer,incoterms:e.incoterms}).returning();console.log("계약 정보 저장 완료:",t)}catch(e){throw console.error("계약 정보 저장 중 오류:",e),Error(`계약 정보 저장 실패: ${e instanceof Error?e.message:"알 수 없는 오류"}`)}try{let t=(0,i.Ak)(),[r]=await n.db.insert(o.payments).values({id:t,paymentDueDate:e.contractDate,paymentMethod:"T/T",contractId:a}).returning();console.log("결제 정보 저장 완료:",r);let[s]=await n.db.insert(o.paymentsTt).values({paymentId:t,advancePaymentDate:e.contractDate,advancePaymentRatio:30,advancePaymentAmount:0,remainingPaymentDate:e.contractDate,remainingPaymentRatio:70,remainingPaymentAmount:0,counterpartBank:""}).returning();console.log("T/T 결제 상세 정보 저장 완료:",s)}catch(e){throw console.error("결제 정보 저장 중 오류:",e),Error(`결제 정보 저장 실패: ${e instanceof Error?e.message:"알 수 없는 오류"}`)}try{let[t]=await n.db.insert(o.shipments).values({id:r,contractId:a,estimatedTimeArrival:e.estimatedTimeArrival,estimatedTimeDeparture:e.estimatedTimeDeparture,arrivalPort:e.arrivalPort,departurePort:e.departurePort}).returning();console.log("선적 정보 저장 완료:",t)}catch(e){throw console.error("선적 정보 저장 중 오류:",e),Error(`선적 정보 저장 실패: ${e instanceof Error?e.message:"알 수 없는 오류"}`)}for(let e of t)try{let t;let a=(0,i.Ak)(),s=await n.db.query.items.findFirst({where:(t,{eq:a,and:r})=>r(a(t.itemName,e.itemName),a(t.itemVariety,e.itemVariety),e.hsCode?a(t.hsCode,e.hsCode):void 0,a(t.packingUnit,e.packingUnit))});if(s)t=s.id;else{let[a]=await n.db.insert(o.items).values({id:(0,i.Ak)(),itemName:e.itemName,itemVariety:e.itemVariety,originCountry:null,hsCode:e.hsCode,packingUnit:e.packingUnit}).returning();t=a.id,console.log("새로운 품목 정보 저장 완료:",a)}let c=(0,i.Ak)(),l=e.unitPrice*e.exchangeRate*e.contractTon/1e3,[d]=await n.db.insert(o.cargos).values({id:c,itemsId:t,shipmentId:r,containerCount:1,contractTon:e.contractTon,progressStatus:"REVIEW",sellingPrice:e.sellingPrice,margin:e.sellingPrice-l,totalProfit:(e.sellingPrice-l)*e.contractTon*1e3,purchaseFeeRate:0}).returning();console.log("화물 정보 저장 완료:",d);let[m]=await n.db.insert(o.costs).values({id:a,cargoId:c,supplyPrice:e.unitPrice,laborCost:0,transportStorageFee:0,loadingUnloadingFee:0}).returning();console.log("비용 정보 저장 완료:",m);let[u]=await n.db.insert(o.costDetails).values({id:(0,i.Ak)(),costId:a,unitPrice:e.unitPrice,exchangeRate:e.exchangeRate,customsTaxRate:e.customsTaxRate,customTaxAmount:e.customTaxAmount,customsFee:e.customsFee,inspectionFee:e.inspectionFee,doCharge:0,otherCosts:e.otherCosts}).returning();console.log("비용 상세 정보 저장 완료:",u)}catch(e){throw console.error("화물 정보 저장 중 오류:",e),Error(`화물 정보 저장 실패: ${e instanceof Error?e.message:"알 수 없는 오류"}`)}return{success:!0,message:"계획이 성공적으로 저장되었습니다."}}catch(e){return console.error("계획 저장 중 오류 발생:",e),e instanceof Error&&console.error("오류 상세:",{message:e.message,stack:e.stack,name:e.name}),{success:!1,message:`계획 저장 중 오류가 발생했습니다: ${e instanceof Error?e.message:"알 수 없는 오류"}`}}}async function v(){try{let e=new c.y,t=new l.o,a=new d.q,r=new m.b,n=new u.T,o=new p.G,i=new g.W,C=new h.Y,[v,A,b,f,D,T,I,w]=await Promise.all([e.findAll(),t.findAll(),a.findAll(),r.findAll(),n.findAll(),o.findAll(),i.findAll(),C.getAllImporters()]);return b.map(e=>{let t=A.find(t=>t.id===e.shipmentId),a=v.find(e=>e.id===t?.contractId),r=f.find(t=>t.id===e?.itemsId),n=D.find(t=>t.cargoId===e?.id),o=T.find(e=>e.costId===n?.id),i=I.find(e=>e.contractId===a?.id),c=w.find(e=>e.id===a?.importerId),l={contract:{id:a?.id||"",contractNumber:a?.contractNumber||"",contractDate:a?.contractDate||"",exporter:a?.exporter||"",importerId:a?.importerId||"",incoterms:a?.incoterms||""},shipment:{id:t?.id||"",contractId:a?.id||"",estimatedTimeDeparture:t?.estimatedTimeDeparture||"",estimatedTimeArrival:t?.estimatedTimeArrival||"",shippingCompany:t?.shippingCompany||"",departurePort:t?.departurePort||"",arrivalPort:t?.arrivalPort||"",blNumber:t?.blNumber||"",palletOrderDate:t?.palletOrderDate||"",palletType:t?.palletType||""},cargo:{id:e?.id||"",remark:e?.remark||"",itemsId:e?.itemsId||"",shipmentId:t?.id||"",containerCount:e?.containerCount||0,contractTon:e?.contractTon||0,progressStatus:e?.progressStatus||"예정",customsClearanceDate:e?.customsClearanceDate||"",quarantineDate:e?.quarantineDate||"",warehouseEntryDate:e?.warehouseEntryDate||"",sellingPrice:e?.sellingPrice||0,margin:e?.margin||0,totalProfit:e?.totalProfit||0,purchaseFeeRate:e?.purchaseFeeRate||0,sellingPriceWholesale:e?.sellingPriceWholesale||0,sellingPriceRetail:e?.sellingPriceRetail||0},cost:{id:n?.id||"",cargoId:e?.id||"",supplyPrice:n?.supplyPrice||0,shippingCost:n?.shippingCost||0,laborCost:n?.laborCost||0,transportStorageFee:n?.transportStorageFee||0,loadingUnloadingFee:n?.loadingUnloadingFee||0,usanceInterest:n?.usanceInterest||0},costDetail:{id:o?.id||"",costId:n?.id||"",unitPrice:o?.unitPrice||0,exchangeRate:o?.exchangeRate||0,customsTaxRate:o?.customsTaxRate||0,customTaxAmount:o?.customTaxAmount||0,customsFee:o?.customsFee||0,inspectionFee:o?.inspectionFee||0,doCharge:o?.doCharge||0,otherCosts:o?.otherCosts||0,transferFee:o?.transferFee||0},payment:{id:i?.id||"",contractId:a?.id||"",paymentMethod:i?.paymentMethod||"",paymentDueDate:i?.paymentDueDate||"",advancePaymentDate:i?.advancePaymentDate||"",advancePaymentRatio:i?.advancePaymentRatio||0,advancePaymentAmount:i?.advancePaymentAmount||0,remainingPaymentDate:i?.remainingPaymentDate||"",remainingPaymentRatio:i?.remainingPaymentRatio||0,remainingPaymentAmount:i?.remainingPaymentAmount||0,counterpartBank:i?.counterpartBank||"",paymentTerm:i?.paymentTerm||"",totalContractAmount:i?.totalContractAmount||0},item:{id:r?.id||"",itemName:r?.itemName||"",itemVariety:r?.itemVariety||"",packingUnit:r?.packingUnit||"",originCountry:r?.originCountry||"",hsCode:r?.hsCode||""},importer:{id:c?.id||"",importerName:c?.importerName||"",calculationType:c?.calculationType||y.A.STANDARD}},d=(0,s.s)(l);return{id:e?.id||"",contractNumber:a?.contractNumber||"",progressStatus:P.LE[e?.progressStatus]||"예정",contractDate:a?.contractDate||"",importer:c?.importerName||"",exporter:a?.exporter||"",estimatedTimeArrival:t?.estimatedTimeArrival||"",arrivalPort:t?.arrivalPort||"",itemName:r?.itemName||"",contractTon:e?.contractTon||0,unitPrice:d.costDetail.unitPrice||0,totalPrice:d.costDetail.totalContractPrice||0,paymentMethod:i?.paymentMethod||"",warehouseEntryDate:e?.warehouseEntryDate||"",importCostPerKg:d.costDetail.costPerKg||0,supplyCostPerKg:d.cost.supplyPrice||0,totalCost:d.cost.contractorCost||0,totalCostPerKg:d.costDetail.costPerKg||0,sellingPrice:d.cargo.sellingPrice||0,margin:d.cargo.margin||0,totalProfit:d.cargo.totalProfit||0}})}catch(e){throw console.error("Failed to fetch plan data:",e),Error("계획 데이터를 불러오는데 실패했습니다.")}}(0,a(1634).D)([C,v]),(0,r.A)(C,"605b4f045eafa7bfea9a27361956d51e66e44e2375",null),(0,r.A)(v,"002f662226f6eaa0d3ac831331de3c10c5b6874bef",null)},26647:(e,t,a)=>{a.d(t,{b:()=>s});var r=a(13913),n=a(8613),o=a(98149),i=a(26763);class s{async create(e){let t=(0,i.Ak)(),[a]=await r.db.insert(n.items).values({...e,id:t}).returning();return a}async findById(e){let[t]=await r.db.select().from(n.items).where((0,o.eq)(n.items.id,e));return t}async searchItems(e){return await r.db.select().from(n.items).where((0,o.eq)(n.items.itemName,e))}async findAll(){return await r.db.select().from(n.items)}async update(e,t){let[a]=await r.db.update(n.items).set(t).where((0,o.eq)(n.items.id,e)).returning();return a}async delete(e){let[t]=await r.db.delete(n.items).where((0,o.eq)(n.items.id,e)).returning();return t}}},70954:(e,t,a)=>{a.d(t,{s:()=>l});var r=a(10854);class n{calculate(e,t){let a=e.contractorCost*(1+t.purchaseFeeRate/100),r=(a-e.contractorCost)*t.contractTon*1e3,n=a*t.contractTon*1e3+t.shippingCost+t.laborCost+t.transportStorageFee+t.loadingUnloadingFee,o=t.sellingPrice-n/t.contractTon/1e3,i=o*t.contractTon*1e3;return{supplyPrice:a,contractorProfit:r,totalCost:n,margin:o,totalProfit:i}}}class o{calculate(e,t){let a=(e.contractorCostAmount+t.shippingCost+t.laborCost+t.transportStorageFee+t.loadingUnloadingFee+t.usanceInterest)/t.contractTon/1e3*(1+t.purchaseFeeRate/100),r=(a-e.contractorCost)*t.contractTon*1e3,n=a*t.contractTon*1e3,o=t.sellingPrice-n/t.contractTon/1e3,i=o*t.contractTon*1e3;return{supplyPrice:a,contractorProfit:r,totalCost:n,margin:o,totalProfit:i}}}class i{calculate(e,t){let a=e.contractorCost*(1+t.purchaseFeeRate/100),r=(a-e.contractorCost)*t.contractTon*1e3,n=a*t.contractTon*1e3+t.shippingCost+t.laborCost+t.transportStorageFee+t.loadingUnloadingFee,o=t.sellingPrice-n/t.contractTon/1e3,i=o*t.contractTon*1e3;return{supplyPrice:a,contractorProfit:r,totalCost:n,margin:o,totalProfit:i}}}class s{static createStrategy(e){if(!e)return new n;switch(e.calculationType){case r.A.STANDARD:return new n;case r.A.DNB:return new o;case r.A.NAMHAE:return new i;default:return new n}}}class c{constructor(e){this.data=e,this.calculationStrategy=s.createStrategy(e.importer),this.calculatedValues=this.calculateValues()}calculateValues(){let e=this.data.costDetail.unitPrice||0,t=this.data.costDetail.exchangeRate||0,a=this.data.cargo.contractTon||0,r=this.data.cargo.sellingPrice||0,n=this.data.cargo.purchaseFeeRate||0,o=Math.floor(e*t*a),i=e*t/1e3,s=o+(this.data.costDetail.customTaxAmount||0)+(this.data.costDetail.transferFee||0)+(this.data.costDetail.customsFee||0)+(this.data.costDetail.inspectionFee||0)+(this.data.costDetail.doCharge||0)+(this.data.costDetail.otherCosts||0),c=s/a/1e3,l=this.calculationStrategy.calculate({contractorCostAmount:s,costPerKg:i,totalContractPrice:o,contractorCost:c},{contractTon:a,sellingPrice:r,purchaseFeeRate:n,shippingCost:this.data.cost.shippingCost||0,laborCost:this.data.cost.laborCost||0,transportStorageFee:this.data.cost.transportStorageFee||0,loadingUnloadingFee:this.data.cost.loadingUnloadingFee||0,usanceInterest:this.data.cost.usanceInterest||0});return{supplyPrice:l.supplyPrice,margin:l.margin,totalProfit:l.totalProfit,totalContractPrice:o,costPerKg:i,contractorCost:c,contractorProfit:l.contractorProfit,totalCost:l.totalCost}}mapItem(e){return{id:e.id,itemName:e.itemName||"",itemVariety:e.itemVariety||"",originCountry:e.originCountry||"",hsCode:e.hsCode||"",packingUnit:e.packingUnit||""}}mapShipment(e){return{id:e.id,estimatedTimeArrival:e.estimatedTimeArrival||"",estimatedTimeDeparture:e.estimatedTimeDeparture||"",arrivalPort:e.arrivalPort||"",departurePort:e.departurePort||"",blNumber:e.blNumber||"",palletOrderDate:e.palletOrderDate||"",palletType:e.palletType||"",shippingCompany:e.shippingCompany||"",contractId:e.contractId||""}}mapContract(e,t,a){return{id:e.id,incoterms:e.incoterms||"",contractNumber:e.contractNumber||"",contractDate:e.contractDate||"",exporter:e.exporter||"",importerId:e.importerId||"",departurePort:t.departurePort||"",arrivalPort:t.arrivalPort||"",estimatedTimeDeparture:t.estimatedTimeDeparture||"",estimatedTimeArrival:t.estimatedTimeArrival||"",blNumber:t.blNumber||"",importerName:a?.importerName||""}}mapPayment(e){return{id:e.id,paymentDueDate:e.paymentDueDate||"",paymentMethod:e.paymentMethod||"",contractId:e.contractId,advancePaymentDate:e.advancePaymentDate||"",advancePaymentRatio:e.advancePaymentRatio||0,advancePaymentAmount:e.advancePaymentAmount||0,remainingPaymentDate:e.remainingPaymentDate||"",remainingPaymentRatio:e.remainingPaymentRatio||0,remainingPaymentAmount:e.remainingPaymentAmount||0,counterpartBank:e.counterpartBank||"",paymentTerm:e.paymentTerm||"",totalContractAmount:this.calculatedValues.totalContractPrice}}mapAndCalculateCostDetail(e){return{id:e.id,unitPrice:e.unitPrice||0,totalContractPrice:this.calculatedValues.totalContractPrice,exchangeRate:e.exchangeRate||0,costPerKg:this.calculatedValues.costPerKg,costId:e.costId,customTaxAmount:e.customTaxAmount||0,customsTaxRate:e.customsTaxRate||0,customsFee:e.customsFee||0,inspectionFee:e.inspectionFee||0,doCharge:e.doCharge||0,otherCosts:e.otherCosts||0,transferFee:e.transferFee||0}}mapAndCalculateContractAmount(e,t){return{id:t.id,cargoId:t.cargoId,contractorCost:this.calculatedValues.contractorCost,supplyPrice:this.calculatedValues.supplyPrice,contractorProfit:this.calculatedValues.contractorProfit,shippingCost:t.shippingCost||0,laborCost:t.laborCost||0,transportStorageFee:t.transportStorageFee||0,loadingUnloadingFee:t.loadingUnloadingFee||0,usanceInterest:t.usanceInterest||0}}mapAndCalculateExpense(e){return{id:e.id,itemsId:e.itemsId,shipmentId:e.shipmentId,containerCount:e.containerCount,contractTon:e.contractTon,customsClearanceDate:e.customsClearanceDate,quarantineDate:e.quarantineDate,warehouseEntryDate:e.warehouseEntryDate,progressStatus:e.progressStatus,totalCost:this.calculatedValues.totalCost,sellingPrice:e.sellingPrice||0,sellingPriceWholesale:e.sellingPriceWholesale||0,sellingPriceRetail:e.sellingPriceRetail||0,margin:this.calculatedValues.margin,totalProfit:this.calculatedValues.totalProfit,purchaseFeeRate:e.purchaseFeeRate,remark:e.remark}}calculate(){return{importer:this.data.importer,contract:this.mapContract(this.data.contract,this.data.shipment,this.data.importer),payment:this.mapPayment(this.data.payment),costDetail:this.mapAndCalculateCostDetail(this.data.costDetail),cost:this.mapAndCalculateContractAmount(this.data.cargo,this.data.cost),cargo:this.mapAndCalculateExpense(this.data.cargo),item:this.mapItem(this.data.item),shipment:this.mapShipment(this.data.shipment)}}}function l(e){return new c(e).calculate()}},98396:(e,t,a)=>{a.d(t,{o:()=>n});var r=a(63016);let n=(0,r.createServerReference)("002f662226f6eaa0d3ac831331de3c10c5b6874bef",r.callServer,void 0,r.findSourceMapURL,"getPlanData")}};
