"use strict";exports.id=405,exports.ids=[405],exports.modules={8613:(e,t,a)=>{a.r(t),a.d(t,{accountNumbers:()=>A,businessNumbers:()=>K,cargos:()=>x,cargosRelations:()=>M,cashflows:()=>G,cashflowsRelations:()=>W,companies:()=>V,companiesRelations:()=>$,contracts:()=>w,contractsRelations:()=>k,costDetails:()=>g,costDetailsRelations:()=>S,costs:()=>v,costsRelations:()=>U,documents:()=>C,documentsRelations:()=>z,historyLogs:()=>R,historyLogsRelations:()=>J,importers:()=>f,importersRelations:()=>O,items:()=>b,itemsRelations:()=>L,links:()=>F,payments:()=>N,paymentsRelations:()=>P,paymentsTt:()=>q,paymentsTtRelations:()=>T,paymentsUsance:()=>Q,paymentsUsanceRelations:()=>E,shipments:()=>D,shipmentsRelations:()=>B,users:()=>I});var r=a(87985),n=a(71198),i=a(70228),d=a(10215),l=a(75263),s=a(49778),o=a(28370);let m=e=>e.value?new Date(e.value).toLocaleDateString("ko-KR",{year:"numeric",month:"long",day:"numeric"}):"",c=e=>e.value?new Intl.NumberFormat("ko-KR",{style:"currency",currency:"KRW"}).format(e.value):"",u=e=>e.value?new Intl.NumberFormat("ko-KR",{style:"currency",currency:"KRW",minimumFractionDigits:0,maximumFractionDigits:0}).format(e.value)+"/kg":"",p=[{field:"contractNumber",headerName:"계약 번호",width:130},{field:"progressStatus",headerName:"진행 상태",width:100},{field:"contractDate",headerName:"계약일자",valueFormatter:m,width:150},{field:"exporter",headerName:"공급업체",width:120},{field:"importer",headerName:"수입회사",width:120},{field:"estimatedTimeArrival",headerName:"ETA",valueFormatter:m,width:150},{field:"arrivalPort",headerName:"도착항",width:120},{field:"itemName",headerName:"품목",width:120},{field:"contractTon",headerName:"무게",valueFormatter:e=>`${e.value}톤`,width:100},{field:"unitPrice",headerName:"단가",valueFormatter:c,width:130},{field:"totalPrice",headerName:"단가 * 무게",valueFormatter:c,width:150},{field:"paymentMethod",headerName:"결제방식",width:100},{field:"warehouseEntryDate",headerName:"입고일",valueFormatter:m,width:150},{field:"importCostPerKg",headerName:"수입가/kg",valueFormatter:u,width:130},{field:"supplyCostPerKg",headerName:"수급가/kg",valueFormatter:u,width:130},{field:"totalCost",headerName:"총 비용",valueFormatter:c,width:150},{field:"totalCostPerKg",headerName:"총 비용/kg",valueFormatter:u,width:130},{field:"sellingPrice",headerName:"판매가",valueFormatter:c,width:130},{field:"margin",headerName:"마진",valueFormatter:c,width:100},{field:"totalProfit",headerName:"총 이익",valueFormatter:c,width:150}],h=[{field:"contractNumber",headerName:"계약 번호",width:130},{field:"progressStatus",headerName:"진행 상태",width:100},{field:"contractDate",headerName:"계약일자",valueFormatter:m,width:150},{field:"importer",headerName:"수입회사",width:120},{field:"productName",headerName:"제품명",width:150},{field:"itemName",headerName:"품목",width:120},{field:"weight",headerName:"무게",valueFormatter:e=>`${e.value}톤`,width:100},{field:"containerCount",headerName:"컨테이너 개수",width:120},{field:"packingUnit",headerName:"포장 단위",width:100},{field:"unitPrice",headerName:"단가",valueFormatter:c,width:130},{field:"totalPrice",headerName:"단가 * 무게",valueFormatter:c,width:150},{field:"supplyPrice",headerName:"수급가",valueFormatter:c,width:130},{field:"sellingPrice",headerName:"판매가",valueFormatter:c,width:130},{field:"paymentMethod",headerName:"결제방식",width:100},{field:"hsCode",headerName:"HS CODE",width:120},{field:"blNumber",headerName:"BL no.",width:120},{field:"departurePort",headerName:"port(출발항)",width:120},{field:"etd",headerName:"ETD",valueFormatter:m,width:150},{field:"arrivalPort",headerName:"port(도착항)",width:120},{field:"eta",headerName:"ETA",valueFormatter:m,width:150},{field:"exporter",headerName:"공급업체",width:120},{field:"customsDate",headerName:"통관일자",valueFormatter:m,width:150}],y=p.map(e=>e.field),_=h.map(e=>e.field),f=(0,r.D)("importers",{id:(0,n.Qq)("id").primaryKey(),importerName:(0,n.Qq)("importer_name").notNull(),calculationType:(0,n.Qq)("calculation_type").notNull()}),N=(0,r.D)("payments",{id:(0,n.Qq)("id").primaryKey(),paymentDueDate:(0,n.Qq)("payment_due_date"),paymentMethod:(0,n.Qq)("payment_method").notNull(),contractId:(0,n.Qq)("contract_id").notNull()},e=>[(0,i.z6)("payment_type_check",(0,s.ll)`${e.paymentMethod} IN ('T/T', 'CAD', 'L/C', 'Usance')`)]),q=(0,r.D)("payments_tt",{paymentId:(0,n.Qq)("payment_id").primaryKey().references(()=>N.id,{onDelete:"cascade"}),advancePaymentDate:(0,n.Qq)("advance_payment_date"),advancePaymentRatio:(0,d.x)("advance_payment_ratio"),advancePaymentAmount:(0,d.x)("advance_payment_amount"),remainingPaymentDate:(0,n.Qq)("remaining_payment_date"),remainingPaymentRatio:(0,d.x)("remaining_payment_ratio"),remainingPaymentAmount:(0,d.x)("remaining_payment_amount"),counterpartBank:(0,n.Qq)("counterpart_bank")}),Q=(0,r.D)("payments_usance",{paymentId:(0,n.Qq)("payment_id").primaryKey().references(()=>N.id,{onDelete:"cascade"}),paymentTerm:(0,n.Qq)("payment_term"),contractExchangeRate:(0,n.Qq)("contact_exchange_rate")}),g=(0,r.D)("cost_details",{id:(0,n.Qq)("id").primaryKey(),unitPrice:(0,d.x)("unit_price"),exchangeRate:(0,d.x)("exchange_rate"),customsTaxRate:(0,d.x)("customs_tax_rate"),customTaxAmount:(0,d.x)("custom_tax_amount"),customsFee:(0,d.x)("customs_fee"),inspectionFee:(0,d.x)("inspection_fee"),doCharge:(0,d.x)("do_charge"),otherCosts:(0,d.x)("other_costs"),transferFee:(0,d.x)("transfer_fee"),costId:(0,n.Qq)("cost_id").notNull()}),w=(0,r.D)("contracts",{id:(0,n.Qq)("id").primaryKey(),contractNumber:(0,n.Qq)("contract_number"),contractDate:(0,n.Qq)("contract_date"),exporter:(0,n.Qq)("exporter"),importerId:(0,n.Qq)("importer_id").references(()=>f.id),incoterms:(0,n.Qq)("incoterms")}),b=(0,r.D)("items",{id:(0,n.Qq)("id").primaryKey(),itemName:(0,n.Qq)("item_name"),itemVariety:(0,n.Qq)("item_variety"),originCountry:(0,n.Qq)("origin_country"),hsCode:(0,n.Qq)("hs_code"),packingUnit:(0,n.Qq)("packing_unit")}),v=(0,r.D)("costs",{id:(0,n.Qq)("id").primaryKey(),supplyPrice:(0,d.x)("supply_price"),shippingCost:(0,d.x)("shipping_cost"),laborCost:(0,d.x)("labor_cost"),transportStorageFee:(0,d.x)("transport_storage_fee"),loadingUnloadingFee:(0,d.x)("loading_unloading_fee"),usanceInterest:(0,d.x)("usance_interest"),cargoId:(0,n.Qq)("cargo_id").notNull()}),I=(0,r.D)("users",{id:(0,n.Qq)("id").primaryKey(),email:(0,n.Qq)("email"),password:(0,n.Qq)("password"),name:(0,n.Qq)("name"),planColumnOrder:(0,n.Qq)("plan_column_order").default(JSON.stringify(y)),shipmentColumnOrder:(0,n.Qq)("shipment_column_order").default(JSON.stringify(_))}),D=(0,r.D)("shipments",{id:(0,n.Qq)("id").primaryKey(),contractId:(0,n.Qq)("contract_id").notNull(),estimatedTimeArrival:(0,n.Qq)("estimated_time_arrival"),estimatedTimeDeparture:(0,n.Qq)("estimated_time_departure"),arrivalPort:(0,n.Qq)("arrival_port"),shippingCompany:(0,n.Qq)("shipping_company"),departurePort:(0,n.Qq)("departure_port"),blNumber:(0,n.Qq)("bl_number"),palletOrderDate:(0,n.Qq)("pallet_order_date"),palletType:(0,n.Qq)("pallet_type")}),x=(0,r.D)("cargos",{id:(0,n.Qq)("id").primaryKey(),itemsId:(0,n.Qq)("items_id").notNull(),shipmentId:(0,n.Qq)("shipment_id").notNull(),containerCount:(0,l.nd)("container_count"),contractTon:(0,l.nd)("contract_ton"),customsClearanceDate:(0,n.Qq)("customs_clearance_date"),quarantineDate:(0,n.Qq)("quarantine_date"),warehouseEntryDate:(0,n.Qq)("warehouse_entry_date"),progressStatus:(0,n.Qq)("progress_status"),sellingPrice:(0,d.x)("selling_price"),sellingPriceWholesale:(0,d.x)("selling_price_wholesale"),sellingPriceRetail:(0,d.x)("selling_price_retail"),margin:(0,d.x)("margin"),totalProfit:(0,d.x)("total_profit"),purchaseFeeRate:(0,d.x)("purchase_fee_rate"),remark:(0,n.Qq)("remark")},e=>[(0,i.z6)("progress_status_check",(0,s.ll)`${e.progressStatus} IN ('REVIEW', 'CONTRACTING', 'BEFORE_LC', 'BEFORE_ARRIVAL', 'WAREHOUSE_MOVING', 'BEFORE_QUARANTINE', 'QUARANTINING', 'CUSTOMS_DECLARING', 'DONE_ARRIVAL', 'AFTER_CUSTOMS', 'SELLING')`)]),C=(0,r.D)("documents",{id:(0,n.Qq)("id").primaryKey(),documentName:(0,n.Qq)("document_name").notNull(),documentType:(0,n.Qq)("document_type").notNull(),s3Url:(0,n.Qq)("s3_url").notNull(),uploadDate:(0,n.Qq)("upload_date").notNull(),relatedId:(0,n.Qq)("related_id").notNull(),documentCategory:(0,n.Qq)("document_category").notNull()}),R=(0,r.D)("history_logs",{id:(0,n.Qq)("id").primaryKey(),targetType:(0,n.Qq)("target_type"),targetId:(0,n.Qq)("target_id"),type:(0,n.Qq)("type"),user:(0,n.Qq)("user"),changes:(0,n.Qq)("changes"),status:(0,n.Qq)("status"),createdAt:(0,n.Qq)("created_at")}),A=(0,r.D)("account_numbers",{id:(0,n.Qq)("id").primaryKey(),accountNumber:(0,n.Qq)("account_number").notNull(),bankName:(0,n.Qq)("bank_name").notNull(),owner:(0,n.Qq)("owner").notNull(),createdAt:(0,n.Qq)("created_at").notNull(),updatedAt:(0,n.Qq)("updated_at")}),K=(0,r.D)("business_numbers",{id:(0,n.Qq)("id").primaryKey(),businessNumber:(0,n.Qq)("business_number").notNull(),businessName:(0,n.Qq)("business_name").notNull(),businessRepresentative:(0,n.Qq)("business_representative").notNull(),createdAt:(0,n.Qq)("created_at").notNull(),updatedAt:(0,n.Qq)("updated_at")}),F=(0,r.D)("links",{id:(0,n.Qq)("id").primaryKey(),title:(0,n.Qq)("title").notNull(),url:(0,n.Qq)("url").notNull(),thumbnail:(0,n.Qq)("thumbnail"),order:(0,l.nd)("order").notNull(),createdAt:(0,n.Qq)("created_at").notNull(),updatedAt:(0,n.Qq)("updated_at").notNull()}),O=(0,o.K1)(f,({many:e})=>({contracts:e(w)})),P=(0,o.K1)(N,({one:e})=>({contract:e(w,{fields:[N.contractId],references:[w.id]}),paymentsTt:e(q,{fields:[N.id],references:[q.paymentId]}),paymentsUsance:e(Q,{fields:[N.id],references:[Q.paymentId]})})),T=(0,o.K1)(q,({one:e})=>({payment:e(N,{fields:[q.paymentId],references:[N.id]})})),E=(0,o.K1)(Q,({one:e})=>({payment:e(N,{fields:[Q.paymentId],references:[N.id]})})),S=(0,o.K1)(g,({one:e})=>({cost:e(v,{fields:[g.costId],references:[v.id]})})),k=(0,o.K1)(w,({many:e,one:t})=>({payments:e(N),shipments:e(D),documents:e(C),importer:t(f,{fields:[w.importerId],references:[f.id]})})),L=(0,o.K1)(b,({many:e})=>({cargos:e(x)})),U=(0,o.K1)(v,({one:e,many:t})=>({cargo:e(x,{fields:[v.cargoId],references:[x.id]}),costDetails:t(g)})),B=(0,o.K1)(D,({one:e,many:t})=>({contract:e(w,{fields:[D.contractId],references:[w.id]}),cargos:t(x),documents:t(C)})),M=(0,o.K1)(x,({one:e,many:t})=>({item:e(b,{fields:[x.itemsId],references:[b.id]}),shipment:e(D,{fields:[x.shipmentId],references:[D.id]}),costs:t(v)})),z=(0,o.K1)(C,({one:e})=>({contract:e(w,{fields:[C.relatedId],references:[w.id],relationName:"contract_documents"}),shipment:e(D,{fields:[C.relatedId],references:[D.id],relationName:"shipment_documents"})})),J=(0,o.K1)(R,({})=>({})),G=(0,r.D)("cashflows",{id:(0,n.Qq)("id").primaryKey(),date:(0,n.Qq)("date").notNull(),companyId:(0,n.Qq)("company_id").notNull(),counterparty:(0,n.Qq)("counterparty").notNull(),amount:(0,d.x)("amount").notNull(),type:(0,n.Qq)("type").notNull(),priority:(0,l.nd)("priority"),createdAt:(0,n.Qq)("created_at").notNull(),updatedAt:(0,n.Qq)("updated_at").notNull()},e=>[(0,i.z6)("cashflow_type_check",(0,s.ll)`${e.type} IN ('income', 'expense')`)]),V=(0,r.D)("companies",{id:(0,n.Qq)("id").primaryKey(),name:(0,n.Qq)("name").notNull(),companyBalance:(0,d.x)("company_balance").notNull(),createdAt:(0,n.Qq)("created_at").notNull(),updatedAt:(0,n.Qq)("updated_at").notNull()}),W=(0,o.K1)(G,({one:e})=>({company:e(V,{fields:[G.companyId],references:[V.id]})})),$=(0,o.K1)(V,({many:e})=>({cashflows:e(G)}))},13913:(e,t,a)=>{a.d(t,{db:()=>m});var r=a(58622),n=a(87550),i=a.n(n),d=a(8613),l=a(33873);let s=a.n(l)().join(process.cwd(),"drizzle","database.sqlite"),o=new(i())(s),m=(0,r.f)(o,{schema:d})},36405:(e,t,a)=>{a.d(t,{wz:()=>y,Dm:()=>_,OA:()=>f,Lx:()=>p,y4:()=>h,Mo:()=>N,Fq:()=>q});var r=a(17464);a(55414);var n=a(19541),i=a(14567),d=a(15198),l=a(13913),s=a(8613),o=a(98149);class m{async findByEmail(e){let[t]=await l.db.select().from(s.users).where((0,o.eq)(s.users.email,e));return t}async findById(e){let[t]=await l.db.select().from(s.users).where((0,o.eq)(s.users.id,e));return t}async getPlanColumnOrder(e){let t=await this.findById(e);return t.planColumnOrder?JSON.parse(t.planColumnOrder):null}async getShipmentColumnOrder(e){let t=await this.findById(e);return t.shipmentColumnOrder?JSON.parse(t.shipmentColumnOrder):null}async updatePlanColumnOrder(e,t){let[a]=await l.db.update(s.users).set({planColumnOrder:t}).where((0,o.eq)(s.users.id,e)).returning();return a}async updateShipmentColumnOrder(e,t){let[a]=await l.db.update(s.users).set({shipmentColumnOrder:t}).where((0,o.eq)(s.users.id,e)).returning();return a}async create(e){let[t]=await l.db.insert(s.users).values(e).returning();return t}async delete(e){return await l.db.delete(s.users).where((0,o.eq)(s.users.id,e)),!0}}var c=a(1634);let u=new m;async function p(e){let t=e.get("email"),a=e.get("password");try{let e=await u.findByEmail(t);if(!e||e.password!==a)return{error:"이메일 또는 비밀번호가 올바르지 않습니다."};return(await (0,i.UL)()).set({name:"userId",value:e.id,httpOnly:!0,maxAge:604800,path:"/"}),{success:!0}}catch(e){return console.error("Login error:",e),{error:"로그인 중 오류가 발생했습니다."}}}async function h(){(await (0,i.UL)()).delete("userId"),(0,d.redirect)("/login")}async function y(){let e=await (0,i.UL)(),t=e.get("userId")?.value;return t?u.findById(t):null}async function _(){let e=await (0,i.UL)(),t=e.get("userId")?.value;return t?await u.getPlanColumnOrder(t):[]}async function f(){let e=await (0,i.UL)(),t=e.get("userId")?.value;return t?await u.getShipmentColumnOrder(t):[]}async function N(e){let t=await (0,i.UL)(),a=t.get("userId")?.value;if(!a)return{error:"로그인이 필요합니다."};try{return await u.updatePlanColumnOrder(a,JSON.stringify(e)),(0,n.revalidatePath)("/"),{success:!0}}catch(e){return console.error("컬럼 순서 저장 오류:",e),{error:"컬럼 순서를 저장하는 중 오류가 발생했습니다."}}}async function q(e){let t=await (0,i.UL)(),a=t.get("userId")?.value;if(!a)return{error:"로그인이 필요합니다."};try{return await u.updateShipmentColumnOrder(a,JSON.stringify(e)),(0,n.revalidatePath)("/"),{success:!0}}catch(e){return console.error("컬럼 순서 저장 오류:",e),{error:"컬럼 순서를 저장하는 중 오류가 발생했습니다."}}}(0,c.D)([p,h,y,_,f,N,q]),(0,r.A)(p,"408c77eec3f6d15173603492dbf0da092fad1cf8d8",null),(0,r.A)(h,"0013dd990a4fd5ae9dc9b18689e2cf86c7d50e1314",null),(0,r.A)(y,"005b21d426dd2797e083bac5673b4b9aabe1c75ade",null),(0,r.A)(_,"00189a155a71a524681f0e122f65da9ac99c853dc6",null),(0,r.A)(f,"007b5de81a3a29d4ccfeb6a3a65370aa20aee06084",null),(0,r.A)(N,"40830ed04b7c39ad90603d2b53a88bec1c121db291",null),(0,r.A)(q,"4077bbad020888d931c4288e91e6a3dd851e3cb34a",null)}};
