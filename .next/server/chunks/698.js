"use strict";exports.id=698,exports.ids=[698],exports.modules={26647:(e,t,a)=>{a.d(t,{b:()=>s});var r=a(13913),i=a(8613),n=a(98149),l=a(26763);class s{async create(e){let t=(0,l.Ak)(),[a]=await r.db.insert(i.items).values({...e,id:t}).returning();return a}async findById(e){let[t]=await r.db.select().from(i.items).where((0,n.eq)(i.items.id,e));return t}async searchItems(e){return await r.db.select().from(i.items).where((0,n.eq)(i.items.itemName,e))}async findAll(){return await r.db.select().from(i.items)}async update(e,t){let[a]=await r.db.update(i.items).set(t).where((0,n.eq)(i.items.id,e)).returning();return a}async delete(e){let[t]=await r.db.delete(i.items).where((0,n.eq)(i.items.id,e)).returning();return t}}},36405:(e,t,a)=>{a.d(t,{wz:()=>g,Dm:()=>f,OA:()=>y,Lx:()=>h,y4:()=>p,Mo:()=>w,Fq:()=>b});var r=a(17464);a(55414);var i=a(19541),n=a(14567),l=a(15198),s=a(13913),o=a(8613),d=a(98149);class c{async findByEmail(e){let[t]=await s.db.select().from(o.users).where((0,d.eq)(o.users.email,e));return t}async findById(e){let[t]=await s.db.select().from(o.users).where((0,d.eq)(o.users.id,e));return t}async getPlanColumnOrder(e){let t=await this.findById(e);return t.planColumnOrder?JSON.parse(t.planColumnOrder):null}async getShipmentColumnOrder(e){let t=await this.findById(e);return t.shipmentColumnOrder?JSON.parse(t.shipmentColumnOrder):null}async updatePlanColumnOrder(e,t){let[a]=await s.db.update(o.users).set({planColumnOrder:t}).where((0,d.eq)(o.users.id,e)).returning();return a}async updateShipmentColumnOrder(e,t){let[a]=await s.db.update(o.users).set({shipmentColumnOrder:t}).where((0,d.eq)(o.users.id,e)).returning();return a}async create(e){let[t]=await s.db.insert(o.users).values(e).returning();return t}async delete(e){return await s.db.delete(o.users).where((0,d.eq)(o.users.id,e)),!0}}var u=a(1634);let m=new c;async function h(e){let t=e.get("email"),a=e.get("password");try{let e=await m.findByEmail(t);if(!e||e.password!==a)return{error:"이메일 또는 비밀번호가 올바르지 않습니다."};return(await (0,n.UL)()).set({name:"userId",value:e.id,httpOnly:!0,maxAge:604800,path:"/"}),{success:!0}}catch(e){return console.error("Login error:",e),{error:"로그인 중 오류가 발생했습니다."}}}async function p(){(await (0,n.UL)()).delete("userId"),(0,l.redirect)("/login")}async function g(){let e=await (0,n.UL)(),t=e.get("userId")?.value;return t?m.findById(t):null}async function f(){let e=await (0,n.UL)(),t=e.get("userId")?.value;return t?await m.getPlanColumnOrder(t):[]}async function y(){let e=await (0,n.UL)(),t=e.get("userId")?.value;return t?await m.getShipmentColumnOrder(t):[]}async function w(e){let t=await (0,n.UL)(),a=t.get("userId")?.value;if(!a)return{error:"로그인이 필요합니다."};try{return await m.updatePlanColumnOrder(a,JSON.stringify(e)),(0,i.revalidatePath)("/"),{success:!0}}catch(e){return console.error("컬럼 순서 저장 오류:",e),{error:"컬럼 순서를 저장하는 중 오류가 발생했습니다."}}}async function b(e){let t=await (0,n.UL)(),a=t.get("userId")?.value;if(!a)return{error:"로그인이 필요합니다."};try{return await m.updateShipmentColumnOrder(a,JSON.stringify(e)),(0,i.revalidatePath)("/"),{success:!0}}catch(e){return console.error("컬럼 순서 저장 오류:",e),{error:"컬럼 순서를 저장하는 중 오류가 발생했습니다."}}}(0,u.D)([h,p,g,f,y,w,b]),(0,r.A)(h,"40d0eae169c34be33be197a140e6f5d424fbe452aa",null),(0,r.A)(p,"00838c01ffaa6b154adc75d53878d6de7425b30f47",null),(0,r.A)(g,"009fbeacdf290a3a185d1a5b6ff8f74907ee1401d6",null),(0,r.A)(f,"00d4d518275a352e9acfa900a39fd2149555101b4b",null),(0,r.A)(y,"00c5ff540788186748639db7b8b243f1d54c82fed2",null),(0,r.A)(w,"40e6bc2921dd5c24f95351bcba63042c63011b307e",null),(0,r.A)(b,"400332ec8182b18eb201c8e354a4b9c27b81f292a4",null)},42623:(e,t,a)=>{a.d(t,{R8:()=>r,gt:()=>n,ye:()=>i});let r=e=>e.value?new Date(e.value).toLocaleDateString("ko-KR",{year:"numeric",month:"long",day:"numeric"}):"",i=e=>e.value?new Intl.NumberFormat("ko-KR",{style:"currency",currency:"KRW"}).format(e.value):"",n=e=>e.value?new Intl.NumberFormat("ko-KR",{style:"currency",currency:"KRW",minimumFractionDigits:0,maximumFractionDigits:0}).format(e.value)+"/kg":""},53295:(e,t,a)=>{a.d(t,{A:()=>i});var r=a(11417);let i=function(e){let t=(0,r.useRef)([]);return{onDragStarted:e=>{t.current=e.api.getColumnState().map(e=>e.colId)},onDragStopped:a=>{let r=a.api.getColumnState().map(e=>e.colId).filter(e=>"detail"!==e);t.current.every((e,t)=>e===r[t])||e(a)}}}},53341:(e,t,a)=>{a.d(t,{A:()=>g,t:()=>h});var r=a(11432),i=a(11417),n=a(26093),l=a(38762),s=a(98194),o=a(10320),d=a(97136),c=a(71251),u=a.n(c),m=a(29871);s.syG.registerModules([s.JKr]);let h=e=>(0,r.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,r.jsx)(u(),{href:`/detail/${e.data.id}`,className:"inline-block px-4 py-1.5 bg-[#22C55E] text-white rounded-lg hover:bg-[#16A34A] transition-colors text-sm font-medium text-center",children:"상세보기"})});function p(e){return new Date(e).toISOString().slice(0,10)}function g({columnDefs:e,data:t,loading:a=!1,error:s=null,onDragStarted:c,onDragStopped:u,onResetColumnOrder:h,onSelectionChanged:g,searchDateField:f}){let[y,w]=(0,i.useState)(""),[b,C]=(0,i.useState)(""),[v,N]=(0,i.useState)(""),[x,P]=(0,i.useState)(!1),[D,F]=(0,i.useState)(!1),A=(0,i.useRef)(null),S=(0,i.useMemo)(()=>({sortable:!0,resizable:!0,minWidth:100,filter:!0,lockPinned:!0}),[]),T=(0,i.useMemo)(()=>e.filter(e=>e.field).map(e=>({colId:e.field,pinned:e.pinned,flex:e.flex,width:e.width,lockPinned:e.lockPinned})),[e]),I=(0,i.useMemo)(()=>l.z0,[]),j=(0,i.useMemo)(()=>t.filter(t=>{let a=!y||e.some(e=>{let a=e.field;if(!a)return!1;let r=t[a];return r&&r.toString().toLowerCase().includes(y.toLowerCase())});if(f){let e=p(t[f]),r=b?p(b):null,i=v?p(v):null;if(r&&i)return a&&e>=r&&e<=i;if(r)return a&&e>=r;if(i)return a&&e<=i}return a}),[t,y,b,v,e,f]),R=(0,i.useCallback)(e=>{A.current=e.api,A.current?.applyColumnState({state:T,applyOrder:!0})},[T]);return s?(0,r.jsx)("div",{className:"w-full h-[800px] bg-white flex items-center justify-center",children:(0,r.jsx)("p",{className:"text-red-500",children:s})}):(0,r.jsxs)("div",{className:"flex flex-col md:flex-row w-full h-[800px] bg-slate-50 rounded-xl overflow-hidden shadow-lg p-6 gap-6",children:[(0,r.jsxs)("button",{onClick:()=>P(!x),className:"md:hidden flex items-center justify-center gap-2 mb-4 px-4 py-2 bg-white rounded-lg shadow-sm text-gray-700 hover:bg-gray-50 transition-colors",children:[(0,r.jsx)(o.A,{className:"w-5 h-5"}),(0,r.jsxs)("span",{children:["필터 ",x?"숨기기":"보기"]})]}),(0,r.jsxs)("div",{className:`relative transition-all duration-300 p-6 space-y-6
        ${x?"block":"hidden md:block"}
        ${D?"w-12 bg-slate-50":"w-full md:w-80 bg-white rounded-xl shadow-sm"}
        md:shrink-0 overflow-hidden`,children:[(0,r.jsx)("button",{onClick:()=>F(e=>!e),className:"absolute right-2 top-2 w-8 h-8 bg-gray-200 text-gray-600 rounded-full shadow-md hover:bg-gray-300 transition z-10 hidden md:block",children:D?">":"<"}),!D&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-gray-800 mb-4",children:"필터"}),(0,r.jsxs)("div",{className:"space-y-5",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-600 mb-2",children:"검색어"}),(0,r.jsx)("input",{type:"text",placeholder:"검색어를 입력하세요",className:"w-full px-4 py-2.5 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200",value:y,onChange:e=>w(e.target.value)})]}),f&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-600 mb-2",children:"조회 기간"}),(0,r.jsx)("input",{type:"date",className:"w-full px-4 py-2.5 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 mb-3",value:b,onChange:e=>C(e.target.value)}),(0,r.jsx)("input",{type:"date",className:"w-full px-4 py-2.5 bg-gray-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200",value:v,onChange:e=>N(e.target.value)})]}),h&&(0,r.jsxs)("button",{onClick:h,className:"w-full flex items-center justify-center gap-2 px-4 py-2.5 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:[(0,r.jsx)(d.A,{className:"w-5 h-5"}),(0,r.jsx)("span",{children:"컬럼 순서 초기화"})]})]})]})]}),(0,r.jsx)("div",{className:"flex-1 bg-white rounded-xl shadow-sm overflow-hidden min-h-[400px]",children:a?(0,r.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("div",{className:"w-3 h-3 bg-[#22C55E] rounded-full animate-bounce"}),(0,r.jsx)("div",{className:"w-3 h-3 bg-[#22C55E] rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),(0,r.jsx)("div",{className:"w-3 h-3 bg-[#22C55E] rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})}):(0,r.jsx)("div",{className:"w-full h-full",children:(0,r.jsx)(n.W6,{theme:m.g,rowData:j,columnDefs:e,defaultColDef:S,pagination:!0,paginationPageSize:15,rowSelection:"multiple",localeText:I,onDragStarted:c,onDragStopped:u,onGridReady:R,onSelectionChanged:g})})})]})}},61839:(e,t,a)=>{a.d(t,{FX:()=>s,cX:()=>n,mg:()=>l,zG:()=>i});var r=a(42623);let i=[{field:"contractNumber",headerName:"계약 번호",width:130},{field:"progressStatus",headerName:"진행 상태",width:100},{field:"contractDate",headerName:"계약일자",valueFormatter:r.R8,width:150},{field:"exporter",headerName:"공급업체",width:120},{field:"importer",headerName:"수입회사",width:120},{field:"estimatedTimeArrival",headerName:"ETA",valueFormatter:r.R8,width:150},{field:"arrivalPort",headerName:"도착항",width:120},{field:"itemName",headerName:"품목",width:120},{field:"contractTon",headerName:"무게",valueFormatter:e=>`${e.value}톤`,width:100},{field:"unitPrice",headerName:"단가",valueFormatter:r.ye,width:130},{field:"totalPrice",headerName:"단가 * 무게",valueFormatter:r.ye,width:150},{field:"paymentMethod",headerName:"결제방식",width:100},{field:"warehouseEntryDate",headerName:"입고일",valueFormatter:r.R8,width:150},{field:"importCostPerKg",headerName:"수입가/kg",valueFormatter:r.gt,width:130},{field:"supplyCostPerKg",headerName:"수급가/kg",valueFormatter:r.gt,width:130},{field:"totalCost",headerName:"총 비용",valueFormatter:r.ye,width:150},{field:"totalCostPerKg",headerName:"총 비용/kg",valueFormatter:r.gt,width:130},{field:"sellingPrice",headerName:"판매가",valueFormatter:r.ye,width:130},{field:"margin",headerName:"마진",valueFormatter:r.ye,width:100},{field:"totalProfit",headerName:"총 이익",valueFormatter:r.ye,width:150}],n=[{field:"contractNumber",headerName:"계약 번호",width:130},{field:"progressStatus",headerName:"진행 상태",width:100},{field:"contractDate",headerName:"계약일자",valueFormatter:r.R8,width:150},{field:"importer",headerName:"수입회사",width:120},{field:"productName",headerName:"제품명",width:150},{field:"itemName",headerName:"품목",width:120},{field:"weight",headerName:"무게",valueFormatter:e=>`${e.value}톤`,width:100},{field:"containerCount",headerName:"컨테이너 개수",width:120},{field:"packingUnit",headerName:"포장 단위",width:100},{field:"unitPrice",headerName:"단가",valueFormatter:r.ye,width:130},{field:"totalPrice",headerName:"단가 * 무게",valueFormatter:r.ye,width:150},{field:"supplyPrice",headerName:"수급가",valueFormatter:r.ye,width:130},{field:"sellingPrice",headerName:"판매가",valueFormatter:r.ye,width:130},{field:"paymentMethod",headerName:"결제방식",width:100},{field:"hsCode",headerName:"HS CODE",width:120},{field:"blNumber",headerName:"BL no.",width:120},{field:"departurePort",headerName:"port(출발항)",width:120},{field:"etd",headerName:"ETD",valueFormatter:r.R8,width:150},{field:"arrivalPort",headerName:"port(도착항)",width:120},{field:"eta",headerName:"ETA",valueFormatter:r.R8,width:150},{field:"exporter",headerName:"공급업체",width:120},{field:"customsDate",headerName:"통관일자",valueFormatter:r.R8,width:150}],l=i.map(e=>e.field),s=n.map(e=>e.field)},70954:(e,t,a)=>{a.d(t,{s:()=>d});var r=a(10854);class i{calculate(e,t){let a=e.contractorCost*(1+t.purchaseFeeRate/100),r=(a-e.contractorCost)*t.contractTon*1e3,i=a*t.contractTon*1e3+t.shippingCost+t.laborCost+t.transportStorageFee+t.loadingUnloadingFee,n=t.sellingPrice-i/t.contractTon/1e3,l=n*t.contractTon*1e3;return{supplyPrice:a,contractorProfit:r,totalCost:i,margin:n,totalProfit:l}}}class n{calculate(e,t){let a=(e.contractorCostAmount+t.shippingCost+t.laborCost+t.transportStorageFee+t.loadingUnloadingFee+t.usanceInterest)/t.contractTon/1e3*(1+t.purchaseFeeRate/100),r=(a-e.contractorCost)*t.contractTon*1e3,i=a*t.contractTon*1e3,n=t.sellingPrice-i/t.contractTon/1e3,l=n*t.contractTon*1e3;return{supplyPrice:a,contractorProfit:r,totalCost:i,margin:n,totalProfit:l}}}class l{calculate(e,t){let a=e.contractorCost*(1+t.purchaseFeeRate/100),r=(a-e.contractorCost)*t.contractTon*1e3,i=a*t.contractTon*1e3+t.shippingCost+t.laborCost+t.transportStorageFee+t.loadingUnloadingFee,n=t.sellingPrice-i/t.contractTon/1e3,l=n*t.contractTon*1e3;return{supplyPrice:a,contractorProfit:r,totalCost:i,margin:n,totalProfit:l}}}class s{static createStrategy(e){if(!e)return new i;switch(e.calculationType){case r.A.STANDARD:return new i;case r.A.DNB:return new n;case r.A.NAMHAE:return new l;default:return new i}}}class o{constructor(e){this.data=e,this.calculationStrategy=s.createStrategy(e.importer),this.calculatedValues=this.calculateValues()}calculateValues(){let e=this.data.costDetail.unitPrice||0,t=this.data.costDetail.exchangeRate||0,a=this.data.cargo.contractTon||0,r=this.data.cargo.sellingPrice||0,i=this.data.cargo.purchaseFeeRate||0,n=Math.floor(e*t*a),l=e*t/1e3,s=n+(this.data.costDetail.customTaxAmount||0)+(this.data.costDetail.transferFee||0)+(this.data.costDetail.customsFee||0)+(this.data.costDetail.inspectionFee||0)+(this.data.costDetail.doCharge||0)+(this.data.costDetail.otherCosts||0),o=s/a/1e3,d=this.calculationStrategy.calculate({contractorCostAmount:s,costPerKg:l,totalContractPrice:n,contractorCost:o},{contractTon:a,sellingPrice:r,purchaseFeeRate:i,shippingCost:this.data.cost.shippingCost||0,laborCost:this.data.cost.laborCost||0,transportStorageFee:this.data.cost.transportStorageFee||0,loadingUnloadingFee:this.data.cost.loadingUnloadingFee||0,usanceInterest:this.data.cost.usanceInterest||0});return{supplyPrice:d.supplyPrice,margin:d.margin,totalProfit:d.totalProfit,totalContractPrice:n,costPerKg:l,contractorCost:o,contractorProfit:d.contractorProfit,totalCost:d.totalCost}}mapItem(e){return{id:e.id,itemName:e.itemName||"",itemVariety:e.itemVariety||"",originCountry:e.originCountry||"",hsCode:e.hsCode||"",packingUnit:e.packingUnit||""}}mapShipment(e){return{id:e.id,estimatedTimeArrival:e.estimatedTimeArrival||"",estimatedTimeDeparture:e.estimatedTimeDeparture||"",arrivalPort:e.arrivalPort||"",departurePort:e.departurePort||"",blNumber:e.blNumber||"",palletOrderDate:e.palletOrderDate||"",palletType:e.palletType||"",shippingCompany:e.shippingCompany||"",contractId:e.contractId||""}}mapContract(e,t,a){return{id:e.id,incoterms:e.incoterms||"",contractNumber:e.contractNumber||"",contractDate:e.contractDate||"",exporter:e.exporter||"",importerId:e.importerId||"",departurePort:t.departurePort||"",arrivalPort:t.arrivalPort||"",estimatedTimeDeparture:t.estimatedTimeDeparture||"",estimatedTimeArrival:t.estimatedTimeArrival||"",blNumber:t.blNumber||"",importerName:a?.importerName||""}}mapPayment(e){return{id:e.id,paymentDueDate:e.paymentDueDate||"",paymentMethod:e.paymentMethod||"",contractId:e.contractId,advancePaymentDate:e.advancePaymentDate||"",advancePaymentRatio:e.advancePaymentRatio||0,advancePaymentAmount:e.advancePaymentAmount||0,remainingPaymentDate:e.remainingPaymentDate||"",remainingPaymentRatio:e.remainingPaymentRatio||0,remainingPaymentAmount:e.remainingPaymentAmount||0,counterpartBank:e.counterpartBank||"",paymentTerm:e.paymentTerm||"",totalContractAmount:this.calculatedValues.totalContractPrice}}mapAndCalculateCostDetail(e){return{id:e.id,unitPrice:e.unitPrice||0,totalContractPrice:this.calculatedValues.totalContractPrice,exchangeRate:e.exchangeRate||0,costPerKg:this.calculatedValues.costPerKg,costId:e.costId,customTaxAmount:e.customTaxAmount||0,customsTaxRate:e.customsTaxRate||0,customsFee:e.customsFee||0,inspectionFee:e.inspectionFee||0,doCharge:e.doCharge||0,otherCosts:e.otherCosts||0,transferFee:e.transferFee||0}}mapAndCalculateContractAmount(e,t){return{id:t.id,cargoId:t.cargoId,contractorCost:this.calculatedValues.contractorCost,supplyPrice:this.calculatedValues.supplyPrice,contractorProfit:this.calculatedValues.contractorProfit,shippingCost:t.shippingCost||0,laborCost:t.laborCost||0,transportStorageFee:t.transportStorageFee||0,loadingUnloadingFee:t.loadingUnloadingFee||0,usanceInterest:t.usanceInterest||0}}mapAndCalculateExpense(e){return{id:e.id,itemsId:e.itemsId,shipmentId:e.shipmentId,containerCount:e.containerCount,contractTon:e.contractTon,customsClearanceDate:e.customsClearanceDate,quarantineDate:e.quarantineDate,warehouseEntryDate:e.warehouseEntryDate,progressStatus:e.progressStatus,totalCost:this.calculatedValues.totalCost,sellingPrice:e.sellingPrice||0,sellingPriceWholesale:e.sellingPriceWholesale||0,sellingPriceRetail:e.sellingPriceRetail||0,margin:this.calculatedValues.margin,totalProfit:this.calculatedValues.totalProfit,purchaseFeeRate:e.purchaseFeeRate,remark:e.remark}}calculate(){return{importer:this.data.importer,contract:this.mapContract(this.data.contract,this.data.shipment,this.data.importer),payment:this.mapPayment(this.data.payment),costDetail:this.mapAndCalculateCostDetail(this.data.costDetail),cost:this.mapAndCalculateContractAmount(this.data.cargo,this.data.cost),cargo:this.mapAndCalculateExpense(this.data.cargo),item:this.mapItem(this.data.item),shipment:this.mapShipment(this.data.shipment)}}}function d(e){return new o(e).calculate()}}};
