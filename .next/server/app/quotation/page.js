(()=>{var e={};e.id=259,e.ids=[259],e.modules={511:(e,t,r)=>{"use strict";r.d(t,{default:()=>n});let n=(0,r(73602).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/kang-yean-woo/gompyo/src/containers/quotation/quotation.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/kang-yean-woo/gompyo/src/containers/quotation/quotation.tsx","default")},972:e=>{"use strict";e.exports=import("@react-pdf/renderer")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4638:(e,t,r)=>{"use strict";r.a(e,async(e,n)=>{try{r.d(t,{A:()=>d});var i=r(73407);r(95700);var a=r(972),o=r(33873),l=r.n(o),s=e([a]);(a=(s.then?(await s)():s)[0]).Font.register({family:"NotoSansKR",fonts:[{src:l().join(process.cwd(),"public","fonts","NotoSansKR-Thin.ttf"),fontWeight:100},{src:l().join(process.cwd(),"public","fonts","NotoSansKR-ExtraLight.ttf"),fontWeight:200},{src:l().join(process.cwd(),"public","fonts","NotoSansKR-Light.ttf"),fontWeight:300},{src:l().join(process.cwd(),"public","fonts","NotoSansKR-Regular.ttf"),fontWeight:400},{src:l().join(process.cwd(),"public","fonts","NotoSansKR-Medium.ttf"),fontWeight:500},{src:l().join(process.cwd(),"public","fonts","NotoSansKR-SemiBold.ttf"),fontWeight:600},{src:l().join(process.cwd(),"public","fonts","NotoSansKR-Bold.ttf"),fontWeight:700},{src:l().join(process.cwd(),"public","fonts","NotoSansKR-ExtraBold.ttf"),fontWeight:800},{src:l().join(process.cwd(),"public","fonts","NotoSansKR-Black.ttf"),fontWeight:900}]});let c=a.StyleSheet.create({page:{flexDirection:"column",backgroundColor:"#FFFFFF",padding:30,fontSize:11,fontFamily:"NotoSansKR",minHeight:"100vh"},mainContent:{flex:1,flexDirection:"column"},footer:{marginTop:"auto",paddingTop:20,position:"relative"},header:{textAlign:"center",marginBottom:5,fontFamily:"NotoSansKR"},companyName:{fontSize:24,fontFamily:"NotoSansKR",fontWeight:700,textAlign:"center"},companyInfo:{fontSize:12,lineHeight:1.2,marginBottom:4,fontFamily:"NotoSansKR",fontWeight:400},documentInfo:{fontSize:12,lineHeight:1.6,fontFamily:"NotoSansKR",fontWeight:400},greeting:{textAlign:"center",marginBottom:15,fontSize:11,fontFamily:"NotoSansKR",fontWeight:400},belowText:{textAlign:"center",fontSize:12,fontFamily:"NotoSansKR",fontWeight:700,marginBottom:20},unitInfo:{textAlign:"right",fontSize:10,marginBottom:5,fontFamily:"NotoSansKR",fontWeight:400},divider:{borderBottomWidth:3,borderBottomColor:"#000000",borderBottomStyle:"solid",width:"100%"},divider_thin:{borderBottomWidth:2,borderBottomColor:"#000000",borderBottomStyle:"solid",width:"100%"},table:{width:"100%",borderStyle:"solid",borderWidth:1,borderColor:"#000000",marginBottom:30},tableRow:{margin:"auto",flexDirection:"row",minHeight:25,maxHeight:40},tableColHeader:{borderStyle:"solid",borderWidth:1,borderColor:"#000000",backgroundColor:"#f0f0f0",padding:3,textAlign:"center",minHeight:25},tableCol:{borderStyle:"solid",borderWidth:1,borderColor:"#000000",padding:3,textAlign:"center",minHeight:25,maxHeight:40,overflow:"hidden"},tableColNo:{width:"10%"},tableColProduct:{width:"50%"},tableColPrice:{width:"20%"},tableColNote:{width:"20%"},tableCellHeader:{fontSize:10,fontFamily:"NotoSansKR",fontWeight:700},tableCell:{fontSize:14,fontFamily:"NotoSansKR",fontWeight:600},tableCellLeft:{fontSize:12,fontFamily:"NotoSansKR",fontWeight:600,textAlign:"left",marginLeft:5,lineHeight:1.2,overflow:"hidden"},tableCellRight:{fontSize:14,fontFamily:"NotoSansKR",fontWeight:800,textAlign:"right",marginRight:5},closing:{fontSize:11,fontFamily:"NotoSansKR",fontWeight:400,textAlign:"center",marginBottom:20},footerDate:{fontSize:14,fontFamily:"NotoSansKR",fontWeight:400,textAlign:"center",marginBottom:10},footerCompany:{fontSize:18,fontFamily:"NotoSansKR",fontWeight:400,textAlign:"center",marginBottom:20},stampImage:{position:"absolute",width:60,height:60,right:140,top:30},emptyRow:{height:25},continuationPage:{flexDirection:"column",backgroundColor:"#FFFFFF",padding:30,fontSize:11,fontFamily:"NotoSansKR"},continuationHeader:{textAlign:"center",marginBottom:20,fontSize:16,fontFamily:"NotoSansKR",fontWeight:700}}),u=e=>new Intl.NumberFormat("ko-KR").format(e),m=e=>{let t=[];if(e.length<=15)t.push(e);else{t.push(e.slice(0,15));let r=e.slice(15);for(;r.length>0;)t.push(r.slice(0,25)),r=r.slice(25)}return t},f=({priceType:e})=>(0,i.jsxs)(a.View,{style:c.tableRow,children:[(0,i.jsx)(a.View,{style:[c.tableColHeader,c.tableColNo],children:(0,i.jsx)(a.Text,{style:c.tableCellHeader,children:"NO"})}),(0,i.jsx)(a.View,{style:[c.tableColHeader,c.tableColProduct],children:(0,i.jsx)(a.Text,{style:c.tableCellHeader,children:"품 명"})}),(0,i.jsx)(a.View,{style:[c.tableColHeader,c.tableColPrice],children:(0,i.jsxs)(a.Text,{style:c.tableCellHeader,children:["arrival"===e?"도착도":"상차도"," 원/kg"]})}),(0,i.jsx)(a.View,{style:[c.tableColHeader,c.tableColNote],children:(0,i.jsx)(a.Text,{style:c.tableCellHeader,children:"비고"})})]}),h=({item:e,index:t})=>(0,i.jsxs)(a.View,{style:c.tableRow,children:[(0,i.jsx)(a.View,{style:[c.tableCol,c.tableColNo],children:(0,i.jsx)(a.Text,{style:c.tableCell,children:e.no})}),(0,i.jsx)(a.View,{style:[c.tableCol,c.tableColProduct],children:(0,i.jsx)(a.Text,{style:c.tableCellLeft,children:`${e.name} ${e.originEn} ${e.nameEn}`})}),(0,i.jsx)(a.View,{style:[c.tableCol,c.tableColPrice],children:(0,i.jsx)(a.Text,{style:c.tableCellRight,children:e.price?u(e.price):""})}),(0,i.jsx)(a.View,{style:[c.tableCol,c.tableColNote]})]},t);function d({invoiceData:e}){let{documentNumber:t="GP202401-01",sender:r="㈜ 곰표",receiver:n="",reference:o="",title:s="견적",date:d=new Date().toLocaleDateString("ko-KR"),items:u=[],companyInfo:p={office:"인천광역시 중구 축항대로86번길 70 205호   T.032-888-9686, F.032-888-9685",warehouse:"안산시 단원구 별망로175 금은산업b동2층 T.032-888-9686, F.032-888-9685"},priceType:g="도착도"}=e,y=u.length>0?u:[],b=m(y);return(0,i.jsx)(a.Document,{children:b.map((e,u)=>(0,i.jsxs)(a.Page,{size:"A4",style:c.page,children:[(0,i.jsxs)(a.View,{style:c.mainContent,children:[0===u?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(a.View,{style:c.header,children:(0,i.jsx)(a.Text,{style:c.companyName,children:"㈜ 곰표"})}),(0,i.jsxs)(a.View,{style:c.companyInfo,children:[(0,i.jsxs)(a.Text,{children:["사무실 : ",p.office]}),(0,i.jsxs)(a.Text,{children:["물류창고 : ",p.warehouse]})]}),(0,i.jsx)(a.View,{style:c.divider}),(0,i.jsxs)(a.View,{style:c.documentInfo,children:[(0,i.jsxs)(a.Text,{children:["▷문서번호 : ",t]}),(0,i.jsxs)(a.Text,{children:["▷발 신 : ",r]}),(0,i.jsxs)(a.Text,{children:["▷수 신 : ",n]}),(0,i.jsxs)(a.Text,{children:["▷참 조 : ",o]}),(0,i.jsxs)(a.Text,{children:["▷제 목 : ",s]})]}),(0,i.jsx)(a.View,{style:c.divider_thin}),(0,i.jsx)(a.View,{style:c.greeting,children:(0,i.jsx)(a.Text,{children:"1. 귀사의 일익 번창하심을 진심으로 기원드립니다."})}),(0,i.jsx)(a.View,{style:c.belowText,children:(0,i.jsx)(a.Text,{children:"― 아 래 ―"})}),(0,i.jsx)(a.View,{style:c.unitInfo,children:(0,i.jsx)(a.Text,{children:"단위(원)"})})]}):(0,i.jsx)(a.View,{style:c.continuationHeader,children:(0,i.jsx)(a.Text,{children:"견적서 (계속)"})}),(0,i.jsxs)(a.View,{style:c.table,children:[(0,i.jsx)(f,{priceType:g}),e.map((e,t)=>(0,i.jsx)(h,{item:e,index:t},t))]}),u===b.length-1&&(0,i.jsx)(a.View,{style:c.closing,children:(0,i.jsx)(a.Text,{children:"2. 위 내용에 대해서는 담당자에게 문의하여 주시기 바랍니다."})})]}),u===b.length-1&&(0,i.jsxs)(a.View,{style:c.footer,children:[(0,i.jsx)(a.View,{style:c.footerDate,children:(0,i.jsx)(a.Text,{children:d})}),(0,i.jsx)(a.View,{style:c.footerCompany,children:(0,i.jsx)(a.Text,{children:"주식회사 곰표"})}),(0,i.jsx)(a.Image,{style:c.stampImage,src:l().join(process.cwd(),"public","gompyo_stamp.png")})]})]},u))})}n()}catch(e){n(e)}})},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},15995:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});var n=r(10674),i=r(511);function a(){return(0,n.jsx)(i.default,{})}},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},21037:(e,t,r)=>{"use strict";e.exports=r(68074).style},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33552:(e,t,r)=>{"use strict";r.a(e,async(e,n)=>{try{r.d(t,{A_:()=>C,Bs:()=>u,Dn:()=>y,Er:()=>S,Oc:()=>w,Vt:()=>x,Vz:()=>h,pM:()=>g,ps:()=>b,t4:()=>v,tF:()=>f,vf:()=>p,w1:()=>m});var i=r(17464);r(55414);var a=r(53063),o=r(19541),l=r(972),s=r(4638),d=r(1634),c=e([l,s]);async function u(){try{return await (0,a._0)()}catch(e){throw console.error("getQuotationDataAction error",e),e}}async function m(e){try{await (0,a.yN)(e),(0,o.revalidatePath)("/grid")}catch(e){throw console.error("updateQuotationCellAction error",e),e}}async function f(e){try{let t=await (0,a.P0)(e);return(0,o.revalidatePath)("/grid"),t}catch(e){throw console.error("addQuotationCompanyAction error",e),e}}async function h(e){try{let t=await (0,a.B5)(e);return(0,o.revalidatePath)("/grid"),t}catch(e){throw console.error("addQuotationItemAction error",e),e}}async function p(e){try{await (0,a.RC)(e),(0,o.revalidatePath)("/grid")}catch(e){throw console.error("deleteQuotationCompanyAction error",e),e}}async function g(e){try{await (0,a.LD)(e),(0,o.revalidatePath)("/grid")}catch(e){throw console.error("deleteQuotationItemAction error",e),e}}async function y(e,t){try{let r=await (0,a.JT)(e,{companyName:t.companyName,companyType:t.companyType,priceType:t.priceType});return(0,o.revalidatePath)("/quotation"),r}catch(e){throw console.error("updateCompanyAction error",e),e}}async function b(e,t){try{let r=await (0,a.fk)(e,{itemName:t.itemName,itemOrigin:t.itemOrigin,itemNameEn:t.itemNameEn||null,itemOriginEn:t.itemOriginEn||null});return(0,o.revalidatePath)("/quotation"),r}catch(e){throw console.error("updateItemAction error",e),e}}async function w(){try{return await (0,a.U_)()}catch(e){throw console.error("getCompaniesAction error",e),e}}async function x(){try{return await (0,a.JS)()}catch(e){throw console.error("getItemsAction error",e),e}}async function v(){try{return await (0,a._0)("domestic")}catch(e){throw console.error("getDomesticAction error",e),e}}async function S(){try{return await (0,a._0)("foreign")}catch(e){throw console.error("getForeignerAction error",e),e}}async function C(e){try{let t=(0,s.A)({invoiceData:e}),r=(await (0,l.renderToBuffer)(t)).toString("base64");return{success:!0,pdf:r,filename:`${e.receiver}_견적서_${new Date().toISOString().split("T")[0]}.pdf`}}catch(e){return console.error("PDF 생성 오류:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}[l,s]=c.then?(await c)():c,(0,d.D)([u,m,f,h,p,g,y,b,w,x,v,S,C]),(0,i.A)(u,"0094bebc528d302e8a31420db99eddc8ba703e44bb",null),(0,i.A)(m,"40f749ad93ee75eadf1cc05d8edc5da960aaa830d1",null),(0,i.A)(f,"409a615c018433fa2f101a2a21581937161c0c1ee2",null),(0,i.A)(h,"40505237c0372e88c322fb73731b0cdee4aba64747",null),(0,i.A)(p,"40978e4adc50118fd05fa6dfb16b58a8d80242dea3",null),(0,i.A)(g,"4055fb31d9adee20bd75e8170cbda5f709b74963f8",null),(0,i.A)(y,"60c7bac4156a834f9aa4d6980d87e605630af8d75c",null),(0,i.A)(b,"6048f7069ff341fc5173436274c4b93d2ee114bdd0",null),(0,i.A)(w,"005c5ef54216e7ecc1b79b4016c3a369be059362c9",null),(0,i.A)(x,"006a63e432f2c6417eb080b7cc674ec917982d5390",null),(0,i.A)(v,"008c79e7b09ae4723dd2d6ba4fb1333aff2ab0e31a",null),(0,i.A)(S,"00601584ba4e18e46925a4a924e98d11f979d29c83",null),(0,i.A)(C,"401df350c3b6aa883ddfad7dd5397163bb931bbb49",null),n()}catch(e){n(e)}})},33873:e=>{"use strict";e.exports=require("path")},36046:(e,t,r)=>{Promise.resolve().then(r.bind(r,83426))},36405:(e,t,r)=>{"use strict";r.d(t,{wz:()=>p,Dm:()=>g,_4:()=>b,OA:()=>y,Lx:()=>f,y4:()=>h,Mo:()=>w,V3:()=>v,Fq:()=>x});var n=r(17464);r(55414);var i=r(19541),a=r(14567),o=r(15198),l=r(13913),s=r(8613),d=r(98149);class c{async findByEmail(e){let[t]=await l.db.select().from(s.users).where((0,d.eq)(s.users.email,e));return t}async findById(e){let[t]=await l.db.select().from(s.users).where((0,d.eq)(s.users.id,e));return t}async getPlanColumnOrder(e){let t=await this.findById(e);return t.planColumnOrder?JSON.parse(t.planColumnOrder):null}async getShipmentColumnOrder(e){let t=await this.findById(e);return t.shipmentColumnOrder?JSON.parse(t.shipmentColumnOrder):null}async getQuotationColumnOrder(e){let t=await this.findById(e);return t.quotationColumnOrder?JSON.parse(t.quotationColumnOrder):null}async updatePlanColumnOrder(e,t){let[r]=await l.db.update(s.users).set({planColumnOrder:t}).where((0,d.eq)(s.users.id,e)).returning();return r}async updateShipmentColumnOrder(e,t){let[r]=await l.db.update(s.users).set({shipmentColumnOrder:t}).where((0,d.eq)(s.users.id,e)).returning();return r}async updateQuotationColumnOrder(e,t){let[r]=await l.db.update(s.users).set({quotationColumnOrder:t}).where((0,d.eq)(s.users.id,e)).returning();return r}async create(e){let[t]=await l.db.insert(s.users).values(e).returning();return t}async delete(e){return await l.db.delete(s.users).where((0,d.eq)(s.users.id,e)),!0}}var u=r(1634);let m=new c;async function f(e){let t=e.get("email"),r=e.get("password");try{let e=await m.findByEmail(t);if(!e||e.password!==r)return{error:"이메일 또는 비밀번호가 올바르지 않습니다."};return(await (0,a.UL)()).set({name:"userId",value:e.id,httpOnly:!0,maxAge:604800,path:"/"}),{success:!0}}catch(e){return console.error("Login error:",e),{error:"로그인 중 오류가 발생했습니다."}}}async function h(){(await (0,a.UL)()).delete("userId"),(0,o.redirect)("/login")}async function p(){let e=await (0,a.UL)(),t=e.get("userId")?.value;return t?m.findById(t):null}async function g(){let e=await (0,a.UL)(),t=e.get("userId")?.value;return t?await m.getPlanColumnOrder(t):[]}async function y(){let e=await (0,a.UL)(),t=e.get("userId")?.value;return t?await m.getShipmentColumnOrder(t):[]}async function b(){let e=await (0,a.UL)(),t=e.get("userId")?.value;return t?await m.getQuotationColumnOrder(t):[]}async function w(e){let t=await (0,a.UL)(),r=t.get("userId")?.value;if(!r)return{error:"로그인이 필요합니다."};try{return await m.updatePlanColumnOrder(r,JSON.stringify(e)),(0,i.revalidatePath)("/"),{success:!0}}catch(e){return console.error("컬럼 순서 저장 오류:",e),{error:"컬럼 순서를 저장하는 중 오류가 발생했습니다."}}}async function x(e){let t=await (0,a.UL)(),r=t.get("userId")?.value;if(!r)return{error:"로그인이 필요합니다."};try{return await m.updateShipmentColumnOrder(r,JSON.stringify(e)),(0,i.revalidatePath)("/"),{success:!0}}catch(e){return console.error("컬럼 순서 저장 오류:",e),{error:"컬럼 순서를 저장하는 중 오류가 발생했습니다."}}}async function v(e){let t=await (0,a.UL)(),r=t.get("userId")?.value;if(!r)return{error:"로그인이 필요합니다."};try{return await m.updateQuotationColumnOrder(r,JSON.stringify(e)),(0,i.revalidatePath)("/"),{success:!0}}catch(e){return console.error("컬럼 순서 저장 오류:",e),{error:"컬럼 순서를 저장하는 중 오류가 발생했습니다."}}}(0,u.D)([f,h,p,g,y,b,w,x,v]),(0,n.A)(f,"40936ad88e3f1a4fa4fe1c0dd6aec3e2d65e62a0c1",null),(0,n.A)(h,"0003009d873d621b767ebfb709789f648c231c485b",null),(0,n.A)(p,"0028b4c78e95647dc5a53ee5fba9631161871c02cb",null),(0,n.A)(g,"003fa9301003c8ba05a336e03f03866e45be449bd6",null),(0,n.A)(y,"0030665d1c07fcb4de0143ec72ae810e2dc9ce96e5",null),(0,n.A)(b,"004c7fb7d7ab1c521263cba5f72104bb1b194f1053",null),(0,n.A)(w,"4023a82c0377ba75765752ff21005200097bd8ec35",null),(0,n.A)(x,"404757e7a76cb9b03e2ba3b2fa52f1184db3542cd1",null),(0,n.A)(v,"40f1e18f30af0fbc377817d793409ade21b851dabe",null)},42623:(e,t,r)=>{"use strict";r.d(t,{Kg:()=>s,eg:()=>l,f3:()=>o,gt:()=>a,sg:()=>i,ye:()=>n});let n=e=>e.value?new Intl.NumberFormat("ko-KR",{style:"currency",currency:"KRW"}).format(e.value):"",i=e=>{if(null===e.value||void 0===e.value||""===e.value)return"";let t=Number(e.value);if(isNaN(t))return"";let r=!Number.isInteger(t);return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2*!!r,maximumFractionDigits:2*!!r}).format(t)},a=e=>e.value?new Intl.NumberFormat("ko-KR",{style:"currency",currency:"KRW",minimumFractionDigits:0,maximumFractionDigits:0}).format(e.value)+"/kg":"",o=e=>e.value?new Date(e.value).toLocaleDateString("ko-KR",{month:"long",day:"numeric",weekday:"short"}):"",l=e=>{if(null===e.value||void 0===e.value||""===e.value)return"";let t=Number(e.value);if(isNaN(t))return"";let r=Number(t.toFixed(1));return Number.isInteger(r)?r.toString():r.toFixed(1)},s=e=>{if(!e.value)return"";let t=new Date(e.value),r=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0");return`${r}/${n}/${i}`}},47896:(e,t,r)=>{"use strict";r.a(e,async(e,n)=>{try{r.r(t),r.d(t,{"0003009d873d621b767ebfb709789f648c231c485b":()=>i.y4,"0028b4c78e95647dc5a53ee5fba9631161871c02cb":()=>i.wz,"0030665d1c07fcb4de0143ec72ae810e2dc9ce96e5":()=>i.OA,"003fa9301003c8ba05a336e03f03866e45be449bd6":()=>i.Dm,"004c7fb7d7ab1c521263cba5f72104bb1b194f1053":()=>i._4,"005c5ef54216e7ecc1b79b4016c3a369be059362c9":()=>a.Oc,"00601584ba4e18e46925a4a924e98d11f979d29c83":()=>a.Er,"006a63e432f2c6417eb080b7cc674ec917982d5390":()=>a.Vt,"008c79e7b09ae4723dd2d6ba4fb1333aff2ab0e31a":()=>a.t4,"0094bebc528d302e8a31420db99eddc8ba703e44bb":()=>a.Bs,"401df350c3b6aa883ddfad7dd5397163bb931bbb49":()=>a.A_,"4023a82c0377ba75765752ff21005200097bd8ec35":()=>i.Mo,"404757e7a76cb9b03e2ba3b2fa52f1184db3542cd1":()=>i.Fq,"40505237c0372e88c322fb73731b0cdee4aba64747":()=>a.Vz,"4055fb31d9adee20bd75e8170cbda5f709b74963f8":()=>a.pM,"40936ad88e3f1a4fa4fe1c0dd6aec3e2d65e62a0c1":()=>i.Lx,"40978e4adc50118fd05fa6dfb16b58a8d80242dea3":()=>a.vf,"409a615c018433fa2f101a2a21581937161c0c1ee2":()=>a.tF,"40f1e18f30af0fbc377817d793409ade21b851dabe":()=>i.V3,"40f749ad93ee75eadf1cc05d8edc5da960aaa830d1":()=>a.w1,"6048f7069ff341fc5173436274c4b93d2ee114bdd0":()=>a.ps,"60c7bac4156a834f9aa4d6980d87e605630af8d75c":()=>a.Dn});var i=r(36405),a=r(33552),o=e([a]);a=(o.then?(await o)():o)[0],n()}catch(e){n(e)}})},53063:(e,t,r)=>{"use strict";r.d(t,{B5:()=>d,JS:()=>f,JT:()=>p,LD:()=>u,P0:()=>s,RC:()=>c,U_:()=>m,_0:()=>h,fk:()=>g,yN:()=>l});var n=r(13913),i=r(8613),a=r(98149),o=r(26763);async function l(e){try{let{itemId:t,companyId:r,value:l}=e;(await n.db.select().from(i.quotationCompaniesItems).where((0,a.Uo)((0,a.eq)(i.quotationCompaniesItems.itemId,t),(0,a.eq)(i.quotationCompaniesItems.companyId,r))).limit(1)).length>0?await n.db.update(i.quotationCompaniesItems).set({value:l,updatedAt:new Date().toISOString()}).where((0,a.Uo)((0,a.eq)(i.quotationCompaniesItems.itemId,t),(0,a.eq)(i.quotationCompaniesItems.companyId,r))):await n.db.insert(i.quotationCompaniesItems).values({id:(0,o.Ak)(),itemId:t,companyId:r,value:l,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()})}catch(e){throw console.error("그리드 셀 업데이트 실패:",e),Error("데이터 업데이트에 실패했습니다.")}}async function s(e){try{return await n.db.insert(i.quotationCompanies).values(e),e}catch(e){throw console.error("회사 추가 실패:",e),Error("회사 추가에 실패했습니다.")}}async function d(e){try{return await n.db.insert(i.quotationItems).values(e),e}catch(e){throw console.error("품목 추가 실패:",e),Error("품목 추가에 실패했습니다.")}}async function c(e){try{await n.db.delete(i.quotationCompanies).where((0,a.eq)(i.quotationCompanies.id,e))}catch(e){throw console.error("회사 삭제 실패:",e),Error("회사 삭제에 실패했습니다.")}}async function u(e){try{await n.db.delete(i.quotationItems).where((0,a.eq)(i.quotationItems.id,e))}catch(e){throw console.error("품목 삭제 실패:",e),Error("품목 삭제에 실패했습니다.")}}async function m(e){let t=n.db.select().from(i.quotationCompanies).orderBy(i.quotationCompanies.companyName);return e?await t.where((0,a.eq)(i.quotationCompanies.companyType,e)):await t}async function f(e){if(!e)return await n.db.select().from(i.quotationItems).orderBy(i.quotationItems.itemName);let t=(await m(e)).map(e=>e.id);if(0===t.length)return[];let r=n.db.selectDistinct({itemId:i.quotationCompaniesItems.itemId}).from(i.quotationCompaniesItems).where(1===t.length?(0,a.eq)(i.quotationCompaniesItems.companyId,t[0]):(0,a.RV)(i.quotationCompaniesItems.companyId,t)),o=(await r).map(e=>e.itemId);return 0===o.length?[]:await n.db.select().from(i.quotationItems).where(1===o.length?(0,a.eq)(i.quotationItems.id,o[0]):(0,a.RV)(i.quotationItems.id,o)).orderBy(i.quotationItems.itemName)}async function h(e){try{if(!e)return{items:[],companies:[],priceData:{}};let t=await m(e),r=t.map(e=>e.id);if(0===r.length)return{items:[],companies:[],priceData:{}};let o=await f(e),l=o.map(e=>e.id);if(0===l.length)return{items:[],companies:[],priceData:{}};let s=await n.db.select().from(i.quotationCompaniesItems).where(1===r.length?(0,a.eq)(i.quotationCompaniesItems.companyId,r[0]):(0,a.RV)(i.quotationCompaniesItems.companyId,r)),d={};return t.forEach(e=>{d[e.id]={}}),s.forEach(e=>{null!==e.value&&(d[e.companyId]||(d[e.companyId]={}),d[e.companyId][e.itemId]=e.value)}),{items:o,companies:t,priceData:d}}catch(e){throw console.error("getQuotationRelations error",e),Error("견적 관계 데이터 조회에 실패했습니다.")}}async function p(e,t){try{await n.db.update(i.quotationCompanies).set({...t,updatedAt:new Date().toISOString()}).where((0,a.eq)(i.quotationCompanies.id,e));let r=await n.db.select().from(i.quotationCompanies).where((0,a.eq)(i.quotationCompanies.id,e)).limit(1);if(0===r.length)throw Error("업데이트된 회사를 찾을 수 없습니다.");return r[0]}catch(e){throw console.error("회사 업데이트 실패:",e),Error("회사 정보 업데이트에 실패했습니다.")}}async function g(e,t){try{await n.db.update(i.quotationItems).set({...t,updatedAt:new Date().toISOString()}).where((0,a.eq)(i.quotationItems.id,e));let r=await n.db.select().from(i.quotationItems).where((0,a.eq)(i.quotationItems.id,e)).limit(1);if(0===r.length)throw Error("업데이트된 품목을 찾을 수 없습니다.");return r[0]}catch(e){throw console.error("품목 업데이트 실패:",e),Error("품목 정보 업데이트에 실패했습니다.")}}},53295:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});var n=r(11417);let i=function(e){let t=(0,n.useRef)([]);return{onDragStarted:e=>{t.current=e.api.getColumnState().map(e=>e.colId)},onDragStopped:r=>{let n=r.api.getColumnState().map(e=>e.colId).filter(e=>"detail"!==e);t.current.every((e,t)=>e===n[t])||e(r)}}}},61839:(e,t,r)=>{"use strict";r.d(t,{FX:()=>l,Jd:()=>s,cX:()=>a,mg:()=>o,zG:()=>i});var n=r(42623);let i=[{field:"contractNumber",headerName:"계약 번호",width:130},{field:"progressStatus",headerName:"진행 상태",width:100},{field:"contractDate",headerName:"계약일자",valueFormatter:n.Kg,width:150},{field:"exporter",headerName:"공급업체",width:120},{field:"importer",headerName:"수입회사",width:120},{field:"estimatedTimeArrival",headerName:"ETA",valueFormatter:n.Kg,width:150},{field:"arrivalPort",headerName:"도착항",width:120},{field:"itemName",headerName:"품목",width:120},{field:"contractTon",headerName:"무게",valueFormatter:e=>`${e.value}톤`,width:100},{field:"packingUnit",headerName:"포장 단위",width:130},{field:"unitPrice",headerName:"단가",valueFormatter:n.sg,width:130},{field:"totalPriceUsd",headerName:"단가 * 톤수",valueFormatter:n.sg,width:150},{field:"paymentMethod",headerName:"결제방식",width:100},{field:"warehouseEntryDate",headerName:"입고일",valueFormatter:n.Kg,width:150},{field:"importCostPerKg",headerName:"수입가/kg",valueFormatter:n.gt,width:130},{field:"supplyCostPerKg",headerName:"수급가/kg",valueFormatter:n.gt,width:130},{field:"totalCost",headerName:"총 비용",valueFormatter:n.ye,width:150},{field:"totalCostPerKg",headerName:"총 비용/kg",valueFormatter:n.gt,width:130},{field:"sellingPrice",headerName:"판매가",valueFormatter:n.ye,width:130},{field:"margin",headerName:"마진",valueFormatter:n.ye,width:100},{field:"totalProfit",headerName:"총 이익",valueFormatter:n.ye,width:150}],a=[{field:"contractNumber",headerName:"계약 번호",width:130},{field:"progressStatus",headerName:"진행 상태",width:100},{field:"contractDate",headerName:"계약일자",valueFormatter:n.Kg,width:150},{field:"importer",headerName:"수입회사",width:120},{field:"productName",headerName:"품종",width:150},{field:"itemName",headerName:"품목",width:120},{field:"weight",headerName:"무게",valueFormatter:e=>`${e.value}톤`,width:100},{field:"containerCount",headerName:"컨테이너 개수",width:120},{field:"packingUnit",headerName:"포장 단위",width:100},{field:"unitPrice",headerName:"단가",valueFormatter:n.sg,width:130},{field:"totalPriceUsd",headerName:"단가 * 톤수",valueFormatter:n.sg,width:150},{field:"supplyPrice",headerName:"수급가",valueFormatter:n.ye,width:130},{field:"sellingPrice",headerName:"판매가",valueFormatter:n.ye,width:130},{field:"paymentMethod",headerName:"결제방식",width:100},{field:"hsCode",headerName:"HS CODE",width:120},{field:"blNumber",headerName:"BL no.",width:120},{field:"departurePort",headerName:"port(출발항)",width:120},{field:"etd",headerName:"ETD",valueFormatter:n.Kg,width:150},{field:"arrivalPort",headerName:"port(도착항)",width:120},{field:"eta",headerName:"ETA",valueFormatter:n.Kg,width:150},{field:"exporter",headerName:"공급업체",width:120},{field:"customsDate",headerName:"통관일자",valueFormatter:n.Kg,width:150}],o=i.map(e=>({field:e.field,width:e.width||100})),l=a.map(e=>({field:e.field,width:e.width||100})),s=[{field:"companyColumnName",width:150}]},62814:()=>{},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},66310:(e,t,r)=>{Promise.resolve().then(r.bind(r,511))},68074:(e,t,r)=>{"use strict";r(62814);var n=r(11417),i=function(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}(n),a="undefined"!=typeof process&&process.env&&!0,o=function(e){return"[object String]"===Object.prototype.toString.call(e)},l=function(){function e(e){var t=void 0===e?{}:e,r=t.name,n=void 0===r?"stylesheet":r,i=t.optimizeForSpeed,l=void 0===i?a:i;s(o(n),"`name` must be a string"),this._name=n,this._deletedRulePlaceholder="#"+n+"-deleted-rule____{}",s("boolean"==typeof l,"`optimizeForSpeed` must be a boolean"),this._optimizeForSpeed=l,this._serverSheet=void 0,this._tags=[],this._injected=!1,this._rulesCount=0,this._nonce=null}var t=e.prototype;return t.setOptimizeForSpeed=function(e){s("boolean"==typeof e,"`setOptimizeForSpeed` accepts a boolean"),s(0===this._rulesCount,"optimizeForSpeed cannot be when rules have already been inserted"),this.flush(),this._optimizeForSpeed=e,this.inject()},t.isOptimizeForSpeed=function(){return this._optimizeForSpeed},t.inject=function(){var e=this;s(!this._injected,"sheet already injected"),this._injected=!0,this._serverSheet={cssRules:[],insertRule:function(t,r){return"number"==typeof r?e._serverSheet.cssRules[r]={cssText:t}:e._serverSheet.cssRules.push({cssText:t}),r},deleteRule:function(t){e._serverSheet.cssRules[t]=null}}},t.getSheetForTag=function(e){if(e.sheet)return e.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===e)return document.styleSheets[t]},t.getSheet=function(){return this.getSheetForTag(this._tags[this._tags.length-1])},t.insertRule=function(e,t){return s(o(e),"`insertRule` accepts only strings"),"number"!=typeof t&&(t=this._serverSheet.cssRules.length),this._serverSheet.insertRule(e,t),this._rulesCount++},t.replaceRule=function(e,t){this._optimizeForSpeed;var r=this._serverSheet;if(t.trim()||(t=this._deletedRulePlaceholder),!r.cssRules[e])return e;r.deleteRule(e);try{r.insertRule(t,e)}catch(n){a||console.warn("StyleSheet: illegal rule: \n\n"+t+"\n\nSee https://stackoverflow.com/q/20007992 for more info"),r.insertRule(this._deletedRulePlaceholder,e)}return e},t.deleteRule=function(e){this._serverSheet.deleteRule(e)},t.flush=function(){this._injected=!1,this._rulesCount=0,this._serverSheet.cssRules=[]},t.cssRules=function(){return this._serverSheet.cssRules},t.makeStyleTag=function(e,t,r){t&&s(o(t),"makeStyleTag accepts only strings as second parameter");var n=document.createElement("style");this._nonce&&n.setAttribute("nonce",this._nonce),n.type="text/css",n.setAttribute("data-"+e,""),t&&n.appendChild(document.createTextNode(t));var i=document.head||document.getElementsByTagName("head")[0];return r?i.insertBefore(n,r):i.appendChild(n),n},function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(e.prototype,[{key:"length",get:function(){return this._rulesCount}}]),e}();function s(e,t){if(!e)throw Error("StyleSheet: "+t+".")}var d=function(e){for(var t=5381,r=e.length;r;)t=33*t^e.charCodeAt(--r);return t>>>0},c={};function u(e,t){if(!t)return"jsx-"+e;var r=String(t),n=e+r;return c[n]||(c[n]="jsx-"+d(e+"-"+r)),c[n]}function m(e,t){var r=e+(t=t.replace(/\/style/gi,"\\/style"));return c[r]||(c[r]=t.replace(/__jsx-style-dynamic-selector/g,e)),c[r]}var f=function(){function e(e){var t=void 0===e?{}:e,r=t.styleSheet,n=void 0===r?null:r,i=t.optimizeForSpeed,a=void 0!==i&&i;this._sheet=n||new l({name:"styled-jsx",optimizeForSpeed:a}),this._sheet.inject(),n&&"boolean"==typeof a&&(this._sheet.setOptimizeForSpeed(a),this._optimizeForSpeed=this._sheet.isOptimizeForSpeed()),this._fromServer=void 0,this._indices={},this._instancesCounts={}}var t=e.prototype;return t.add=function(e){var t=this;void 0===this._optimizeForSpeed&&(this._optimizeForSpeed=Array.isArray(e.children),this._sheet.setOptimizeForSpeed(this._optimizeForSpeed),this._optimizeForSpeed=this._sheet.isOptimizeForSpeed());var r=this.getIdAndRules(e),n=r.styleId,i=r.rules;if(n in this._instancesCounts){this._instancesCounts[n]+=1;return}var a=i.map(function(e){return t._sheet.insertRule(e)}).filter(function(e){return -1!==e});this._indices[n]=a,this._instancesCounts[n]=1},t.remove=function(e){var t=this,r=this.getIdAndRules(e).styleId;if(function(e,t){if(!e)throw Error("StyleSheetRegistry: "+t+".")}(r in this._instancesCounts,"styleId: `"+r+"` not found"),this._instancesCounts[r]-=1,this._instancesCounts[r]<1){var n=this._fromServer&&this._fromServer[r];n?(n.parentNode.removeChild(n),delete this._fromServer[r]):(this._indices[r].forEach(function(e){return t._sheet.deleteRule(e)}),delete this._indices[r]),delete this._instancesCounts[r]}},t.update=function(e,t){this.add(t),this.remove(e)},t.flush=function(){this._sheet.flush(),this._sheet.inject(),this._fromServer=void 0,this._indices={},this._instancesCounts={}},t.cssRules=function(){var e=this,t=this._fromServer?Object.keys(this._fromServer).map(function(t){return[t,e._fromServer[t]]}):[],r=this._sheet.cssRules();return t.concat(Object.keys(this._indices).map(function(t){return[t,e._indices[t].map(function(e){return r[e].cssText}).join(e._optimizeForSpeed?"":"\n")]}).filter(function(e){return!!e[1]}))},t.styles=function(e){var t,r;return t=this.cssRules(),void 0===(r=e)&&(r={}),t.map(function(e){var t=e[0],n=e[1];return i.default.createElement("style",{id:"__"+t,key:"__"+t,nonce:r.nonce?r.nonce:void 0,dangerouslySetInnerHTML:{__html:n}})})},t.getIdAndRules=function(e){var t=e.children,r=e.dynamic,n=e.id;if(r){var i=u(n,r);return{styleId:i,rules:Array.isArray(t)?t.map(function(e){return m(i,e)}):[m(i,t)]}}return{styleId:u(n),rules:Array.isArray(t)?t:[t]}},t.selectFromServer=function(){return Array.prototype.slice.call(document.querySelectorAll('[id^="__jsx-"]')).reduce(function(e,t){return e[t.id.slice(2)]=t,e},{})},e}(),h=n.createContext(null);h.displayName="StyleSheetContext";i.default.useInsertionEffect||i.default.useLayoutEffect;var p=void 0;function g(e){var t=p||n.useContext(h);return t&&t.add(e),null}g.dynamic=function(e){return e.map(function(e){return u(e[0],e[1])}).join(" ")},t.style=g},73405:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>o.a,__next_app__:()=>u,pages:()=>c,routeModule:()=>m,tree:()=>d});var n=r(65282),i=r(20277),a=r(47757),o=r.n(a),l=r(96002),s={};for(let e in l)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(s[e]=()=>l[e]);r.d(t,s);let d={children:["",{children:["quotation",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,15995)),"/Users/kang-yean-woo/gompyo/src/app/quotation/page.tsx"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,34421))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,98445)),"/Users/kang-yean-woo/gompyo/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.bind(r,24327)),"/Users/kang-yean-woo/gompyo/src/app/not-found.tsx"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,68366,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,75895,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,34421))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,c=["/Users/kang-yean-woo/gompyo/src/app/quotation/page.tsx"],u={require:r,loadChunk:()=>Promise.resolve()},m=new n.AppPageRouteModule({definition:{kind:i.RouteKind.APP_PAGE,page:"/quotation/page",pathname:"/quotation",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},73407:(e,t,r)=>{"use strict";e.exports=r(65282).vendored["react-rsc"].ReactJsxRuntime},77598:e=>{"use strict";e.exports=require("node:crypto")},79551:e=>{"use strict";e.exports=require("url")},83426:(e,t,r)=>{"use strict";let n,i;r.d(t,{default:()=>Y});var a=r(11432),o=r(11417),l=r(21037),s=r.n(l),d=r(9037),c=r(63016);c.callServer,c.findSourceMapURL;let u=(0,c.createServerReference)("40f1e18f30af0fbc377817d793409ade21b851dabe",c.callServer,void 0,c.findSourceMapURL,"saveUserQuotationColumnOrder");var m=r(53295);function f({items:e,companies:t,priceData:r,setSelectedRows:n,selectedColumns:i,setSelectedColumns:l,formatNumber:c,onCompanySelect:f,onItemsSelect:h,onCellValueChanged:p,selectedColumnsForManagement:g,setSelectedColumnsForManagement:y,onColumnOrderChange:b}){let[w,x]=(0,o.useState)([]),v=(0,o.useCallback)(async e=>{let t=e.api.getColumnState().filter(e=>"checkbox"!==e.colId).map(e=>({field:e.colId,width:e.width||100}));try{(await u(t)).success&&(x(t),b?.(t))}catch(e){console.error("컬럼 순서 저장 중 오류:",e)}},[]),{onDragStarted:S,onDragStopped:C}=(0,m.A)(v),N=(e,t=100,r=250)=>{let n=(e.match(/[가-힣]/g)||[]).length,i=e.length-n;return Math.max(t,Math.min(r,16*n+8*i+40))},j=(e,t=100,r=250)=>Math.max(t,Math.min(r,Math.max(...e.map(e=>N(e,0,1/0))))),A=({data:e,colDef:t})=>{if(!e)return null;let n=e.id,i=t?.field,o=r[n]?.[i||""]||0;return(0,a.jsx)("div",{className:"w-full h-full flex items-center justify-start",children:(0,a.jsx)("span",{children:o>0?c(o):""})})},I=t=>{let r=t.displayName,n=e.find(e=>`${e.name} (${e.origin})`===r),i=n?.id||r,o=t.selectedColumns[i],s=g?.[i]||!1;return(0,a.jsx)("div",{className:`w-full h-full flex items-center justify-start cursor-pointer px-[24px] ${s?"bg-blue-200 font-bold":""}`,onClick:()=>{let e={...t.selectedColumns,[i]:!o};l(e),h(Object.keys(e).filter(t=>e[t])),y&&y({...g,[i]:!s})},children:(0,a.jsx)("span",{children:r})})},R=(0,o.useMemo)(()=>{let r=[{headerName:"",checkboxSelection:!0,minWidth:50,flex:1,headerCheckboxSelection:!1,filter:!1,pinned:"left",lockPinned:!0,width:70,field:"checkbox"},{headerName:"업체명",field:"companyColumnName",pinned:"left",width:w.find(e=>"companyColumnName"===e.field)?.width||j([...t.map(e=>e.companyColumnName),"업체명"],120,250),sortable:!1}],n=e.map(e=>({headerName:`${e.name} (${e.origin})`,headerClass:"item-header",field:e.id,headerComponent:t=>I({...t,displayName:`${e.name} (${e.origin})`,selectedColumns:i,setSelectedColumns:l}),minWidth:100,width:w.find(t=>t.field===e.id)?.width||N(`${e.name} (${e.origin})`),cellRenderer:A,editable:!0,sortable:!1}));return[...r,...w.length>1?w.filter(e=>"companyColumnName"!==e.field).map(e=>n.find(t=>t.field===e.field)).filter(e=>void 0!==e).concat(n.filter(e=>!w.some(t=>t.field===e.field))):n]},[w,e,t,i,l]),_=t.map(t=>{let n={id:t.id,companyColumnName:t.companyColumnName};return e.forEach(e=>{n[e.id]=r[t.id]?.[e.id]||0}),n});return(0,a.jsx)("div",{className:"w-full h-[600px] lg:h-full",children:(0,a.jsxs)("div",{className:"jsx-d081cf3d79c8ea3c w-full h-full",children:[(0,a.jsx)(s(),{id:"d081cf3d79c8ea3c",children:"div.jsx-d081cf3d79c8ea3c .ag-header-cell.item-header{padding:0!important}"}),(0,a.jsx)(d.A,{columnDefs:R,data:_,pagination:!1,loading:!1,onSelectionChanged:i=>{let a=i.api.getSelectedNodes();if(1===a.length){let i=a[0].data.id;n({[i]:!0});let o=r[i]||{},s=[];e.forEach(e=>{let t=o[e.id];t&&t>0&&s.push(e.id)});let d={};s.forEach(e=>{d[e]=!0}),l(d),f(t.find(e=>e.id===i)||null),h(s)}else n({}),l({}),f(null),h([])},onCellValueChanged:p,onDragStarted:S,onDragStopped:C,rowSelection:"single"})]})})}r(61839);var h=r(82472),p=r(20245),g=r(2494),y=r(14368),b=r(68634);let w=b.z.object({name:b.z.string().min(1,"업체명을 입력해주세요."),description:b.z.string().optional(),priceType:b.z.enum(["arrival","loading"])}),x=[{name:"name",label:"업체명",type:"text",required:!0},{name:"priceType",label:"가격 유형",type:"select",options:[{label:"도착도",value:"arrival"},{label:"상차도",value:"loading"}],required:!0}];function v({onClose:e,onSubmit:t,submitLabel:r="추가"}){let[n,i]=(0,o.useState)({}),l=async r=>{try{t(r),i({}),e?.()}catch(e){e instanceof Error?i({name:e.message}):i({name:"오류가 발생했습니다."})}};return(0,a.jsx)(y.A,{fields:x,onSubmit:l,submitLabel:r,zodSchema:w,fieldErrors:n})}function S({onClose:e,onSubmit:t,submitLabel:r="수정",selectedCompany:n}){let[i,l]=(0,o.useState)({});if(!n)return null;let s=async r=>{try{t(r),l({}),e?.()}catch(e){e instanceof Error?l({name:e.message}):l({name:"오류가 발생했습니다."})}};return(0,a.jsx)(y.A,{fields:x,onSubmit:s,submitLabel:r,zodSchema:w,fieldErrors:i,initialValues:{name:n.companyName,priceType:n.priceType}})}let C=b.z.object({itemName:b.z.string().min(1,"제품명을 입력해주세요."),itemOrigin:b.z.string().min(1,"원산지를 입력해주세요."),itemNameEn:b.z.string().min(1,"제품명(영문)을 입력해주세요."),itemOriginEn:b.z.string().min(1,"원산지(영문)을 입력해주세요.")}),N=[{name:"itemName",label:"제품명",type:"text",required:!0},{name:"itemOrigin",label:"원산지",type:"text",required:!0},{name:"itemNameEn",label:"제품명(영문)",type:"text",required:!0},{name:"itemOriginEn",label:"원산지(영문)",type:"text",required:!0}];function j({onClose:e,onSubmit:t,submitLabel:r="추가"}){let[n,i]=(0,o.useState)({}),l=async r=>{try{t(r),i({}),e?.()}catch(e){e instanceof Error?i({itemName:e.message}):i({itemName:"오류가 발생했습니다."})}};return(0,a.jsx)(y.A,{fields:N,onSubmit:l,submitLabel:r,zodSchema:C,fieldErrors:n})}function A({onClose:e,onSubmit:t,submitLabel:r="수정",selectedItem:n}){let[i,l]=(0,o.useState)({});if(!n)return null;let s=async r=>{try{t(r),l({}),e?.()}catch(e){e instanceof Error?l({itemName:e.message}):l({itemName:"오류가 발생했습니다."})}};return(0,a.jsx)(y.A,{fields:N,onSubmit:s,submitLabel:r,zodSchema:C,initialValues:{itemName:n.itemName,itemOrigin:n.itemOrigin,itemNameEn:n.itemNameEn??"",itemOriginEn:n.itemOriginEn??""},fieldErrors:i})}var I=r(74247),R=r(71020);function _({open:e,onClose:t,onConfirm:r,title:n,message:i}){return(0,a.jsxs)(h.A,{open:e,onClose:t,maxWidth:"xs",fullWidth:!0,children:[(0,a.jsx)(p.A,{children:n}),(0,a.jsx)(g.A,{sx:{py:3},children:i}),(0,a.jsxs)(I.A,{sx:{px:3,pb:2,pt:0,justifyContent:"flex-end"},children:[(0,a.jsx)(R.A,{variant:"outline",onClick:t,children:"취소"}),(0,a.jsx)(R.A,{variant:"outline-danger",onClick:r,children:"삭제"})]})]})}function F({open:e,onClose:t,onConfirm:r}){return(0,a.jsx)(_,{open:e,onClose:t,onConfirm:r,title:"업체 삭제 확인",message:"정말로 선택한 업체를 삭제하시겠습니까?"})}function O({open:e,onClose:t,onConfirm:r}){return(0,a.jsx)(_,{open:e,onClose:t,onConfirm:r,title:"품목 삭제 확인",message:"정말로 선택한 품목을 삭제하시겠습니까?"})}function E({open:e,onClose:t,onSubmit:r}){return(0,a.jsxs)(h.A,{open:e,onClose:t,maxWidth:"xs",fullWidth:!0,children:[(0,a.jsx)(p.A,{children:"업체 추가"}),(0,a.jsx)(g.A,{children:(0,a.jsx)(v,{onClose:t,onSubmit:r})})]})}function q({open:e,onClose:t,onSubmit:r,selectedCompany:n}){return(0,a.jsxs)(h.A,{open:e,onClose:t,maxWidth:"xs",fullWidth:!0,children:[(0,a.jsx)(p.A,{children:"업체 수정"}),(0,a.jsx)(g.A,{children:(0,a.jsx)(S,{onClose:t,onSubmit:r,selectedCompany:n})})]})}function T({open:e,onClose:t,onSubmit:r}){return(0,a.jsxs)(h.A,{open:e,onClose:t,maxWidth:"xs",fullWidth:!0,children:[(0,a.jsx)(p.A,{children:"품목 추가"}),(0,a.jsx)(g.A,{children:(0,a.jsx)(j,{onClose:t,onSubmit:r})})]})}function k({open:e,onClose:t,onSubmit:r,selectedItem:n}){return(0,a.jsxs)(h.A,{open:e,onClose:t,maxWidth:"xs",fullWidth:!0,children:[(0,a.jsx)(p.A,{children:"품목 수정"}),(0,a.jsx)(g.A,{children:(0,a.jsx)(A,{onClose:t,onSubmit:r,selectedItem:n})})]})}function P({open:e,onClose:t,onDownload:r,onOpenInNewWindow:n}){let[i,l]=(0,o.useState)(!1),[s,d]=(0,o.useState)(!1),c=async()=>{if(!i)try{l(!0),await r()}finally{l(!1)}},u=async()=>{if(!s)try{d(!0),await n()}finally{d(!1)}},m=i||s;return(0,a.jsxs)(h.A,{open:e,onClose:t,maxWidth:"xs",fullWidth:!0,children:[(0,a.jsx)(p.A,{children:"견적서 출력"}),(0,a.jsx)(g.A,{sx:{py:3},children:"아래 버튼을 클릭하여 견적서를 출력할 수 있습니다."}),(0,a.jsxs)(I.A,{sx:{px:3,pb:2,pt:0,justifyContent:"flex-end"},children:[(0,a.jsx)(R.A,{variant:"outline",onClick:t,disabled:m,children:"창 닫기"}),(0,a.jsx)(R.A,{variant:"primary",onClick:c,disabled:m,children:i?"다운로드 중...":"다운로드"}),(0,a.jsx)(R.A,{variant:"primary",onClick:u,disabled:m,children:s?"새창 열기 중...":"새창에서 열기"})]})]})}var D=r(82423),z=r(68792),L=r(1816);c.callServer,c.findSourceMapURL,c.callServer,c.findSourceMapURL;let U=(0,c.createServerReference)("409a615c018433fa2f101a2a21581937161c0c1ee2",c.callServer,void 0,c.findSourceMapURL,"addQuotationCompanyAction"),K=(0,c.createServerReference)("40f749ad93ee75eadf1cc05d8edc5da960aaa830d1",c.callServer,void 0,c.findSourceMapURL,"updateQuotationCellAction"),V=(0,c.createServerReference)("40505237c0372e88c322fb73731b0cdee4aba64747",c.callServer,void 0,c.findSourceMapURL,"addQuotationItemAction"),W=(0,c.createServerReference)("40978e4adc50118fd05fa6dfb16b58a8d80242dea3",c.callServer,void 0,c.findSourceMapURL,"deleteQuotationCompanyAction"),B=(0,c.createServerReference)("4055fb31d9adee20bd75e8170cbda5f709b74963f8",c.callServer,void 0,c.findSourceMapURL,"deleteQuotationItemAction"),M=(0,c.createServerReference)("60c7bac4156a834f9aa4d6980d87e605630af8d75c",c.callServer,void 0,c.findSourceMapURL,"updateCompanyAction"),$=(0,c.createServerReference)("6048f7069ff341fc5173436274c4b93d2ee114bdd0",c.callServer,void 0,c.findSourceMapURL,"updateItemAction"),H=(0,c.createServerReference)("401df350c3b6aa883ddfad7dd5397163bb931bbb49",c.callServer,void 0,c.findSourceMapURL,"generateQuotationPDF");var Q=r(77598);function J(e){!n||n.length<e?(n=Buffer.allocUnsafe(128*e),Q.webcrypto.getRandomValues(n),i=0):i+e>n.length&&(Q.webcrypto.getRandomValues(n),i=0),i+=e}function G(e=21){J(e|=0);let t="";for(let r=i-e;r<i;r++)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&n[r]];return t}let X=()=>{let e=new Date,t=e.getFullYear().toString(),r=(e.getMonth()+1).toString().padStart(2,"0"),n=e.getDate().toString().padStart(2,"0"),i=Math.floor(1e4*Math.random()).toString().padStart(4,"0");return`GP${t}${r}${n}${i}`};function Y(){let[e,t]=(0,o.useState)(!1),[r,n]=(0,o.useState)(!1),[i,l]=(0,o.useState)(!1),[s,d]=(0,o.useState)(!1),[c,u]=(0,o.useState)(!1),[m,h]=(0,o.useState)(!1),[p,g]=(0,o.useState)(null),[y,b]=(0,o.useState)(!1),[w,x]=(0,o.useState)([]),[v,S]=(0,o.useState)({}),[C,N]=(0,o.useState)({}),[j,A]=(0,o.useState)({}),I=(0,o.useCallback)(e=>{x(e)},[]),[_,Q]=(0,o.useState)([]),[J,Y]=(0,o.useState)([]),[Z,ee]=(0,o.useState)({}),[et,er]=(0,o.useState)([]),[en,ei]=(0,o.useState)([]),[ea,eo]=(0,o.useState)({}),[el,es]=(0,o.useState)("domestic"),ed="domestic"===el?_:et,ec="domestic"===el?J:en,eu="domestic"===el?Z:ea,em="domestic"===el?Q:er,ef="domestic"===el?Y:ei,eh="domestic"===el?ee:eo,ep=e=>new Intl.NumberFormat("ko-KR").format(e),eg=(e,t)=>"arrival"===t?`${e} (도착도)`:`${e} (상차도)`,ey=(e,t,r)=>{if(r.some(r=>r.companyName===e&&r.priceType===t))throw Error(`이미 존재하는 업체명과 가격 타입입니다. (${e} - ${"arrival"===t?"도착도":"상차도"})`)},eb=(e,t,r)=>{if(r.some(r=>r.itemName===e&&r.itemOrigin===t))throw Error(`이미 존재하는 품목입니다. (${e} - ${t})`)},ew=()=>{let e=[];return Object.entries(v).forEach(([t,r])=>{r&&Object.entries(C).forEach(([r,n])=>{if(n){let n=ed.find(e=>e.id===r),i=ec.find(e=>e.id===t),a=eu[t]?.[r]||0;a>0&&e.push({productCode:r,productName:n?.itemName||"",origin:n?.itemOrigin||"",company:i?.companyName||t,priceType:i?.priceType||"",price:a,originEn:n?.itemOriginEn||"",productNameEn:n?.itemNameEn||""})}})}),e.sort((e,t)=>{let r=w.findIndex(t=>t.field===e.productCode),n=w.findIndex(e=>e.field===t.productCode);return -1===r&&-1===n?0:-1===r?1:-1===n?-1:r-n})},ex=e=>{let t=Object.keys(j).filter(e=>j[e]);0!==t.length&&(eb(e.itemName,e.itemOrigin,ed),$(t[0],{itemName:e.itemName,itemOrigin:e.itemOrigin,itemNameEn:e.itemNameEn,itemOriginEn:e.itemOriginEn}),em(r=>r.map(r=>r.id===t[0]?{...r,itemName:e.itemName,itemOrigin:e.itemOrigin,itemNameEn:e.itemNameEn,itemOriginEn:e.itemOriginEn}:r)),A({}),d(!1))},ev=async e=>{try{let t=e.data.id,r=e.column.getColId(),n=e.newValue,i=e.oldValue,a=e.data[r];if(console.log("=== 셀 값 변경 디버깅 ==="),console.log("companyId:",t),console.log("itemId:",r),console.log("newValue:",n),console.log("oldValue:",i),console.log("currentValue:",a),console.log("params:",e),!r||"string"!=typeof r||"companyColumnName"===r){console.log("itemId가 유효하지 않음, 처리 중단");return}let o=void 0!==n?n:a,l=""===o||null==o?null:Number(o);console.log("finalValue:",o),console.log("numericValue:",l),eh(e=>({...e,[t]:{...e[t],[r]:l||0}})),await K({itemId:r,companyId:t,value:l}),console.log(`셀 값 업데이트 완료: 회사 ${t}, 제품 ${r}, 값 ${l}`)}catch(e){console.error("셀 값 업데이트 실패:",e),alert("가격 업데이트에 실패했습니다. 다시 시도해주세요.")}},eS=async()=>{let e=ew();if(0===e.length)throw Error("선택된 견적 항목이 없습니다.");console.log("PDF 생성 시 컬럼 순서:",w),console.log("PDF 생성 시 견적 데이터:",e);let t=e.sort((e,t)=>{let r=w.findIndex(t=>t.field===e.productCode),n=w.findIndex(e=>e.field===t.productCode);return -1===r&&-1===n?0:-1===r?1:-1===n?-1:r-n});console.log("PDF 생성 시 정렬된 견적 데이터:",t);let r=await H({sender:"㈜ 곰표",receiver:t[0].company,date:new Date().toISOString().split("T")[0],items:t.map((e,t)=>({no:t+1,name:e.productName,originEn:e.originEn,nameEn:e.productNameEn,price:e.price})),documentNumber:X(),priceType:t[0].priceType,reference:""});if(!r.success||!r.pdf)throw Error(r.error||"PDF 생성에 실패했습니다.");let n=atob(r.pdf),i=new Uint8Array(n.length);for(let e=0;e<n.length;e++)i[e]=n.charCodeAt(e);return{bytes:i,filename:r.filename||"견적서.pdf"}},eC=async()=>{try{let{bytes:e,filename:t}=await eS(),r=new Blob([e],{type:"application/pdf"}),n=URL.createObjectURL(r),i=document.createElement("a");i.href=n,i.download=t,i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(n),console.log("PDF 다운로드 완료:",t)}catch(e){console.error("PDF 다운로드 중 오류 발생:",e),alert("PDF 다운로드 중 오류가 발생했습니다: "+(e instanceof Error?e.message:"알 수 없는 오류"))}},eN=async()=>{try{let{bytes:e,filename:t}=await eS(),r=new Blob([e],{type:"application/pdf"}),n=URL.createObjectURL(r),i=window.open(n,"_blank");if(i)i.addEventListener("load",()=>{try{i.document.title=t}catch(e){console.warn("새 창 제목 설정 실패:",e)}}),setTimeout(()=>{URL.revokeObjectURL(n)},1e3),console.log("PDF 새 창에서 열기 완료:",t);else{alert("팝업이 차단되었습니다. 다운로드로 진행합니다.");let e=document.createElement("a");e.href=n,e.download=t,e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e),URL.revokeObjectURL(n),console.log("팝업 차단으로 다운로드 대체 완료:",t)}}catch(e){console.error("PDF 새창 열기 중 오류 발생:",e),alert("PDF 새창 열기 중 오류가 발생했습니다: "+(e instanceof Error?e.message:"알 수 없는 오류"))}};return(0,a.jsxs)("div",{className:"w-full min-h-screen bg-gray-100",children:[(0,a.jsxs)("div",{className:"p-4 sm:p-8",children:[(0,a.jsx)("div",{className:"flex flex-col lg:flex-row lg:items-center sm:justify-between mb-4 sm:mb-6 gap-4",children:(0,a.jsx)("h1",{className:"text-xl sm:text-2xl font-bold",children:"견적서 작성"})}),(0,a.jsxs)(D.A,{direction:{xs:"column",lg:"row"},spacing:2,children:[(0,a.jsx)("div",{className:"flex flex-row justify-between items-end flex-shrink-0 overflow-x-auto",style:{minHeight:24},children:(0,a.jsxs)(z.A,{value:el,onChange:(e,t)=>es(t),sx:{"& .MuiTabs-indicator":{backgroundColor:"#22C55E"},"& .MuiTab-root":{color:"#6B7280","&.Mui-selected":{color:"#22C55E"},"&:hover":{color:"#16A34A"}}},children:[(0,a.jsx)(L.A,{label:"국내 업체",value:"domestic"}),(0,a.jsx)(L.A,{label:"해외 업체",value:"overseas"})]})}),(0,a.jsx)("div",{className:"overflow-auto w-full",children:(0,a.jsxs)(D.A,{direction:"row",spacing:2,sx:{width:"100%",justifyContent:{xs:"flex-start",lg:"flex-end"},pb:1,overflowX:"auto",flexWrap:"nowrap",minWidth:"max-content","& > *":{flexShrink:0}},children:[(0,a.jsx)(R.A,{variant:"info",onClick:()=>t(!0),children:"업체 추가"}),(0,a.jsx)(R.A,{variant:"info",onClick:()=>l(!0),children:"품목 추가"}),(0,a.jsx)(R.A,{variant:"primary",onClick:()=>n(!0),disabled:!p,children:"업체 수정"}),(0,a.jsx)(R.A,{variant:"primary",onClick:()=>d(!0),disabled:1!==Object.keys(j).filter(e=>j[e]).length,children:"품목 수정"}),(0,a.jsx)(R.A,{variant:"danger",onClick:()=>u(!0),disabled:!p,children:"업체 삭제"}),(0,a.jsx)(R.A,{variant:"danger",onClick:()=>h(!0),disabled:0===Object.keys(j).filter(e=>j[e]).length,children:"품목 삭제"}),(0,a.jsxs)(R.A,{variant:"special",onClick:()=>b(!0),disabled:0===ew().length,children:["견적서 작성 (",ew().length,")"]})]})})]}),(0,a.jsx)("div",{className:"overflow-auto lg:h-[75vh]",children:(0,a.jsx)(f,{items:ed.map(e=>({id:e.id,code:e.itemOrigin,name:e.itemName,origin:e.itemOrigin})),companies:ec,priceData:eu,selectedRows:v,setSelectedRows:S,selectedColumns:C,setSelectedColumns:N,selectedColumnsForManagement:j,setSelectedColumnsForManagement:A,getIntersectionItems:ew,formatNumber:ep,onCompanySelect:g,onCellValueChanged:ev,onItemsSelect:()=>{},onColumnOrderChange:I})}),ew().length>0&&(0,a.jsxs)("div",{className:"mt-4 p-3 bg-green-50 rounded-lg",children:[(0,a.jsxs)("p",{className:"text-sm text-green-800 font-semibold",children:["선택된 견적 항목: ",ew().length,"개"]}),(0,a.jsx)("div",{className:"text-xs text-green-700 mt-1",children:ew().map((e,t)=>(0,a.jsxs)("span",{children:[e.company,"에서 ",e.productName," (",ep(e.price),"원)",t<ew().length-1?", ":""]},t))})]})]}),(0,a.jsx)(E,{open:e,onClose:()=>t(!1),onSubmit:e=>{let t=e.name;ey(t,e.priceType,ec);let r={id:G(),companyName:t,companyType:el,priceType:e.priceType,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},n={...r,companyColumnName:eg(r.companyName,r.priceType)};ef(e=>[...e,n]),eh(e=>({...e,[r.id]:{}})),U(r),K({companyId:r.id,itemId:"domestic"===el?_[0].id:et[0].id,value:0})}}),p&&ec.find(e=>e.id===p.id)&&(0,a.jsx)(q,{open:r,onClose:()=>n(!1),onSubmit:e=>{p&&(ey(e.name,e.priceType,ec),M(p.id,{companyName:e.name,companyType:el,priceType:e.priceType}),ef(t=>t.map(t=>t.id===p.id?{...t,companyName:e.name,priceType:e.priceType,companyColumnName:eg(e.name,e.priceType)}:t)),n(!1))},selectedCompany:ec.find(e=>e.id===p?.id)||p}),(0,a.jsx)(T,{open:i,onClose:()=>l(!1),onSubmit:e=>{eb(e.itemName,e.itemOrigin,ed);let t={id:G(),itemName:e.itemName,itemOrigin:e.itemOrigin,itemNameEn:e.itemNameEn,itemOriginEn:e.itemOriginEn,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};em(e=>[...e,t]),V(t),K({companyId:"domestic"===el?J[0].id:en[0].id,itemId:t.id,value:0})}}),(()=>{let e=Object.keys(j).filter(e=>j[e]),t=e.length>0?ed.find(t=>t.id===e[0]):null;return t?(0,a.jsx)(k,{open:s,onClose:()=>d(!1),onSubmit:ex,selectedItem:t}):null})(),(0,a.jsx)(F,{open:c,onClose:()=>u(!1),onConfirm:()=>{p&&(ef(e=>e.filter(e=>e.id!==p.id)),W(p.id),eh(e=>{let t={...e};return delete t[p.id],t}),g(null),u(!1))}}),(0,a.jsx)(O,{open:m,onClose:()=>h(!1),onConfirm:()=>{let e=Object.keys(j).filter(e=>j[e]);0!==e.length&&(em(t=>t.filter(t=>!e.includes(t.id))),e.forEach(e=>{B(e)}),eh(t=>{let r={...t};return Object.keys(r).forEach(t=>{e.forEach(e=>{r[t][e]&&delete r[t][e]})}),r}),A({}),h(!1))}}),(0,a.jsx)(P,{open:y,onClose:()=>b(!1),onDownload:eC,onOpenInNewWindow:eN})]})}},87550:e=>{"use strict";e.exports=require("better-sqlite3")}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[883,32,91,36,162,293,728,289,547,913,898,368],()=>r(73405));module.exports=n})();
