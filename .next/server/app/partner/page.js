(()=>{var e={};e.id=967,e.ids=[967],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},22541:(e,a,r)=>{"use strict";r.r(a),r.d(a,{"00ea76b8afd93bec80376e61e1bb6580411dbf0f5f":()=>m,"401f85b74817279bdb72026df9f07bf93f6938c701":()=>u,"40ced9f35ffa1ba213608c8255e2f037dabef1775c":()=>C,"6067bb744766495445252e053313a7c9ded00d9c0f":()=>v,"60a2933c5de39a972cf37845c81181c0c7a9e4ce6e":()=>A,"60a7ca32ef03f5ffc90daec271b7aed09bdb419a36":()=>p,"60c4c8a437e3120dbfe17aedb6dcdb3a094317731b":()=>w,"60c88d6bffa079bbcde9d95beb7fb63f0fbdf8d6ed":()=>f,"70a6b90c6bc0c32faba4cfcf8629360bb960cf34b4":()=>b});var t=r(17464);r(55414);var n=r(19541),l=r(18591),o=r(98149),i=r(13913),s=r(8613),c=r(26763);function d(e){let a={이월잔액:0,"1월":1,"2월":2,"3월":3,"4월":4,"5월":5,"6월":6,"7월":7,"8월":8,"9월":9,"10월":10,"11월":11,"12월":12};return e.sort((e,r)=>(a[e.month]??999)-(a[r.month]??999))}async function m(){try{return await i.db.select({id:s.partnerCompanies.id,name:s.partnerCompanies.name,type:s.partnerCompanies.type}).from(s.partnerCompanies).orderBy((0,l.Y)(s.partnerCompanies.name))}catch(e){throw console.error("거래처 목록 조회 실패:",e),Error("거래처 목록을 불러오는데 실패했습니다.")}}async function p(e,a){try{if(!e||!e.trim())throw Error("회사명을 입력해주세요.");if(!a||!["payment","collection"].includes(a))throw Error("올바른 회사 유형을 선택해주세요.");if((await i.db.select().from(s.partnerCompanies).where((0,o.eq)(s.partnerCompanies.name,e.trim())).limit(1)).length>0)throw Error("이미 존재하는 회사명입니다.");let r=new Date().toISOString(),t=(0,c.Ak)();await i.db.insert(s.partnerCompanies).values({id:t,name:e.trim(),type:a,createdAt:r,updatedAt:r});let l=new Date().getFullYear(),d=await y(t,l);return await h(d),(0,n.revalidatePath)("/partner"),{id:t}}catch(e){if(console.error("거래처 추가 실패:",e),e instanceof Error)throw e;throw Error("거래처 추가에 실패했습니다.")}}async function u(e){try{if(!e)throw Error("삭제할 회사를 선택해주세요.");let a=await i.db.select().from(s.partnerCompanies).where((0,o.eq)(s.partnerCompanies.id,e)).limit(1);if(0===a.length)throw Error("존재하지 않는 회사입니다.");await i.db.transaction(async a=>{for(let r of(await a.select().from(s.companyYears).where((0,o.eq)(s.companyYears.companyId,e))))await a.delete(s.financialData).where((0,o.eq)(s.financialData.yearId,r.id));await a.delete(s.companyYears).where((0,o.eq)(s.companyYears.companyId,e)),await a.delete(s.partnerCompanies).where((0,o.eq)(s.partnerCompanies.id,e))}),(0,n.revalidatePath)("/partner")}catch(e){if(console.error("거래처 삭제 실패:",e),e instanceof Error)throw e;throw Error("거래처 삭제에 실패했습니다.")}}async function f(e,a){try{if(!e||!a)throw Error("회사와 연도를 선택해주세요.");let r=await i.db.select().from(s.companyYears).where((0,o.Uo)((0,o.eq)(s.companyYears.companyId,e),(0,o.eq)(s.companyYears.year,a))).limit(1);0===r.length&&(await y(e,a),r=await i.db.select().from(s.companyYears).where((0,o.Uo)((0,o.eq)(s.companyYears.companyId,e),(0,o.eq)(s.companyYears.year,a))).limit(1));let t=r[0].id,n=await i.db.select().from(s.financialData).where((0,o.eq)(s.financialData.yearId,t));if(0===n.length)return await h(t),await f(e,a);return d(n).map(e=>({id:e.id,yearId:e.yearId,month:e.month,isCarryover:e.isCarryover||!1,lamplePurchase:e.lamplePurchase,lamplePayment:e.lamplePayment,gompyoPurchase:e.gompyoPurchase,gompyoPayment:e.gompyoPayment}))}catch(e){if(console.error("재무 데이터 조회 실패:",e),e instanceof Error)throw e;throw Error("재무 데이터를 불러오는데 실패했습니다.")}}async function y(e,a){let r=new Date().toISOString(),t=(0,c.Ak)(),n=await i.db.select().from(s.companyYears).where((0,o.Uo)((0,o.eq)(s.companyYears.companyId,e),(0,o.eq)(s.companyYears.year,a-1))).limit(1),l=n.length>0&&n[0].lampleClosingBalance||0,d=n.length>0&&n[0].gompyoClosingBalance||0;return console.log("lampleOpeningBalance",l),console.log("gompyoOpeningBalance",d),await i.db.insert(s.companyYears).values({id:t,companyId:e,year:a,lampleOpeningBalance:l,gompyoOpeningBalance:d,lampleClosingBalance:0,gompyoClosingBalance:0,isActive:!0,createdAt:r,updatedAt:r}),t}async function h(e){let a=new Date().toISOString(),r=[{id:(0,c.Ak)(),yearId:e,month:"이월잔액",isCarryover:!0,lamplePurchase:null,lamplePayment:null,gompyoPurchase:null,gompyoPayment:null,createdAt:a,updatedAt:a},...["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"].map(r=>({id:(0,c.Ak)(),yearId:e,month:r,isCarryover:!1,lamplePurchase:null,lamplePayment:null,gompyoPurchase:null,gompyoPayment:null,createdAt:a,updatedAt:a}))];await i.db.insert(s.financialData).values(r)}async function b(e,a,r){try{if(!e||!a||!r||0===r.length)throw Error("저장할 데이터가 없습니다.");let t=new Date().toISOString(),l=await i.db.select().from(s.companyYears).where((0,o.Uo)((0,o.eq)(s.companyYears.companyId,e),(0,o.eq)(s.companyYears.year,a))).limit(1);if(0===l.length)throw Error("해당 연도 데이터를 찾을 수 없습니다.");let c=l[0].id;for(let e of r)await i.db.update(s.financialData).set({lamplePurchase:e.lamplePurchase,lamplePayment:e.lamplePayment,gompyoPurchase:e.gompyoPurchase,gompyoPayment:e.gompyoPayment,updatedAt:t}).where((0,o.eq)(s.financialData.id,e.id)),e.isCarryover&&"이월잔액"===e.month&&await g(c,e);await x(e,a),(0,n.revalidatePath)("/partner")}catch(e){if(console.error("재무 데이터 저장 실패:",e),e instanceof Error)throw e;throw Error("재무 데이터 저장에 실패했습니다.")}}async function g(e,a){try{let r=new Date().toISOString(),t=a.lamplePurchase||0,n=a.gompyoPurchase||0;await i.db.update(s.companyYears).set({lampleOpeningBalance:t,gompyoOpeningBalance:n,updatedAt:r}).where((0,o.eq)(s.companyYears.id,e))}catch(e){throw console.error("이월잔액 업데이트 실패:",e),Error("이월잔액 업데이트에 실패했습니다.")}}async function x(e,a){let r=await i.db.select().from(s.companyYears).where((0,o.Uo)((0,o.eq)(s.companyYears.companyId,e),(0,o.eq)(s.companyYears.year,a))).limit(1);if(0===r.length)return;let t=r[0].id;d(await i.db.select().from(s.financialData).where((0,o.eq)(s.financialData.yearId,t))).find(e=>"12월"===e.month)&&await i.db.update(s.companyYears).set({lampleClosingBalance:0,gompyoClosingBalance:0,updatedAt:new Date().toISOString()}).where((0,o.eq)(s.companyYears.id,t))}async function v(e,a){try{if(!e||!a)throw Error("회사와 연도를 선택해주세요.");if((await i.db.select().from(s.companyYears).where((0,o.Uo)((0,o.eq)(s.companyYears.companyId,e),(0,o.eq)(s.companyYears.year,a))).limit(1)).length>0)throw Error("이미 존재하는 연도입니다.");let r=await y(e,a);await h(r),(0,n.revalidatePath)("/partner")}catch(e){if(console.error("연도 추가 실패:",e),e instanceof Error)throw e;throw Error("연도 추가에 실패했습니다.")}}async function w(e,a){try{if(!e||!a)throw Error("삭제할 회사와 연도를 선택해주세요.");let r=await i.db.select().from(s.companyYears).where((0,o.Uo)((0,o.eq)(s.companyYears.companyId,e),(0,o.eq)(s.companyYears.year,a))).limit(1);if(0===r.length)throw Error("존재하지 않는 연도입니다.");let t=r[0].id;await i.db.transaction(async r=>{await r.delete(s.financialData).where((0,o.eq)(s.financialData.yearId,t)),await r.delete(s.companyYears).where((0,o.Uo)((0,o.eq)(s.companyYears.companyId,e),(0,o.eq)(s.companyYears.year,a)))}),(0,n.revalidatePath)("/partner")}catch(e){if(console.error("연도별 데이터 삭제 실패:",e),e instanceof Error)throw e;throw Error("연도별 데이터 삭제에 실패했습니다.")}}async function C(e){try{if(!e)return[];return(await i.db.select({year:s.companyYears.year}).from(s.companyYears).where((0,o.eq)(s.companyYears.companyId,e)).orderBy((0,l.i)(s.companyYears.year))).map(e=>e.year)}catch(e){return console.error("사용 가능한 연도 목록 조회 실패:",e),[]}}async function A(e,a){try{let r=await i.db.select().from(s.companyYears).where((0,o.Uo)((0,o.eq)(s.companyYears.companyId,e),(0,o.eq)(s.companyYears.year,a))).limit(1);if(0===r.length)return null;let t=r[0];return{id:t.id,companyId:t.companyId,year:t.year,lampleOpeningBalance:t.lampleOpeningBalance||0,gompyoOpeningBalance:t.gompyoOpeningBalance||0,lampleClosingBalance:t.lampleClosingBalance||0,gompyoClosingBalance:t.gompyoClosingBalance||0,isActive:t.isActive||!0,createdAt:t.createdAt,updatedAt:t.updatedAt}}catch(e){return console.error("회사 연도 데이터 조회 실패:",e),null}}(0,r(1634).D)([m,p,u,f,b,v,w,C,A]),(0,t.A)(m,"00ea76b8afd93bec80376e61e1bb6580411dbf0f5f",null),(0,t.A)(p,"60a7ca32ef03f5ffc90daec271b7aed09bdb419a36",null),(0,t.A)(u,"401f85b74817279bdb72026df9f07bf93f6938c701",null),(0,t.A)(f,"60c88d6bffa079bbcde9d95beb7fb63f0fbdf8d6ed",null),(0,t.A)(b,"70a6b90c6bc0c32faba4cfcf8629360bb960cf34b4",null),(0,t.A)(v,"6067bb744766495445252e053313a7c9ded00d9c0f",null),(0,t.A)(w,"60c4c8a437e3120dbfe17aedb6dcdb3a094317731b",null),(0,t.A)(C,"40ced9f35ffa1ba213608c8255e2f037dabef1775c",null),(0,t.A)(A,"60a2933c5de39a972cf37845c81181c0c7a9e4ce6e",null)},23555:(e,a,r)=>{"use strict";r.r(a),r.d(a,{default:()=>l});var t=r(10674),n=r(61171);function l(){return(0,t.jsx)(n.default,{})}},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},45593:(e,a,r)=>{"use strict";r.r(a),r.d(a,{GlobalError:()=>o.a,__next_app__:()=>m,pages:()=>d,routeModule:()=>p,tree:()=>c});var t=r(65282),n=r(20277),l=r(47757),o=r.n(l),i=r(96002),s={};for(let e in i)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(s[e]=()=>i[e]);r.d(a,s);let c={children:["",{children:["partner",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,23555)),"/Users/kang-yean-woo/gompyo/src/app/partner/page.tsx"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,34421))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,98445)),"/Users/kang-yean-woo/gompyo/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.bind(r,24327)),"/Users/kang-yean-woo/gompyo/src/app/not-found.tsx"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,68366,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,75895,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,34421))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,d=["/Users/kang-yean-woo/gompyo/src/app/partner/page.tsx"],m={require:r,loadChunk:()=>Promise.resolve()},p=new t.AppPageRouteModule({definition:{kind:n.RouteKind.APP_PAGE,page:"/partner/page",pathname:"/partner",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},61171:(e,a,r)=>{"use strict";r.d(a,{default:()=>t});let t=(0,r(73602).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/kang-yean-woo/gompyo/src/containers/partner/partner.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/kang-yean-woo/gompyo/src/containers/partner/partner.tsx","default")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},77598:e=>{"use strict";e.exports=require("node:crypto")},79551:e=>{"use strict";e.exports=require("url")},82518:(e,a,r)=>{"use strict";r.d(a,{default:()=>Q});var t=r(11432),n=r(11417),l=r(98801),o=r(82423),i=r(52510),s=r(64655),c=r(25867),d=r(47338),m=r(1836),p=r(9037),u=r(65640);let f=(e,a)=>{let r=[...e];r.sort((e,a)=>{let r={이월잔액:0,"1월":1,"2월":2,"3월":3,"4월":4,"5월":5,"6월":6,"7월":7,"8월":8,"9월":9,"10월":10,"11월":11,"12월":12};return(r[e.month]??999)-(r[a.month]??999)});let t=0,n=0;for(let e=0;e<r.length;e++){let l=r[e];if(l.isCarryover)t=l.lampleBalance||0,n=l.gompyoBalance||0,l.totalBalance=t+n;else{let e=l.lamplePurchase||0,r=l.lamplePayment||0,o=l.gompyoPurchase||0,i=l.gompyoPayment||0;"payment"===a?(t=t-e+r,n=n-o+i):(t=t+e-r,n=n+o-i),l.lampleBalance=t,l.gompyoBalance=n,l.totalPurchase=e+o,l.totalPayment=r+i,l.totalBalance=t+n}}return r},y=e=>({...e,totalBalance:(e.lampleBalance||0)+(e.gompyoBalance||0)}),h=e=>null==e?"":new Intl.NumberFormat("ko-KR").format(e),b=e=>{if(null==e)return null;let a=String(e);if(!a||""===a.trim())return null;let r=parseFloat(a.replace(/,/g,""));return isNaN(r)?null:r};function g({companies:e,selectedCompany:a,selectedYear:r,data:l,loading:o=!1,editMode:i=!1,onDataChange:s,onGridReady:c}){let d=e.find(e=>e.id===a),m=d?.type==="payment",g=m?"구매":"판매",x=m?"지급":"수금",v=d?.type||"collection",w=(0,n.useMemo)(()=>[{headerName:"월",suppressMovable:!0,headerClass:"text-center",field:"month",pinned:"left",filter:!1,sortable:!1,width:120,editable:!1,cellStyle:{fontWeight:"bold"}},{headerName:"램플",suppressMovable:!0,headerClass:"text-center",children:[{headerName:g,field:"lamplePurchase",suppressMovable:!0,filter:!1,sortable:!1,minWidth:120,flex:1,editable:e=>i&&!e.data?.isCarryover,valueFormatter:e=>e.data?.isCarryover?"":h(e.value),valueSetter:e=>{let a=b(e.newValue);return e.data.lamplePurchase=a,s(f(l,v)),!0},cellStyle:e=>i&&e.data?.isCarryover?{backgroundColor:"#F3F4F6"}:{}},{headerName:x,field:"lamplePayment",suppressMovable:!0,filter:!1,sortable:!1,minWidth:120,flex:1,editable:e=>i&&!e.data?.isCarryover,valueFormatter:e=>e.data?.isCarryover?"":h(e.value),valueSetter:e=>{let a=b(e.newValue);return e.data.lamplePayment=a,s(f(l,v)),!0},cellStyle:e=>i&&e.data?.isCarryover?{backgroundColor:"#F3F4F6"}:{}},{headerName:"잔액",field:"lampleBalance",suppressMovable:!0,filter:!1,sortable:!1,minWidth:120,flex:1,editable:e=>i&&e.data?.isCarryover,valueFormatter:e=>h(e.value),valueSetter:e=>{if(e.data.isCarryover){let a=b(e.newValue);e.data.lampleBalance=a;let r=y(e.data);return s(f(l.map(a=>a.id===e.data.id?r:a),v)),!0}return!1},cellStyle:e=>{let a={};return i&&!e.data?.isCarryover&&(a.backgroundColor="#F3F4F6"),e.value<0&&(a.color="red"),a}}]},{headerName:"곰표",headerClass:"text-center",suppressMovable:!0,children:[{headerName:g,filter:!1,field:"gompyoPurchase",suppressMovable:!0,sortable:!1,minWidth:120,flex:1,editable:e=>i&&!e.data?.isCarryover,valueFormatter:e=>e.data?.isCarryover?"":h(e.value),valueSetter:e=>{let a=b(e.newValue);return e.data.gompyoPurchase=a,s(f(l,v)),!0},cellStyle:e=>i&&e.data?.isCarryover?{backgroundColor:"#F3F4F6"}:{}},{headerName:x,filter:!1,field:"gompyoPayment",suppressMovable:!0,sortable:!1,minWidth:120,flex:1,editable:e=>i&&!e.data?.isCarryover,valueFormatter:e=>e.data?.isCarryover?"":h(e.value),valueSetter:e=>{let a=b(e.newValue);return e.data.gompyoPayment=a,s(f(l,v)),!0},cellStyle:e=>i&&e.data?.isCarryover?{backgroundColor:"#F3F4F6"}:{}},{headerName:"잔액",filter:!1,field:"gompyoBalance",suppressMovable:!0,sortable:!1,minWidth:120,flex:1,editable:e=>i&&e.data?.isCarryover,valueFormatter:e=>h(e.value),valueSetter:e=>{if(e.data.isCarryover){let a=b(e.newValue);e.data.gompyoBalance=a;let r=y(e.data);return s(f(l.map(a=>a.id===e.data.id?r:a),v)),!0}return!1},cellStyle:e=>{let a={};return i&&!e.data?.isCarryover&&(a.backgroundColor="#F3F4F6"),e.value<0&&(a.color="red"),a}}]},{headerName:"전체",headerClass:"text-center",children:[{headerName:g,filter:!1,suppressMovable:!0,sortable:!1,field:"totalPurchase",minWidth:120,flex:1,editable:!1,valueFormatter:e=>e.data?.isCarryover?"":h(e.value),cellStyle:i?{backgroundColor:"#F3F4F6"}:{}},{headerName:x,filter:!1,suppressMovable:!0,sortable:!1,field:"totalPayment",minWidth:120,flex:1,editable:!1,valueFormatter:e=>e.data?.isCarryover?"":h(e.value),cellStyle:i?{backgroundColor:"#F3F4F6"}:{}},{headerName:"잔액",filter:!1,suppressMovable:!0,sortable:!1,field:"totalBalance",minWidth:120,flex:1,editable:!1,valueFormatter:e=>h(e.value),cellStyle:e=>{let a=i?{backgroundColor:"#F3F4F6"}:{};return e.value<0?{...a,color:"red"}:a}}]}],[g,x,i,v,l,s]);return(0,t.jsx)("div",{className:"w-full h-[600px]",children:o?(0,t.jsx)("div",{className:"w-full h-full bg-gray-50 border border-gray-300 rounded-lg flex items-center justify-center",children:(0,t.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[(0,t.jsx)(u.A,{size:40}),(0,t.jsx)("p",{className:"text-gray-500",children:"데이터를 불러오는 중..."})]})}):l.length>0?(0,t.jsx)(p.A,{columnDefs:w,data:l,pagination:!1,onCellValueChanged:e=>{console.log("Grid: 셀 값 변경",{필드:e.colDef.field,이전값:e.oldValue,새값:e.newValue,행:e.data.month})},onGridReady:c}):(0,t.jsx)("div",{className:"w-full h-full bg-gray-50 border border-gray-300 rounded-lg flex items-center justify-center",children:(0,t.jsxs)("p",{className:"text-gray-500",children:[r,"년 데이터가 없습니다."]})})})}var x=r(32246),v=r(82472),w=r(20245),C=r(2494),A=r(74247),j=r(90714);let P=(0,j.eU)([]),S=(0,j.eU)(""),F=(0,j.eU)([]),k=(0,j.eU)(2025),Y=(0,j.eU)([]),E=(0,j.eU)(0);var q=r(68634);let B=q.z.object({name:q.z.string().min(1,"회사명을 입력해주세요.").max(50,"회사명은 50자 이내로 입력해주세요.").trim(),type:q.z.enum(["payment","collection"],{errorMap:()=>({message:"회사 타입을 선택해주세요."})})}),I=q.z.object({year:q.z.string().min(1,"연도를 입력해주세요.").refine(e=>!isNaN(parseInt(e)),"올바른 숫자를 입력해주세요.").refine(e=>{let a=parseInt(e);return a>=1900&&a<=2100},"1900~2100 사이의 연도를 입력해주세요.")}),W=[{name:"name",label:"회사명",type:"text",required:!0},{name:"type",label:"회사 타입",type:"select",required:!0,options:[{label:"지급회사",value:"payment"},{label:"수금회사",value:"collection"}]}],D=[{name:"year",label:"연도",type:"text",required:!0,helperText:"1900~2100 사이의 연도를 입력해주세요."}];var N=r(14368),U=r(63016);let M=(0,U.createServerReference)("60a7ca32ef03f5ffc90daec271b7aed09bdb419a36",U.callServer,void 0,U.findSourceMapURL,"createCompany"),R=(0,U.createServerReference)("401f85b74817279bdb72026df9f07bf93f6938c701",U.callServer,void 0,U.findSourceMapURL,"deleteCompany"),X=(0,U.createServerReference)("6067bb744766495445252e053313a7c9ded00d9c0f",U.callServer,void 0,U.findSourceMapURL,"addYear"),_=(0,U.createServerReference)("60c4c8a437e3120dbfe17aedb6dcdb3a094317731b",U.callServer,void 0,U.findSourceMapURL,"deleteYear");function z({open:e,onClose:a,onConfirm:r,title:n,message:l,loading:o=!1}){return(0,t.jsxs)(v.A,{open:e,onClose:a,maxWidth:"xs",fullWidth:!0,children:[(0,t.jsx)(w.A,{children:n}),(0,t.jsx)(C.A,{sx:{py:3},children:l}),(0,t.jsxs)(A.A,{sx:{px:3,pb:2,pt:0,justifyContent:"flex-end"},children:[(0,t.jsx)(c.A,{variant:"outlined",color:"primary",onClick:a,disabled:o,children:"취소"}),(0,t.jsx)(c.A,{variant:"contained",color:"primary",onClick:r,disabled:o,children:o?"처리 중...":"삭제"})]})]})}function O({open:e,onClose:a}){let[r,l]=(0,n.useState)({}),[o,i]=(0,n.useState)(!1),s=(0,x.Xr)(E),c=(0,x.Xr)(S),d=(0,x.Xr)(k),m=(0,x.Xr)(F),p=()=>{l({}),a()},u=async e=>{i(!0);try{let{id:a}=await M(e.name,e.type);c(a);let r=new Date().getFullYear();d(r),m([r]),s(e=>e+1),p()}catch(e){l({name:e instanceof Error?e.message:"회사 추가 중 오류가 발생했습니다."})}finally{i(!1)}};return(0,t.jsxs)(v.A,{open:e,onClose:p,maxWidth:"xs",fullWidth:!0,children:[(0,t.jsx)(w.A,{children:"회사 추가"}),(0,t.jsx)(C.A,{sx:{py:3},children:(0,t.jsx)(N.A,{fields:W,onSubmit:u,onCancel:p,submitLabel:o?"추가 중...":"추가",zodSchema:B,fieldErrors:r})})]})}function L({open:e,onClose:a,companyName:r}){let[l,o]=(0,n.useState)(!1),i=(0,x.md)(S),s=(0,x.Xr)(S),c=(0,x.Xr)(k),d=(0,x.Xr)(Y),m=(0,x.Xr)(E),p=(0,x.Xr)(F),u=async()=>{if(i){o(!0);try{d([]),s(""),c(new Date().getFullYear()),p([]),await R(i),m(e=>e+1),a()}catch(e){console.error("회사 삭제 실패:",e),s(i),c(new Date().getFullYear()),p([])}finally{o(!1)}}};return(0,t.jsx)(z,{open:e,onClose:a,onConfirm:u,title:"회사 삭제 확인",message:`정말로 "${r}" 회사를 삭제하시겠습니까? 관련된 모든 재무 데이터도 함께 삭제됩니다.`,loading:l})}function G({open:e,onClose:a}){let[r,l]=(0,n.useState)({}),[o,i]=(0,n.useState)(!1),s=(0,x.md)(F),c=(0,x.md)(S),d=(0,x.Xr)(E),m=()=>{l({}),a()},p=async e=>{if(!c){l({year:"회사를 먼저 선택해주세요."});return}let a=parseInt(e.year);if(s.includes(a)){l({year:"이미 존재하는 연도입니다."});return}i(!0);try{await X(c,a),d(e=>e+1),m()}catch(e){l({year:e instanceof Error?e.message:"연도 추가 중 오류가 발생했습니다."})}finally{i(!1)}};return(0,t.jsxs)(v.A,{open:e,onClose:m,maxWidth:"xs",fullWidth:!0,children:[(0,t.jsx)(w.A,{children:"연도 추가"}),(0,t.jsx)(C.A,{sx:{py:3},children:(0,t.jsx)(N.A,{fields:D,onSubmit:p,onCancel:m,submitLabel:o?"추가 중...":"추가",zodSchema:I,fieldErrors:r})})]})}function V({open:e,onClose:a}){let[r,l]=(0,n.useState)(!1),[o,i]=(0,x.fp)(F),[s,d]=(0,x.fp)(k),m=(0,x.md)(S),p=(0,x.md)(P),u=(0,x.Xr)(E),f=(0,x.Xr)(S),y=(0,x.Xr)(Y),[h,b]=(0,n.useState)(!1),g=async()=>{if(m&&s)try{if(1===o.length){b(!0);return}l(!0),await _(m,s);let e=o.filter(e=>e!==s);i(e),e.length>0&&d(e[0]),u(e=>e+1),a()}catch(e){console.error("년도 삭제 실패:",e)}finally{l(!1)}},j=async()=>{if(m){l(!0);try{y([]),f(""),d(new Date().getFullYear()),i([]),await R(m),u(e=>e+1),b(!1),a()}catch(e){console.error("회사 삭제 실패:",e),f(m),d(s),i(o)}finally{l(!1)}}};if(h){let a=p.find(e=>e.id===m)?.name||"";return(0,t.jsxs)(v.A,{open:e,onClose:()=>b(!1),maxWidth:"sm",fullWidth:!0,children:[(0,t.jsx)(w.A,{sx:{color:"#EF4444",fontWeight:600},children:"⚠️ 회사 삭제 경고"}),(0,t.jsx)(C.A,{sx:{py:3},children:(0,t.jsxs)("div",{style:{lineHeight:1.6},children:[(0,t.jsxs)("p",{style:{marginBottom:"12px",fontSize:"16px"},children:[(0,t.jsxs)("strong",{children:[s,"년"]}),"이"," ",(0,t.jsxs)("strong",{children:["`",a,"`"]})," 회사의 마지막 연도입니다."]}),(0,t.jsx)("p",{style:{marginBottom:"12px",color:"#EF4444",fontWeight:500},children:"연도를 삭제하면 해당 회사까지 함께 삭제됩니다."}),(0,t.jsx)("p",{style:{color:"#6B7280"},children:"정말로 계속하시겠습니까?"})]})}),(0,t.jsxs)(A.A,{sx:{px:3,pb:2,pt:0,justifyContent:"flex-end"},children:[(0,t.jsx)(c.A,{variant:"outlined",color:"primary",onClick:()=>b(!1),disabled:r,children:"취소"}),(0,t.jsx)(c.A,{variant:"contained",sx:{backgroundColor:"#EF4444","&:hover":{backgroundColor:"#DC2626"}},onClick:j,disabled:r,children:r?"삭제 중...":"회사까지 삭제"})]})]})}return(0,t.jsx)(z,{open:e,onClose:a,onConfirm:g,title:"연도 삭제 확인",message:`정말로 ${s}년 데이터를 삭제하시겠습니까?`,loading:r})}function K({open:e,onClose:a,onConfirm:r}){return(0,t.jsxs)(v.A,{open:e,onClose:a,maxWidth:"xs",fullWidth:!0,children:[(0,t.jsx)(w.A,{sx:{fontWeight:600},children:"편집 취소 확인"}),(0,t.jsxs)(C.A,{sx:{py:3},children:[(0,t.jsx)("p",{style:{marginBottom:"8px",color:"#374151"},children:"편집한 모든 변경사항이 저장되지 않습니다."}),(0,t.jsx)("p",{style:{color:"#6B7280"},children:"정말로 편집을 취소하시겠습니까?"})]}),(0,t.jsxs)(A.A,{sx:{px:3,pb:2,pt:0},children:[(0,t.jsx)(c.A,{onClick:a,variant:"outlined",color:"primary",children:"계속 편집"}),(0,t.jsx)(c.A,{onClick:r,variant:"contained",sx:{backgroundColor:"#EF4444","&:hover":{backgroundColor:"#DC2626"}},children:"취소하고 나가기"})]})]})}let T=(0,U.createServerReference)("00ea76b8afd93bec80376e61e1bb6580411dbf0f5f",U.callServer,void 0,U.findSourceMapURL,"fetchCompanies");U.callServer,U.findSourceMapURL;let $=(0,U.createServerReference)("60c88d6bffa079bbcde9d95beb7fb63f0fbdf8d6ed",U.callServer,void 0,U.findSourceMapURL,"fetchFinancialData"),H=(0,U.createServerReference)("70a6b90c6bc0c32faba4cfcf8629360bb960cf34b4",U.callServer,void 0,U.findSourceMapURL,"saveFinancialData");async function J(e,a,r){let t=(await T()).find(e=>e.id===a),n=t?.type||"collection",l=[...e].sort((e,a)=>{let r={이월잔액:0,"1월":1,"2월":2,"3월":3,"4월":4,"5월":5,"6월":6,"7월":7,"8월":8,"9월":9,"10월":10,"11월":11,"12월":12};return(r[e.month]??999)-(r[a.month]??999)}),o=[],i=0,s=0;for(let e=0;e<l.length;e++){let t=l[e];if(t.isCarryover)i=t.lamplePurchase||0,s=t.gompyoPurchase||0,o.push({...t,year:r,companyId:a,lampleBalance:i,gompyoBalance:s,totalPurchase:null,totalPayment:null,totalBalance:i+s});else{let e=t.lamplePurchase||0,l=t.lamplePayment||0,c=t.gompyoPurchase||0,d=t.gompyoPayment||0;"payment"===n?(i=i-e+l,s=s-c+d):(i=i+e-l,s=s+c-d);let m=e+c,p=l+d,u=i+s;o.push({...t,year:r,companyId:a,lampleBalance:i,gompyoBalance:s,totalPurchase:m||null,totalPayment:p||null,totalBalance:u})}}return o}function Q(){let e=(0,x.md)(P),[a,r]=(0,x.fp)(S),[p,u]=(0,x.fp)(k),f=(0,x.md)(Y),y=(0,x.md)(F);(0,x.md)(E);let[h,b]=(0,n.useState)(!1);(0,x.Xr)(P),(0,x.Xr)(F);let v=(0,x.Xr)(Y),w=(0,x.Xr)(E),[C,A]=(0,n.useState)(!1),[j,q]=(0,n.useState)(!1),[B,I]=(0,n.useState)(!1),[W,D]=(0,n.useState)(!1),[N,U]=(0,n.useState)(!1),[M,R]=(0,n.useState)(!1),[X,_]=(0,n.useState)(!1),[z,T]=(0,n.useState)(""),[Q,Z]=(0,n.useState)(null),[ee,ea]=(0,n.useState)(null),[er,et]=(0,n.useState)([]),[en,el]=(0,n.useState)([]),eo=j?er:en,ei=async()=>{if(!j){q(!0),T(""),et(await J(f,a,p));return}if(Q&&Q.getEditingCells().length>0){T("편집 중인 셀을 완료해주세요");return}if(T(""),j){_(!0);try{ea(null);let e=er.map(e=>e.isCarryover?{id:e.id,yearId:e.yearId,month:e.month,isCarryover:e.isCarryover,lamplePurchase:e.lampleBalance||0,lamplePayment:0,gompyoPurchase:e.gompyoBalance||0,gompyoPayment:0}:{id:e.id,yearId:e.yearId,month:e.month,isCarryover:e.isCarryover,lamplePurchase:e.lamplePurchase,lamplePayment:e.lamplePayment,gompyoPurchase:e.gompyoPurchase,gompyoPayment:e.gompyoPayment});await H(a,p,e),console.log("저장 완료!");let r=await $(a,p);v(r);let t=await J(r,a,p);et(t),el(t),w(e=>e+1)}catch(e){console.error("저장 실패:",e),ea(e instanceof Error?e.message:"저장에 실패했습니다."),_(!1);return}finally{_(!1)}}q(!1)},es=async()=>{q(!1),b(!1),et(await J(f,a,p))},ec=e=>{"add_year"===e?I(!0):u(e)};return(0,t.jsxs)("div",{className:"w-full min-h-screen bg-gray-100",children:[(0,t.jsxs)("div",{className:"p-4 sm:p-8",children:[(0,t.jsx)("h1",{className:"text-xl sm:text-2xl font-bold mb-4 sm:mb-6",children:"거래처 관리"}),ee&&(0,t.jsx)(l.A,{severity:"error",sx:{mb:2},onClose:()=>ea(null),children:ee}),(0,t.jsxs)(o.A,{direction:"row",spacing:2,className:"w-full justify-between items-center mb-4 sm:mb-6",children:[(0,t.jsxs)(o.A,{direction:"row",spacing:2,alignItems:"center",children:[(0,t.jsxs)(i.A,{size:"small",sx:{minWidth:200},disabled:j||C,children:[(0,t.jsx)(s.A,{children:"회사"}),(0,t.jsx)(d.A,{value:a,label:"회사",onChange:e=>r(e.target.value),disabled:j||C,children:e.map(e=>(0,t.jsxs)(m.A,{value:e.id,children:[e.name," (","payment"===e.type?"지급":"수금",")"]},e.id))})]}),(0,t.jsxs)(i.A,{size:"small",sx:{minWidth:120},disabled:j||C||!a,children:[(0,t.jsx)(s.A,{children:"연도"}),(0,t.jsxs)(d.A,{value:p,label:"연도",onChange:e=>ec(e.target.value),disabled:j||C||!a,children:[y.map(e=>(0,t.jsxs)(m.A,{value:e,children:[e,"년"]},e)),(0,t.jsx)(m.A,{value:"add_year",children:"+ 연도 추가"})]})]})]}),(0,t.jsxs)(o.A,{direction:"row",spacing:2,alignItems:"flex-start",children:[!j&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(c.A,{variant:"contained",color:"primary",onClick:()=>U(!0),disabled:C,sx:{minWidth:120,fontWeight:600,backgroundColor:"#22C55E","&:hover":{backgroundColor:"#16A34A"},"&:disabled":{backgroundColor:"#9CA3AF"},boxShadow:"none"},children:"회사 추가"}),(0,t.jsx)(c.A,{variant:"contained",color:"primary",onClick:()=>R(!0),disabled:C||!a,sx:{minWidth:120,fontWeight:600,backgroundColor:"#EF4444","&:hover":{backgroundColor:"#DC2626"},"&:disabled":{backgroundColor:"#9CA3AF"},boxShadow:"none"},children:"회사 삭제"}),(0,t.jsx)(c.A,{variant:"contained",color:"primary",onClick:()=>D(!0),disabled:C||0===eo.length||X||!a||!p,sx:{minWidth:120,fontWeight:600,backgroundColor:"#EF4444","&:hover":{backgroundColor:"#DC2626"},"&:disabled":{backgroundColor:"#9CA3AF"},boxShadow:"none"},children:"해당 연도 삭제"})]}),j&&(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(c.A,{variant:"outlined",color:"secondary",onClick:()=>{b(!0),T("")},disabled:X,sx:{minWidth:120,fontWeight:600,borderColor:"#EF4444",color:"#EF4444","&:hover":{backgroundColor:"#FEF2F2",borderColor:"#DC2626",color:"#DC2626"},"&:disabled":{borderColor:"#9CA3AF",color:"#9CA3AF"}},children:"편집 취소"})}),(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)(c.A,{variant:"contained",color:"secondary",onClick:ei,disabled:C||0===eo.length,sx:{minWidth:120,fontWeight:600,backgroundColor:j?"#f3f4f6":"#64748b",color:j?"#374151":"#fff","&:hover":{backgroundColor:j?"#e5e7eb":"#475569"},"&:disabled":{backgroundColor:"#9CA3AF"},boxShadow:"none",border:j?"1px solid #cbd5e1":"none"},children:j?X?"저장 중...":"편집 저장":"편집 모드"}),z&&(0,t.jsx)("span",{className:"text-red-500 text-xs mt-1 whitespace-nowrap",children:z})]})]})]}),e.length>0&&a&&p&&eo.length>0?(0,t.jsx)("div",{className:"overflow-hidden",children:(0,t.jsx)(g,{editMode:j,companies:e,selectedCompany:a,selectedYear:p,data:eo,loading:C,onDataChange:e=>{j&&et(e)},onGridReady:e=>{Z(e)}})}):(0,t.jsx)("div",{className:"w-full h-[600px] flex items-center justify-center text-gray-400",children:"회사와 연도를 선택해주세요."})]}),(0,t.jsx)(G,{open:B,onClose:()=>I(!1)}),(0,t.jsx)(V,{open:W,onClose:()=>D(!1)}),(0,t.jsx)(O,{open:N,onClose:()=>U(!1)}),(0,t.jsx)(L,{open:M,onClose:()=>R(!1),companyName:e.find(e=>e.id===a)?.name||""}),(0,t.jsx)(K,{open:h,onClose:()=>b(!1),onConfirm:es})]})}},84122:(e,a,r)=>{Promise.resolve().then(r.bind(r,82518))},87550:e=>{"use strict";e.exports=require("better-sqlite3")},94738:(e,a,r)=>{Promise.resolve().then(r.bind(r,61171))}};var a=require("../../webpack-runtime.js");a.C(e);var r=e=>a(a.s=e),t=a.X(0,[883,32,91,36,162,293,246,541,768,547,913,37,368],()=>r(45593));module.exports=t})();
