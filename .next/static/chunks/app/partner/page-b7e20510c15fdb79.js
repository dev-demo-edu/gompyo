(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8967],{36966:(e,r,a)=>{Promise.resolve().then(a.bind(a,38928))},38928:(e,r,a)=>{"use strict";a.d(r,{default:()=>$});var l=a(22318),t=a(20926),n=a(40309),o=a(92262),i=a(17859),s=a(51678),d=a(71599),c=a(21768),u=a(60660),m=a(66292),h=a(81759);let v=(e,r)=>{let a=[...e];a.sort((e,r)=>{var a,l;let t={이월잔액:0,"1월":1,"2월":2,"3월":3,"4월":4,"5월":5,"6월":6,"7월":7,"8월":8,"9월":9,"10월":10,"11월":11,"12월":12};return(null!==(a=t[e.month])&&void 0!==a?a:999)-(null!==(l=t[r.month])&&void 0!==l?l:999)});let l=0,t=0;for(let e=0;e<a.length;e++){let n=a[e];if(n.isCarryover)l=n.lampleBalance||0,t=n.gompyoBalance||0,n.totalBalance=l+t;else{let e=n.lamplePurchase||0,a=n.lamplePayment||0,o=n.gompyoPurchase||0,i=n.gompyoPayment||0;"payment"===r?(l=l-e+a,t=t-o+i):(l=l+e-a,t=t+o-i),n.lampleBalance=l,n.gompyoBalance=t,n.totalPurchase=e+o,n.totalPayment=a+i,n.totalBalance=l+t}}return a},f=e=>({...e,totalBalance:(e.lampleBalance||0)+(e.gompyoBalance||0)}),p=e=>null==e?"":new Intl.NumberFormat("ko-KR").format(e),y=e=>{if(null==e)return null;let r=String(e);if(!r||""===r.trim())return null;let a=parseFloat(r.replace(/,/g,""));return isNaN(a)?null:a};function x(e){let{companies:r,selectedCompany:a,selectedYear:n,data:o,loading:i=!1,editMode:s=!1,onDataChange:d,onGridReady:c}=e,u=r.find(e=>e.id===a),x=(null==u?void 0:u.type)==="payment",b=x?"구매":"판매",g=x?"지급":"수금",C=(null==u?void 0:u.type)||"collection",j=(0,t.useMemo)(()=>[{headerName:"월",suppressMovable:!0,headerClass:"text-center",field:"month",pinned:"left",filter:!1,sortable:!1,width:120,editable:!1,cellStyle:{fontWeight:"bold"}},{headerName:"램플",suppressMovable:!0,headerClass:"text-center",children:[{headerName:b,field:"lamplePurchase",suppressMovable:!0,filter:!1,sortable:!1,minWidth:120,flex:1,editable:e=>{var r;return s&&!(null===(r=e.data)||void 0===r?void 0:r.isCarryover)},valueFormatter:e=>{var r;return(null===(r=e.data)||void 0===r?void 0:r.isCarryover)?"":p(e.value)},valueSetter:e=>{let r=y(e.newValue);return e.data.lamplePurchase=r,d(v(o,C)),!0},cellStyle:e=>{var r;return s&&(null===(r=e.data)||void 0===r?void 0:r.isCarryover)?{backgroundColor:"#F3F4F6"}:{}}},{headerName:g,field:"lamplePayment",suppressMovable:!0,filter:!1,sortable:!1,minWidth:120,flex:1,editable:e=>{var r;return s&&!(null===(r=e.data)||void 0===r?void 0:r.isCarryover)},valueFormatter:e=>{var r;return(null===(r=e.data)||void 0===r?void 0:r.isCarryover)?"":p(e.value)},valueSetter:e=>{let r=y(e.newValue);return e.data.lamplePayment=r,d(v(o,C)),!0},cellStyle:e=>{var r;return s&&(null===(r=e.data)||void 0===r?void 0:r.isCarryover)?{backgroundColor:"#F3F4F6"}:{}}},{headerName:"잔액",field:"lampleBalance",suppressMovable:!0,filter:!1,sortable:!1,minWidth:120,flex:1,editable:e=>{var r;return s&&(null===(r=e.data)||void 0===r?void 0:r.isCarryover)},valueFormatter:e=>p(e.value),valueSetter:e=>{if(e.data.isCarryover){let r=y(e.newValue);e.data.lampleBalance=r;let a=f(e.data);return d(v(o.map(r=>r.id===e.data.id?a:r),C)),!0}return!1},cellStyle:e=>{var r;let a={};return!s||(null===(r=e.data)||void 0===r?void 0:r.isCarryover)||(a.backgroundColor="#F3F4F6"),e.value<0&&(a.color="red"),a}}]},{headerName:"곰표",headerClass:"text-center",suppressMovable:!0,children:[{headerName:b,filter:!1,field:"gompyoPurchase",suppressMovable:!0,sortable:!1,minWidth:120,flex:1,editable:e=>{var r;return s&&!(null===(r=e.data)||void 0===r?void 0:r.isCarryover)},valueFormatter:e=>{var r;return(null===(r=e.data)||void 0===r?void 0:r.isCarryover)?"":p(e.value)},valueSetter:e=>{let r=y(e.newValue);return e.data.gompyoPurchase=r,d(v(o,C)),!0},cellStyle:e=>{var r;return s&&(null===(r=e.data)||void 0===r?void 0:r.isCarryover)?{backgroundColor:"#F3F4F6"}:{}}},{headerName:g,filter:!1,field:"gompyoPayment",suppressMovable:!0,sortable:!1,minWidth:120,flex:1,editable:e=>{var r;return s&&!(null===(r=e.data)||void 0===r?void 0:r.isCarryover)},valueFormatter:e=>{var r;return(null===(r=e.data)||void 0===r?void 0:r.isCarryover)?"":p(e.value)},valueSetter:e=>{let r=y(e.newValue);return e.data.gompyoPayment=r,d(v(o,C)),!0},cellStyle:e=>{var r;return s&&(null===(r=e.data)||void 0===r?void 0:r.isCarryover)?{backgroundColor:"#F3F4F6"}:{}}},{headerName:"잔액",filter:!1,field:"gompyoBalance",suppressMovable:!0,sortable:!1,minWidth:120,flex:1,editable:e=>{var r;return s&&(null===(r=e.data)||void 0===r?void 0:r.isCarryover)},valueFormatter:e=>p(e.value),valueSetter:e=>{if(e.data.isCarryover){let r=y(e.newValue);e.data.gompyoBalance=r;let a=f(e.data);return d(v(o.map(r=>r.id===e.data.id?a:r),C)),!0}return!1},cellStyle:e=>{var r;let a={};return!s||(null===(r=e.data)||void 0===r?void 0:r.isCarryover)||(a.backgroundColor="#F3F4F6"),e.value<0&&(a.color="red"),a}}]},{headerName:"전체",headerClass:"text-center",children:[{headerName:b,filter:!1,suppressMovable:!0,sortable:!1,field:"totalPurchase",minWidth:120,flex:1,editable:!1,valueFormatter:e=>{var r;return(null===(r=e.data)||void 0===r?void 0:r.isCarryover)?"":p(e.value)},cellStyle:s?{backgroundColor:"#F3F4F6"}:{}},{headerName:g,filter:!1,suppressMovable:!0,sortable:!1,field:"totalPayment",minWidth:120,flex:1,editable:!1,valueFormatter:e=>{var r;return(null===(r=e.data)||void 0===r?void 0:r.isCarryover)?"":p(e.value)},cellStyle:s?{backgroundColor:"#F3F4F6"}:{}},{headerName:"잔액",filter:!1,suppressMovable:!0,sortable:!1,field:"totalBalance",minWidth:120,flex:1,editable:!1,valueFormatter:e=>p(e.value),cellStyle:e=>{let r=s?{backgroundColor:"#F3F4F6"}:{};return e.value<0?{...r,color:"red"}:r}}]}],[b,g,s,C,o,d]);return(0,l.jsx)("div",{className:"w-full h-[600px]",children:i?(0,l.jsx)("div",{className:"w-full h-full bg-gray-50 border border-gray-300 rounded-lg flex items-center justify-center",children:(0,l.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[(0,l.jsx)(h.A,{size:40}),(0,l.jsx)("p",{className:"text-gray-500",children:"데이터를 불러오는 중..."})]})}):o.length>0?(0,l.jsx)(m.A,{columnDefs:j,data:o,pagination:!1,onCellValueChanged:e=>{console.log("Grid: 셀 값 변경",{필드:e.colDef.field,이전값:e.oldValue,새값:e.newValue,행:e.data.month})},onGridReady:c}):(0,l.jsx)("div",{className:"w-full h-full bg-gray-50 border border-gray-300 rounded-lg flex items-center justify-center",children:(0,l.jsxs)("p",{className:"text-gray-500",children:[n,"년 데이터가 없습니다."]})})})}var b=a(86956),g=a(40017),C=a(57797),j=a(89085),A=a(57598),S=a(49812);let F=(0,S.eU)([]),w=(0,S.eU)(""),k=(0,S.eU)([]),P=(0,S.eU)(2025),W=(0,S.eU)([]),N=(0,S.eU)(0);var B=a(60720);let E=B.z.object({name:B.z.string().min(1,"회사명을 입력해주세요.").max(50,"회사명은 50자 이내로 입력해주세요.").trim(),type:B.z.enum(["payment","collection"],{errorMap:()=>({message:"회사 타입을 선택해주세요."})})}),M=B.z.object({year:B.z.string().min(1,"연도를 입력해주세요.").refine(e=>!isNaN(parseInt(e)),"올바른 숫자를 입력해주세요.").refine(e=>{let r=parseInt(e);return r>=1900&&r<=2100},"1900~2100 사이의 연도를 입력해주세요.")}),D=[{name:"name",label:"회사명",type:"text",required:!0},{name:"type",label:"회사 타입",type:"select",required:!0,options:[{label:"지급회사",value:"payment"},{label:"수금회사",value:"collection"}]}],R=[{name:"year",label:"연도",type:"text",required:!0,helperText:"1900~2100 사이의 연도를 입력해주세요."}];var X=a(49344),I=a(64358);let z=(0,I.createServerReference)("60a7ca32ef03f5ffc90daec271b7aed09bdb419a36",I.callServer,void 0,I.findSourceMapURL,"createCompany"),U=(0,I.createServerReference)("401f85b74817279bdb72026df9f07bf93f6938c701",I.callServer,void 0,I.findSourceMapURL,"deleteCompany"),L=(0,I.createServerReference)("6067bb744766495445252e053313a7c9ded00d9c0f",I.callServer,void 0,I.findSourceMapURL,"addYear"),V=(0,I.createServerReference)("60c4c8a437e3120dbfe17aedb6dcdb3a094317731b",I.callServer,void 0,I.findSourceMapURL,"deleteYear");function Y(e){let{open:r,onClose:a,onConfirm:t,title:n,message:o,loading:i=!1}=e;return(0,l.jsxs)(g.A,{open:r,onClose:a,maxWidth:"xs",fullWidth:!0,children:[(0,l.jsx)(C.A,{children:n}),(0,l.jsx)(j.A,{sx:{py:3},children:o}),(0,l.jsxs)(A.A,{sx:{px:3,pb:2,pt:0,justifyContent:"flex-end"},children:[(0,l.jsx)(d.A,{variant:"outlined",color:"primary",onClick:a,disabled:i,children:"취소"}),(0,l.jsx)(d.A,{variant:"contained",color:"primary",onClick:t,disabled:i,children:i?"처리 중...":"삭제"})]})]})}function _(e){let{open:r,onClose:a}=e,[n,o]=(0,t.useState)({}),[i,s]=(0,t.useState)(!1),d=(0,b.Xr)(N),c=(0,b.Xr)(w),u=(0,b.Xr)(P),m=(0,b.Xr)(k),h=()=>{o({}),a()},v=async e=>{s(!0);try{let{id:r}=await z(e.name,e.type);c(r);let a=new Date().getFullYear();u(a),m([a]),d(e=>e+1),h()}catch(e){o({name:e instanceof Error?e.message:"회사 추가 중 오류가 발생했습니다."})}finally{s(!1)}};return(0,l.jsxs)(g.A,{open:r,onClose:h,maxWidth:"xs",fullWidth:!0,children:[(0,l.jsx)(C.A,{children:"회사 추가"}),(0,l.jsx)(j.A,{sx:{py:3},children:(0,l.jsx)(X.A,{fields:D,onSubmit:v,onCancel:h,submitLabel:i?"추가 중...":"추가",zodSchema:E,fieldErrors:n})})]})}function T(e){let{open:r,onClose:a,companyName:n}=e,[o,i]=(0,t.useState)(!1),s=(0,b.md)(w),d=(0,b.Xr)(w),c=(0,b.Xr)(P),u=(0,b.Xr)(W),m=(0,b.Xr)(N),h=(0,b.Xr)(k),v=async()=>{if(s){i(!0);try{u([]),d(""),c(new Date().getFullYear()),h([]),await U(s),m(e=>e+1),a()}catch(e){console.error("회사 삭제 실패:",e),d(s),c(new Date().getFullYear()),h([])}finally{i(!1)}}};return(0,l.jsx)(Y,{open:r,onClose:a,onConfirm:v,title:"회사 삭제 확인",message:'정말로 "'.concat(n,'" 회사를 삭제하시겠습니까? 관련된 모든 재무 데이터도 함께 삭제됩니다.'),loading:o})}function q(e){let{open:r,onClose:a}=e,[n,o]=(0,t.useState)({}),[i,s]=(0,t.useState)(!1),d=(0,b.md)(k),c=(0,b.md)(w),u=(0,b.Xr)(N),m=()=>{o({}),a()},h=async e=>{if(!c){o({year:"회사를 먼저 선택해주세요."});return}let r=parseInt(e.year);if(d.includes(r)){o({year:"이미 존재하는 연도입니다."});return}s(!0);try{await L(c,r),u(e=>e+1),m()}catch(e){o({year:e instanceof Error?e.message:"연도 추가 중 오류가 발생했습니다."})}finally{s(!1)}};return(0,l.jsxs)(g.A,{open:r,onClose:m,maxWidth:"xs",fullWidth:!0,children:[(0,l.jsx)(C.A,{children:"연도 추가"}),(0,l.jsx)(j.A,{sx:{py:3},children:(0,l.jsx)(X.A,{fields:R,onSubmit:h,onCancel:m,submitLabel:i?"추가 중...":"추가",zodSchema:M,fieldErrors:n})})]})}function G(e){let{open:r,onClose:a}=e,[n,o]=(0,t.useState)(!1),[i,s]=(0,b.fp)(k),[c,u]=(0,b.fp)(P),m=(0,b.md)(w),h=(0,b.md)(F),v=(0,b.Xr)(N),f=(0,b.Xr)(w),p=(0,b.Xr)(W),[y,x]=(0,t.useState)(!1),S=async()=>{if(m&&c)try{if(1===i.length){x(!0);return}o(!0),await V(m,c);let e=i.filter(e=>e!==c);s(e),e.length>0&&u(e[0]),v(e=>e+1),a()}catch(e){console.error("년도 삭제 실패:",e)}finally{o(!1)}},B=async()=>{if(m){o(!0);try{p([]),f(""),u(new Date().getFullYear()),s([]),await U(m),v(e=>e+1),x(!1),a()}catch(e){console.error("회사 삭제 실패:",e),f(m),u(c),s(i)}finally{o(!1)}}};if(y){var E;let e=(null===(E=h.find(e=>e.id===m))||void 0===E?void 0:E.name)||"";return(0,l.jsxs)(g.A,{open:r,onClose:()=>x(!1),maxWidth:"sm",fullWidth:!0,children:[(0,l.jsx)(C.A,{sx:{color:"#EF4444",fontWeight:600},children:"⚠️ 회사 삭제 경고"}),(0,l.jsx)(j.A,{sx:{py:3},children:(0,l.jsxs)("div",{style:{lineHeight:1.6},children:[(0,l.jsxs)("p",{style:{marginBottom:"12px",fontSize:"16px"},children:[(0,l.jsxs)("strong",{children:[c,"년"]}),"이"," ",(0,l.jsxs)("strong",{children:["`",e,"`"]})," 회사의 마지막 연도입니다."]}),(0,l.jsx)("p",{style:{marginBottom:"12px",color:"#EF4444",fontWeight:500},children:"연도를 삭제하면 해당 회사까지 함께 삭제됩니다."}),(0,l.jsx)("p",{style:{color:"#6B7280"},children:"정말로 계속하시겠습니까?"})]})}),(0,l.jsxs)(A.A,{sx:{px:3,pb:2,pt:0,justifyContent:"flex-end"},children:[(0,l.jsx)(d.A,{variant:"outlined",color:"primary",onClick:()=>x(!1),disabled:n,children:"취소"}),(0,l.jsx)(d.A,{variant:"contained",sx:{backgroundColor:"#EF4444","&:hover":{backgroundColor:"#DC2626"}},onClick:B,disabled:n,children:n?"삭제 중...":"회사까지 삭제"})]})]})}return(0,l.jsx)(Y,{open:r,onClose:a,onConfirm:S,title:"연도 삭제 확인",message:"정말로 ".concat(c,"년 데이터를 삭제하시겠습니까?"),loading:n})}function O(e){let{open:r,onClose:a,onConfirm:t}=e;return(0,l.jsxs)(g.A,{open:r,onClose:a,maxWidth:"xs",fullWidth:!0,children:[(0,l.jsx)(C.A,{sx:{fontWeight:600},children:"편집 취소 확인"}),(0,l.jsxs)(j.A,{sx:{py:3},children:[(0,l.jsx)("p",{style:{marginBottom:"8px",color:"#374151"},children:"편집한 모든 변경사항이 저장되지 않습니다."}),(0,l.jsx)("p",{style:{color:"#6B7280"},children:"정말로 편집을 취소하시겠습니까?"})]}),(0,l.jsxs)(A.A,{sx:{px:3,pb:2,pt:0},children:[(0,l.jsx)(d.A,{onClick:a,variant:"outlined",color:"primary",children:"계속 편집"}),(0,l.jsx)(d.A,{onClick:t,variant:"contained",sx:{backgroundColor:"#EF4444","&:hover":{backgroundColor:"#DC2626"}},children:"취소하고 나가기"})]})]})}let H=(0,I.createServerReference)("00ea76b8afd93bec80376e61e1bb6580411dbf0f5f",I.callServer,void 0,I.findSourceMapURL,"fetchCompanies"),K=(0,I.createServerReference)("40ced9f35ffa1ba213608c8255e2f037dabef1775c",I.callServer,void 0,I.findSourceMapURL,"fetchAvailableYears"),J=(0,I.createServerReference)("60c88d6bffa079bbcde9d95beb7fb63f0fbdf8d6ed",I.callServer,void 0,I.findSourceMapURL,"fetchFinancialData"),Q=(0,I.createServerReference)("70a6b90c6bc0c32faba4cfcf8629360bb960cf34b4",I.callServer,void 0,I.findSourceMapURL,"saveFinancialData");async function Z(e,r,a){let l=(await H()).find(e=>e.id===r),t=(null==l?void 0:l.type)||"collection",n=[...e].sort((e,r)=>{var a,l;let t={이월잔액:0,"1월":1,"2월":2,"3월":3,"4월":4,"5월":5,"6월":6,"7월":7,"8월":8,"9월":9,"10월":10,"11월":11,"12월":12};return(null!==(a=t[e.month])&&void 0!==a?a:999)-(null!==(l=t[r.month])&&void 0!==l?l:999)}),o=[],i=0,s=0;for(let e=0;e<n.length;e++){let l=n[e];if(l.isCarryover)i=l.lamplePurchase||0,s=l.gompyoPurchase||0,o.push({...l,year:a,companyId:r,lampleBalance:i,gompyoBalance:s,totalPurchase:null,totalPayment:null,totalBalance:i+s});else{let e=l.lamplePurchase||0,n=l.lamplePayment||0,d=l.gompyoPurchase||0,c=l.gompyoPayment||0;"payment"===t?(i=i-e+n,s=s-d+c):(i=i+e-n,s=s+d-c);let u=e+d,m=n+c,h=i+s;o.push({...l,year:a,companyId:r,lampleBalance:i,gompyoBalance:s,totalPurchase:u||null,totalPayment:m||null,totalBalance:h})}}return o}function $(){var e;let r=(0,b.md)(F),[a,m]=(0,b.fp)(w),[h,v]=(0,b.fp)(P),f=(0,b.md)(W),p=(0,b.md)(k),y=(0,b.md)(N),[g,C]=(0,t.useState)(!1),j=(0,b.Xr)(F),A=(0,b.Xr)(k),S=(0,b.Xr)(W),B=(0,b.Xr)(N),[E,M]=(0,t.useState)(!1),[D,R]=(0,t.useState)(!1),[X,I]=(0,t.useState)(!1),[z,U]=(0,t.useState)(!1),[L,V]=(0,t.useState)(!1),[Y,$]=(0,t.useState)(!1),[ee,er]=(0,t.useState)(!1),[ea,el]=(0,t.useState)(""),[et,en]=(0,t.useState)(null),[eo,ei]=(0,t.useState)(null),[es,ed]=(0,t.useState)([]),[ec,eu]=(0,t.useState)([]);(0,t.useEffect)(()=>{(async()=>{if(a&&h)try{if(D)return;let e=await Z(f,a,h);eu(e)}catch(e){console.error("재무 데이터 계산 실패:",e),eu([])}})()},[f,D,a,h]);let em=D?es:ec;(0,t.useEffect)(()=>{(async()=>{try{ei(null);let e=await H();if(j(e),e.length>0){if(a&&e.find(e=>e.id===a)){let e=await K(a);A(e)}else{let r=e[0].id;m(r);let a=await K(r);A(a),a.length>0?v(a[0]):v(new Date().getFullYear())}}}catch(e){console.error("회사 목록 로드 실패:",e),ei(e instanceof Error?e.message:"회사 목록을 불러오는데 실패했습니다.")}})()},[y,a]),(0,t.useEffect)(()=>{(async()=>{if(a)try{let e=await K(a);A(e),0===e.length&&v(new Date().getFullYear())}catch(e){console.error("사용 가능한 연도 목록 조회 실패:",e),v(new Date().getFullYear())}})()},[a]),(0,t.useEffect)(()=>{(async()=>{if(!a||!h||0===r.length){S([]),ed([]);return}if(p.length>0&&!p.includes(h)){v(p[0]);return}M(!0);try{ei(null);let e=await J(a,h);if(S(e),!D){let r=await Z(e,a,h);ed(r)}}catch(e){console.error("데이터 로드 실패:",e),ei(e instanceof Error?e.message:"데이터를 불러오는데 실패했습니다."),S([]),ed([])}finally{M(!1)}})()},[a,h,y,p,r]);let eh=async()=>{if(!D){R(!0),el(""),ed(await Z(f,a,h));return}if(et&&et.getEditingCells().length>0){el("편집 중인 셀을 완료해주세요");return}if(el(""),D){er(!0);try{ei(null);let e=es.map(e=>e.isCarryover?{id:e.id,yearId:e.yearId,month:e.month,isCarryover:e.isCarryover,lamplePurchase:e.lampleBalance||0,lamplePayment:0,gompyoPurchase:e.gompyoBalance||0,gompyoPayment:0}:{id:e.id,yearId:e.yearId,month:e.month,isCarryover:e.isCarryover,lamplePurchase:e.lamplePurchase,lamplePayment:e.lamplePayment,gompyoPurchase:e.gompyoPurchase,gompyoPayment:e.gompyoPayment});await Q(a,h,e),console.log("저장 완료!");let r=await J(a,h);S(r);let l=await Z(r,a,h);ed(l),eu(l),B(e=>e+1)}catch(e){console.error("저장 실패:",e),ei(e instanceof Error?e.message:"저장에 실패했습니다."),er(!1);return}finally{er(!1)}}R(!1)},ev=async()=>{R(!1),C(!1),ed(await Z(f,a,h))},ef=e=>{"add_year"===e?I(!0):v(e)};return(0,l.jsxs)("div",{className:"w-full min-h-screen bg-gray-100",children:[(0,l.jsxs)("div",{className:"p-4 sm:p-8",children:[(0,l.jsx)("h1",{className:"text-xl sm:text-2xl font-bold mb-4 sm:mb-6",children:"거래처 관리"}),eo&&(0,l.jsx)(n.A,{severity:"error",sx:{mb:2},onClose:()=>ei(null),children:eo}),(0,l.jsxs)(o.A,{direction:"row",spacing:2,className:"w-full justify-between items-center mb-4 sm:mb-6",children:[(0,l.jsxs)(o.A,{direction:"row",spacing:2,alignItems:"center",children:[(0,l.jsxs)(i.A,{size:"small",sx:{minWidth:200},disabled:D||E,children:[(0,l.jsx)(s.A,{children:"회사"}),(0,l.jsx)(c.A,{value:a,label:"회사",onChange:e=>m(e.target.value),disabled:D||E,children:r.map(e=>(0,l.jsxs)(u.A,{value:e.id,children:[e.name," (","payment"===e.type?"지급":"수금",")"]},e.id))})]}),(0,l.jsxs)(i.A,{size:"small",sx:{minWidth:120},disabled:D||E||!a,children:[(0,l.jsx)(s.A,{children:"연도"}),(0,l.jsxs)(c.A,{value:h,label:"연도",onChange:e=>ef(e.target.value),disabled:D||E||!a,children:[p.map(e=>(0,l.jsxs)(u.A,{value:e,children:[e,"년"]},e)),(0,l.jsx)(u.A,{value:"add_year",children:"+ 연도 추가"})]})]})]}),(0,l.jsxs)(o.A,{direction:"row",spacing:2,alignItems:"flex-start",children:[!D&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(d.A,{variant:"contained",color:"primary",onClick:()=>V(!0),disabled:E,sx:{minWidth:120,fontWeight:600,backgroundColor:"#22C55E","&:hover":{backgroundColor:"#16A34A"},"&:disabled":{backgroundColor:"#9CA3AF"},boxShadow:"none"},children:"회사 추가"}),(0,l.jsx)(d.A,{variant:"contained",color:"primary",onClick:()=>$(!0),disabled:E||!a,sx:{minWidth:120,fontWeight:600,backgroundColor:"#EF4444","&:hover":{backgroundColor:"#DC2626"},"&:disabled":{backgroundColor:"#9CA3AF"},boxShadow:"none"},children:"회사 삭제"}),(0,l.jsx)(d.A,{variant:"contained",color:"primary",onClick:()=>U(!0),disabled:E||0===em.length||ee||!a||!h,sx:{minWidth:120,fontWeight:600,backgroundColor:"#EF4444","&:hover":{backgroundColor:"#DC2626"},"&:disabled":{backgroundColor:"#9CA3AF"},boxShadow:"none"},children:"해당 연도 삭제"})]}),D&&(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(d.A,{variant:"outlined",color:"secondary",onClick:()=>{C(!0),el("")},disabled:ee,sx:{minWidth:120,fontWeight:600,borderColor:"#EF4444",color:"#EF4444","&:hover":{backgroundColor:"#FEF2F2",borderColor:"#DC2626",color:"#DC2626"},"&:disabled":{borderColor:"#9CA3AF",color:"#9CA3AF"}},children:"편집 취소"})}),(0,l.jsxs)("div",{className:"flex flex-col",children:[(0,l.jsx)(d.A,{variant:"contained",color:"secondary",onClick:eh,disabled:E||0===em.length,sx:{minWidth:120,fontWeight:600,backgroundColor:D?"#f3f4f6":"#64748b",color:D?"#374151":"#fff","&:hover":{backgroundColor:D?"#e5e7eb":"#475569"},"&:disabled":{backgroundColor:"#9CA3AF"},boxShadow:"none",border:D?"1px solid #cbd5e1":"none"},children:D?ee?"저장 중...":"편집 저장":"편집 모드"}),ea&&(0,l.jsx)("span",{className:"text-red-500 text-xs mt-1 whitespace-nowrap",children:ea})]})]})]}),r.length>0&&a&&h&&em.length>0?(0,l.jsx)("div",{className:"overflow-hidden",children:(0,l.jsx)(x,{editMode:D,companies:r,selectedCompany:a,selectedYear:h,data:em,loading:E,onDataChange:e=>{D&&ed(e)},onGridReady:e=>{en(e)}})}):(0,l.jsx)("div",{className:"w-full h-[600px] flex items-center justify-center text-gray-400",children:"회사와 연도를 선택해주세요."})]}),(0,l.jsx)(q,{open:X,onClose:()=>I(!1)}),(0,l.jsx)(G,{open:z,onClose:()=>U(!1)}),(0,l.jsx)(_,{open:L,onClose:()=>V(!1)}),(0,l.jsx)(T,{open:Y,onClose:()=>$(!1),companyName:(null===(e=r.find(e=>e.id===a))||void 0===e?void 0:e.name)||""}),(0,l.jsx)(O,{open:g,onClose:()=>C(!1),onConfirm:ev})]})}},49344:(e,r,a)=>{"use strict";a.d(r,{A:()=>b});var l=a(22318),t=a(20926),n=a(92262),o=a(54069),i=a(2877),s=a(17859),d=a(51678),c=a(21768),u=a(60660),m=a(6987),h=a(27849),v=a(46558),f=a(71599),p=a(20063),y=a(90748);function x(e){return e.reduce((e,r)=>{var a,l,t;let n;return n="array"===r.type?null!==(a=r.defaultValue)&&void 0!==a?a:[]:"select"===r.type&&r.options&&r.options.length>0?null!==(l=r.defaultValue)&&void 0!==l?l:r.options[0].value:null!==(t=r.defaultValue)&&void 0!==t?t:"",{...e,[r.name]:n}},{})}function b(e){let{zodSchema:r,steps:a,fields:b,onSubmit:g,submitLabel:C="저장",zodSchemas:j,onCancel:A,fieldErrors:S={},initialValues:F={}}=e,w=!!a,[k,P]=(0,t.useState)(0),W=w?a[k].fields:b,[N,B]=(0,t.useState)(w?{...a.reduce((e,r)=>({...e,...x(r.fields)}),{}),...F}:{...x(b),...F}),[E,M]=(0,t.useState)({}),[D,R]=(0,t.useState)(!1),X=(e,r)=>{B(a=>({...a,[e]:r}))},I=e=>{B(r=>({...r,[e.name]:[...Array.isArray(r[e.name])?r[e.name]:[],x(e.fields)]}))},z=(e,r)=>{B(a=>({...a,[e.name]:Array.isArray(a[e.name])?a[e.name].filter((e,a)=>a!==r):[]}))},U=(e,r,a,l)=>{B(t=>({...t,[e.name]:Array.isArray(t[e.name])?t[e.name].map((e,t)=>t===r?{...e,[a]:l}:e):[]}))},L=e=>{let r={};return e.errors.forEach(e=>{r[e.path[0]]=e.message}),r},V=async e=>{let l;if(!D){if(e.preventDefault(),(l=w&&j?j[k].safeParse(N):r?r.safeParse(N):{success:!0,data:N})&&!l.success){M(L(l.error));return}M({}),R(!0);try{w&&k<a.length-1?P(e=>e+1):await g(N)}finally{R(!1)}}},Y=(e,r,a,f,x)=>{let b=S[e.name]||f;switch(e.type){case"text":case"number":case"date":return(0,l.jsx)(o.A,{label:e.label,name:e.name,type:"number"===e.type?"number":e.type,value:r,onChange:r=>a("number"===e.type?Number(r.target.value):r.target.value),fullWidth:!0,error:!!b,helperText:b||e.helperText,InputLabelProps:"date"===e.type?{shrink:!0}:void 0,InputProps:e.endAdornment?{endAdornment:(0,l.jsx)(i.A,{sx:{color:"inherit","& .MuiTypography-root":{color:"inherit"}},position:"end",children:e.endAdornment})}:void 0,sx:{mb:1}},e.name+(null!=x?x:""));case"select":var g;return(0,l.jsxs)(s.A,{fullWidth:!0,error:!!b,sx:{mb:1},children:[(0,l.jsx)(d.A,{children:e.label}),(0,l.jsx)(c.A,{value:r,label:e.label,onChange:e=>a(e.target.value),children:null===(g=e.options)||void 0===g?void 0:g.map(e=>(0,l.jsx)(u.A,{value:e.value,children:e.label},e.value))}),b&&(0,l.jsx)(m.A,{color:"error",variant:"caption",children:b})]},e.name+(null!=x?x:""));case"array":return(0,l.jsxs)(h.A,{sx:{mb:2},children:[(0,l.jsxs)(h.A,{display:"flex",alignItems:"center",mb:1,children:[(0,l.jsx)(m.A,{variant:"subtitle1",children:e.label}),(0,l.jsx)(v.A,{size:"small",onClick:()=>I(e),sx:{ml:1},children:(0,l.jsx)(p.A,{fontSize:"small"})})]}),(Array.isArray(r)?r:[]).map((r,a)=>(0,l.jsxs)(h.A,{sx:{border:"1px solid #eee",borderRadius:1,p:2,mb:1},children:[(0,l.jsxs)(h.A,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[(0,l.jsxs)(m.A,{variant:"body2",children:[e.label," #",a+1]}),(0,l.jsx)(v.A,{size:"small",onClick:()=>z(e,a),children:(0,l.jsx)(y.A,{fontSize:"small"})})]}),function(e){var r;let{field:a,item:h,onChange:v,errors:f}=e;return(0,l.jsx)(n.A,{spacing:1,mt:1,children:null===(r=a.fields)||void 0===r?void 0:r.map(e=>{let r=h[e.name];return(0,l.jsx)(t.Fragment,{children:(()=>{switch(e.type){case"text":case"number":case"date":return(0,l.jsx)(o.A,{label:e.label,name:e.name,type:"number"===e.type?"number":e.type,value:r,onChange:r=>v(e.name,"number"===e.type?Number(r.target.value):r.target.value),fullWidth:!0,error:!!f[e.name],helperText:f[e.name]||e.helperText,InputLabelProps:"date"===e.type?{shrink:!0}:void 0,InputProps:e.endAdornment?{endAdornment:(0,l.jsx)(i.A,{sx:{color:"inherit","& .MuiTypography-root":{color:"inherit"}},position:"end",children:e.endAdornment})}:void 0,sx:{mb:1}});case"select":var a;return(0,l.jsxs)(s.A,{fullWidth:!0,error:!!f[e.name],sx:{mb:1},children:[(0,l.jsx)(d.A,{children:e.label}),(0,l.jsx)(c.A,{value:r,label:e.label,onChange:r=>v(e.name,r.target.value),children:null===(a=e.options)||void 0===a?void 0:a.map(e=>(0,l.jsx)(u.A,{value:e.value,children:e.label},e.value))}),f[e.name]&&(0,l.jsx)(m.A,{color:"error",variant:"caption",children:f[e.name]})]});case"custom":return e.render?e.render({value:r,onChange:r=>v(e.name,r),error:f[e.name]}):null;default:return null}})()},e.name)})})}({field:e,item:r,onChange:(r,l)=>U(e,a,r,l),errors:{}})]},a))]},e.name);case"custom":return e.render?e.render({value:r,onChange:a,error:b}):null;default:return null}};return(0,l.jsxs)("form",{onSubmit:V,children:[w&&(0,l.jsx)(m.A,{variant:"h6",sx:{mb:2},children:a[k].label}),(0,l.jsx)(n.A,{spacing:2,sx:{mt:1},children:W.map(e=>Y(e,N[e.name],r=>X(e.name,r),E[e.name]))}),(0,l.jsxs)(h.A,{display:"flex",flexDirection:"row",justifyContent:"flex-end",gap:2,mt:2,children:[w&&k>0&&(0,l.jsx)(f.A,{variant:"outlined",color:"primary",onClick:()=>P(e=>e-1),children:"이전"}),"function"==typeof A&&(0,l.jsx)(f.A,{variant:"outlined",color:"primary",onClick:A,children:"취소"}),(0,l.jsx)(f.A,{type:"submit",variant:"contained",color:"primary",sx:{fontWeight:600},disabled:D,children:w&&k<a.length-1?"다음":C})]})]})}}},e=>{var r=r=>e(e.s=r);e.O(0,[1775,8082,7045,3336,4069,6510,4090,2394,6956,9052,4379,6292,9039,1077,7358],()=>r(36966)),_N_E=e.O()}]);
