(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8259],{2123:(e,t,r)=>{"use strict";r.d(t,{FX:()=>o,Jd:()=>d,cX:()=>i,mg:()=>l,zG:()=>n});var a=r(32921);let n=[{field:"contractNumber",headerName:"계약 번호",width:130},{field:"progressStatus",headerName:"진행 상태",width:100},{field:"contractDate",headerName:"계약일자",valueFormatter:a.Kg,width:150},{field:"exporter",headerName:"공급업체",width:120},{field:"importer",headerName:"수입회사",width:120},{field:"estimatedTimeArrival",headerName:"ETA",valueFormatter:a.Kg,width:150},{field:"arrivalPort",headerName:"도착항",width:120},{field:"itemName",headerName:"품목",width:120},{field:"contractTon",headerName:"무게",valueFormatter:e=>"".concat(e.value,"톤"),width:100},{field:"packingUnit",headerName:"포장 단위",width:130},{field:"unitPrice",headerName:"단가",valueFormatter:a.sg,width:130},{field:"totalPriceUsd",headerName:"단가 * 톤수",valueFormatter:a.sg,width:150},{field:"paymentMethod",headerName:"결제방식",width:100},{field:"warehouseEntryDate",headerName:"입고일",valueFormatter:a.Kg,width:150},{field:"importCostPerKg",headerName:"수입가/kg",valueFormatter:a.gt,width:130},{field:"supplyCostPerKg",headerName:"수급가/kg",valueFormatter:a.gt,width:130},{field:"totalCost",headerName:"총 비용",valueFormatter:a.ye,width:150},{field:"totalCostPerKg",headerName:"총 비용/kg",valueFormatter:a.gt,width:130},{field:"sellingPrice",headerName:"판매가",valueFormatter:a.ye,width:130},{field:"margin",headerName:"마진",valueFormatter:a.ye,width:100},{field:"totalProfit",headerName:"총 이익",valueFormatter:a.ye,width:150}],i=[{field:"contractNumber",headerName:"계약 번호",width:130},{field:"progressStatus",headerName:"진행 상태",width:100},{field:"contractDate",headerName:"계약일자",valueFormatter:a.Kg,width:150},{field:"importer",headerName:"수입회사",width:120},{field:"productName",headerName:"품종",width:150},{field:"itemName",headerName:"품목",width:120},{field:"weight",headerName:"무게",valueFormatter:e=>"".concat(e.value,"톤"),width:100},{field:"containerCount",headerName:"컨테이너 개수",width:120},{field:"packingUnit",headerName:"포장 단위",width:100},{field:"unitPrice",headerName:"단가",valueFormatter:a.sg,width:130},{field:"totalPriceUsd",headerName:"단가 * 톤수",valueFormatter:a.sg,width:150},{field:"supplyPrice",headerName:"수급가",valueFormatter:a.ye,width:130},{field:"sellingPrice",headerName:"판매가",valueFormatter:a.ye,width:130},{field:"paymentMethod",headerName:"결제방식",width:100},{field:"hsCode",headerName:"HS CODE",width:120},{field:"blNumber",headerName:"BL no.",width:120},{field:"departurePort",headerName:"port(출발항)",width:120},{field:"etd",headerName:"ETD",valueFormatter:a.Kg,width:150},{field:"arrivalPort",headerName:"port(도착항)",width:120},{field:"eta",headerName:"ETA",valueFormatter:a.Kg,width:150},{field:"exporter",headerName:"공급업체",width:120},{field:"customsDate",headerName:"통관일자",valueFormatter:a.Kg,width:150}],l=n.map(e=>({field:e.field,width:e.width||100})),o=i.map(e=>({field:e.field,width:e.width||100})),d=[{field:"companyColumnName",width:150}]},6624:(e,t,r)=>{"use strict";r.d(t,{default:()=>Z});var a=r(22318),n=r(20926),i=r(27333),l=r.n(i),o=r(66292),d=r(64358);let c=(0,d.createServerReference)("007414b2f3dbd4feee779bd8064c0480c8d85fb29c",d.callServer,void 0,d.findSourceMapURL,"getUserQuotationColumnOrder"),s=(0,d.createServerReference)("40468492781adb2263175f4245f0937589ae77cf6b",d.callServer,void 0,d.findSourceMapURL,"saveUserQuotationColumnOrder");var m=r(50757),u=r(2123);function h(e){let{items:t,companies:r,priceData:i,setSelectedRows:d,selectedColumns:h,setSelectedColumns:f,formatNumber:p,onCompanySelect:g,onItemsSelect:v,onCellValueChanged:x,selectedColumnsForManagement:b,setSelectedColumnsForManagement:y,onColumnOrderChange:C}=e,[N,j]=(0,n.useState)([]);(0,n.useEffect)(()=>{(async()=>{try{let e=await c();j(e||u.Jd)}catch(e){console.error("컬럼 순서 로딩 오류:",e),j(u.Jd)}})()},[]),(0,n.useEffect)(()=>{if(t.length>0&&N.length>0){let e=t.map(e=>e.id),r=N.filter(e=>"companyColumnName"!==e.field).map(e=>e.field),a=e.filter(e=>!r.includes(e)),n=r.filter(t=>!e.includes(t)),i=!1,l=[...N];a.length>0&&(l=[...l,...a.map(e=>({field:e,width:150}))],i=!0,console.log("새 품목 ".concat(a.length,"개가 컬럼 순서에 추가됩니다."))),n.length>0&&(l=l.filter(e=>"companyColumnName"===e.field||!n.includes(e.field)),i=!0,console.log("삭제된 품목 ".concat(n.length,"개가 컬럼 순서에서 제거됩니다."))),i&&s(l).then(e=>{e.success&&(j(l),null==C||C(l),console.log("컬럼 순서가 업데이트되었습니다."))}).catch(e=>{console.error("컬럼 순서 업데이트 오류:",e)})}},[t,N]);let w=(0,n.useCallback)(async e=>{let t=e.api.getColumnState().filter(e=>"checkbox"!==e.colId).map(e=>({field:e.colId,width:e.width||100}));try{(await s(t)).success&&(j(t),null==C||C(t))}catch(e){console.error("컬럼 순서 저장 중 오류:",e)}},[]),{onDragStarted:S,onDragStopped:A}=(0,m.A)(w),F=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:250,a=(e.match(/[가-힣]/g)||[]).length,n=e.length-a;return Math.max(t,Math.min(r,16*a+8*n+40))},k=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:250;return Math.max(t,Math.min(r,Math.max(...e.map(e=>F(e,0,1/0)))))},E=e=>{var t;let{data:r,colDef:n}=e;if(!r)return null;let l=r.id,o=null==n?void 0:n.field,d=(null===(t=i[l])||void 0===t?void 0:t[o||""])||0;return(0,a.jsx)("div",{className:"w-full h-full flex items-center justify-start",children:(0,a.jsx)("span",{children:d>0?p(d):""})})},O=e=>{let r=e.displayName,n=t.find(e=>"".concat(e.name," (").concat(e.origin,")")===r),i=(null==n?void 0:n.id)||r,l=e.selectedColumns[i],o=(null==b?void 0:b[i])||!1;return(0,a.jsx)("div",{className:"w-full h-full flex items-center justify-start cursor-pointer px-[24px] ".concat(o?"bg-blue-200 font-bold":""),onClick:()=>{let t={...e.selectedColumns,[i]:!l};f(t),v(Object.keys(t).filter(e=>t[e])),y&&y({...b,[i]:!o})},children:(0,a.jsx)("span",{children:r})})},D=(0,n.useMemo)(()=>{var e;let a=[{headerName:"",checkboxSelection:!0,minWidth:50,flex:1,headerCheckboxSelection:!1,filter:!1,pinned:"left",lockPinned:!0,width:70,field:"checkbox"},{headerName:"업체명",field:"companyColumnName",pinned:"left",width:(null===(e=N.find(e=>"companyColumnName"===e.field))||void 0===e?void 0:e.width)||k([...r.map(e=>e.companyColumnName),"업체명"],120,250),sortable:!1}],n=t.map(e=>{var t;return{headerName:"".concat(e.name," (").concat(e.origin,")"),headerClass:"item-header",field:e.id,headerComponent:t=>O({...t,displayName:"".concat(e.name," (").concat(e.origin,")"),selectedColumns:h,setSelectedColumns:f}),minWidth:100,width:(null===(t=N.find(t=>t.field===e.id))||void 0===t?void 0:t.width)||F("".concat(e.name," (").concat(e.origin,")")),cellRenderer:E,editable:!0,sortable:!1}});return[...a,...N.length>1?N.filter(e=>"companyColumnName"!==e.field).map(e=>n.find(t=>t.field===e.field)).filter(e=>void 0!==e).concat(n.filter(e=>!N.some(t=>t.field===e.field))):n]},[N,t,r,h,f]),R=r.map(e=>{let r={id:e.id,companyColumnName:e.companyColumnName};return t.forEach(t=>{var a;r[t.id]=(null===(a=i[e.id])||void 0===a?void 0:a[t.id])||0}),r});return(0,a.jsx)("div",{className:"w-full h-[600px] lg:h-full",children:(0,a.jsxs)("div",{className:"jsx-d081cf3d79c8ea3c w-full h-full",children:[(0,a.jsx)(l(),{id:"d081cf3d79c8ea3c",children:"div.jsx-d081cf3d79c8ea3c .ag-header-cell.item-header{padding:0!important}"}),(0,a.jsx)(o.A,{columnDefs:D,data:R,pagination:!1,loading:!1,onSelectionChanged:e=>{let a=e.api.getSelectedNodes();if(1===a.length){let e=a[0].data.id;d({[e]:!0});let n=i[e]||{},l=[];t.forEach(e=>{let t=n[e.id];t&&t>0&&l.push(e.id)});let o={};l.forEach(e=>{o[e]=!0}),f(o),g(r.find(t=>t.id===e)||null),v(l)}else d({}),f({}),g(null),v([])},onCellValueChanged:x,onDragStarted:S,onDragStopped:A,rowSelection:"single"})]})})}var f=r(40017),p=r(57797),g=r(89085),v=r(49344),x=r(60720);let b=x.z.object({name:x.z.string().min(1,"업체명을 입력해주세요."),description:x.z.string().optional(),priceType:x.z.enum(["arrival","loading"])}),y=[{name:"name",label:"업체명",type:"text",required:!0},{name:"priceType",label:"가격 유형",type:"select",options:[{label:"도착도",value:"arrival"},{label:"상차도",value:"loading"}],required:!0}];function C(e){let{onClose:t,onSubmit:r,submitLabel:i="추가"}=e,[l,o]=(0,n.useState)({}),d=async e=>{try{r(e),o({}),null==t||t()}catch(e){e instanceof Error?o({name:e.message}):o({name:"오류가 발생했습니다."})}};return(0,a.jsx)(v.A,{fields:y,onSubmit:d,submitLabel:i,zodSchema:b,fieldErrors:l})}function N(e){let{onClose:t,onSubmit:r,submitLabel:i="수정",selectedCompany:l}=e,[o,d]=(0,n.useState)({});if(!l)return null;let c=async e=>{try{r(e),d({}),null==t||t()}catch(e){e instanceof Error?d({name:e.message}):d({name:"오류가 발생했습니다."})}};return(0,a.jsx)(v.A,{fields:y,onSubmit:c,submitLabel:i,zodSchema:b,fieldErrors:o,initialValues:{name:l.companyName,priceType:l.priceType}})}let j=x.z.object({itemName:x.z.string().min(1,"제품명을 입력해주세요."),itemOrigin:x.z.string().min(1,"원산지를 입력해주세요."),itemNameEn:x.z.string().min(1,"제품명(영문)을 입력해주세요."),itemOriginEn:x.z.string().min(1,"원산지(영문)을 입력해주세요.")}),w=[{name:"itemName",label:"제품명",type:"text",required:!0},{name:"itemOrigin",label:"원산지",type:"text",required:!0},{name:"itemNameEn",label:"제품명(영문)",type:"text",required:!0},{name:"itemOriginEn",label:"원산지(영문)",type:"text",required:!0}];function S(e){let{onClose:t,onSubmit:r,submitLabel:i="추가"}=e,[l,o]=(0,n.useState)({}),d=async e=>{try{r(e),o({}),null==t||t()}catch(e){e instanceof Error?o({itemName:e.message}):o({itemName:"오류가 발생했습니다."})}};return(0,a.jsx)(v.A,{fields:w,onSubmit:d,submitLabel:i,zodSchema:j,fieldErrors:l})}function A(e){var t,r;let{onClose:i,onSubmit:l,submitLabel:o="수정",selectedItem:d}=e,[c,s]=(0,n.useState)({});if(!d)return null;let m=async e=>{try{l(e),s({}),null==i||i()}catch(e){e instanceof Error?s({itemName:e.message}):s({itemName:"오류가 발생했습니다."})}};return(0,a.jsx)(v.A,{fields:w,onSubmit:m,submitLabel:o,zodSchema:j,initialValues:{itemName:d.itemName,itemOrigin:d.itemOrigin,itemNameEn:null!==(t=d.itemNameEn)&&void 0!==t?t:"",itemOriginEn:null!==(r=d.itemOriginEn)&&void 0!==r?r:""},fieldErrors:c})}var F=r(57598),k=r(75746);function E(e){let{open:t,onClose:r,onConfirm:n,title:i,message:l}=e;return(0,a.jsxs)(f.A,{open:t,onClose:r,maxWidth:"xs",fullWidth:!0,children:[(0,a.jsx)(p.A,{children:i}),(0,a.jsx)(g.A,{sx:{py:3},children:l}),(0,a.jsxs)(F.A,{sx:{px:3,pb:2,pt:0,justifyContent:"flex-end"},children:[(0,a.jsx)(k.A,{variant:"outline",onClick:r,children:"취소"}),(0,a.jsx)(k.A,{variant:"outline-danger",onClick:n,children:"삭제"})]})]})}function O(e){let{open:t,onClose:r,onConfirm:n}=e;return(0,a.jsx)(E,{open:t,onClose:r,onConfirm:n,title:"업체 삭제 확인",message:"정말로 선택한 업체를 삭제하시겠습니까?"})}function D(e){let{open:t,onClose:r,onConfirm:n}=e;return(0,a.jsx)(E,{open:t,onClose:r,onConfirm:n,title:"품목 삭제 확인",message:"정말로 선택한 품목을 삭제하시겠습니까?"})}function R(e){let{open:t,onClose:r,onSubmit:n}=e;return(0,a.jsxs)(f.A,{open:t,onClose:r,maxWidth:"xs",fullWidth:!0,children:[(0,a.jsx)(p.A,{children:"업체 추가"}),(0,a.jsx)(g.A,{children:(0,a.jsx)(C,{onClose:r,onSubmit:n})})]})}function I(e){let{open:t,onClose:r,onSubmit:n,selectedCompany:i}=e;return(0,a.jsxs)(f.A,{open:t,onClose:r,maxWidth:"xs",fullWidth:!0,children:[(0,a.jsx)(p.A,{children:"업체 수정"}),(0,a.jsx)(g.A,{children:(0,a.jsx)(N,{onClose:r,onSubmit:n,selectedCompany:i})})]})}function T(e){let{open:t,onClose:r,onSubmit:n}=e;return(0,a.jsxs)(f.A,{open:t,onClose:r,maxWidth:"xs",fullWidth:!0,children:[(0,a.jsx)(p.A,{children:"품목 추가"}),(0,a.jsx)(g.A,{children:(0,a.jsx)(S,{onClose:r,onSubmit:n})})]})}function P(e){let{open:t,onClose:r,onSubmit:n,selectedItem:i}=e;return(0,a.jsxs)(f.A,{open:t,onClose:r,maxWidth:"xs",fullWidth:!0,children:[(0,a.jsx)(p.A,{children:"품목 수정"}),(0,a.jsx)(g.A,{children:(0,a.jsx)(A,{onClose:r,onSubmit:n,selectedItem:i})})]})}function L(e){let{open:t,onClose:r,onDownload:i,onOpenInNewWindow:l}=e,[o,d]=(0,n.useState)(!1),[c,s]=(0,n.useState)(!1),m=async()=>{if(!o)try{d(!0),await i()}finally{d(!1)}},u=async()=>{if(!c)try{s(!0),await l()}finally{s(!1)}},h=o||c;return(0,a.jsxs)(f.A,{open:t,onClose:r,maxWidth:"xs",fullWidth:!0,children:[(0,a.jsx)(p.A,{children:"견적서 출력"}),(0,a.jsx)(g.A,{sx:{py:3},children:"아래 버튼을 클릭하여 견적서를 출력할 수 있습니다."}),(0,a.jsxs)(F.A,{sx:{px:3,pb:2,pt:0,justifyContent:"flex-end"},children:[(0,a.jsx)(k.A,{variant:"outline",onClick:r,disabled:h,children:"창 닫기"}),(0,a.jsx)(k.A,{variant:"primary",onClick:m,disabled:h,children:o?"다운로드 중...":"다운로드"}),(0,a.jsx)(k.A,{variant:"primary",onClick:u,disabled:h,children:c?"새창 열기 중...":"새창에서 열기"})]})]})}var M=r(92262),U=r(40404),W=r(39390);let z=(0,d.createServerReference)("000b6a598631e8ad4441c12a5edde48f117fd00b6c",d.callServer,void 0,d.findSourceMapURL,"getDomesticAction"),K=(0,d.createServerReference)("00a4ee9f22c9e0ce739a2c5f3c893603821f38a147",d.callServer,void 0,d.findSourceMapURL,"getForeignerAction"),V=(0,d.createServerReference)("402d9d90d97a58c0aa9c8a6f8ce0757f26c7ff3943",d.callServer,void 0,d.findSourceMapURL,"addQuotationCompanyAction"),Q=(0,d.createServerReference)("4032d36cfc090494fc968bab03d8925a824d73f420",d.callServer,void 0,d.findSourceMapURL,"updateQuotationCellAction"),B=(0,d.createServerReference)("408ea21b0c05e41268cbd75c8a1abda3d1b6acbcea",d.callServer,void 0,d.findSourceMapURL,"addQuotationItemAction"),J=(0,d.createServerReference)("40ddafa0e9d4a16cd6e62d6c0c77db8d024d068fdc",d.callServer,void 0,d.findSourceMapURL,"deleteQuotationCompanyAction"),_=(0,d.createServerReference)("40fb85a9d73544f75bec10762291200ad1f2d2953b",d.callServer,void 0,d.findSourceMapURL,"deleteQuotationItemAction"),q=(0,d.createServerReference)("60d1bf711da514ccb2071f954f7ef3ce4ea876c4ee",d.callServer,void 0,d.findSourceMapURL,"updateCompanyAction"),X=(0,d.createServerReference)("607a3946c2f80ba49fe99e6eeaccbee9827efaf1a1",d.callServer,void 0,d.findSourceMapURL,"updateItemAction"),G=(0,d.createServerReference)("40dc10624bb247cbdc6de547478c381cc1727e08c6",d.callServer,void 0,d.findSourceMapURL,"generateQuotationPDF");var H=r(80681);let Y=()=>{let e=new Date,t=e.getFullYear().toString(),r=(e.getMonth()+1).toString().padStart(2,"0"),a=e.getDate().toString().padStart(2,"0"),n=Math.floor(1e4*Math.random()).toString().padStart(4,"0");return"GP".concat(t).concat(r).concat(a).concat(n)};function Z(){let[e,t]=(0,n.useState)(!1),[r,i]=(0,n.useState)(!1),[l,o]=(0,n.useState)(!1),[d,s]=(0,n.useState)(!1),[m,f]=(0,n.useState)(!1),[p,g]=(0,n.useState)(!1),[v,x]=(0,n.useState)(null),[b,y]=(0,n.useState)(!1),[C,N]=(0,n.useState)([]),[j,w]=(0,n.useState)({}),[S,A]=(0,n.useState)({}),[F,E]=(0,n.useState)({});(0,n.useEffect)(()=>{(async()=>{try{let e=await c();N(e||u.Jd)}catch(e){console.error("컬럼 순서 로딩 오류:",e),N(u.Jd)}})()},[]);let Z=(0,n.useCallback)(e=>{N(e)},[]),[$,ee]=(0,n.useState)([]),[et,er]=(0,n.useState)([]),[ea,en]=(0,n.useState)({}),[ei,el]=(0,n.useState)([]),[eo,ed]=(0,n.useState)([]),[ec,es]=(0,n.useState)({}),[em,eu]=(0,n.useState)("domestic"),eh="domestic"===em?$:ei,ef="domestic"===em?et:eo,ep="domestic"===em?ea:ec,eg="domestic"===em?ee:el,ev="domestic"===em?er:ed,ex="domestic"===em?en:es;(0,n.useEffect)(()=>{(async()=>{let e=await z();ee(e.items),er(e.companies.map(e=>({...e,companyColumnName:ey(e.companyName,e.priceType)}))),en(e.priceData);let t=await K();el(t.items),ed(t.companies.map(e=>({...e,companyColumnName:ey(e.companyName,e.priceType)}))),es(t.priceData),console.log("domesticData",e),console.log("overseasData",t);try{let e=await c();N(e||u.Jd)}catch(e){console.error("컬럼 순서 로딩 오류:",e),N(u.Jd)}})()},[]);let eb=e=>new Intl.NumberFormat("ko-KR").format(e),ey=(e,t)=>"arrival"===t?"".concat(e," (도착도)"):"".concat(e," (상차도)"),eC=(e,t,r)=>{if(r.some(r=>r.companyName===e&&r.priceType===t))throw Error("이미 존재하는 업체명과 가격 타입입니다. (".concat(e," - ").concat("arrival"===t?"도착도":"상차도",")"))},eN=(e,t,r)=>{if(r.some(r=>r.itemName===e&&r.itemOrigin===t))throw Error("이미 존재하는 품목입니다. (".concat(e," - ").concat(t,")"))},ej=()=>{let e=[];return Object.entries(j).forEach(t=>{let[r,a]=t;a&&Object.entries(S).forEach(t=>{let[a,n]=t;if(n){var i;let t=eh.find(e=>e.id===a),n=ef.find(e=>e.id===r),l=(null===(i=ep[r])||void 0===i?void 0:i[a])||0;l>0&&e.push({productCode:a,productName:(null==t?void 0:t.itemName)||"",origin:(null==t?void 0:t.itemOrigin)||"",company:(null==n?void 0:n.companyName)||r,priceType:(null==n?void 0:n.priceType)||"",price:l,originEn:(null==t?void 0:t.itemOriginEn)||"",productNameEn:(null==t?void 0:t.itemNameEn)||""})}})}),e.sort((e,t)=>{let r=C.findIndex(t=>t.field===e.productCode),a=C.findIndex(e=>e.field===t.productCode);return -1===r&&-1===a?0:-1===r?1:-1===a?-1:r-a})},ew=e=>{let t=Object.keys(F).filter(e=>F[e]);0!==t.length&&(eN(e.itemName,e.itemOrigin,eh),X(t[0],{itemName:e.itemName,itemOrigin:e.itemOrigin,itemNameEn:e.itemNameEn,itemOriginEn:e.itemOriginEn}),eg(r=>r.map(r=>r.id===t[0]?{...r,itemName:e.itemName,itemOrigin:e.itemOrigin,itemNameEn:e.itemNameEn,itemOriginEn:e.itemOriginEn}:r)),E({}),s(!1))},eS=async e=>{try{let t=e.data.id,r=e.column.getColId(),a=e.newValue,n=e.oldValue,i=e.data[r];if(console.log("=== 셀 값 변경 디버깅 ==="),console.log("companyId:",t),console.log("itemId:",r),console.log("newValue:",a),console.log("oldValue:",n),console.log("currentValue:",i),console.log("params:",e),!r||"string"!=typeof r||"companyColumnName"===r){console.log("itemId가 유효하지 않음, 처리 중단");return}let l=void 0!==a?a:i,o=""===l||null==l?null:Number(l);console.log("finalValue:",l),console.log("numericValue:",o),ex(e=>({...e,[t]:{...e[t],[r]:o||0}})),await Q({itemId:r,companyId:t,value:o}),console.log("셀 값 업데이트 완료: 회사 ".concat(t,", 제품 ").concat(r,", 값 ").concat(o))}catch(e){console.error("셀 값 업데이트 실패:",e),alert("가격 업데이트에 실패했습니다. 다시 시도해주세요.")}},eA=async()=>{let e=ej();if(0===e.length)throw Error("선택된 견적 항목이 없습니다.");console.log("PDF 생성 시 컬럼 순서:",C),console.log("PDF 생성 시 견적 데이터:",e);let t=e.sort((e,t)=>{let r=C.findIndex(t=>t.field===e.productCode),a=C.findIndex(e=>e.field===t.productCode);return -1===r&&-1===a?0:-1===r?1:-1===a?-1:r-a});console.log("PDF 생성 시 정렬된 견적 데이터:",t);let r=await G({sender:"㈜ 곰표",receiver:t[0].company,date:new Date().toISOString().split("T")[0],items:t.map((e,t)=>({no:t+1,name:e.productName,originEn:e.originEn,nameEn:e.productNameEn,price:e.price})),documentNumber:Y(),priceType:t[0].priceType,reference:""});if(!r.success||!r.pdf)throw Error(r.error||"PDF 생성에 실패했습니다.");let a=atob(r.pdf),n=new Uint8Array(a.length);for(let e=0;e<a.length;e++)n[e]=a.charCodeAt(e);return{bytes:n,filename:r.filename||"견적서.pdf"}},eF=async()=>{try{let{bytes:e,filename:t}=await eA(),r=new Blob([e],{type:"application/pdf"}),a=URL.createObjectURL(r),n=document.createElement("a");n.href=a,n.download=t,n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(a),console.log("PDF 다운로드 완료:",t)}catch(e){console.error("PDF 다운로드 중 오류 발생:",e),alert("PDF 다운로드 중 오류가 발생했습니다: "+(e instanceof Error?e.message:"알 수 없는 오류"))}},ek=async()=>{try{let{bytes:e,filename:t}=await eA(),r=new Blob([e],{type:"application/pdf"}),a=URL.createObjectURL(r),n=window.open(a,"_blank");if(n)n.addEventListener("load",()=>{try{n.document.title=t}catch(e){console.warn("새 창 제목 설정 실패:",e)}}),setTimeout(()=>{URL.revokeObjectURL(a)},1e3),console.log("PDF 새 창에서 열기 완료:",t);else{alert("팝업이 차단되었습니다. 다운로드로 진행합니다.");let e=document.createElement("a");e.href=a,e.download=t,e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e),URL.revokeObjectURL(a),console.log("팝업 차단으로 다운로드 대체 완료:",t)}}catch(e){console.error("PDF 새창 열기 중 오류 발생:",e),alert("PDF 새창 열기 중 오류가 발생했습니다: "+(e instanceof Error?e.message:"알 수 없는 오류"))}};return(0,a.jsxs)("div",{className:"w-full min-h-screen bg-gray-100",children:[(0,a.jsxs)("div",{className:"p-4 sm:p-8",children:[(0,a.jsx)("div",{className:"flex flex-col lg:flex-row lg:items-center sm:justify-between mb-4 sm:mb-6 gap-4",children:(0,a.jsx)("h1",{className:"text-xl sm:text-2xl font-bold",children:"견적서 작성"})}),(0,a.jsxs)(M.A,{direction:{xs:"column",lg:"row"},spacing:2,children:[(0,a.jsx)("div",{className:"flex flex-row justify-between items-end flex-shrink-0 overflow-x-auto",style:{minHeight:24},children:(0,a.jsxs)(U.A,{value:em,onChange:(e,t)=>eu(t),sx:{"& .MuiTabs-indicator":{backgroundColor:"#22C55E"},"& .MuiTab-root":{color:"#6B7280","&.Mui-selected":{color:"#22C55E"},"&:hover":{color:"#16A34A"}}},children:[(0,a.jsx)(W.A,{label:"국내 업체",value:"domestic"}),(0,a.jsx)(W.A,{label:"해외 업체",value:"overseas"})]})}),(0,a.jsx)("div",{className:"overflow-auto w-full",children:(0,a.jsxs)(M.A,{direction:"row",spacing:2,sx:{width:"100%",justifyContent:{xs:"flex-start",lg:"flex-end"},pb:1,overflowX:"auto",flexWrap:"nowrap",minWidth:"max-content","& > *":{flexShrink:0}},children:[(0,a.jsx)(k.A,{variant:"info",onClick:()=>t(!0),children:"업체 추가"}),(0,a.jsx)(k.A,{variant:"info",onClick:()=>o(!0),children:"품목 추가"}),(0,a.jsx)(k.A,{variant:"primary",onClick:()=>i(!0),disabled:!v,children:"업체 수정"}),(0,a.jsx)(k.A,{variant:"primary",onClick:()=>s(!0),disabled:1!==Object.keys(F).filter(e=>F[e]).length,children:"품목 수정"}),(0,a.jsx)(k.A,{variant:"danger",onClick:()=>f(!0),disabled:!v,children:"업체 삭제"}),(0,a.jsx)(k.A,{variant:"danger",onClick:()=>g(!0),disabled:0===Object.keys(F).filter(e=>F[e]).length,children:"품목 삭제"}),(0,a.jsxs)(k.A,{variant:"special",onClick:()=>y(!0),disabled:0===ej().length,children:["견적서 작성 (",ej().length,")"]})]})})]}),(0,a.jsx)("div",{className:"overflow-auto lg:h-[75vh]",children:(0,a.jsx)(h,{items:eh.map(e=>({id:e.id,code:e.itemOrigin,name:e.itemName,origin:e.itemOrigin})),companies:ef,priceData:ep,selectedRows:j,setSelectedRows:w,selectedColumns:S,setSelectedColumns:A,selectedColumnsForManagement:F,setSelectedColumnsForManagement:E,getIntersectionItems:ej,formatNumber:eb,onCompanySelect:x,onCellValueChanged:eS,onItemsSelect:()=>{},onColumnOrderChange:Z})}),ej().length>0&&(0,a.jsxs)("div",{className:"mt-4 p-3 bg-green-50 rounded-lg",children:[(0,a.jsxs)("p",{className:"text-sm text-green-800 font-semibold",children:["선택된 견적 항목: ",ej().length,"개"]}),(0,a.jsx)("div",{className:"text-xs text-green-700 mt-1",children:ej().map((e,t)=>(0,a.jsxs)("span",{children:[e.company,"에서 ",e.productName," (",eb(e.price),"원)",t<ej().length-1?", ":""]},t))})]})]}),(0,a.jsx)(R,{open:e,onClose:()=>t(!1),onSubmit:e=>{let t=e.name;eC(t,e.priceType,ef);let r={id:(0,H.Ak)(),companyName:t,companyType:em,priceType:e.priceType,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},a={...r,companyColumnName:ey(r.companyName,r.priceType)};ev(e=>[...e,a]),ex(e=>({...e,[r.id]:{}})),V(r),Q({companyId:r.id,itemId:"domestic"===em?$[0].id:ei[0].id,value:0})}}),v&&ef.find(e=>e.id===v.id)&&(0,a.jsx)(I,{open:r,onClose:()=>i(!1),onSubmit:e=>{v&&(eC(e.name,e.priceType,ef),q(v.id,{companyName:e.name,companyType:em,priceType:e.priceType}),ev(t=>t.map(t=>t.id===v.id?{...t,companyName:e.name,priceType:e.priceType,companyColumnName:ey(e.name,e.priceType)}:t)),i(!1))},selectedCompany:ef.find(e=>e.id===(null==v?void 0:v.id))||v}),(0,a.jsx)(T,{open:l,onClose:()=>o(!1),onSubmit:e=>{eN(e.itemName,e.itemOrigin,eh);let t={id:(0,H.Ak)(),itemName:e.itemName,itemOrigin:e.itemOrigin,itemNameEn:e.itemNameEn,itemOriginEn:e.itemOriginEn,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};eg(e=>[...e,t]),B(t),Q({companyId:"domestic"===em?et[0].id:eo[0].id,itemId:t.id,value:0})}}),(()=>{let e=Object.keys(F).filter(e=>F[e]),t=e.length>0?eh.find(t=>t.id===e[0]):null;return t?(0,a.jsx)(P,{open:d,onClose:()=>s(!1),onSubmit:ew,selectedItem:t}):null})(),(0,a.jsx)(O,{open:m,onClose:()=>f(!1),onConfirm:()=>{v&&(ev(e=>e.filter(e=>e.id!==v.id)),J(v.id),ex(e=>{let t={...e};return delete t[v.id],t}),x(null),f(!1))}}),(0,a.jsx)(D,{open:p,onClose:()=>g(!1),onConfirm:()=>{let e=Object.keys(F).filter(e=>F[e]);0!==e.length&&(eg(t=>t.filter(t=>!e.includes(t.id))),e.forEach(e=>{_(e)}),ex(t=>{let r={...t};return Object.keys(r).forEach(t=>{e.forEach(e=>{r[t][e]&&delete r[t][e]})}),r}),E({}),g(!1))}}),(0,a.jsx)(L,{open:b,onClose:()=>y(!1),onDownload:eF,onOpenInNewWindow:ek})]})}},32921:(e,t,r)=>{"use strict";r.d(t,{Kg:()=>d,eg:()=>o,f3:()=>l,gt:()=>i,sg:()=>n,ye:()=>a});let a=e=>e.value?new Intl.NumberFormat("ko-KR",{style:"currency",currency:"KRW"}).format(e.value):"",n=e=>{if(null===e.value||void 0===e.value||""===e.value)return"";let t=Number(e.value);if(isNaN(t))return"";let r=!Number.isInteger(t);return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2*!!r,maximumFractionDigits:2*!!r}).format(t)},i=e=>e.value?new Intl.NumberFormat("ko-KR",{style:"currency",currency:"KRW",minimumFractionDigits:0,maximumFractionDigits:0}).format(e.value)+"/kg":"",l=e=>e.value?new Date(e.value).toLocaleDateString("ko-KR",{month:"long",day:"numeric",weekday:"short"}):"",o=e=>{if(null===e.value||void 0===e.value||""===e.value)return"";let t=Number(e.value);if(isNaN(t))return"";let r=Number(t.toFixed(1));return Number.isInteger(r)?r.toString():r.toFixed(1)},d=e=>{if(!e.value)return"";let t=new Date(e.value),r=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0");return"".concat(r,"/").concat(a,"/").concat(n)}},41002:(e,t,r)=>{Promise.resolve().then(r.bind(r,6624))},49344:(e,t,r)=>{"use strict";r.d(t,{A:()=>b});var a=r(22318),n=r(20926),i=r(92262),l=r(54069),o=r(2877),d=r(17859),c=r(51678),s=r(21768),m=r(60660),u=r(6987),h=r(27849),f=r(46558),p=r(71599),g=r(20063),v=r(90748);function x(e){return e.reduce((e,t)=>{var r,a,n;let i;return i="array"===t.type?null!==(r=t.defaultValue)&&void 0!==r?r:[]:"select"===t.type&&t.options&&t.options.length>0?null!==(a=t.defaultValue)&&void 0!==a?a:t.options[0].value:null!==(n=t.defaultValue)&&void 0!==n?n:"",{...e,[t.name]:i}},{})}function b(e){let{zodSchema:t,steps:r,fields:b,onSubmit:y,submitLabel:C="저장",zodSchemas:N,onCancel:j,fieldErrors:w={},initialValues:S={}}=e,A=!!r,[F,k]=(0,n.useState)(0),E=A?r[F].fields:b,[O,D]=(0,n.useState)(A?{...r.reduce((e,t)=>({...e,...x(t.fields)}),{}),...S}:{...x(b),...S}),[R,I]=(0,n.useState)({}),[T,P]=(0,n.useState)(!1),L=(e,t)=>{D(r=>({...r,[e]:t}))},M=e=>{D(t=>({...t,[e.name]:[...Array.isArray(t[e.name])?t[e.name]:[],x(e.fields)]}))},U=(e,t)=>{D(r=>({...r,[e.name]:Array.isArray(r[e.name])?r[e.name].filter((e,r)=>r!==t):[]}))},W=(e,t,r,a)=>{D(n=>({...n,[e.name]:Array.isArray(n[e.name])?n[e.name].map((e,n)=>n===t?{...e,[r]:a}:e):[]}))},z=e=>{let t={};return e.errors.forEach(e=>{t[e.path[0]]=e.message}),t},K=async e=>{let a;if(!T){if(e.preventDefault(),(a=A&&N?N[F].safeParse(O):t?t.safeParse(O):{success:!0,data:O})&&!a.success){I(z(a.error));return}I({}),P(!0);try{A&&F<r.length-1?k(e=>e+1):await y(O)}finally{P(!1)}}},V=(e,t,r,p,x)=>{let b=w[e.name]||p;switch(e.type){case"text":case"number":case"date":return(0,a.jsx)(l.A,{label:e.label,name:e.name,type:"number"===e.type?"number":e.type,value:t,onChange:t=>r("number"===e.type?Number(t.target.value):t.target.value),fullWidth:!0,error:!!b,helperText:b||e.helperText,InputLabelProps:"date"===e.type?{shrink:!0}:void 0,InputProps:e.endAdornment?{endAdornment:(0,a.jsx)(o.A,{sx:{color:"inherit","& .MuiTypography-root":{color:"inherit"}},position:"end",children:e.endAdornment})}:void 0,sx:{mb:1}},e.name+(null!=x?x:""));case"select":var y;return(0,a.jsxs)(d.A,{fullWidth:!0,error:!!b,sx:{mb:1},children:[(0,a.jsx)(c.A,{children:e.label}),(0,a.jsx)(s.A,{value:t,label:e.label,onChange:e=>r(e.target.value),children:null===(y=e.options)||void 0===y?void 0:y.map(e=>(0,a.jsx)(m.A,{value:e.value,children:e.label},e.value))}),b&&(0,a.jsx)(u.A,{color:"error",variant:"caption",children:b})]},e.name+(null!=x?x:""));case"array":return(0,a.jsxs)(h.A,{sx:{mb:2},children:[(0,a.jsxs)(h.A,{display:"flex",alignItems:"center",mb:1,children:[(0,a.jsx)(u.A,{variant:"subtitle1",children:e.label}),(0,a.jsx)(f.A,{size:"small",onClick:()=>M(e),sx:{ml:1},children:(0,a.jsx)(g.A,{fontSize:"small"})})]}),(Array.isArray(t)?t:[]).map((t,r)=>(0,a.jsxs)(h.A,{sx:{border:"1px solid #eee",borderRadius:1,p:2,mb:1},children:[(0,a.jsxs)(h.A,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[(0,a.jsxs)(u.A,{variant:"body2",children:[e.label," #",r+1]}),(0,a.jsx)(f.A,{size:"small",onClick:()=>U(e,r),children:(0,a.jsx)(v.A,{fontSize:"small"})})]}),function(e){var t;let{field:r,item:h,onChange:f,errors:p}=e;return(0,a.jsx)(i.A,{spacing:1,mt:1,children:null===(t=r.fields)||void 0===t?void 0:t.map(e=>{let t=h[e.name];return(0,a.jsx)(n.Fragment,{children:(()=>{switch(e.type){case"text":case"number":case"date":return(0,a.jsx)(l.A,{label:e.label,name:e.name,type:"number"===e.type?"number":e.type,value:t,onChange:t=>f(e.name,"number"===e.type?Number(t.target.value):t.target.value),fullWidth:!0,error:!!p[e.name],helperText:p[e.name]||e.helperText,InputLabelProps:"date"===e.type?{shrink:!0}:void 0,InputProps:e.endAdornment?{endAdornment:(0,a.jsx)(o.A,{sx:{color:"inherit","& .MuiTypography-root":{color:"inherit"}},position:"end",children:e.endAdornment})}:void 0,sx:{mb:1}});case"select":var r;return(0,a.jsxs)(d.A,{fullWidth:!0,error:!!p[e.name],sx:{mb:1},children:[(0,a.jsx)(c.A,{children:e.label}),(0,a.jsx)(s.A,{value:t,label:e.label,onChange:t=>f(e.name,t.target.value),children:null===(r=e.options)||void 0===r?void 0:r.map(e=>(0,a.jsx)(m.A,{value:e.value,children:e.label},e.value))}),p[e.name]&&(0,a.jsx)(u.A,{color:"error",variant:"caption",children:p[e.name]})]});case"custom":return e.render?e.render({value:t,onChange:t=>f(e.name,t),error:p[e.name]}):null;default:return null}})()},e.name)})})}({field:e,item:t,onChange:(t,a)=>W(e,r,t,a),errors:{}})]},r))]},e.name);case"custom":return e.render?e.render({value:t,onChange:r,error:b}):null;default:return null}};return(0,a.jsxs)("form",{onSubmit:K,children:[A&&(0,a.jsx)(u.A,{variant:"h6",sx:{mb:2},children:r[F].label}),(0,a.jsx)(i.A,{spacing:2,sx:{mt:1},children:E.map(e=>V(e,O[e.name],t=>L(e.name,t),R[e.name]))}),(0,a.jsxs)(h.A,{display:"flex",flexDirection:"row",justifyContent:"flex-end",gap:2,mt:2,children:[A&&F>0&&(0,a.jsx)(p.A,{variant:"outlined",color:"primary",onClick:()=>k(e=>e-1),children:"이전"}),"function"==typeof j&&(0,a.jsx)(p.A,{variant:"outlined",color:"primary",onClick:j,children:"취소"}),(0,a.jsx)(p.A,{type:"submit",variant:"contained",color:"primary",sx:{fontWeight:600},disabled:T,children:A&&F<r.length-1?"다음":C})]})]})}},50757:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var a=r(20926);let n=function(e){let t=(0,a.useRef)([]);return{onDragStarted:e=>{t.current=e.api.getColumnState().map(e=>e.colId)},onDragStopped:r=>{let a=r.api.getColumnState().map(e=>e.colId).filter(e=>"detail"!==e);t.current.every((e,t)=>e===a[t])||e(r)}}}},75746:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var a=r(22318),n=r(71599);let i=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"primary",t=arguments.length>1?arguments[1]:void 0,r={fontWeight:600,border:"1px solid",boxShadow:"none",whiteSpace:"nowrap","&:disabled":{backgroundColor:"#9CA3AF",color:"#FFFFFF"}};switch(e){case"primary":return{...r,backgroundColor:"#22C55E",color:"#FFFFFF","&:hover":{backgroundColor:"#16A34A"}};case"inherit":return{whiteSpace:"nowrap"};case"secondary":return{...r,backgroundColor:t?"#f3f4f6":"#64748b",color:t?"#374151":"#FFFFFF",border:t?"1px solid #cbd5e1":"none","&:hover":{backgroundColor:t?"#e5e7eb":"#475569"}};case"danger":return{...r,backgroundColor:"#EF4444",color:"#FFFFFF","&:hover":{backgroundColor:"#DC2626"}};case"info":return{...r,backgroundColor:"#3B82F6",color:"#FFFFFF","&:hover":{backgroundColor:"#2563EB"}};case"special":return{...r,backgroundColor:"#6366F1",color:"#FFFFFF","&:hover":{backgroundColor:"#4F46E5"}};case"outline":return{...r,backgroundColor:"transparent",borderColor:"primary",color:"#22C55E","&:hover":{backgroundColor:"#F9FAFB",borderColor:"primary"},"&:disabled":{backgroundColor:"transparent",borderColor:"#9CA3AF",color:"#9CA3AF"}};case"outline-danger":return{...r,backgroundColor:"transparent",borderColor:"#EF4444",color:"#EF4444","&:hover":{backgroundColor:"#FEF2F2",borderColor:"#DC2626",color:"#DC2626"},"&:disabled":{backgroundColor:"transparent",borderColor:"#9CA3AF",color:"#9CA3AF"}};default:return r}};function l(e){let{variant:t="primary",children:r,minWidth:l,sx:o,editMode:d=!1,...c}=e,s=i(t,d),m=t.includes("outline");return(0,a.jsx)(n.A,{variant:"inherit"===t?"contained":m?"outlined":"contained",color:"inherit"===t?"inherit":"primary",sx:{...s,minWidth:l,...o},...c,children:r})}}},e=>{var t=t=>e(e.s=t);e.O(0,[1775,8082,7045,3336,4069,6510,4090,2394,9052,2555,9453,6292,9039,1077,7358],()=>t(41002)),_N_E=e.O()}]);
