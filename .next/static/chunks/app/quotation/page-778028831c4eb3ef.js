(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8259],{2123:(e,t,a)=>{"use strict";a.d(t,{FX:()=>o,Jd:()=>d,cX:()=>i,mg:()=>l,zG:()=>r});var n=a(32921);let r=[{field:"contractNumber",headerName:"계약 번호",width:130},{field:"progressStatus",headerName:"진행 상태",width:100},{field:"contractDate",headerName:"계약일자",valueFormatter:n.Kg,width:150},{field:"exporter",headerName:"공급업체",width:120},{field:"importer",headerName:"수입회사",width:120},{field:"estimatedTimeArrival",headerName:"ETA",valueFormatter:n.Kg,width:150},{field:"arrivalPort",headerName:"도착항",width:120},{field:"itemName",headerName:"품목",width:120},{field:"contractTon",headerName:"무게",valueFormatter:e=>"".concat(e.value,"톤"),width:100},{field:"packingUnit",headerName:"포장 단위",width:130},{field:"unitPrice",headerName:"단가",valueFormatter:n.sg,width:130},{field:"totalPriceUsd",headerName:"단가 * 톤수",valueFormatter:n.sg,width:150},{field:"paymentMethod",headerName:"결제방식",width:100},{field:"warehouseEntryDate",headerName:"입고일",valueFormatter:n.Kg,width:150},{field:"importCostPerKg",headerName:"수입가/kg",valueFormatter:n.gt,width:130},{field:"supplyCostPerKg",headerName:"수급가/kg",valueFormatter:n.gt,width:130},{field:"totalCost",headerName:"총 비용",valueFormatter:n.ye,width:150},{field:"totalCostPerKg",headerName:"총 비용/kg",valueFormatter:n.gt,width:130},{field:"sellingPrice",headerName:"판매가",valueFormatter:n.ye,width:130},{field:"margin",headerName:"마진",valueFormatter:n.ye,width:100},{field:"totalProfit",headerName:"총 이익",valueFormatter:n.ye,width:150}],i=[{field:"contractNumber",headerName:"계약 번호",width:130},{field:"progressStatus",headerName:"진행 상태",width:100},{field:"contractDate",headerName:"계약일자",valueFormatter:n.Kg,width:150},{field:"importer",headerName:"수입회사",width:120},{field:"productName",headerName:"품종",width:150},{field:"itemName",headerName:"품목",width:120},{field:"weight",headerName:"무게",valueFormatter:e=>"".concat(e.value,"톤"),width:100},{field:"containerCount",headerName:"컨테이너 개수",width:120},{field:"packingUnit",headerName:"포장 단위",width:100},{field:"unitPrice",headerName:"단가",valueFormatter:n.sg,width:130},{field:"totalPriceUsd",headerName:"단가 * 톤수",valueFormatter:n.sg,width:150},{field:"supplyPrice",headerName:"수급가",valueFormatter:n.ye,width:130},{field:"sellingPrice",headerName:"판매가",valueFormatter:n.ye,width:130},{field:"paymentMethod",headerName:"결제방식",width:100},{field:"hsCode",headerName:"HS CODE",width:120},{field:"blNumber",headerName:"BL no.",width:120},{field:"departurePort",headerName:"port(출발항)",width:120},{field:"etd",headerName:"ETD",valueFormatter:n.Kg,width:150},{field:"arrivalPort",headerName:"port(도착항)",width:120},{field:"eta",headerName:"ETA",valueFormatter:n.Kg,width:150},{field:"exporter",headerName:"공급업체",width:120},{field:"customsDate",headerName:"통관일자",valueFormatter:n.Kg,width:150}],l=r.map(e=>({field:e.field,width:e.width||100})),o=i.map(e=>({field:e.field,width:e.width||100})),d=[{field:"companyColumnName",width:150}]},32921:(e,t,a)=>{"use strict";a.d(t,{Kg:()=>d,eg:()=>o,f3:()=>l,gt:()=>i,sg:()=>r,ye:()=>n});let n=e=>e.value?new Intl.NumberFormat("ko-KR",{style:"currency",currency:"KRW"}).format(e.value):"",r=e=>{if(null===e.value||void 0===e.value||""===e.value)return"";let t=Number(e.value);if(isNaN(t))return"";let a=!Number.isInteger(t);return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2*!!a,maximumFractionDigits:2*!!a}).format(t)},i=e=>e.value?new Intl.NumberFormat("ko-KR",{style:"currency",currency:"KRW",minimumFractionDigits:0,maximumFractionDigits:0}).format(e.value)+"/kg":"",l=e=>e.value?new Date(e.value).toLocaleDateString("ko-KR",{month:"long",day:"numeric",weekday:"short"}):"",o=e=>{if(null===e.value||void 0===e.value||""===e.value)return"";let t=Number(e.value);if(isNaN(t))return"";let a=Number(t.toFixed(1));return Number.isInteger(a)?a.toString():a.toFixed(1)},d=e=>{if(!e.value)return"";let t=new Date(e.value),a=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return"".concat(a,"/").concat(n,"/").concat(r)}},41002:(e,t,a)=>{Promise.resolve().then(a.bind(a,64282))},49344:(e,t,a)=>{"use strict";a.d(t,{A:()=>y});var n=a(22318),r=a(20926),i=a(92262),l=a(54069),o=a(2877),d=a(17859),c=a(51678),s=a(21768),m=a(60660),u=a(6987),h=a(27849),f=a(46558),p=a(71599),g=a(20063),v=a(90748);function x(e){return e.reduce((e,t)=>{var a,n,r;let i;return i="array"===t.type?null!==(a=t.defaultValue)&&void 0!==a?a:[]:"select"===t.type&&t.options&&t.options.length>0?null!==(n=t.defaultValue)&&void 0!==n?n:t.options[0].value:null!==(r=t.defaultValue)&&void 0!==r?r:"",{...e,[t.name]:i}},{})}function y(e){let{zodSchema:t,steps:a,fields:y,onSubmit:b,submitLabel:N="저장",zodSchemas:j,onCancel:S,fieldErrors:w={},initialValues:C={}}=e,A=!!a,[E,k]=(0,r.useState)(0),O=A?a[E].fields:y,[F,D]=(0,r.useState)(A?{...a.reduce((e,t)=>({...e,...x(t.fields)}),{}),...C}:{...x(y),...C}),[R,I]=(0,r.useState)({}),[T,P]=(0,r.useState)(!1),L=(e,t)=>{D(a=>({...a,[e]:t}))},M=e=>{D(t=>({...t,[e.name]:[...Array.isArray(t[e.name])?t[e.name]:[],x(e.fields)]}))},U=(e,t)=>{D(a=>({...a,[e.name]:Array.isArray(a[e.name])?a[e.name].filter((e,a)=>a!==t):[]}))},W=(e,t,a,n)=>{D(r=>({...r,[e.name]:Array.isArray(r[e.name])?r[e.name].map((e,r)=>r===t?{...e,[a]:n}:e):[]}))},z=e=>{let t={};return e.errors.forEach(e=>{t[e.path[0]]=e.message}),t},K=async e=>{let n;if(!T){if(e.preventDefault(),(n=A&&j?j[E].safeParse(F):t?t.safeParse(F):{success:!0,data:F})&&!n.success){I(z(n.error));return}I({}),P(!0);try{A&&E<a.length-1?k(e=>e+1):await b(F)}finally{P(!1)}}},V=(e,t,a,p,x)=>{let y=w[e.name]||p;switch(e.type){case"text":case"number":case"date":return(0,n.jsx)(l.A,{label:e.label,name:e.name,type:"number"===e.type?"number":e.type,value:t,onChange:t=>a("number"===e.type?Number(t.target.value):t.target.value),fullWidth:!0,error:!!y,helperText:y||e.helperText,InputLabelProps:"date"===e.type?{shrink:!0}:void 0,InputProps:e.endAdornment?{endAdornment:(0,n.jsx)(o.A,{sx:{color:"inherit","& .MuiTypography-root":{color:"inherit"}},position:"end",children:e.endAdornment})}:void 0,sx:{mb:1}},e.name+(null!=x?x:""));case"select":var b;return(0,n.jsxs)(d.A,{fullWidth:!0,error:!!y,sx:{mb:1},children:[(0,n.jsx)(c.A,{children:e.label}),(0,n.jsx)(s.A,{value:t,label:e.label,onChange:e=>a(e.target.value),children:null===(b=e.options)||void 0===b?void 0:b.map(e=>(0,n.jsx)(m.A,{value:e.value,children:e.label},e.value))}),y&&(0,n.jsx)(u.A,{color:"error",variant:"caption",children:y})]},e.name+(null!=x?x:""));case"array":return(0,n.jsxs)(h.A,{sx:{mb:2},children:[(0,n.jsxs)(h.A,{display:"flex",alignItems:"center",mb:1,children:[(0,n.jsx)(u.A,{variant:"subtitle1",children:e.label}),(0,n.jsx)(f.A,{size:"small",onClick:()=>M(e),sx:{ml:1},children:(0,n.jsx)(g.A,{fontSize:"small"})})]}),(Array.isArray(t)?t:[]).map((t,a)=>(0,n.jsxs)(h.A,{sx:{border:"1px solid #eee",borderRadius:1,p:2,mb:1},children:[(0,n.jsxs)(h.A,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[(0,n.jsxs)(u.A,{variant:"body2",children:[e.label," #",a+1]}),(0,n.jsx)(f.A,{size:"small",onClick:()=>U(e,a),children:(0,n.jsx)(v.A,{fontSize:"small"})})]}),function(e){var t;let{field:a,item:h,onChange:f,errors:p}=e;return(0,n.jsx)(i.A,{spacing:1,mt:1,children:null===(t=a.fields)||void 0===t?void 0:t.map(e=>{let t=h[e.name];return(0,n.jsx)(r.Fragment,{children:(()=>{switch(e.type){case"text":case"number":case"date":return(0,n.jsx)(l.A,{label:e.label,name:e.name,type:"number"===e.type?"number":e.type,value:t,onChange:t=>f(e.name,"number"===e.type?Number(t.target.value):t.target.value),fullWidth:!0,error:!!p[e.name],helperText:p[e.name]||e.helperText,InputLabelProps:"date"===e.type?{shrink:!0}:void 0,InputProps:e.endAdornment?{endAdornment:(0,n.jsx)(o.A,{sx:{color:"inherit","& .MuiTypography-root":{color:"inherit"}},position:"end",children:e.endAdornment})}:void 0,sx:{mb:1}});case"select":var a;return(0,n.jsxs)(d.A,{fullWidth:!0,error:!!p[e.name],sx:{mb:1},children:[(0,n.jsx)(c.A,{children:e.label}),(0,n.jsx)(s.A,{value:t,label:e.label,onChange:t=>f(e.name,t.target.value),children:null===(a=e.options)||void 0===a?void 0:a.map(e=>(0,n.jsx)(m.A,{value:e.value,children:e.label},e.value))}),p[e.name]&&(0,n.jsx)(u.A,{color:"error",variant:"caption",children:p[e.name]})]});case"custom":return e.render?e.render({value:t,onChange:t=>f(e.name,t),error:p[e.name]}):null;default:return null}})()},e.name)})})}({field:e,item:t,onChange:(t,n)=>W(e,a,t,n),errors:{}})]},a))]},e.name);case"custom":return e.render?e.render({value:t,onChange:a,error:y}):null;default:return null}};return(0,n.jsxs)("form",{onSubmit:K,children:[A&&(0,n.jsx)(u.A,{variant:"h6",sx:{mb:2},children:a[E].label}),(0,n.jsx)(i.A,{spacing:2,sx:{mt:1},children:O.map(e=>V(e,F[e.name],t=>L(e.name,t),R[e.name]))}),(0,n.jsxs)(h.A,{display:"flex",flexDirection:"row",justifyContent:"flex-end",gap:2,mt:2,children:[A&&E>0&&(0,n.jsx)(p.A,{variant:"outlined",color:"primary",onClick:()=>k(e=>e-1),children:"이전"}),"function"==typeof S&&(0,n.jsx)(p.A,{variant:"outlined",color:"primary",onClick:S,children:"취소"}),(0,n.jsx)(p.A,{type:"submit",variant:"contained",color:"primary",sx:{fontWeight:600},disabled:T,children:A&&E<a.length-1?"다음":N})]})]})}},50757:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});var n=a(20926);let r=function(e){let t=(0,n.useRef)([]);return{onDragStarted:e=>{t.current=e.api.getColumnState().map(e=>e.colId)},onDragStopped:a=>{let n=a.api.getColumnState().map(e=>e.colId).filter(e=>"detail"!==e);t.current.every((e,t)=>e===n[t])||e(a)}}}},64282:(e,t,a)=>{"use strict";a.d(t,{default:()=>Z});var n=a(22318),r=a(20926),i=a(27333),l=a.n(i),o=a(66292),d=a(64358);let c=(0,d.createServerReference)("004c7fb7d7ab1c521263cba5f72104bb1b194f1053",d.callServer,void 0,d.findSourceMapURL,"getUserQuotationColumnOrder"),s=(0,d.createServerReference)("40f1e18f30af0fbc377817d793409ade21b851dabe",d.callServer,void 0,d.findSourceMapURL,"saveUserQuotationColumnOrder");var m=a(50757),u=a(2123);function h(e){let{items:t,companies:a,priceData:i,setSelectedRows:d,selectedColumns:h,setSelectedColumns:f,formatNumber:p,onCompanySelect:g,onItemsSelect:v,onCellValueChanged:x,selectedColumnsForManagement:y,setSelectedColumnsForManagement:b,onColumnOrderChange:N}=e,[j,S]=(0,r.useState)([]);(0,r.useEffect)(()=>{(async()=>{try{let e=await c();S(e||u.Jd)}catch(e){console.error("컬럼 순서 로딩 오류:",e),S(u.Jd)}})()},[]),(0,r.useEffect)(()=>{if(t.length>0&&j.length>0){let e=t.map(e=>e.id),a=j.filter(e=>"companyColumnName"!==e.field).map(e=>e.field),n=e.filter(e=>!a.includes(e)),r=a.filter(t=>!e.includes(t)),i=!1,l=[...j];n.length>0&&(l=[...l,...n.map(e=>({field:e,width:150}))],i=!0,console.log("새 품목 ".concat(n.length,"개가 컬럼 순서에 추가됩니다."))),r.length>0&&(l=l.filter(e=>"companyColumnName"===e.field||!r.includes(e.field)),i=!0,console.log("삭제된 품목 ".concat(r.length,"개가 컬럼 순서에서 제거됩니다."))),i&&s(l).then(e=>{e.success&&(S(l),null==N||N(l),console.log("컬럼 순서가 업데이트되었습니다."))}).catch(e=>{console.error("컬럼 순서 업데이트 오류:",e)})}},[t,j]);let w=(0,r.useCallback)(async e=>{let t=e.api.getColumnState().filter(e=>"checkbox"!==e.colId).map(e=>({field:e.colId,width:e.width||100}));try{(await s(t)).success&&(S(t),null==N||N(t))}catch(e){console.error("컬럼 순서 저장 중 오류:",e)}},[]),{onDragStarted:C,onDragStopped:A}=(0,m.A)(w),E=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:250,n=(e.match(/[가-힣]/g)||[]).length,r=e.length-n;return Math.max(t,Math.min(a,16*n+8*r+40))},k=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:250;return Math.max(t,Math.min(a,Math.max(...e.map(e=>E(e,0,1/0)))))},O=e=>{var t;let{data:a,colDef:r}=e;if(!a)return null;let l=a.id,o=null==r?void 0:r.field,d=(null===(t=i[l])||void 0===t?void 0:t[o||""])||0;return(0,n.jsx)("div",{className:"w-full h-full flex items-center justify-start",children:(0,n.jsx)("span",{children:d>0?p(d):""})})},F=e=>{let a=e.displayName,r=t.find(e=>"".concat(e.name," (").concat(e.origin,")")===a),i=(null==r?void 0:r.id)||a,l=e.selectedColumns[i],o=(null==y?void 0:y[i])||!1;return(0,n.jsx)("div",{className:"w-full h-full flex items-center justify-start cursor-pointer px-[24px] ".concat(o?"bg-blue-200 font-bold":""),onClick:()=>{let t={...e.selectedColumns,[i]:!l};f(t),v(Object.keys(t).filter(e=>t[e])),b&&b({...y,[i]:!o})},children:(0,n.jsx)("span",{children:a})})},D=(0,r.useMemo)(()=>{var e;let n=[{headerName:"",checkboxSelection:!0,minWidth:50,flex:1,headerCheckboxSelection:!1,filter:!1,pinned:"left",lockPinned:!0,width:70,field:"checkbox"},{headerName:"업체명",field:"companyColumnName",pinned:"left",width:(null===(e=j.find(e=>"companyColumnName"===e.field))||void 0===e?void 0:e.width)||k([...a.map(e=>e.companyColumnName),"업체명"],120,250),sortable:!1}],r=t.map(e=>{var t;return{headerName:"".concat(e.name," (").concat(e.origin,")"),headerClass:"item-header",field:e.id,headerComponent:t=>F({...t,displayName:"".concat(e.name," (").concat(e.origin,")"),selectedColumns:h,setSelectedColumns:f}),minWidth:100,width:(null===(t=j.find(t=>t.field===e.id))||void 0===t?void 0:t.width)||E("".concat(e.name," (").concat(e.origin,")")),cellRenderer:O,editable:!0,sortable:!1}});return[...n,...j.length>1?j.filter(e=>"companyColumnName"!==e.field).map(e=>r.find(t=>t.field===e.field)).filter(e=>void 0!==e).concat(r.filter(e=>!j.some(t=>t.field===e.field))):r]},[j,t,a,h,f]),R=a.map(e=>{let a={id:e.id,companyColumnName:e.companyColumnName};return t.forEach(t=>{var n;a[t.id]=(null===(n=i[e.id])||void 0===n?void 0:n[t.id])||0}),a});return(0,n.jsx)("div",{className:"w-full h-[600px] lg:h-full",children:(0,n.jsxs)("div",{className:"jsx-d081cf3d79c8ea3c w-full h-full",children:[(0,n.jsx)(l(),{id:"d081cf3d79c8ea3c",children:"div.jsx-d081cf3d79c8ea3c .ag-header-cell.item-header{padding:0!important}"}),(0,n.jsx)(o.A,{columnDefs:D,data:R,pagination:!1,loading:!1,onSelectionChanged:e=>{let n=e.api.getSelectedNodes();if(1===n.length){let e=n[0].data.id;d({[e]:!0});let r=i[e]||{},l=[];t.forEach(e=>{let t=r[e.id];t&&t>0&&l.push(e.id)});let o={};l.forEach(e=>{o[e]=!0}),f(o),g(a.find(t=>t.id===e)||null),v(l)}else d({}),f({}),g(null),v([])},onCellValueChanged:x,onDragStarted:C,onDragStopped:A,rowSelection:"single"})]})})}var f=a(40017),p=a(57797),g=a(89085),v=a(49344),x=a(60720);let y=x.z.object({name:x.z.string().min(1,"업체명을 입력해주세요."),description:x.z.string().optional(),priceType:x.z.enum(["arrival","loading"])}),b=[{name:"name",label:"업체명",type:"text",required:!0},{name:"priceType",label:"가격 유형",type:"select",options:[{label:"도착도",value:"arrival"},{label:"상차도",value:"loading"}],required:!0}];function N(e){let{onClose:t,onSubmit:a,submitLabel:i="추가"}=e,[l,o]=(0,r.useState)({}),d=async e=>{try{a(e),o({}),null==t||t()}catch(e){e instanceof Error?o({name:e.message}):o({name:"오류가 발생했습니다."})}};return(0,n.jsx)(v.A,{fields:b,onSubmit:d,submitLabel:i,zodSchema:y,fieldErrors:l})}function j(e){let{onClose:t,onSubmit:a,submitLabel:i="수정",selectedCompany:l}=e,[o,d]=(0,r.useState)({});if(!l)return null;let c=async e=>{try{a(e),d({}),null==t||t()}catch(e){e instanceof Error?d({name:e.message}):d({name:"오류가 발생했습니다."})}};return(0,n.jsx)(v.A,{fields:b,onSubmit:c,submitLabel:i,zodSchema:y,fieldErrors:o,initialValues:{name:l.companyName,priceType:l.priceType}})}let S=x.z.object({itemName:x.z.string().min(1,"제품명을 입력해주세요."),itemOrigin:x.z.string().min(1,"원산지를 입력해주세요."),itemNameEn:x.z.string().min(1,"제품명(영문)을 입력해주세요."),itemOriginEn:x.z.string().min(1,"원산지(영문)을 입력해주세요.")}),w=[{name:"itemName",label:"제품명",type:"text",required:!0},{name:"itemOrigin",label:"원산지",type:"text",required:!0},{name:"itemNameEn",label:"제품명(영문)",type:"text",required:!0},{name:"itemOriginEn",label:"원산지(영문)",type:"text",required:!0}];function C(e){let{onClose:t,onSubmit:a,submitLabel:i="추가"}=e,[l,o]=(0,r.useState)({}),d=async e=>{try{a(e),o({}),null==t||t()}catch(e){e instanceof Error?o({itemName:e.message}):o({itemName:"오류가 발생했습니다."})}};return(0,n.jsx)(v.A,{fields:w,onSubmit:d,submitLabel:i,zodSchema:S,fieldErrors:l})}function A(e){var t,a;let{onClose:i,onSubmit:l,submitLabel:o="수정",selectedItem:d}=e,[c,s]=(0,r.useState)({});if(!d)return null;let m=async e=>{try{l(e),s({}),null==i||i()}catch(e){e instanceof Error?s({itemName:e.message}):s({itemName:"오류가 발생했습니다."})}};return(0,n.jsx)(v.A,{fields:w,onSubmit:m,submitLabel:o,zodSchema:S,initialValues:{itemName:d.itemName,itemOrigin:d.itemOrigin,itemNameEn:null!==(t=d.itemNameEn)&&void 0!==t?t:"",itemOriginEn:null!==(a=d.itemOriginEn)&&void 0!==a?a:""},fieldErrors:c})}var E=a(57598),k=a(75746);function O(e){let{open:t,onClose:a,onConfirm:r,title:i,message:l}=e;return(0,n.jsxs)(f.A,{open:t,onClose:a,maxWidth:"xs",fullWidth:!0,children:[(0,n.jsx)(p.A,{children:i}),(0,n.jsx)(g.A,{sx:{py:3},children:l}),(0,n.jsxs)(E.A,{sx:{px:3,pb:2,pt:0,justifyContent:"flex-end"},children:[(0,n.jsx)(k.A,{variant:"outline",onClick:a,children:"취소"}),(0,n.jsx)(k.A,{variant:"outline-danger",onClick:r,children:"삭제"})]})]})}function F(e){let{open:t,onClose:a,onConfirm:r}=e;return(0,n.jsx)(O,{open:t,onClose:a,onConfirm:r,title:"업체 삭제 확인",message:"정말로 선택한 업체를 삭제하시겠습니까?"})}function D(e){let{open:t,onClose:a,onConfirm:r}=e;return(0,n.jsx)(O,{open:t,onClose:a,onConfirm:r,title:"품목 삭제 확인",message:"정말로 선택한 품목을 삭제하시겠습니까?"})}function R(e){let{open:t,onClose:a,onSubmit:r}=e;return(0,n.jsxs)(f.A,{open:t,onClose:a,maxWidth:"xs",fullWidth:!0,children:[(0,n.jsx)(p.A,{children:"업체 추가"}),(0,n.jsx)(g.A,{children:(0,n.jsx)(N,{onClose:a,onSubmit:r})})]})}function I(e){let{open:t,onClose:a,onSubmit:r,selectedCompany:i}=e;return(0,n.jsxs)(f.A,{open:t,onClose:a,maxWidth:"xs",fullWidth:!0,children:[(0,n.jsx)(p.A,{children:"업체 수정"}),(0,n.jsx)(g.A,{children:(0,n.jsx)(j,{onClose:a,onSubmit:r,selectedCompany:i})})]})}function T(e){let{open:t,onClose:a,onSubmit:r}=e;return(0,n.jsxs)(f.A,{open:t,onClose:a,maxWidth:"xs",fullWidth:!0,children:[(0,n.jsx)(p.A,{children:"품목 추가"}),(0,n.jsx)(g.A,{children:(0,n.jsx)(C,{onClose:a,onSubmit:r})})]})}function P(e){let{open:t,onClose:a,onSubmit:r,selectedItem:i}=e;return(0,n.jsxs)(f.A,{open:t,onClose:a,maxWidth:"xs",fullWidth:!0,children:[(0,n.jsx)(p.A,{children:"품목 수정"}),(0,n.jsx)(g.A,{children:(0,n.jsx)(A,{onClose:a,onSubmit:r,selectedItem:i})})]})}function L(e){let{open:t,onClose:a,onDownload:i,onOpenInNewWindow:l}=e,[o,d]=(0,r.useState)(!1),[c,s]=(0,r.useState)(!1),m=async()=>{if(!o)try{d(!0),await i()}finally{d(!1)}},u=async()=>{if(!c)try{s(!0),await l()}finally{s(!1)}},h=o||c;return(0,n.jsxs)(f.A,{open:t,onClose:a,maxWidth:"xs",fullWidth:!0,children:[(0,n.jsx)(p.A,{children:"견적서 출력"}),(0,n.jsx)(g.A,{sx:{py:3},children:"아래 버튼을 클릭하여 견적서를 출력할 수 있습니다."}),(0,n.jsxs)(E.A,{sx:{px:3,pb:2,pt:0,justifyContent:"flex-end"},children:[(0,n.jsx)(k.A,{variant:"outline",onClick:a,disabled:h,children:"창 닫기"}),(0,n.jsx)(k.A,{variant:"primary",onClick:m,disabled:h,children:o?"다운로드 중...":"다운로드"}),(0,n.jsx)(k.A,{variant:"primary",onClick:u,disabled:h,children:c?"새창 열기 중...":"새창에서 열기"})]})]})}var M=a(92262),U=a(40404),W=a(39390);let z=(0,d.createServerReference)("008c79e7b09ae4723dd2d6ba4fb1333aff2ab0e31a",d.callServer,void 0,d.findSourceMapURL,"getDomesticAction"),K=(0,d.createServerReference)("00601584ba4e18e46925a4a924e98d11f979d29c83",d.callServer,void 0,d.findSourceMapURL,"getForeignerAction"),V=(0,d.createServerReference)("409a615c018433fa2f101a2a21581937161c0c1ee2",d.callServer,void 0,d.findSourceMapURL,"addQuotationCompanyAction"),Q=(0,d.createServerReference)("40f749ad93ee75eadf1cc05d8edc5da960aaa830d1",d.callServer,void 0,d.findSourceMapURL,"updateQuotationCellAction"),J=(0,d.createServerReference)("40505237c0372e88c322fb73731b0cdee4aba64747",d.callServer,void 0,d.findSourceMapURL,"addQuotationItemAction"),_=(0,d.createServerReference)("40978e4adc50118fd05fa6dfb16b58a8d80242dea3",d.callServer,void 0,d.findSourceMapURL,"deleteQuotationCompanyAction"),q=(0,d.createServerReference)("4055fb31d9adee20bd75e8170cbda5f709b74963f8",d.callServer,void 0,d.findSourceMapURL,"deleteQuotationItemAction"),B=(0,d.createServerReference)("60c7bac4156a834f9aa4d6980d87e605630af8d75c",d.callServer,void 0,d.findSourceMapURL,"updateCompanyAction"),X=(0,d.createServerReference)("6048f7069ff341fc5173436274c4b93d2ee114bdd0",d.callServer,void 0,d.findSourceMapURL,"updateItemAction"),G=(0,d.createServerReference)("401df350c3b6aa883ddfad7dd5397163bb931bbb49",d.callServer,void 0,d.findSourceMapURL,"generateQuotationPDF");var H=a(80681);let Y=()=>{let e=new Date,t=e.getFullYear().toString(),a=(e.getMonth()+1).toString().padStart(2,"0"),n=e.getDate().toString().padStart(2,"0"),r=Math.floor(1e4*Math.random()).toString().padStart(4,"0");return"GP".concat(t).concat(a).concat(n).concat(r)};function Z(){let[e,t]=(0,r.useState)(!1),[a,i]=(0,r.useState)(!1),[l,o]=(0,r.useState)(!1),[d,s]=(0,r.useState)(!1),[m,f]=(0,r.useState)(!1),[p,g]=(0,r.useState)(!1),[v,x]=(0,r.useState)(null),[y,b]=(0,r.useState)(!1),[N,j]=(0,r.useState)([]),[S,w]=(0,r.useState)({}),[C,A]=(0,r.useState)({}),[E,O]=(0,r.useState)({});(0,r.useEffect)(()=>{(async()=>{try{let e=await c();j(e||u.Jd)}catch(e){console.error("컬럼 순서 로딩 오류:",e),j(u.Jd)}})()},[]);let Z=(0,r.useCallback)(e=>{j(e)},[]),[$,ee]=(0,r.useState)([]),[et,ea]=(0,r.useState)([]),[en,er]=(0,r.useState)({}),[ei,el]=(0,r.useState)([]),[eo,ed]=(0,r.useState)([]),[ec,es]=(0,r.useState)({}),[em,eu]=(0,r.useState)("domestic"),eh="domestic"===em?$:ei,ef="domestic"===em?et:eo,ep="domestic"===em?en:ec,eg="domestic"===em?ee:el,ev="domestic"===em?ea:ed,ex="domestic"===em?er:es;(0,r.useEffect)(()=>{(async()=>{let e=await z();ee(e.items),ea(e.companies.map(e=>({...e,companyColumnName:eb(e.companyName,e.priceType)}))),er(e.priceData);let t=await K();el(t.items),ed(t.companies.map(e=>({...e,companyColumnName:eb(e.companyName,e.priceType)}))),es(t.priceData),console.log("domesticData",e),console.log("overseasData",t);try{let e=await c();j(e||u.Jd)}catch(e){console.error("컬럼 순서 로딩 오류:",e),j(u.Jd)}})()},[]);let ey=e=>new Intl.NumberFormat("ko-KR").format(e),eb=(e,t)=>"arrival"===t?"".concat(e," (도착도)"):"".concat(e," (상차도)"),eN=(e,t,a)=>{if(a.some(a=>a.companyName===e&&a.priceType===t))throw Error("이미 존재하는 업체명과 가격 타입입니다. (".concat(e," - ").concat("arrival"===t?"도착도":"상차도",")"))},ej=(e,t,a)=>{if(a.some(a=>a.itemName===e&&a.itemOrigin===t))throw Error("이미 존재하는 품목입니다. (".concat(e," - ").concat(t,")"))},eS=()=>{let e=[];return Object.entries(S).forEach(t=>{let[a,n]=t;n&&Object.entries(C).forEach(t=>{let[n,r]=t;if(r){var i;let t=eh.find(e=>e.id===n),r=ef.find(e=>e.id===a),l=(null===(i=ep[a])||void 0===i?void 0:i[n])||0;l>0&&e.push({productCode:n,productName:(null==t?void 0:t.itemName)||"",origin:(null==t?void 0:t.itemOrigin)||"",company:(null==r?void 0:r.companyName)||a,priceType:(null==r?void 0:r.priceType)||"",price:l,originEn:(null==t?void 0:t.itemOriginEn)||"",productNameEn:(null==t?void 0:t.itemNameEn)||""})}})}),e.sort((e,t)=>{let a=N.findIndex(t=>t.field===e.productCode),n=N.findIndex(e=>e.field===t.productCode);return -1===a&&-1===n?0:-1===a?1:-1===n?-1:a-n})},ew=e=>{let t=Object.keys(E).filter(e=>E[e]);0!==t.length&&(ej(e.itemName,e.itemOrigin,eh),X(t[0],{itemName:e.itemName,itemOrigin:e.itemOrigin,itemNameEn:e.itemNameEn,itemOriginEn:e.itemOriginEn}),eg(a=>a.map(a=>a.id===t[0]?{...a,itemName:e.itemName,itemOrigin:e.itemOrigin,itemNameEn:e.itemNameEn,itemOriginEn:e.itemOriginEn}:a)),O({}),s(!1))},eC=async e=>{try{let t=e.data.id,a=e.column.getColId(),n=e.newValue,r=e.oldValue,i=e.data[a];if(console.log("=== 셀 값 변경 디버깅 ==="),console.log("companyId:",t),console.log("itemId:",a),console.log("newValue:",n),console.log("oldValue:",r),console.log("currentValue:",i),console.log("params:",e),!a||"string"!=typeof a||"companyColumnName"===a){console.log("itemId가 유효하지 않음, 처리 중단");return}let l=void 0!==n?n:i,o=""===l||null==l?null:Number(l);console.log("finalValue:",l),console.log("numericValue:",o),ex(e=>({...e,[t]:{...e[t],[a]:o||0}})),await Q({itemId:a,companyId:t,value:o}),console.log("셀 값 업데이트 완료: 회사 ".concat(t,", 제품 ").concat(a,", 값 ").concat(o))}catch(e){console.error("셀 값 업데이트 실패:",e),alert("가격 업데이트에 실패했습니다. 다시 시도해주세요.")}},eA=async()=>{let e=eS();if(0===e.length)throw Error("선택된 견적 항목이 없습니다.");console.log("PDF 생성 시 컬럼 순서:",N),console.log("PDF 생성 시 견적 데이터:",e);let t=e.sort((e,t)=>{let a=N.findIndex(t=>t.field===e.productCode),n=N.findIndex(e=>e.field===t.productCode);return -1===a&&-1===n?0:-1===a?1:-1===n?-1:a-n});console.log("PDF 생성 시 정렬된 견적 데이터:",t);let a=await G({sender:"㈜ 곰표",receiver:t[0].company,date:new Date().toISOString().split("T")[0],items:t.map((e,t)=>({no:t+1,name:e.productName,originEn:e.originEn,nameEn:e.productNameEn,price:e.price})),documentNumber:Y(),priceType:t[0].priceType,reference:""});if(!a.success||!a.pdf)throw Error(a.error||"PDF 생성에 실패했습니다.");let n=atob(a.pdf),r=new Uint8Array(n.length);for(let e=0;e<n.length;e++)r[e]=n.charCodeAt(e);return{bytes:r,filename:a.filename||"견적서.pdf"}},eE=async()=>{try{let{bytes:e,filename:t}=await eA(),a=new Blob([e],{type:"application/pdf"}),n=URL.createObjectURL(a),r=document.createElement("a");r.href=n,r.download=t,r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n),console.log("PDF 다운로드 완료:",t)}catch(e){console.error("PDF 다운로드 중 오류 발생:",e),alert("PDF 다운로드 중 오류가 발생했습니다: "+(e instanceof Error?e.message:"알 수 없는 오류"))}},ek=async()=>{try{let{bytes:e,filename:t}=await eA(),a=new Blob([e],{type:"application/pdf"}),n=URL.createObjectURL(a),r=window.open(n,"_blank");if(r)r.addEventListener("load",()=>{try{r.document.title=t}catch(e){console.warn("새 창 제목 설정 실패:",e)}}),setTimeout(()=>{URL.revokeObjectURL(n)},1e3),console.log("PDF 새 창에서 열기 완료:",t);else{alert("팝업이 차단되었습니다. 다운로드로 진행합니다.");let e=document.createElement("a");e.href=n,e.download=t,e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e),URL.revokeObjectURL(n),console.log("팝업 차단으로 다운로드 대체 완료:",t)}}catch(e){console.error("PDF 새창 열기 중 오류 발생:",e),alert("PDF 새창 열기 중 오류가 발생했습니다: "+(e instanceof Error?e.message:"알 수 없는 오류"))}};return(0,n.jsxs)("div",{className:"w-full min-h-screen bg-gray-100",children:[(0,n.jsxs)("div",{className:"p-4 sm:p-8",children:[(0,n.jsx)("div",{className:"flex flex-col lg:flex-row lg:items-center sm:justify-between mb-4 sm:mb-6 gap-4",children:(0,n.jsx)("h1",{className:"text-xl sm:text-2xl font-bold",children:"견적서 작성"})}),(0,n.jsxs)(M.A,{direction:{xs:"column",lg:"row"},spacing:2,children:[(0,n.jsx)("div",{className:"flex flex-row justify-between items-end flex-shrink-0 overflow-x-auto",style:{minHeight:24},children:(0,n.jsxs)(U.A,{value:em,onChange:(e,t)=>eu(t),sx:{"& .MuiTabs-indicator":{backgroundColor:"#22C55E"},"& .MuiTab-root":{color:"#6B7280","&.Mui-selected":{color:"#22C55E"},"&:hover":{color:"#16A34A"}}},children:[(0,n.jsx)(W.A,{label:"국내 업체",value:"domestic"}),(0,n.jsx)(W.A,{label:"해외 업체",value:"overseas"})]})}),(0,n.jsx)("div",{className:"overflow-auto w-full",children:(0,n.jsxs)(M.A,{direction:"row",spacing:2,sx:{width:"100%",justifyContent:{xs:"flex-start",lg:"flex-end"},pb:1,overflowX:"auto",flexWrap:"nowrap",minWidth:"max-content","& > *":{flexShrink:0}},children:[(0,n.jsx)(k.A,{variant:"info",onClick:()=>t(!0),children:"업체 추가"}),(0,n.jsx)(k.A,{variant:"info",onClick:()=>o(!0),children:"품목 추가"}),(0,n.jsx)(k.A,{variant:"primary",onClick:()=>i(!0),disabled:!v,children:"업체 수정"}),(0,n.jsx)(k.A,{variant:"primary",onClick:()=>s(!0),disabled:1!==Object.keys(E).filter(e=>E[e]).length,children:"품목 수정"}),(0,n.jsx)(k.A,{variant:"danger",onClick:()=>f(!0),disabled:!v,children:"업체 삭제"}),(0,n.jsx)(k.A,{variant:"danger",onClick:()=>g(!0),disabled:0===Object.keys(E).filter(e=>E[e]).length,children:"품목 삭제"}),(0,n.jsxs)(k.A,{variant:"special",onClick:()=>b(!0),disabled:0===eS().length,children:["견적서 작성 (",eS().length,")"]})]})})]}),(0,n.jsx)("div",{className:"overflow-auto lg:h-[75vh]",children:(0,n.jsx)(h,{items:eh.map(e=>({id:e.id,code:e.itemOrigin,name:e.itemName,origin:e.itemOrigin})),companies:ef,priceData:ep,selectedRows:S,setSelectedRows:w,selectedColumns:C,setSelectedColumns:A,selectedColumnsForManagement:E,setSelectedColumnsForManagement:O,getIntersectionItems:eS,formatNumber:ey,onCompanySelect:x,onCellValueChanged:eC,onItemsSelect:()=>{},onColumnOrderChange:Z})}),eS().length>0&&(0,n.jsxs)("div",{className:"mt-4 p-3 bg-green-50 rounded-lg",children:[(0,n.jsxs)("p",{className:"text-sm text-green-800 font-semibold",children:["선택된 견적 항목: ",eS().length,"개"]}),(0,n.jsx)("div",{className:"text-xs text-green-700 mt-1",children:eS().map((e,t)=>(0,n.jsxs)("span",{children:[e.company,"에서 ",e.productName," (",ey(e.price),"원)",t<eS().length-1?", ":""]},t))})]})]}),(0,n.jsx)(R,{open:e,onClose:()=>t(!1),onSubmit:e=>{let t=e.name;eN(t,e.priceType,ef);let a={id:(0,H.Ak)(),companyName:t,companyType:em,priceType:e.priceType,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},n={...a,companyColumnName:eb(a.companyName,a.priceType)};ev(e=>[...e,n]),ex(e=>({...e,[a.id]:{}})),V(a),Q({companyId:a.id,itemId:"domestic"===em?$[0].id:ei[0].id,value:0})}}),v&&ef.find(e=>e.id===v.id)&&(0,n.jsx)(I,{open:a,onClose:()=>i(!1),onSubmit:e=>{v&&(eN(e.name,e.priceType,ef),B(v.id,{companyName:e.name,companyType:em,priceType:e.priceType}),ev(t=>t.map(t=>t.id===v.id?{...t,companyName:e.name,priceType:e.priceType,companyColumnName:eb(e.name,e.priceType)}:t)),i(!1))},selectedCompany:ef.find(e=>e.id===(null==v?void 0:v.id))||v}),(0,n.jsx)(T,{open:l,onClose:()=>o(!1),onSubmit:e=>{ej(e.itemName,e.itemOrigin,eh);let t={id:(0,H.Ak)(),itemName:e.itemName,itemOrigin:e.itemOrigin,itemNameEn:e.itemNameEn,itemOriginEn:e.itemOriginEn,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};eg(e=>[...e,t]),J(t),Q({companyId:"domestic"===em?et[0].id:eo[0].id,itemId:t.id,value:0})}}),(()=>{let e=Object.keys(E).filter(e=>E[e]),t=e.length>0?eh.find(t=>t.id===e[0]):null;return t?(0,n.jsx)(P,{open:d,onClose:()=>s(!1),onSubmit:ew,selectedItem:t}):null})(),(0,n.jsx)(F,{open:m,onClose:()=>f(!1),onConfirm:()=>{v&&(ev(e=>e.filter(e=>e.id!==v.id)),_(v.id),ex(e=>{let t={...e};return delete t[v.id],t}),x(null),f(!1))}}),(0,n.jsx)(D,{open:p,onClose:()=>g(!1),onConfirm:()=>{let e=Object.keys(E).filter(e=>E[e]);0!==e.length&&(eg(t=>t.filter(t=>!e.includes(t.id))),e.forEach(e=>{q(e)}),ex(t=>{let a={...t};return Object.keys(a).forEach(t=>{e.forEach(e=>{a[t][e]&&delete a[t][e]})}),a}),O({}),g(!1))}}),(0,n.jsx)(L,{open:y,onClose:()=>b(!1),onDownload:eE,onOpenInNewWindow:ek})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[1775,8082,7045,3336,4069,6510,4090,2394,9052,2555,9453,1449,9039,1077,7358],()=>t(41002)),_N_E=e.O()}]);
