(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[259],{41002:(e,n,t)=>{Promise.resolve().then(t.bind(t,98378))},49344:(e,n,t)=>{"use strict";t.d(n,{A:()=>v});var a=t(22318),i=t(20926),r=t(92262),l=t(54069),o=t(2877),c=t(17859),d=t(51678),s=t(21768),m=t(60660),u=t(6987),p=t(27849),h=t(46558),f=t(71599),x=t(20063),b=t(90748);function g(e){return e.reduce((e,n)=>{var t,a,i;let r;return r="array"===n.type?null!==(t=n.defaultValue)&&void 0!==t?t:[]:"select"===n.type&&n.options&&n.options.length>0?null!==(a=n.defaultValue)&&void 0!==a?a:n.options[0].value:null!==(i=n.defaultValue)&&void 0!==i?i:"",{...e,[n.name]:r}},{})}function v(e){let{zodSchema:n,steps:t,fields:v,onSubmit:y,submitLabel:j="저장",zodSchemas:A,onCancel:C,fieldErrors:S={},initialValues:N={}}=e,E=!!t,[w,k]=(0,i.useState)(0),O=E?t[w].fields:v,[R,T]=(0,i.useState)(E?{...t.reduce((e,n)=>({...e,...g(n.fields)}),{}),...N}:{...g(v),...N}),[D,I]=(0,i.useState)({}),[L,W]=(0,i.useState)(!1),F=(e,n)=>{T(t=>({...t,[e]:n}))},M=e=>{T(n=>({...n,[e.name]:[...Array.isArray(n[e.name])?n[e.name]:[],g(e.fields)]}))},U=(e,n)=>{T(t=>({...t,[e.name]:Array.isArray(t[e.name])?t[e.name].filter((e,t)=>t!==n):[]}))},z=(e,n,t,a)=>{T(i=>({...i,[e.name]:Array.isArray(i[e.name])?i[e.name].map((e,i)=>i===n?{...e,[t]:a}:e):[]}))},P=e=>{let n={};return e.errors.forEach(e=>{n[e.path[0]]=e.message}),n},V=async e=>{let a;if(!L){if(e.preventDefault(),(a=E&&A?A[w].safeParse(R):n?n.safeParse(R):{success:!0,data:R})&&!a.success){I(P(a.error));return}I({}),W(!0);try{E&&w<t.length-1?k(e=>e+1):await y(R)}finally{W(!1)}}},B=(e,n,t,f,g)=>{let v=S[e.name]||f;switch(e.type){case"text":case"number":case"date":return(0,a.jsx)(l.A,{label:e.label,name:e.name,type:"number"===e.type?"number":e.type,value:n,onChange:n=>t("number"===e.type?Number(n.target.value):n.target.value),fullWidth:!0,error:!!v,helperText:v||e.helperText,InputLabelProps:"date"===e.type?{shrink:!0}:void 0,InputProps:e.endAdornment?{endAdornment:(0,a.jsx)(o.A,{sx:{color:"inherit","& .MuiTypography-root":{color:"inherit"}},position:"end",children:e.endAdornment})}:void 0,sx:{mb:1}},e.name+(null!=g?g:""));case"select":var y;return(0,a.jsxs)(c.A,{fullWidth:!0,error:!!v,sx:{mb:1},children:[(0,a.jsx)(d.A,{children:e.label}),(0,a.jsx)(s.A,{value:n,label:e.label,onChange:e=>t(e.target.value),children:null===(y=e.options)||void 0===y?void 0:y.map(e=>(0,a.jsx)(m.A,{value:e.value,children:e.label},e.value))}),v&&(0,a.jsx)(u.A,{color:"error",variant:"caption",children:v})]},e.name+(null!=g?g:""));case"array":return(0,a.jsxs)(p.A,{sx:{mb:2},children:[(0,a.jsxs)(p.A,{display:"flex",alignItems:"center",mb:1,children:[(0,a.jsx)(u.A,{variant:"subtitle1",children:e.label}),(0,a.jsx)(h.A,{size:"small",onClick:()=>M(e),sx:{ml:1},children:(0,a.jsx)(x.A,{fontSize:"small"})})]}),(Array.isArray(n)?n:[]).map((n,t)=>(0,a.jsxs)(p.A,{sx:{border:"1px solid #eee",borderRadius:1,p:2,mb:1},children:[(0,a.jsxs)(p.A,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[(0,a.jsxs)(u.A,{variant:"body2",children:[e.label," #",t+1]}),(0,a.jsx)(h.A,{size:"small",onClick:()=>U(e,t),children:(0,a.jsx)(b.A,{fontSize:"small"})})]}),function(e){var n;let{field:t,item:p,onChange:h,errors:f}=e;return(0,a.jsx)(r.A,{spacing:1,mt:1,children:null===(n=t.fields)||void 0===n?void 0:n.map(e=>{let n=p[e.name];return(0,a.jsx)(i.Fragment,{children:(()=>{switch(e.type){case"text":case"number":case"date":return(0,a.jsx)(l.A,{label:e.label,name:e.name,type:"number"===e.type?"number":e.type,value:n,onChange:n=>h(e.name,"number"===e.type?Number(n.target.value):n.target.value),fullWidth:!0,error:!!f[e.name],helperText:f[e.name]||e.helperText,InputLabelProps:"date"===e.type?{shrink:!0}:void 0,InputProps:e.endAdornment?{endAdornment:(0,a.jsx)(o.A,{sx:{color:"inherit","& .MuiTypography-root":{color:"inherit"}},position:"end",children:e.endAdornment})}:void 0,sx:{mb:1}});case"select":var t;return(0,a.jsxs)(c.A,{fullWidth:!0,error:!!f[e.name],sx:{mb:1},children:[(0,a.jsx)(d.A,{children:e.label}),(0,a.jsx)(s.A,{value:n,label:e.label,onChange:n=>h(e.name,n.target.value),children:null===(t=e.options)||void 0===t?void 0:t.map(e=>(0,a.jsx)(m.A,{value:e.value,children:e.label},e.value))}),f[e.name]&&(0,a.jsx)(u.A,{color:"error",variant:"caption",children:f[e.name]})]});case"custom":return e.render?e.render({value:n,onChange:n=>h(e.name,n),error:f[e.name]}):null;default:return null}})()},e.name)})})}({field:e,item:n,onChange:(n,a)=>z(e,t,n,a),errors:{}})]},t))]},e.name);case"custom":return e.render?e.render({value:n,onChange:t,error:v}):null;default:return null}};return(0,a.jsxs)("form",{onSubmit:V,children:[E&&(0,a.jsx)(u.A,{variant:"h6",sx:{mb:2},children:t[w].label}),(0,a.jsx)(r.A,{spacing:2,sx:{mt:1},children:O.map(e=>B(e,R[e.name],n=>F(e.name,n),D[e.name]))}),(0,a.jsxs)(p.A,{display:"flex",flexDirection:"row",justifyContent:"flex-end",gap:2,mt:2,children:[E&&w>0&&(0,a.jsx)(f.A,{variant:"outlined",color:"primary",onClick:()=>k(e=>e-1),children:"이전"}),"function"==typeof C&&(0,a.jsx)(f.A,{variant:"outlined",color:"primary",onClick:C,children:"취소"}),(0,a.jsx)(f.A,{type:"submit",variant:"contained",color:"primary",sx:{fontWeight:600},disabled:L,children:E&&w<t.length-1?"다음":j})]})]})}},98378:(e,n,t)=>{"use strict";t.d(n,{default:()=>K});var a=t(22318),i=t(20926),r=t(27333),l=t.n(r),o=t(66292);function c(e){let{items:n,companies:t,priceData:i,selectedRows:r,setSelectedRows:c,selectedColumns:d,setSelectedColumns:s,formatNumber:m,onCompanySelect:u,onItemsSelect:p,onCellValueChanged:h}=e,f=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:250,a=(e.match(/[가-힣]/g)||[]).length,i=e.length-a;return Math.max(n,Math.min(t,16*a+8*i+40))},x=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:250;return Math.max(n,Math.min(t,Math.max(...e.map(e=>f(e,0,1/0)))))},b=e=>{let n=e.displayName,i=t.find(e=>e.companyColumnName===n),r=(null==i?void 0:i.id)||n,l=e.selectedColumns[r];return(0,a.jsx)("div",{className:"w-full h-full flex items-center justify-start cursor-pointer px-[24px] ".concat(l?"bg-blue-200 font-bold":""),onClick:()=>{let e={[r]:!l};s(e);let n=Object.keys(e).find(n=>e[n]);u((n?t.find(e=>e.id===n):null)||null)},children:(0,a.jsx)("span",{children:n})})},g=e=>{var n;let{data:t,colDef:l}=e;if(!t)return null;let o=t.name,c=null==l?void 0:l.field,s=c&&(null===(n=i[c])||void 0===n?void 0:n[o])||0,u=r[t.id],p=!!c&&d[c];return(0,a.jsx)("div",{className:"w-full h-full flex items-center justify-start ".concat(u&&p?"bg-green-200 font-bold":u?"bg-blue-100":""),children:(0,a.jsx)("span",{children:s>0?m(s):""})})},v=[{headerName:"",checkboxSelection:!0,minWidth:50,flex:1,headerCheckboxSelection:!0,filter:!1,pinned:"left",lockPinned:!0,width:70,field:"checkbox"},{headerName:"제품명",field:"name",pinned:"left",width:x([...n.map(e=>e.name),"제품명"],80,200),cellStyle:e=>({backgroundColor:r[e.data.id]?"#DBEAFE":"#f8f9fa"}),sortable:!1},{headerName:"원산지",field:"origin",pinned:"left",width:x([...n.map(e=>e.origin),"원산지"],60,120),cellStyle:e=>({backgroundColor:r[e.data.id]?"#DBEAFE":"#f8f9fa"}),sortable:!1},...t.map(e=>({headerName:e.companyColumnName,headerClass:"company-header",field:e.id,headerComponent:n=>b({...n,displayName:e.companyColumnName,selectedColumns:d,setSelectedColumns:s}),minWidth:100,width:f(e.companyColumnName),cellRenderer:g,editable:!0,cellStyle:n=>{let t=r[n.data.id],a=d[e.id];return{backgroundColor:t&&a?"#BBF7D0":t?"#DBEAFE":a?"#FEF3C7":"#ffffff"}},sortable:!1}))],y=n.map(e=>{let n={...e};return t.forEach(t=>{var a;n[t.id]=(null===(a=i[t.id])||void 0===a?void 0:a[e.name])||0}),n});return(0,a.jsx)("div",{className:"w-full",children:(0,a.jsxs)("div",{className:"jsx-da33b79ac718ce16 w-full h-[600px]",children:[(0,a.jsx)(l(),{id:"da33b79ac718ce16",children:"div.jsx-da33b79ac718ce16 .ag-header-cell.company-header{padding:0!important}"}),(0,a.jsx)(o.A,{columnDefs:v,data:y,pagination:!1,loading:!1,onSelectionChanged:e=>{let n=e.api.getSelectedNodes(),t={};n.forEach(e=>{t[e.data.id]=!0}),c(t),p(n.map(e=>e.data.id))},onCellValueChanged:h})]})})}var d=t(40017),s=t(57797),m=t(89085),u=t(49344),p=t(60720);let h=p.z.object({name:p.z.string().min(1,"업체명을 입력해주세요."),description:p.z.string().optional(),priceType:p.z.enum(["arrival","loading"])}),f=[{name:"name",label:"업체명",type:"text",required:!0},{name:"priceType",label:"가격 유형",type:"select",options:[{label:"도착도",value:"arrival"},{label:"상차도",value:"loading"}],required:!0}];function x(e){let{onClose:n,onSubmit:t,submitLabel:r="추가"}=e,[l,o]=(0,i.useState)({}),c=async e=>{try{t(e),o({}),null==n||n()}catch(e){e instanceof Error?o({name:e.message}):o({name:"오류가 발생했습니다."})}};return(0,a.jsx)(u.A,{fields:f,onSubmit:c,submitLabel:r,zodSchema:h,fieldErrors:l})}function b(e){let{onClose:n,onSubmit:t,submitLabel:r="수정",selectedCompany:l}=e,[o,c]=(0,i.useState)({});if(!l)return null;let d=async e=>{try{t(e),c({}),null==n||n()}catch(e){e instanceof Error?c({name:e.message}):c({name:"오류가 발생했습니다."})}};return(0,a.jsx)(u.A,{fields:f,onSubmit:d,submitLabel:r,zodSchema:h,fieldErrors:o,initialValues:{name:l.companyName,priceType:l.priceType}})}let g=p.z.object({itemName:p.z.string().min(1,"제품명을 입력해주세요."),itemOrigin:p.z.string().min(1,"원산지를 입력해주세요."),itemNameEn:p.z.string().min(1,"제품명(영문)을 입력해주세요."),itemOriginEn:p.z.string().min(1,"원산지(영문)을 입력해주세요.")}),v=[{name:"itemName",label:"제품명",type:"text",required:!0},{name:"itemOrigin",label:"원산지",type:"text",required:!0},{name:"itemNameEn",label:"제품명(영문)",type:"text",required:!0},{name:"itemOriginEn",label:"원산지(영문)",type:"text",required:!0}];function y(e){let{onClose:n,onSubmit:t,submitLabel:r="추가"}=e,[l,o]=(0,i.useState)({}),c=async e=>{try{t(e),o({}),null==n||n()}catch(e){e instanceof Error?o({itemName:e.message}):o({itemName:"오류가 발생했습니다."})}};return(0,a.jsx)(u.A,{fields:v,onSubmit:c,submitLabel:r,zodSchema:g,fieldErrors:l})}function j(e){var n,t;let{onClose:r,onSubmit:l,submitLabel:o="수정",selectedItem:c}=e,[d,s]=(0,i.useState)({});if(!c)return null;let m=async e=>{try{l(e),s({}),null==r||r()}catch(e){e instanceof Error?s({itemName:e.message}):s({itemName:"오류가 발생했습니다."})}};return(0,a.jsx)(u.A,{fields:v,onSubmit:m,submitLabel:o,zodSchema:g,initialValues:{itemName:c.itemName,itemOrigin:c.itemOrigin,itemNameEn:null!==(n=c.itemNameEn)&&void 0!==n?n:"",itemOriginEn:null!==(t=c.itemOriginEn)&&void 0!==t?t:""},fieldErrors:d})}var A=t(57598),C=t(71599);function S(e){let{open:n,onClose:t,onConfirm:i,title:r,message:l}=e;return(0,a.jsxs)(d.A,{open:n,onClose:t,maxWidth:"xs",fullWidth:!0,children:[(0,a.jsx)(s.A,{children:r}),(0,a.jsx)(m.A,{sx:{py:3},children:l}),(0,a.jsxs)(A.A,{sx:{px:3,pb:2,pt:0,justifyContent:"flex-end"},children:[(0,a.jsx)(C.A,{variant:"outlined",color:"primary",onClick:t,children:"취소"}),(0,a.jsx)(C.A,{variant:"contained",color:"primary",onClick:i,children:"삭제"})]})]})}function N(e){let{open:n,onClose:t,onConfirm:i}=e;return(0,a.jsx)(S,{open:n,onClose:t,onConfirm:i,title:"업체 삭제 확인",message:"정말로 선택한 업체를 삭제하시겠습니까?"})}function E(e){let{open:n,onClose:t,onConfirm:i}=e;return(0,a.jsx)(S,{open:n,onClose:t,onConfirm:i,title:"품목 삭제 확인",message:"정말로 선택한 품목을 삭제하시겠습니까?"})}function w(e){let{open:n,onClose:t,onSubmit:i}=e;return(0,a.jsxs)(d.A,{open:n,onClose:t,maxWidth:"xs",fullWidth:!0,children:[(0,a.jsx)(s.A,{children:"업체 추가"}),(0,a.jsx)(m.A,{children:(0,a.jsx)(x,{onClose:t,onSubmit:i})})]})}function k(e){let{open:n,onClose:t,onSubmit:i,selectedCompany:r}=e;return(0,a.jsxs)(d.A,{open:n,onClose:t,maxWidth:"xs",fullWidth:!0,children:[(0,a.jsx)(s.A,{children:"업체 수정"}),(0,a.jsx)(m.A,{children:(0,a.jsx)(b,{onClose:t,onSubmit:i,selectedCompany:r})})]})}function O(e){let{open:n,onClose:t,onSubmit:i}=e;return(0,a.jsxs)(d.A,{open:n,onClose:t,maxWidth:"xs",fullWidth:!0,children:[(0,a.jsx)(s.A,{children:"품목 추가"}),(0,a.jsx)(m.A,{children:(0,a.jsx)(y,{onClose:t,onSubmit:i})})]})}function R(e){let{open:n,onClose:t,onSubmit:i,selectedItem:r}=e;return(0,a.jsxs)(d.A,{open:n,onClose:t,maxWidth:"xs",fullWidth:!0,children:[(0,a.jsx)(s.A,{children:"품목 수정"}),(0,a.jsx)(m.A,{children:(0,a.jsx)(j,{onClose:t,onSubmit:i,selectedItem:r})})]})}function T(e){let{open:n,onClose:t,onDownload:r,onOpenInNewWindow:l}=e,[o,c]=(0,i.useState)(!1),[u,p]=(0,i.useState)(!1),h=async()=>{if(!o)try{c(!0),await r()}finally{c(!1)}},f=async()=>{if(!u)try{p(!0),await l()}finally{p(!1)}},x=o||u;return(0,a.jsxs)(d.A,{open:n,onClose:t,maxWidth:"xs",fullWidth:!0,children:[(0,a.jsx)(s.A,{children:"견적서 출력"}),(0,a.jsx)(m.A,{sx:{py:3},children:"아래 버튼을 클릭하여 견적서를 출력할 수 있습니다."}),(0,a.jsxs)(A.A,{sx:{px:3,pb:2,pt:0,justifyContent:"flex-end"},children:[(0,a.jsx)(C.A,{variant:"outlined",color:"primary",onClick:t,disabled:x,children:"창 닫기"}),(0,a.jsx)(C.A,{variant:"contained",color:"primary",onClick:h,disabled:x,children:o?"다운로드 중...":"다운로드"}),(0,a.jsx)(C.A,{variant:"contained",color:"primary",onClick:f,disabled:x,children:u?"새창 열기 중...":"새창에서 열기"})]})]})}var D=t(92262),I=t(40404),L=t(39390),W=t(64358);let F=(0,W.createServerReference)("008c79e7b09ae4723dd2d6ba4fb1333aff2ab0e31a",W.callServer,void 0,W.findSourceMapURL,"getDomesticAction"),M=(0,W.createServerReference)("00601584ba4e18e46925a4a924e98d11f979d29c83",W.callServer,void 0,W.findSourceMapURL,"getForeignerAction"),U=(0,W.createServerReference)("409a615c018433fa2f101a2a21581937161c0c1ee2",W.callServer,void 0,W.findSourceMapURL,"addQuotationCompanyAction"),z=(0,W.createServerReference)("40f749ad93ee75eadf1cc05d8edc5da960aaa830d1",W.callServer,void 0,W.findSourceMapURL,"updateQuotationCellAction"),P=(0,W.createServerReference)("40505237c0372e88c322fb73731b0cdee4aba64747",W.callServer,void 0,W.findSourceMapURL,"addQuotationItemAction"),V=(0,W.createServerReference)("40978e4adc50118fd05fa6dfb16b58a8d80242dea3",W.callServer,void 0,W.findSourceMapURL,"deleteQuotationCompanyAction"),B=(0,W.createServerReference)("4055fb31d9adee20bd75e8170cbda5f709b74963f8",W.callServer,void 0,W.findSourceMapURL,"deleteQuotationItemAction"),_=(0,W.createServerReference)("60c7bac4156a834f9aa4d6980d87e605630af8d75c",W.callServer,void 0,W.findSourceMapURL,"updateCompanyAction"),q=(0,W.createServerReference)("6048f7069ff341fc5173436274c4b93d2ee114bdd0",W.callServer,void 0,W.findSourceMapURL,"updateItemAction"),Q=(0,W.createServerReference)("401df350c3b6aa883ddfad7dd5397163bb931bbb49",W.callServer,void 0,W.findSourceMapURL,"generateQuotationPDF");var G=t(80681);let H=()=>{let e=new Date,n=e.getFullYear().toString(),t=(e.getMonth()+1).toString().padStart(2,"0"),a=e.getDate().toString().padStart(2,"0"),i=Math.floor(1e4*Math.random()).toString().padStart(4,"0");return"GP".concat(n).concat(t).concat(a).concat(i)};function K(){let[e,n]=(0,i.useState)(!1),[t,r]=(0,i.useState)(!1),[l,o]=(0,i.useState)(!1),[d,s]=(0,i.useState)(!1),[m,u]=(0,i.useState)(!1),[p,h]=(0,i.useState)(!1),[f,x]=(0,i.useState)(null),[b,g]=(0,i.useState)(null),[v,y]=(0,i.useState)(!1),[j,A]=(0,i.useState)({}),[S,W]=(0,i.useState)({}),[K,Y]=(0,i.useState)([]),[J,X]=(0,i.useState)([]),[Z,$]=(0,i.useState)({}),[ee,en]=(0,i.useState)([]),[et,ea]=(0,i.useState)([]),[ei,er]=(0,i.useState)({}),[el,eo]=(0,i.useState)("domestic"),ec="domestic"===el?K:ee,ed="domestic"===el?J:et,es="domestic"===el?Z:ei,em="domestic"===el?Y:en,eu="domestic"===el?X:ea,ep="domestic"===el?$:er;(0,i.useEffect)(()=>{(async()=>{let e=await F();Y(e.items),X(e.companies.map(e=>({...e,companyColumnName:ef(e.companyName,e.priceType)}))),$(e.priceData);let n=await M();en(n.items),ea(n.companies.map(e=>({...e,companyColumnName:ef(e.companyName,e.priceType)}))),er(n.priceData),console.log("domesticData",e),console.log("overseasData",n)})()},[]);let eh=e=>new Intl.NumberFormat("ko-KR").format(e),ef=(e,n)=>"arrival"===n?"".concat(e," (도착도)"):"".concat(e," (상차도)"),ex=(e,n,t)=>{if(t.some(t=>t.companyName===e&&t.priceType===n))throw Error("이미 존재하는 업체명과 가격 타입입니다. (".concat(e," - ").concat("arrival"===n?"도착도":"상차도",")"))},eb=(e,n,t)=>{if(t.some(t=>t.itemName===e&&t.itemOrigin===n))throw Error("이미 존재하는 품목입니다. (".concat(e," - ").concat(n,")"))},eg=()=>{let e=[];return Object.entries(j).forEach(n=>{let[t,a]=n;a&&Object.entries(S).forEach(n=>{let[a,i]=n;if(i){var r;let n=ec.find(e=>e.id===t),i=ed.find(e=>e.id===a),l=(null===(r=es[a])||void 0===r?void 0:r[(null==n?void 0:n.itemName)||""])||0;l>0&&e.push({productCode:t,productName:(null==n?void 0:n.itemName)||"",origin:(null==n?void 0:n.itemOrigin)||"",company:(null==i?void 0:i.companyName)||a,priceType:(null==i?void 0:i.priceType)||"",price:l,originEn:(null==n?void 0:n.itemOriginEn)||"",productNameEn:(null==n?void 0:n.itemNameEn)||""})}})}),e},ev=async e=>{try{let n=e.data.id,t=e.column.getColId(),a=e.newValue,i=e.oldValue,r=e.data[t];if(console.log("=== 셀 값 변경 디버깅 ==="),console.log("itemId:",n),console.log("companyId:",t),console.log("newValue:",a),console.log("oldValue:",i),console.log("currentValue:",r),console.log("params:",e),!t||"string"!=typeof t){console.log("companyId가 유효하지 않음, 처리 중단");return}let l=void 0!==a?a:r,o=""===l||null==l?null:Number(l);console.log("finalValue:",l),console.log("numericValue:",o);let c=ec.find(e=>e.id===n);c&&ep(e=>({...e,[t]:{...e[t],[c.itemName]:o||0}})),await z({itemId:n,companyId:t,value:o}),console.log("셀 값 업데이트 완료: 제품 ".concat(n,", 회사 ").concat(t,", 값 ").concat(o))}catch(e){console.error("셀 값 업데이트 실패:",e),alert("가격 업데이트에 실패했습니다. 다시 시도해주세요.")}},ey=async()=>{let e=eg(),n=await Q({sender:"㈜ 곰표",receiver:e[0].company,date:new Date().toISOString().split("T")[0],items:e.map((e,n)=>({no:n+1,name:e.productName,originEn:e.originEn,nameEn:e.productNameEn,price:e.price})),documentNumber:H(),priceType:e[0].priceType,reference:""});if(!n.success||!n.pdf)throw Error(n.error||"PDF 생성에 실패했습니다.");let t=atob(n.pdf),a=new Uint8Array(t.length);for(let e=0;e<t.length;e++)a[e]=t.charCodeAt(e);return{bytes:a,filename:n.filename||"견적서.pdf"}},ej=async()=>{try{let{bytes:e,filename:n}=await ey(),t=new Blob([e],{type:"application/pdf"}),a=URL.createObjectURL(t),i=document.createElement("a");i.href=a,i.download=n,i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(a),console.log("PDF 다운로드 완료:",n)}catch(e){console.error("PDF 다운로드 중 오류 발생:",e),alert("PDF 다운로드 중 오류가 발생했습니다: "+(e instanceof Error?e.message:"알 수 없는 오류"))}},eA=async()=>{try{let{bytes:e,filename:n}=await ey(),t=new Blob([e],{type:"application/pdf"}),a=URL.createObjectURL(t),i=window.open(a,"_blank");if(i)i.addEventListener("load",()=>{try{i.document.title=n}catch(e){console.warn("새 창 제목 설정 실패:",e)}}),setTimeout(()=>{URL.revokeObjectURL(a)},1e3),console.log("PDF 새 창에서 열기 완료:",n);else{alert("팝업이 차단되었습니다. 다운로드로 진행합니다.");let e=document.createElement("a");e.href=a,e.download=n,e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e),URL.revokeObjectURL(a),console.log("팝업 차단으로 다운로드 대체 완료:",n)}}catch(e){console.error("PDF 새창 열기 중 오류 발생:",e),alert("PDF 새창 열기 중 오류가 발생했습니다: "+(e instanceof Error?e.message:"알 수 없는 오류"))}};return(0,a.jsxs)("div",{className:"w-full min-h-screen bg-gray-100",children:[(0,a.jsxs)("div",{className:"p-4 sm:p-8",children:[(0,a.jsx)("div",{className:"flex flex-col lg:flex-row lg:items-center sm:justify-between mb-4 sm:mb-6 gap-4",children:(0,a.jsx)("h1",{className:"text-xl sm:text-2xl font-bold",children:"견적서 작성"})}),(0,a.jsxs)(D.A,{direction:"row",spacing:2,children:[(0,a.jsx)("div",{className:"flex flex-row justify-between items-end flex-shrink-0",style:{minHeight:24},children:(0,a.jsxs)(I.A,{value:el,onChange:(e,n)=>eo(n),sx:{mb:2,"& .MuiTabs-indicator":{backgroundColor:"#22C55E"},"& .MuiTab-root":{color:"#6B7280","&.Mui-selected":{color:"#22C55E"},"&:hover":{color:"#16A34A"}}},children:[(0,a.jsx)(L.A,{label:"국내 업체",value:"domestic"}),(0,a.jsx)(L.A,{label:"해외 업체",value:"overseas"})]})}),(0,a.jsxs)(D.A,{direction:"row",spacing:2,className:"w-full justify-end pb-4",children:[(0,a.jsx)(C.A,{variant:"contained",onClick:()=>n(!0),sx:{backgroundColor:"#22C55E","&:hover":{backgroundColor:"#16A34A"},fontWeight:600,boxShadow:"none"},children:"업체 추가"}),(0,a.jsx)(C.A,{variant:"contained",onClick:()=>r(!0),disabled:!f,sx:{backgroundColor:"#22C55E","&:hover":{backgroundColor:"#16A34A"},fontWeight:600,boxShadow:"none"},children:"업체 수정"}),(0,a.jsx)(C.A,{variant:"contained",onClick:()=>o(!0),sx:{backgroundColor:"#3B82F6","&:hover":{backgroundColor:"#2563EB"},fontWeight:600,boxShadow:"none"},children:"품목 추가"}),(0,a.jsx)(C.A,{variant:"contained",onClick:()=>s(!0),disabled:null===b||1!==b.length,sx:{backgroundColor:"#3B82F6","&:hover":{backgroundColor:"#2563EB"},fontWeight:600,boxShadow:"none"},children:"품목 수정"}),(0,a.jsx)(C.A,{variant:"contained",onClick:()=>u(!0),disabled:!f,sx:{backgroundColor:"#EF4444","&:hover":{backgroundColor:"#DC2626"},fontWeight:600,boxShadow:"none"},children:"업체 삭제"}),(0,a.jsx)(C.A,{variant:"contained",onClick:()=>h(!0),disabled:null===b||0===b.length,sx:{backgroundColor:"#EF4444","&:hover":{backgroundColor:"#DC2626"},fontWeight:600,boxShadow:"none"},children:"품목 삭제"}),(0,a.jsxs)(C.A,{variant:"contained",disabled:0===eg().length,onClick:()=>y(!0),sx:{backgroundColor:"#6366F1","&:hover":{backgroundColor:"#4F46E5"},fontWeight:600,boxShadow:"none"},children:["견적서 작성 (",eg().length,")"]})]})]}),(0,a.jsx)("div",{className:"overflow-hidden",children:(0,a.jsx)(c,{items:ec.map(e=>({id:e.id,code:e.itemOrigin,name:e.itemName,origin:e.itemOrigin})),companies:ed,priceData:es,selectedRows:j,setSelectedRows:A,selectedColumns:S,setSelectedColumns:W,getIntersectionItems:eg,formatNumber:eh,onCompanySelect:x,onItemsSelect:g,onCellValueChanged:ev})}),eg().length>0&&(0,a.jsxs)("div",{className:"mt-4 p-3 bg-green-50 rounded-lg",children:[(0,a.jsxs)("p",{className:"text-sm text-green-800 font-semibold",children:["선택된 견적 항목: ",eg().length,"개"]}),(0,a.jsx)("div",{className:"text-xs text-green-700 mt-1",children:eg().map((e,n)=>(0,a.jsxs)("span",{children:[e.company,"에서 ",e.productName," (",eh(e.price),"원)",n<eg().length-1?", ":""]},n))})]})]}),(0,a.jsx)(w,{open:e,onClose:()=>n(!1),onSubmit:e=>{let n=e.name;ex(n,e.priceType,ed);let t={id:(0,G.Ak)(),companyName:n,companyType:el,priceType:e.priceType,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},a={...t,companyColumnName:ef(t.companyName,t.priceType)};eu(e=>[...e,a]),ep(e=>({...e,[t.id]:{}})),U(t),z({companyId:t.id,itemId:"domestic"===el?K[0].id:ee[0].id,value:0})}}),f&&ed.find(e=>e.id===f.id)&&(0,a.jsx)(k,{open:t,onClose:()=>r(!1),onSubmit:e=>{f&&(ex(e.name,e.priceType,ed),_(f.id,{companyName:e.name,companyType:el,priceType:e.priceType}),eu(n=>n.map(n=>n.id===f.id?{...n,companyName:e.name,priceType:e.priceType,companyColumnName:ef(e.name,e.priceType)}:n)),r(!1))},selectedCompany:ed.find(e=>e.id===(null==f?void 0:f.id))||f}),(0,a.jsx)(O,{open:l,onClose:()=>o(!1),onSubmit:e=>{eb(e.itemName,e.itemOrigin,ec);let n={id:(0,G.Ak)(),itemName:e.itemName,itemOrigin:e.itemOrigin,itemNameEn:e.itemNameEn,itemOriginEn:e.itemOriginEn,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};em(e=>[...e,n]),P(n),z({companyId:"domestic"===el?J[0].id:et[0].id,itemId:n.id,value:0})}}),b&&b.length>0&&ec.find(e=>e.id===b[0])&&(0,a.jsx)(R,{open:d,onClose:()=>s(!1),onSubmit:e=>{b&&(eb(e.itemName,e.itemOrigin,ec),q(b[0],{itemName:e.itemName,itemOrigin:e.itemOrigin,itemNameEn:e.itemNameEn,itemOriginEn:e.itemOriginEn}),em(n=>n.map(n=>n.id===b[0]?{...n,itemName:e.itemName,itemOrigin:e.itemOrigin,itemNameEn:e.itemNameEn,itemOriginEn:e.itemOriginEn}:n)),s(!1))},selectedItem:ec.find(e=>e.id===(null==b?void 0:b[0]))}),(0,a.jsx)(N,{open:m,onClose:()=>u(!1),onConfirm:()=>{f&&(eu(e=>e.filter(e=>e.id!==f.id)),V(f.id),ep(e=>{let n={...e};return delete n[f.id],n}),x(null),u(!1))}}),(0,a.jsx)(E,{open:p,onClose:()=>h(!1),onConfirm:()=>{null!==b&&0!==b.length&&(em(e=>e.filter(e=>!b.includes(e.id))),b.forEach(e=>{B(e)}),ep(e=>{let n={...e};return Object.keys(n).forEach(e=>{b.forEach(t=>{let a=ec.find(e=>e.id===t);a&&n[e][a.itemName]&&delete n[e][a.itemName]})}),n}),g([]),h(!1))}}),(0,a.jsx)(T,{open:v,onClose:()=>y(!1),onDownload:ej,onOpenInNewWindow:eA})]})}}},e=>{var n=n=>e(e.s=n);e.O(0,[775,82,426,336,69,510,90,394,52,555,453,292,39,77,358],()=>n(41002)),_N_E=e.O()}]);
