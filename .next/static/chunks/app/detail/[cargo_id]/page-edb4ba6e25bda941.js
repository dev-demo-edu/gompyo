(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[999],{9168:(e,t,a)=>{Promise.resolve().then(a.bind(a,90437))},39389:(e,t,a)=>{"use strict";a.d(t,{MM:()=>r,RQ:()=>o,aj:()=>i,c4:()=>s});var n=a(81478);let r=(0,n.eU)(!1),l=(0,n.eU)({}),i=(0,n.eU)(e=>e(l),(e,t,a)=>{let{cargoId:n,category:r,documents:i,isLoading:s}=a,o=e(l),c="".concat(n,"-").concat(r);t(l,{...o,[c]:{documents:i,isLoading:s,lastFetched:Date.now()}})}),s=(0,n.eU)(e=>{let t=e(l);return(e,a)=>{var n;return(null===(n=t["".concat(e,"-").concat(a)])||void 0===n?void 0:n.documents)||[]}}),o=(0,n.eU)(e=>{let t=e(l);return(e,a)=>{var n;return(null===(n=t["".concat(e,"-").concat(a)])||void 0===n?void 0:n.isLoading)||!1}})},90437:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>eP});var n=a(51083),r=a(55061),l=a(39562),i=a(25628),s=a(71392),o=a(39657),c=a(4315),d=a(54128),u=a(35400),m=a(67202),p=a(60295),h=a(35003),g=a(32895),y=a(76244),b=a(5147),v=a(95782),x=a(24942),f=a(57886),A=a(81478),j=a(1231);let C=(0,j.createServerReference)("40161bec10f90f5a56f0cf37d2804c2dbb4bd62322",j.callServer,void 0,j.findSourceMapURL,"getCargoDetail"),T=(0,j.createServerReference)("602bc4241be5cce5b6c63706669e6a559a7f0ba1b7",j.callServer,void 0,j.findSourceMapURL,"updateCargoDetail");class N{calculateValues(){let e=this.data.costDetail.unitPrice||0,t=this.data.costDetail.exchangeRate||0,a=this.data.cargo.contractTon||0,n=this.data.cargo.sellingPrice||0,r=this.data.cargo.purchaseFeeRate||0,l=e*t*a,i=(l+(this.data.costDetail.customTaxAmount||0)+(this.data.costDetail.customsFee||0)+(this.data.costDetail.inspectionFee||0)+(this.data.costDetail.doCharge||0)+(this.data.costDetail.otherCosts||0))/a/1e3,s=i*(1+r/100)*a*1e3,o=s+(this.data.cost.shippingCost||0)+(this.data.cost.laborCost||0)+(this.data.cost.transportStorageFee||0)+(this.data.cost.loadingUnloadingFee||0),c=n-o/a/1e3;return{supplyPrice:e*t*a/1e3,margin:c,totalProfit:c*a*1e3,totalContractPrice:l,costPerKg:e*t/1e3,contractorCost:i,contractorProfit:s,totalCost:o}}mapItem(e){return{id:e.id,itemName:e.itemName||"",itemVariety:e.itemVariety||"",originCountry:e.originCountry||"",hsCode:e.hsCode||"",packingUnit:e.packingUnit||""}}mapShipment(e){return{id:e.id,estimatedTimeArrival:e.estimatedTimeArrival||"",estimatedTimeDeparture:e.estimatedTimeDeparture||"",arrivalPort:e.arrivalPort||"",departurePort:e.departurePort||"",blNumber:e.blNumber||"",palletOrderDate:e.palletOrderDate||"",palletType:e.palletType||"",shippingCompany:e.shippingCompany||"",contractId:e.contractId||""}}mapContract(e,t){return{id:e.id,incoterms:e.incoterms||"",contractNumber:e.contractNumber||"",contractDate:e.contractDate||"",contractParty:e.contractParty||"",importer:e.importer||"",departurePort:t.departurePort||"",arrivalPort:t.arrivalPort||"",estimatedTimeDeparture:t.estimatedTimeDeparture||"",estimatedTimeArrival:t.estimatedTimeArrival||"",blNumber:t.blNumber||""}}mapPayment(e){return{id:e.id,paymentDueDate:e.paymentDueDate||"",paymentMethod:e.paymentMethod||"",contractId:e.contractId,advancePaymentDate:e.advancePaymentDate||"",advancePaymentRatio:e.advancePaymentRatio||0,advancePaymentAmount:e.advancePaymentAmount||0,remainingPaymentDate:e.remainingPaymentDate||"",remainingPaymentRatio:e.remainingPaymentRatio||0,remainingPaymentAmount:e.remainingPaymentAmount||0,counterpartBank:e.counterpartBank||"",paymentTerm:e.paymentTerm||"",totalContractAmount:this.calculatedValues.totalContractPrice}}mapAndCalculateCostDetail(e){return{id:e.id,unitPrice:e.unitPrice||0,totalContractPrice:this.calculatedValues.totalContractPrice,exchangeRate:e.exchangeRate||0,costPerKg:this.calculatedValues.costPerKg,costId:e.costId,customTaxAmount:e.customTaxAmount||0,customsTaxRate:e.customsTaxRate||0,customsFee:e.customsFee||0,inspectionFee:e.inspectionFee||0,doCharge:e.doCharge||0,otherCosts:e.otherCosts||0,transferFee:e.transferFee||0}}mapAndCalculateContractAmount(e,t){return{id:t.id,cargoId:t.cargoId,contractorCost:this.calculatedValues.contractorCost,supplyPrice:this.calculatedValues.contractorCost*(1+(e.purchaseFeeRate||0)/100),contractorProfit:this.calculatedValues.contractorProfit,shippingCost:t.shippingCost||0,laborCost:t.laborCost||0,transportStorageFee:t.transportStorageFee||0,loadingUnloadingFee:t.loadingUnloadingFee||0}}mapAndCalculateExpense(e){return{id:e.id,itemsId:e.itemsId,shipmentId:e.shipmentId,containerCount:e.containerCount,contractTon:e.contractTon,customsClearanceDate:e.customsClearanceDate,quarantineDate:e.quarantineDate,warehouseEntryDate:e.warehouseEntryDate,progressStatus:e.progressStatus,totalCost:this.calculatedValues.totalCost,sellingPrice:e.sellingPrice||0,margin:this.calculatedValues.margin,totalProfit:this.calculatedValues.totalProfit,purchaseFeeRate:e.purchaseFeeRate}}calculate(){return{contract:this.mapContract(this.data.contract,this.data.shipment),payment:this.mapPayment(this.data.payment),costDetail:this.mapAndCalculateCostDetail(this.data.costDetail),cost:this.mapAndCalculateContractAmount(this.data.cargo,this.data.cost),cargo:this.mapAndCalculateExpense(this.data.cargo),item:this.mapItem(this.data.item),shipment:this.mapShipment(this.data.shipment)}}constructor(e){this.data=e,this.calculatedValues=this.calculateValues()}}let S=(0,j.createServerReference)("70f829686b5aed162d87a8fc02c2750f99dee37f97",j.callServer,void 0,j.findSourceMapURL,"createNewShipmentAndUpdateCargo"),D=(0,A.eU)(null),w=(0,A.eU)(null),R=(0,A.eU)(e=>{let t=e(D);return t?new N(t).calculate():null},async(e,t,a)=>{try{let e=await C(a);t(D,e)}catch(e){throw console.error("화물 정보 조회 중 오류 발생:",e),e}}),E=(0,A.eU)(!1),P=(0,A.eU)(null);(0,A.eU)(null,(e,t)=>{let a=e(D);a&&t(w,JSON.parse(JSON.stringify(a)))});let I=(0,A.eU)(null,(e,t)=>{let a=e(w);a&&(t(D,a),t(w,null))}),O=(0,A.eU)(null,async(e,t,a)=>{let{formData:n,cargoId:r,option:l}=a,i=e(D);if(i)try{let e={};if(e.cargo={...i.cargo,...n},e.costDetail={...i.costDetail,...n},e.cost={...i.cost,...n},e.payment={...i.payment,...n},e.contract={...i.contract,...n},e.item={...i.item,...n},n.blNumber&&"single"===l&&n.blNumber!==i.shipment.blNumber){let t=await S(r,n,l);e.shipment={...t},t&&(e.cargo.shipmentId=t.id)}else e.shipment={...i.shipment,...n};let a=await T(r,e);t(D,a)}catch(e){throw e}});function U(e){let{title:t,fields:a,data:i={},onSave:s,onFieldChange:o,className:d=""}=e,[A,j]=(0,c.useState)(!1),[C,T]=(0,c.useState)({}),[,N]=(0,f.fp)(I);(0,c.useEffect)(()=>{T(Object.entries(i).reduce((e,t)=>{var a;let[n,r]=t;return e[n]=null!==(a=null==r?void 0:r.toString())&&void 0!==a?a:null,e},{}))},[i]);let S=(e,t)=>{if(null===e)return null;switch(t){case"number":return""===e?null:Number(e);case"date":return""===e?null:e;case"string":return e}},D=e=>t=>{let a=t.target.value||null;T(t=>({...t,[e]:a})),o&&o(e,a)},w=e=>{var t;if("select"===e.type&&e.options)return(0,n.jsx)(u.A,{fullWidth:!0,disabled:!A||e.disabled,children:(0,n.jsx)(m.A,{freeSolo:!0,options:e.options,getOptionLabel:e=>"string"==typeof e?e:e.label,value:e.options.find(t=>t.value===C[e.name])||C[e.name]||null,onChange:(t,a)=>{let n="string"==typeof a?a:(null==a?void 0:a.value)||null;T(t=>({...t,[e.name]:n})),o&&o(e.name,n)},onInputChange:(t,a)=>{T(t=>({...t,[e.name]:a})),o&&o(e.name,a)},disabled:!A||e.disabled,renderInput:t=>(0,n.jsx)(p.A,{...t,label:e.label,sx:{"& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(145, 158, 171, 0.2)"}}}),renderOption:(e,t)=>(0,n.jsx)("li",{...e,children:"string"==typeof t?t:t.label})})});let a={fullWidth:!0,label:e.label,variant:"outlined",placeholder:e.placeholder||"입력해주세요.",className:"bg-background-paper",disabled:!A||e.disabled,value:null!==(t=C[e.name])&&void 0!==t?t:"",type:e.type,onChange:D(e.name),sx:{"& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"rgba(145, 158, 171, 0.2)"}}},InputLabelProps:"date"===e.type?{shrink:!0}:void 0};return(0,n.jsx)(p.A,{...a})};return(0,n.jsxs)(h.A,{className:"bg-background-paper rounded-2xl shadow-[0px_12px_24px_-4px_rgba(145,158,171,0.12)] shadow-[0px_0px_2px_0px_rgba(145,158,171,0.20)] inline-flex flex-col justify-start items-end ".concat(d),children:[(0,n.jsxs)(r.A,{className:"self-stretch pl-6 pr-4 py-6 border-b border-[rgba(145,158,171,0.2)] flex justify-between items-center",children:[(0,n.jsx)(l.A,{variant:"h6",className:"text-text-primary font-semibold",children:t}),(0,n.jsx)(r.A,{children:A?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(g.A,{onClick:()=>{s&&s(a.reduce((e,t)=>{let a=C[t.name];return e[t.name]=S(a,t.valueType),e},{})),j(!1)},color:"primary",children:(0,n.jsx)(b.A,{})}),(0,n.jsx)(g.A,{onClick:()=>{T(Object.entries(i).reduce((e,t)=>{var a;let[n,r]=t;return e[n]=null!==(a=null==r?void 0:r.toString())&&void 0!==a?a:null,e},{})),j(!1),N()},color:"primary",children:(0,n.jsx)(v.A,{})})]}):(0,n.jsx)(g.A,{onClick:()=>{j(!0)},children:(0,n.jsx)(x.A,{className:"text-action-disabled opacity-80"})})})]}),(0,n.jsx)(r.A,{className:"self-stretch p-6",children:(0,n.jsx)(y.Ay,{container:!0,spacing:3,children:a.map(e=>(0,n.jsx)(y.Ay,{item:!0,xs:e.gridSize||12,children:w(e)},e.name))})})]})}var k=a(83259),F=a(50233);function _(){let[e,t]=(0,c.useState)(!1),[a,r]=(0,c.useState)({title:"",description:""}),l=()=>{t(!1)};return{toast:e=>{r(e),t(!0)},ToastComponent:()=>(0,n.jsx)(k.A,{open:e,autoHideDuration:2e3,onClose:l,anchorOrigin:{vertical:"top",horizontal:"right"},children:(0,n.jsxs)(F.A,{onClose:l,severity:"destructive"===a.variant?"error":"success",sx:{width:"100%"},children:[(0,n.jsx)("div",{className:"font-semibold",children:a.title}),(0,n.jsx)("div",{children:a.description})]})})}}let L=[{name:"contractNumber",label:"계약 번호",valueType:"string"},{name:"contractDate",label:"계약 일자",valueType:"string",type:"date"},{name:"contractor",label:"계약처",valueType:"string",type:"select",options:[]},{name:"importer",label:"수입처",valueType:"string"},{name:"incoterms",label:"인코텀즈",valueType:"string"},{name:"departurePort",label:"출발항",gridSize:6,valueType:"string"},{name:"arrivalPort",label:"도착항",gridSize:6,valueType:"string"},{name:"estimatedTimeDeparture",label:"ETD",gridSize:6,valueType:"string",type:"date"},{name:"estimatedTimeArrival",label:"ETA",gridSize:6,valueType:"string",type:"date"},{name:"blNumber",label:"B/L 번호",valueType:"string"}],M=[{name:"paymentMethod",label:"결제 방식",valueType:"string",type:"select",options:[{value:"T/T",label:"T/T"},{value:"CAD",label:"CAD"},{value:"L/C",label:"L/C at sight"},{value:"Usance",label:"Payment Usance"}]}],z={"T/T":[{name:"exchangeRate",label:"환율",valueType:"number"},{name:"counterpartBank",label:"상대방 은행",valueType:"string"},{name:"advancePaymentDate",label:"선급금 날짜",gridSize:6,valueType:"string",type:"date"},{name:"remainingPaymentDate",label:"잔금 날짜",gridSize:6,valueType:"string",type:"date"},{name:"advancePaymentRatio",label:"선급금 비율",gridSize:6,valueType:"number"},{name:"remainingPaymentRatio",label:"잔금 비율",gridSize:6,valueType:"number"},{name:"advancePaymentAmount",label:"선급금 금액",gridSize:6,valueType:"number",disabled:!0},{name:"remainingPaymentAmount",label:"잔금 금액",gridSize:6,valueType:"number",disabled:!0}],CAD:[{name:"exchangeRate",label:"환율",valueType:"number"},{name:"paymentDueDate",label:"대금 결제일",valueType:"string",type:"date"}],"L/C":[{name:"exchangeRate",label:"환율",valueType:"number"},{name:"paymentDueDate",label:"대금 결제일",valueType:"string",type:"date"}],Usance:[{name:"paymentTerm",label:"결제 기간",valueType:"string"},{name:"exchangeRate",label:"환율",valueType:"number"},{name:"paymentDueDate",label:"대금 결제일",valueType:"string",type:"date"}]},V=[{name:"unitPrice",label:"단가 MT / $",valueType:"number"},{name:"totalContractPrice",label:"총 계약가",valueType:"number",disabled:!0},{name:"exchangeRate",label:"환율",valueType:"number"},{name:"costPerKg",label:"원가 Kg / ₩",valueType:"number",disabled:!0},{name:"customsTaxRate",label:"관세율",valueType:"number",endAdornment:"%"},{name:"customTaxAmount",label:"관세액",valueType:"number",disabled:!0},{name:"transferFee",label:"송금수수료",valueType:"number"},{name:"customsFee",label:"관세수수료",valueType:"number"},{name:"inspectionFee",label:"검사료",valueType:"number"},{name:"doCharge",label:"D/O Charge",valueType:"number"},{name:"otherCosts",label:"기타비용",valueType:"number"},{name:"purchaseFeeRate",label:"매입 수수료율",valueType:"number"}],B=[{name:"contractorCost",label:"계약처 원가",valueType:"number",disabled:!0},{name:"supplyPrice",label:"계약처 수급가",valueType:"number",disabled:!0},{name:"contractorProfit",label:"계약처 이익",valueType:"number",disabled:!0},{name:"shippingCost",label:"배송비",valueType:"number"},{name:"laborCost",label:"작업료",valueType:"number"},{name:"transportStorageFee",label:"운송/보관료",valueType:"number"},{name:"loadingUnloadingFee",label:"상하차 비용",valueType:"number"}],G=[{name:"totalCost",label:"총비용",valueType:"number",disabled:!0},{name:"sellingPrice",label:"판매가",valueType:"number"},{name:"margin",label:"마진",valueType:"number",disabled:!0},{name:"totalProfit",label:"총이익",valueType:"number",disabled:!0}];var W=a(37285);let Q=e=>{let{open:t,onClose:a,onSelect:i}=e;return(0,n.jsx)(W.A,{open:t,onClose:a,"aria-labelledby":"bl-number-update-modal","aria-describedby":"bl-number-update-modal-description",children:(0,n.jsxs)(r.A,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",boxShadow:24,p:4,borderRadius:2},children:[(0,n.jsx)(l.A,{id:"bl-number-update-modal",variant:"h6",component:"h2",sx:{mb:2},children:"B/L 번호 업데이트"}),(0,n.jsx)(l.A,{id:"bl-number-update-modal-description",sx:{mb:3},children:"B/L 번호를 어떻게 업데이트하시겠습니까?"}),(0,n.jsxs)(r.A,{sx:{display:"flex",gap:2,justifyContent:"center"},children:[(0,n.jsx)(o.A,{variant:"outlined",onClick:()=>i("all"),children:"전체 계약 업데이트"}),(0,n.jsx)(o.A,{variant:"contained",onClick:()=>i("single"),children:"특정 화물 업데이트"})]})]})})};function q(e){var t,a,l;let{cargoId:i}=e,[s,o]=(0,f.fp)(R),[u,m]=(0,f.fp)(E),p=(0,f.Xr)(P),[,h]=(0,f.fp)(O),{toast:g,ToastComponent:y}=_(),[b,v]=(0,c.useState)(!1),[x,A]=(0,c.useState)(null),[j,C]=(0,c.useState)(""),[T,N]=(0,c.useState)(()=>(console.log("Initializing currentPaymentFields"),M));(0,c.useEffect)(()=>{var e,t;console.log("mappedData effect triggered, paymentMethod:",null==s?void 0:null===(e=s.payment)||void 0===e?void 0:e.paymentMethod),(null==s?void 0:null===(t=s.payment)||void 0===t?void 0:t.paymentMethod)&&C(s.payment.paymentMethod)},[null==s?void 0:null===(t=s.payment)||void 0===t?void 0:t.paymentMethod]);let S=e=>{console.log("handlePaymentMethodChange called with:",e),C(e)};(0,c.useEffect)(()=>{if(!j){N(M);return}N([...M,...z[j]||[]])},[j]);let D={...null==s?void 0:s.payment,paymentMethod:j||(null==s?void 0:null===(a=s.payment)||void 0===a?void 0:a.paymentMethod),exchangeRate:null==s?void 0:null===(l=s.costDetail)||void 0===l?void 0:l.exchangeRate};(0,c.useEffect)(()=>{!async function(){if(s){m(!1);return}try{m(!0),await o(i)}catch(e){p(e instanceof Error?e.message:"데이터를 불러오는 중 오류가 발생했습니다.")}finally{m(!1)}}()},[i,s,o,m,p]);let w=async e=>{if(!s)return;"T/T"===e.paymentMethod&&(e.totalContractAmount=(s.costDetail.unitPrice||0)*(s.costDetail.exchangeRate||0)*(s.cargo.contractTon||0));let t={...e};if(t.blNumber&&t.blNumber!==s.contract.blNumber){A(t),v(!0);return}try{await h({formData:t,cargoId:i}),await o(i),g({title:"성공",description:"데이터가 성공적으로 저장되었습니다."})}catch(e){g({title:"오류",description:e instanceof Error?e.message:"데이터 저장 중 오류가 발생했습니다.",variant:"destructive"})}},I=async e=>{if(v(!1),x){try{await h({formData:x,cargoId:i,option:e}),await o(i),g({title:"성공",description:"데이터가 성공적으로 저장되었습니다."})}catch(e){g({title:"오류",description:e instanceof Error?e.message:"데이터 저장 중 오류가 발생했습니다.",variant:"destructive"})}A(null)}};return u?(0,n.jsx)(r.A,{className:"w-full h-full flex items-center justify-center",children:(0,n.jsx)(d.A,{})}):s?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(y,{}),(0,n.jsx)(Q,{open:b,onClose:()=>v(!1),onSelect:I}),(0,n.jsxs)(r.A,{className:"w-full mx-auto inline-flex justify-start items-start gap-6 flex-wrap content-start",children:[(0,n.jsx)(U,{title:"계약 정보",fields:L,className:"w-full",data:s.contract,onSave:e=>w(e)}),(0,n.jsx)(U,{title:"결제 정보",fields:T,className:"w-full",data:D,onSave:e=>{w(e)},onFieldChange:(e,t)=>{"paymentMethod"===e&&S(t)}}),(0,n.jsx)(U,{title:"원가 정보",fields:V,className:"w-full md:w-[calc(50%-12px)]",data:{...s.costDetail,purchaseFeeRate:s.cargo.purchaseFeeRate},onSave:e=>w(e)}),(0,n.jsx)(U,{title:"계약처 금액 정보",fields:B,className:"w-full md:w-[calc(50%-12px)]",data:s.cost,onSave:e=>w(e)}),(0,n.jsx)(U,{title:"비용 정보",fields:G,className:"w-full",data:s.cargo,onSave:e=>w(e)})]})]}):(0,n.jsx)("div",{})}let K=[{name:"itemName",label:"품목명",gridSize:6,valueType:"string"},{name:"itemVariety",label:"품종",gridSize:6,valueType:"string"},{name:"originCountry",label:"원산지",gridSize:12,valueType:"string"},{name:"hsCode",label:"HS Code",gridSize:12,valueType:"string"}],H=[{name:"packingUnit",label:"포장 단위",gridSize:12,type:"select",valueType:"string",options:[{value:"25kg-bag",label:"25kg 백"},{value:"1.2ton-bag",label:"1.2톤 백"}]},{name:"contractTon",label:"계약 톤수",gridSize:12,endAdornment:"톤",valueType:"number",type:"number"},{name:"containerCount",label:"컨테이너 개수",gridSize:12,endAdornment:"개",valueType:"number",type:"number"}],J=[{name:"shippingCompany",label:"선사",gridSize:12,valueType:"string"},{name:"customsClearanceDate",label:"통관일",gridSize:12,valueType:"string",type:"date"},{name:"warehouseEntryDate",label:"입고일",gridSize:12,valueType:"string",type:"date"},{name:"quarantineDate",label:"검역일",gridSize:12,valueType:"string",type:"date"},{name:"palletOrderDate",label:"파레트 주문일",gridSize:12,valueType:"string",type:"date"},{name:"palletType",label:"파레트 종류",gridSize:12,valueType:"string"}],X=e=>e?Object.entries(e).reduce((e,t)=>{let[a,n]=t;return null==n?e[a]="":e[a]=n,e},{}):{},$=(e,t)=>({packingUnit:(null==e?void 0:e.packingUnit)||null,contractTon:(null==t?void 0:t.contractTon)||null,containerCount:(null==t?void 0:t.containerCount)||null}),Y=(e,t)=>({palletOrderDate:(null==t?void 0:t.palletOrderDate)||null,palletType:(null==t?void 0:t.palletType)||null,shippingCompany:(null==t?void 0:t.shippingCompany)||null,customsClearanceDate:(null==e?void 0:e.customsClearanceDate)||null,warehouseEntryDate:(null==e?void 0:e.warehouseEntryDate)||null,quarantineDate:(null==e?void 0:e.quarantineDate)||null});function Z(e){let{cargoId:t}=e,[a]=(0,f.fp)(R),[l]=(0,f.fp)(E),[,i]=(0,f.fp)(O),{toast:s,ToastComponent:o}=_();(0,c.useEffect)(()=>{console.log("mappedData:",a)},[a]);let u=async e=>{if(a)try{await i({formData:e,cargoId:t}),s({title:"성공",description:"데이터가 성공적으로 저장되었습니다."})}catch(e){s({title:"오류",description:e instanceof Error?e.message:"데이터 저장 중 오류가 발생했습니다.",variant:"destructive"})}};if(l)return(0,n.jsx)(r.A,{className:"w-full h-full flex items-center justify-center",children:(0,n.jsx)(d.A,{})});if(!a)return(0,n.jsx)("div",{});let m=X(a.item),p=X($(a.item,a.cargo)),h=X(Y(a.cargo,a.shipment));return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,n.jsx)(U,{title:"상품 정보",fields:K,data:m,onSave:e=>u(e)}),(0,n.jsx)(U,{title:"포장 정보",fields:H,data:p,onSave:e=>u(e)}),(0,n.jsx)(U,{title:"상태 정보",fields:J,data:h,onSave:e=>u(e)})]}),(0,n.jsx)(o,{})]})}var ee=a(55869);let et=(0,j.createServerReference)("60d5b1773fa441a205dbe814c4eee654fe8d6dae07",j.callServer,void 0,j.findSourceMapURL,"updateCargoStatusInfo");var ea=a(92215),en=a(28791),er=a(53073),el=a(60603),ei=a(78654),es=a(10861),eo=a(60573),ec=a(21546),ed=a(81770),eu=a(7457),em=a(82746),ep=a(76557),eh=a(53575),eg=a(19842);let ey=(0,j.createServerReference)("60fbc15b7ab6cced7d462e5fa5f4440a9b5f71d013",j.callServer,void 0,j.findSourceMapURL,"getDocuments"),eb=(0,j.createServerReference)("70a06f97175b328ad4e08c43f5b5d34ea116c2c113",j.callServer,void 0,j.findSourceMapURL,"uploadDocuments"),ev=(0,j.createServerReference)("4058f4fe741b19b876b07b8465021d4556188ba605",j.callServer,void 0,j.findSourceMapURL,"getSignedDownloadUrl"),ex=(0,j.createServerReference)("603e5e4c0952e07e315122d7eba53768231d98b9a7",j.callServer,void 0,j.findSourceMapURL,"deleteDocument");var ef=a(39389);function eA(e){let{open:t,onClose:a,onUpload:i,category:s}=e,[d,u]=(0,c.useState)(!1),[m,p]=(0,c.useState)([]),h=(0,c.useCallback)(e=>{e.preventDefault(),u(!0)},[]),y=(0,c.useCallback)(e=>{e.preventDefault(),u(!1)},[]),b=(0,c.useCallback)(e=>{e.preventDefault(),u(!1);let t=Array.from(e.dataTransfer.files);t.length>0&&p(e=>[...e,...t])},[]),v=e=>{p(t=>t.filter((t,a)=>a!==e))},x=()=>{p([]),a()};return(0,n.jsxs)(ea.A,{open:t,onClose:x,maxWidth:"sm",fullWidth:!0,children:[(0,n.jsx)(en.A,{children:"contract"===s?"계약단 서류 업로드":"선적단 서류 업로드"}),(0,n.jsxs)(er.A,{children:[(0,n.jsxs)(r.A,{className:"mt-4 p-8 border-2 border-dashed rounded-lg text-center ".concat(d?"border-primary bg-primary/5":"border-gray-300"),onDragOver:h,onDragLeave:y,onDrop:b,children:[(0,n.jsx)(em.A,{className:"text-4xl text-gray-400 mb-4"}),(0,n.jsx)(l.A,{variant:"body1",sx:{mb:2},children:"파일을 드래그하여 업로드하거나"}),(0,n.jsxs)(o.A,{variant:"outlined",component:"label",children:["파일 선택",(0,n.jsx)("input",{type:"file",multiple:!0,hidden:!0,onChange:e=>{let t=Array.from(e.target.files||[]);t.length>0&&p(e=>[...e,...t])}})]})]}),m.length>0&&(0,n.jsxs)(r.A,{className:"mt-4",children:[(0,n.jsx)(l.A,{variant:"subtitle2",className:"mb-2",children:"선택된 파일 목록"}),(0,n.jsx)(el.A,{className:"max-h-48 overflow-y-auto",children:m.map((e,t)=>(0,n.jsx)(ei.Ay,{secondaryAction:(0,n.jsx)(g.A,{edge:"end","aria-label":"delete",onClick:()=>v(t),children:(0,n.jsx)(ep.A,{})}),children:(0,n.jsx)(es.A,{primary:e.name,secondary:"".concat((e.size/1024).toFixed(2)," KB")})},t))})]})]}),(0,n.jsxs)(eo.A,{children:[(0,n.jsx)(o.A,{onClick:x,children:"취소"}),(0,n.jsxs)(o.A,{variant:"contained",onClick:()=>{m.length>0&&(i(m,s),a())},disabled:0===m.length,children:["업로드 (",m.length,")"]})]})]})}function ej(e){let{cargoId:t}=e,[a,i]=(0,c.useState)("contract"),[u,m]=(0,c.useState)(!1),[p,y]=(0,c.useState)(!1),[b,v]=(0,c.useState)(null),{toast:x}=_(),[,A]=(0,f.fp)(ef.aj),j=(0,f.md)(ef.c4),C=(0,f.md)(ef.RQ),T=j(t,a),N=C(t,a);(0,c.useEffect)(()=>{S()},[t]);let S=async()=>{for(let e of["contract","shipment"])try{A({cargoId:t,category:e,documents:[],isLoading:!0});let a=await ey(t,e);a.success&&a.documents?A({cargoId:t,category:e,documents:a.documents,isLoading:!1}):(console.error("문서 목록 조회 실패:",a.error),x({title:"오류",description:a.error||"문서 목록을 불러오는데 실패했습니다.",variant:"destructive"}),A({cargoId:t,category:e,documents:[],isLoading:!1}))}catch(a){console.error("문서 목록 조회 중 오류 발생:",a),x({title:"오류",description:"문서 목록을 불러오는 중 오류가 발생했습니다.",variant:"destructive"}),A({cargoId:t,category:e,documents:[],isLoading:!1})}},D=async(e,a)=>{try{let n=new FormData;e.forEach(e=>n.append("files",e));let r=await eb(n,t,a);r.success?await S():(console.error("파일 업로드 실패:",r.error),x({title:"오류",description:r.error||"파일 업로드에 실패했습니다.",variant:"destructive"}))}catch(e){console.error("파일 업로드 중 오류 발생:",e),x({title:"오류",description:"파일 업로드 중 오류가 발생했습니다.",variant:"destructive"})}},w=async e=>{try{let t=await ev(e.id);t.success?window.open(t.url,"_blank"):x({title:"오류",description:t.error||"파일 다운로드에 실패했습니다.",variant:"destructive"})}catch(e){console.error("파일 다운로드 중 오류 발생:",e),x({title:"오류",description:"파일 다운로드 중 오류가 발생했습니다.",variant:"destructive"})}},R=async e=>{v(e),y(!0)},E=async()=>{if(b)try{let e=await ex(b.id,t);e.success?(await S(),x({title:"성공",description:"문서가 삭제되었습니다."})):x({title:"오류",description:e.error||"문서 삭제에 실패했습니다.",variant:"destructive"})}catch(e){console.error("문서 삭제 중 오류 발생:",e),x({title:"오류",description:"문서 삭제 중 오류가 발생했습니다.",variant:"destructive"})}finally{y(!1),v(null)}},P=()=>{y(!1),v(null)},I=T.filter(e=>e.documentCategory===a);return N?(0,n.jsx)(r.A,{className:"flex justify-center items-center h-full",children:(0,n.jsx)(d.A,{})}):(0,n.jsxs)(r.A,{className:"space-y-6",children:[(0,n.jsx)(h.A,{className:"p-4",children:(0,n.jsxs)(s.A,{spacing:3,children:[(0,n.jsxs)(s.A,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[(0,n.jsx)(l.A,{variant:"h6",className:"font-bold",children:"서류 관리"}),(0,n.jsx)(o.A,{variant:"contained",startIcon:(0,n.jsx)(eh.A,{}),onClick:()=>m(!0),children:"contract"===a?"계약단 서류 업로드":"선적단 서류 업로드"})]}),(0,n.jsxs)(ec.A,{value:a,onChange:(e,t)=>i(t),className:"border-b",children:[(0,n.jsx)(ed.A,{label:"계약단 서류",value:"contract"}),(0,n.jsx)(ed.A,{label:"선적단 서류",value:"shipment"})]}),(0,n.jsx)(el.A,{children:0===I.length?(0,n.jsx)(ei.Ay,{children:(0,n.jsx)(es.A,{primary:"등록된 ".concat("contract"===a?"계약단":"선적단"," 서류가 없습니다.")})}):I.map(e=>(0,n.jsx)(ei.Ay,{divider:!0,secondaryAction:(0,n.jsxs)(s.A,{direction:"row",spacing:1,children:[(0,n.jsx)(g.A,{edge:"end","aria-label":"download",onClick:()=>w(e),children:(0,n.jsx)(eg.A,{})}),(0,n.jsx)(g.A,{edge:"end","aria-label":"delete",onClick:()=>R(e),children:(0,n.jsx)(ep.A,{})})]}),children:(0,n.jsx)(es.A,{primary:e.documentName,secondary:new Date(e.uploadDate).toLocaleDateString()})},e.id))})]})}),(0,n.jsx)(eA,{open:u,onClose:()=>m(!1),onUpload:D,category:a}),(0,n.jsxs)(ea.A,{open:p,onClose:P,"aria-labelledby":"delete-dialog-title","aria-describedby":"delete-dialog-description",children:[(0,n.jsx)(en.A,{id:"delete-dialog-title",children:"문서 삭제 확인"}),(0,n.jsx)(er.A,{children:(0,n.jsxs)(eu.A,{id:"delete-dialog-description",children:[null==b?void 0:b.documentName," 문서를 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다."]})}),(0,n.jsxs)(eo.A,{children:[(0,n.jsx)(o.A,{onClick:P,children:"취소"}),(0,n.jsx)(o.A,{onClick:E,color:"error",autoFocus:!0,children:"삭제"})]})]})]})}var eC=a(89309),eT=a(82300);function eN(e){let{data:t}=e,[a,i]=(0,c.useState)(!1),s=a?t.historyItems:t.historyItems.slice(0,3);return(0,n.jsxs)(r.A,{className:"w-full bg-white rounded-2xl shadow-lg p-6",children:[(0,n.jsx)(r.A,{className:"flex justify-between items-center mb-6",children:(0,n.jsx)(l.A,{variant:"h6",className:"font-bold text-gray-900",children:"진행 현황"})}),(0,n.jsxs)(r.A,{className:"flex gap-8",children:[(0,n.jsxs)(r.A,{className:"flex-1",children:[s.map(e=>(0,n.jsxs)(r.A,{className:"relative pl-8 pb-6 last:pb-0",children:[(0,n.jsx)(r.A,{className:"absolute left-0 top-0 bottom-0 w-0.5 bg-gray-200"}),(0,n.jsx)(r.A,{className:"absolute left-[-4px] top-0 w-2 h-2 rounded-full bg-primary-main"}),(0,n.jsxs)(r.A,{className:"bg-gray-50 rounded-xl p-4 shadow-sm",children:[(0,n.jsx)(l.A,{variant:"subtitle1",className:"font-semibold text-gray-900",children:e.title}),(0,n.jsx)(l.A,{variant:"body2",className:"text-gray-600 mt-1",children:e.description}),(0,n.jsx)(l.A,{variant:"caption",className:"text-gray-500 mt-2 block",children:e.time})]})]},e.id)),t.historyItems.length>3&&(0,n.jsx)(o.A,{variant:"text",size:"small",endIcon:a?(0,n.jsx)(eC.A,{}):(0,n.jsx)(eT.A,{}),onClick:()=>i(!a),className:"mt-4 text-primary-main",children:a?"숨기기":"더 보기"})]}),(0,n.jsx)(r.A,{className:"w-64 bg-gray-50 rounded-xl p-4 shadow-sm",children:(0,n.jsxs)(r.A,{className:"space-y-4",children:[(0,n.jsxs)(r.A,{children:[(0,n.jsx)(l.A,{variant:"caption",className:"text-gray-500",children:"계약 일자"}),(0,n.jsx)(l.A,{variant:"body2",className:"text-gray-900",children:t.orderTime})]}),(0,n.jsxs)(r.A,{children:[(0,n.jsx)(l.A,{variant:"caption",className:"text-gray-500",children:"결제 일자"}),(0,n.jsx)(l.A,{variant:"body2",className:"text-gray-900",children:t.paymentTime})]}),(0,n.jsxs)(r.A,{children:[(0,n.jsx)(l.A,{variant:"caption",className:"text-gray-500",children:"출발 일자"}),(0,n.jsx)(l.A,{variant:"body2",className:"text-gray-900",children:t.deliveryTime})]}),(0,n.jsxs)(r.A,{children:[(0,n.jsx)(l.A,{variant:"caption",className:"text-gray-500",children:"도착 일자"}),(0,n.jsx)(l.A,{variant:"body2",className:"text-gray-900",children:t.completionTime})]})]})})]})]})}var eS=a(10387),eD=function(e){return e.REVIEW="검토중",e.CONTRACTING="계약중",e.BEFORE_LC="L/C오픈전",e.BEFORE_ARRIVAL="입항전",e.WAREHOUSE_MOVING="창고 이동중",e.BEFORE_QUARANTINE="검역전",e.QUARANTINING="검역중",e.CUSTOMS_DECLARING="세관신고중",e.BEFORE_CUSTOMS="통관전",e.AFTER_CUSTOMS="통관후",e.SELLING="판매중",e}({});let ew={REVIEW:"검토중",CONTRACTING:"계약중",BEFORE_LC:"L/C오픈전",BEFORE_ARRIVAL:"입항전",WAREHOUSE_MOVING:"창고 이동중",BEFORE_QUARANTINE:"검역전",QUARANTINING:"검역중",CUSTOMS_DECLARING:"세관신고중",BEFORE_CUSTOMS:"통관전",AFTER_CUSTOMS:"통관후",SELLING:"판매중"},eR={검토중:"REVIEW",계약중:"CONTRACTING","L/C오픈전":"BEFORE_LC",입항전:"BEFORE_ARRIVAL","창고 이동중":"WAREHOUSE_MOVING",검역전:"BEFORE_QUARANTINE",검역중:"QUARANTINING",세관신고중:"CUSTOMS_DECLARING",통관전:"BEFORE_CUSTOMS",통관후:"AFTER_CUSTOMS",판매중:"SELLING"},eE=Object.values(eD);function eP(){var e;let t=(0,ee.useParams)(),[a,d]=(0,c.useState)("entire"),[u,m]=(0,f.fp)(R),{toast:p,ToastComponent:h}=_();(0,c.useEffect)(()=>{(async function(){u&&u.cargo.id===t.cargo_id||await m(t.cargo_id)})(),console.log(u),console.log(t.cargo_id)},[t.cargo_id]);let g=()=>{var e;if(!(null==u?void 0:null===(e=u.cargo)||void 0===e?void 0:e.progressStatus))return"0%";let t=ew[u.cargo.progressStatus];if(!t)return"0%";let a=eE.indexOf(t),n=eE.length;return"".concat(a/(n-1)*96,"%")},y=()=>{var e;if(!(null==u?void 0:null===(e=u.cargo)||void 0===e?void 0:e.progressStatus))return null;let t=ew[u.cargo.progressStatus];if(!t)return null;let a=eE.indexOf(t);return a===eE.length-1?null:eR[eE[a+1]]||null},b=()=>{var e;if(!(null==u?void 0:null===(e=u.cargo)||void 0===e?void 0:e.progressStatus))return null;let t=ew[u.cargo.progressStatus];if(!t)return null;let a=eE.indexOf(t);return 0===a?null:eR[eE[a-1]]||null},v=async e=>{if((null==u?void 0:u.cargo)&&e)try{var a,n,r;await et(t.cargo_id,{status:e,customsClearanceDate:u.cargo.customsClearanceDate||"",warehouseEntryDate:u.cargo.warehouseEntryDate||"",quarantineDate:u.cargo.quarantineDate||"",shippingCompany:(null===(a=u.shipment)||void 0===a?void 0:a.shippingCompany)||"",palletOrderDate:(null===(n=u.shipment)||void 0===n?void 0:n.palletOrderDate)||"",palletType:(null===(r=u.shipment)||void 0===r?void 0:r.palletType)||""}),await m(t.cargo_id),p({title:"성공",description:"상태가 성공적으로 변경되었습니다."})}catch(e){console.error("상태 업데이트 중 오류 발생:",e),p({title:"오류",description:"상태 변경 중 오류가 발생했습니다.",variant:"destructive"})}};return(0,n.jsxs)("div",{className:"min-h-screen bg-background-paper",children:[(0,n.jsx)(r.A,{className:"w-full h-16 px-10 bg-background-default flex justify-between items-center",children:(0,n.jsx)(l.A,{variant:"h4",className:"text-success-darker font-bold font-['Public_Sans']",children:"상세보기"})}),(0,n.jsx)(r.A,{className:"w-full h-24 relative",children:(0,n.jsx)(i.A,{maxWidth:"xl",className:"progress-container h-full",children:(0,n.jsxs)(r.A,{className:"relative h-full flex items-center px-4",children:[(0,n.jsx)(r.A,{className:"w-full h-2.5 bg-gray-200 rounded-2xl"}),(0,n.jsx)(r.A,{className:"absolute h-2.5 bg-green-200 rounded-2xl transition-all duration-500",style:{width:(()=>{var e;if(!(null==u?void 0:null===(e=u.cargo)||void 0===e?void 0:e.progressStatus))return"0%";let t=ew[u.cargo.progressStatus];if(!t)return"0%";let a=eE.indexOf(t),n=eE.length;return"".concat(a/(n-1)*96,"%")})()}}),(0,n.jsx)(r.A,{className:"absolute transition-all duration-500 ease-in-out",style:{left:"calc(".concat(g()," + 16px)"),top:"50%",transform:"translate(-50%, -50%)"},children:(0,n.jsx)(r.A,{className:"w-10 h-10 bg-white rounded-full border-[3px] border-emerald-600 transition-colors duration-300"})}),(0,n.jsx)(l.A,{className:"absolute text-sm font-normal font-['Public_Sans'] text-emerald-600 whitespace-nowrap transition-all duration-500 ease-in-out",style:{left:"calc(".concat(g()," + 16px)"),top:"calc(50% + 20px)",transform:"translateX(-50%)"},children:(null==u?void 0:null===(e=u.cargo)||void 0===e?void 0:e.progressStatus)?ew[u.cargo.progressStatus]:""})]})})}),(0,n.jsxs)(i.A,{maxWidth:"xl",className:"mt-8",children:[(0,n.jsx)(r.A,{className:"mb-8",children:(0,n.jsxs)(s.A,{direction:"row",spacing:2,justifyContent:"space-between",alignItems:"center",children:[(0,n.jsxs)(s.A,{direction:"row",spacing:2,children:[(0,n.jsx)(o.A,{variant:"contained",color:"entire"===a?"primary":"inherit",onClick:()=>d("entire"),children:"전체정보"}),(0,n.jsx)(o.A,{variant:"contained",color:"document"===a?"primary":"inherit",onClick:()=>d("document"),children:"서류정보"}),(0,n.jsx)(o.A,{variant:"contained",color:"cargo"===a?"primary":"inherit",onClick:()=>d("cargo"),children:"화물 정보"}),(0,n.jsx)(o.A,{variant:"contained",color:"history"===a?"primary":"inherit",onClick:()=>d("history"),children:"히스토리"})]}),(0,n.jsxs)(s.A,{direction:"row",spacing:2,children:[(0,n.jsx)(o.A,{variant:"contained",color:"primary",onClick:()=>v(b()),disabled:!b(),children:"이전 상태로 변경"}),(0,n.jsx)(o.A,{variant:"contained",color:"primary",onClick:()=>v(y()),disabled:!y(),children:"다음 상태로 변경"})]})]})}),(()=>{switch(a){case"entire":return(0,n.jsx)(q,{cargoId:t.cargo_id});case"document":return(0,n.jsx)(ej,{cargoId:t.cargo_id});case"cargo":return(0,n.jsx)(Z,{cargoId:t.cargo_id});case"history":if(!u)return(0,n.jsx)(r.A,{className:"w-full h-full flex items-center justify-center",children:(0,n.jsx)(l.A,{children:"데이터가 없습니다."})});let e={orderTime:u.contract.contractDate||"N/A",paymentTime:u.payment.paymentDueDate||"N/A",deliveryTime:u.shipment.estimatedTimeDeparture||"N/A",completionTime:u.shipment.estimatedTimeArrival||"N/A",historyItems:[{id:(0,eS.Ak)(),title:"화물 계약 체결",description:"계약이 성공적으로 체결되었습니다.",time:u.contract.contractDate||"N/A",isActive:!0,type:"contract"},{id:(0,eS.Ak)(),title:"결제 완료",description:"결제가 정상적으로 완료되었습니다.",time:u.payment.paymentDueDate||"N/A",isActive:!!u.payment.paymentDueDate,type:"payment"},{id:(0,eS.Ak)(),title:"화물 출발",description:"화물이 출발했습니다.",time:u.shipment.estimatedTimeDeparture||"N/A",isActive:!!u.shipment.estimatedTimeDeparture,type:"shipment"},{id:(0,eS.Ak)(),title:"화물 도착",description:"화물이 안전하게 도착했습니다.",time:u.shipment.estimatedTimeArrival||"N/A",isActive:!!u.shipment.estimatedTimeArrival,type:"completion"}]};return(0,n.jsx)(eN,{data:e});default:return null}})(),(0,n.jsx)(r.A,{className:"w-[1093px] h-[50px]"})]}),(0,n.jsx)(h,{})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[308,486,697,940,382,982,268,919,632,358],()=>t(9168)),_N_E=e.O()}]);
