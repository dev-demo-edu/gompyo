(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[999],{55587:(e,t,a)=>{Promise.resolve().then(a.bind(a,63950))},59519:(e,t,a)=>{"use strict";a.d(t,{F:()=>r});var n=a(64358);let r=(0,n.createServerReference)("00d754fe6ffeb97f56bfa979e00a8e24f563fcc1ba",n.callServer,void 0,n.findSourceMapURL,"getAllImporters")},62171:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});var n=function(e){return e.STANDARD="STANDARD",e.DNB="DNB",e.NAMHAE="NAMHAE",e}({})},63950:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>to});var n=a(22318),r=a(27849),l=a(6987),i=a(42846),o=a(92262),s=a(71599),c=a(20926),d=a(81759),u=a(17859),m=a(63001),p=a(54069),g=a(2877),h=a(91394),x=a(46558),y=a(56690),v=a(23093),b=a(5600),f=a(15792),A=a(60720);let j=e=>{if(null==e||""===e)return"";let t=parseFloat(String(e).replace(/[^0-9.-]/g,""));return isNaN(t)?"":new Intl.NumberFormat("ko-KR").format(t)},C=e=>{if(null==e||""===e)return"";let t=parseFloat(String(e).replace(/[^0-9.-]/g,""));return isNaN(t)?"":new Intl.NumberFormat("ko-KR").format(Math.floor(t))},T=e=>e.map(e=>({value:e.importerName,label:e.importerName})),S=e=>[{name:"contractNumber",label:"계약 번호",valueType:"string"},{name:"contractDate",label:"계약 일자",valueType:"string",type:"date"},{name:"importerName",label:"수입회사",valueType:"string",type:"select",options:T(e)},{name:"exporter",label:"공급업체",valueType:"string"},{name:"incoterms",label:"인코텀즈",valueType:"string"},{name:"contractTon",label:"계약 톤수",valueType:"string",type:"number",endAdornment:"톤"},{name:"departurePort",label:"출발항",gridSize:6,valueType:"string"},{name:"arrivalPort",label:"도착항",gridSize:6,valueType:"string"},{name:"estimatedTimeDeparture",label:"ETD",gridSize:6,valueType:"string",type:"date"},{name:"estimatedTimeArrival",label:"ETA",gridSize:6,valueType:"string",type:"date"},{name:"blNumber",label:"B/L 번호",valueType:"string"}],D=[{name:"paymentMethod",label:"결제 방식",valueType:"string",type:"select",options:[{value:"T/T",label:"T/T"},{value:"CAD",label:"CAD"},{value:"L/C",label:"L/C at sight"},{value:"Usance",label:"Payment Usance"}]}],N={"T/T":[{name:"exchangeRate",label:"환율",valueType:"number",endAdornment:"₩/USD"},{name:"counterpartBank",label:"상대방 은행",valueType:"string"},{name:"advancePaymentDate",label:"선급금 날짜",gridSize:6,valueType:"string",type:"date"},{name:"remainingPaymentDate",label:"잔금 날짜",gridSize:6,valueType:"string",type:"date"},{name:"advancePaymentRatio",label:"선급금 비율",gridSize:6,valueType:"number",endAdornment:"%"},{name:"remainingPaymentRatio",label:"잔금 비율",gridSize:6,valueType:"number",endAdornment:"%"},{name:"advancePaymentAmount",label:"선급금 금액",gridSize:6,valueType:"number",disabled:!0,endAdornment:"₩",removeDecimal:!0},{name:"remainingPaymentAmount",label:"잔금 금액",gridSize:6,valueType:"number",disabled:!0,endAdornment:"₩",removeDecimal:!0}],CAD:[{name:"exchangeRate",label:"환율",valueType:"number",endAdornment:"₩/USD"},{name:"paymentDueDate",label:"대금 결제일",valueType:"string",type:"date"}],"L/C":[{name:"exchangeRate",label:"환율",valueType:"number",endAdornment:"₩/USD"},{name:"paymentDueDate",label:"대금 결제일",valueType:"string",type:"date"}],Usance:[{name:"paymentTerm",label:"결제 기간",valueType:"string",endAdornment:"일"},{name:"exchangeRate",label:"환율",valueType:"number",endAdornment:"₩/USD"},{name:"paymentDueDate",label:"대금 결제일",valueType:"string",type:"date"}]},w=[{name:"unitPrice",label:"단가",valueType:"number",endAdornment:"MT/USD",removeDecimal:!0},{name:"totalContractPrice",label:"총 계약가",valueType:"number",endAdornment:"₩",disabled:!0,removeDecimal:!0},{name:"exchangeRate",label:"환율",valueType:"number",endAdornment:"₩/USD",removeDecimal:!0},{name:"costPerKg",label:"원가",valueType:"number",endAdornment:"₩/Kg",disabled:!0,removeDecimal:!0},{name:"customsTaxRate",label:"관세율",valueType:"number",endAdornment:"%",removeDecimal:!0},{name:"customTaxAmount",label:"관세액",valueType:"number",disabled:!0,endAdornment:"₩",removeDecimal:!0},{name:"transferFee",label:"송금수수료",valueType:"number",endAdornment:"₩",removeDecimal:!0},{name:"customsFee",label:"관세수수료",valueType:"number",endAdornment:"₩",removeDecimal:!0},{name:"inspectionFee",label:"검사료",valueType:"number",endAdornment:"₩",removeDecimal:!0},{name:"doCharge",label:"D/O Charge",valueType:"number",endAdornment:"₩",removeDecimal:!0},{name:"otherCosts",label:"기타비용",valueType:"number",endAdornment:"₩",removeDecimal:!0},{name:"purchaseFeeRate",label:"매입 수수료율",valueType:"number",type:"text",endAdornment:"%",removeDecimal:!0}],R=[{name:"contractorCost",label:"수입회사 원가",valueType:"number",disabled:!0,removeDecimal:!0,endAdornment:"₩/Kg"},{name:"supplyPrice",label:"수입회사 수급가",valueType:"number",disabled:!0,removeDecimal:!0,endAdornment:"₩/Kg"},{name:"contractorProfit",label:"수입회사 이익",valueType:"number",disabled:!0,endAdornment:"₩",removeDecimal:!0},{name:"shippingCost",label:"배송비",valueType:"number",endAdornment:"₩",removeDecimal:!0},{name:"laborCost",label:"작업료",valueType:"number",endAdornment:"₩",removeDecimal:!0},{name:"transportStorageFee",label:"운송/보관료",valueType:"number",endAdornment:"₩",removeDecimal:!0},{name:"loadingUnloadingFee",label:"상하차 비용",valueType:"number",endAdornment:"₩",removeDecimal:!0},{name:"usanceInterest",label:"Usance 이자(환차손)",valueType:"number",endAdornment:"₩",removeDecimal:!0}],P=[{name:"totalCost",label:"총비용",valueType:"number",disabled:!0,endAdornment:"₩",removeDecimal:!0},{name:"totalCostPerKg",label:"총비용/Kg",valueType:"number",disabled:!0,endAdornment:"₩/Kg",removeDecimal:!0},{name:"sellingPrice",label:"판매가(총판)",valueType:"number",endAdornment:"₩",removeDecimal:!0},{name:"sellingPriceWholesale",label:"판매가(도매)",valueType:"number",endAdornment:"₩",removeDecimal:!0},{name:"sellingPriceRetail",label:"판매가(소매)",valueType:"number",endAdornment:"₩",removeDecimal:!0},{name:"margin",label:"마진",valueType:"number",disabled:!0,removeDecimal:!0,endAdornment:"₩/Kg"},{name:"totalProfit",label:"총이익",valueType:"number",disabled:!0,endAdornment:"₩",removeDecimal:!0}],F=[{name:"gompyoLaborCost",label:"곰표 작업료",valueType:"number",endAdornment:"₩"},{name:"gompyoTransportStorageFee",label:"곰표 운송/보관료",valueType:"number",endAdornment:"₩"},{name:"gompyoLoadingUnloadingFee",label:"곰표 상하차 비용",valueType:"number",endAdornment:"₩"}];var E=a(86956),U=a(49812),I=a(64358);let k=(0,I.createServerReference)("40c856f42080ae4434f2a03bdbb5f427157718f68e",I.callServer,void 0,I.findSourceMapURL,"getCargoDetail"),L=(0,I.createServerReference)("60ece36e960725ee9fd930f267c3e427f26500e1a9",I.callServer,void 0,I.findSourceMapURL,"updateCargoDetail");var O=a(62171);class M{calculate(e,t){let a=e.contractorCost*(1+t.purchaseFeeRate/100),n=(a-e.contractorCost)*t.contractTon*1e3,r=a*t.contractTon*1e3+t.shippingCost+t.laborCost+t.transportStorageFee+t.loadingUnloadingFee+t.gompyoLaborCost+t.gompyoTransportStorageFee+t.gompyoLoadingUnloadingFee,l=t.sellingPrice-r/t.contractTon/1e3,i=l*t.contractTon*1e3,o=r/t.contractTon/1e3;return{supplyPrice:a,contractorProfit:n,totalCost:r,margin:l,totalProfit:i,totalCostPerKg:o}}}class _{calculate(e,t){let a=(e.contractorCostAmount+t.shippingCost+t.laborCost+t.transportStorageFee+t.loadingUnloadingFee+t.usanceInterest)/t.contractTon/1e3*(1+t.purchaseFeeRate/100),n=(a-e.contractorCost)*t.contractTon*1e3,r=a*t.contractTon*1e3+t.gompyoLaborCost+t.gompyoLoadingUnloadingFee+t.gompyoTransportStorageFee,l=t.sellingPrice-r/t.contractTon/1e3,i=l*t.contractTon*1e3,o=r/t.contractTon/1e3;return{supplyPrice:a,contractorProfit:n,totalCost:r,margin:l,totalProfit:i,totalCostPerKg:o}}}class W{calculate(e,t){let a=e.contractorCost*(1+t.purchaseFeeRate/100),n=(a-e.contractorCost)*t.contractTon*1e3,r=a*t.contractTon*1e3+t.shippingCost+t.laborCost+t.transportStorageFee+t.loadingUnloadingFee+t.gompyoLaborCost+t.gompyoTransportStorageFee+t.gompyoLoadingUnloadingFee,l=t.sellingPrice-r/t.contractTon/1e3,i=l*t.contractTon*1e3,o=r/t.contractTon/1e3;return{supplyPrice:a,contractorProfit:n,totalCost:r,margin:l,totalProfit:i,totalCostPerKg:o}}}class z{static createStrategy(e){if(!e)return new M;switch(e.calculationType){case O.A.STANDARD:return new M;case O.A.DNB:return new _;case O.A.NAMHAE:return new W;default:return new M}}}class B{calculateValues(){let e=this.data.costDetail.unitPrice||0,t=this.data.costDetail.exchangeRate||0,a=this.data.cargo.contractTon||0,n=this.data.cargo.sellingPrice||0,r=this.data.cargo.purchaseFeeRate||0,l=Math.floor(e*t*a),i=e*t/1e3,o=l*(this.data.costDetail.customsTaxRate||0)/100,s=l+o+(this.data.costDetail.transferFee||0)+(this.data.costDetail.customsFee||0)+(this.data.costDetail.inspectionFee||0)+(this.data.costDetail.doCharge||0)+(this.data.costDetail.otherCosts||0),c=s/a/1e3,d=l*(this.data.payment.advancePaymentRatio||0)/100,u=l*(this.data.payment.remainingPaymentRatio||0)/100,m=this.calculationStrategy.calculate({contractorCostAmount:s,costPerKg:i,totalContractPrice:l,contractorCost:c},{contractTon:a,sellingPrice:n,purchaseFeeRate:r,shippingCost:this.data.cost.shippingCost||0,laborCost:this.data.cost.laborCost||0,transportStorageFee:this.data.cost.transportStorageFee||0,loadingUnloadingFee:this.data.cost.loadingUnloadingFee||0,usanceInterest:this.data.cost.usanceInterest||0,gompyoLaborCost:this.data.cost.gompyoLaborCost||0,gompyoTransportStorageFee:this.data.cost.gompyoTransportStorageFee||0,gompyoLoadingUnloadingFee:this.data.cost.gompyoLoadingUnloadingFee||0});return{supplyPrice:m.supplyPrice,margin:m.margin,totalProfit:m.totalProfit,totalContractPrice:l,costPerKg:i,contractorCost:c,contractorProfit:m.contractorProfit,totalCost:m.totalCost,totalCostPerKg:m.totalCostPerKg,customTaxAmount:o,advancePaymentAmount:d,remainingPaymentAmount:u}}mapItem(e){return{id:e.id,itemName:e.itemName||"",itemVariety:e.itemVariety||"",originCountry:e.originCountry||"",hsCode:e.hsCode||"",packingUnit:e.packingUnit||""}}mapShipment(e){return{id:e.id,estimatedTimeArrival:e.estimatedTimeArrival||"",estimatedTimeDeparture:e.estimatedTimeDeparture||"",arrivalPort:e.arrivalPort||"",departurePort:e.departurePort||"",blNumber:e.blNumber||"",palletOrderDate:e.palletOrderDate||"",palletType:e.palletType||"",shippingCompany:e.shippingCompany||"",contractId:e.contractId||"",createdAt:e.createdAt||"",updatedAt:e.updatedAt||""}}mapContract(e,t,a){return{id:e.id,incoterms:e.incoterms||"",contractNumber:e.contractNumber||"",contractDate:e.contractDate||"",exporter:e.exporter||"",importerId:e.importerId||"",departurePort:t.departurePort||"",arrivalPort:t.arrivalPort||"",estimatedTimeDeparture:t.estimatedTimeDeparture||"",estimatedTimeArrival:t.estimatedTimeArrival||"",blNumber:t.blNumber||"",importerName:(null==a?void 0:a.importerName)||"",createdAt:e.createdAt||"",updatedAt:e.updatedAt||""}}mapPayment(e){return{id:e.id,paymentDueDate:e.paymentDueDate||"",paymentMethod:e.paymentMethod||"",contractId:e.contractId,advancePaymentDate:e.advancePaymentDate||"",advancePaymentRatio:e.advancePaymentRatio||0,advancePaymentAmount:this.calculatedValues.advancePaymentAmount,remainingPaymentDate:e.remainingPaymentDate||"",remainingPaymentRatio:e.remainingPaymentRatio||0,remainingPaymentAmount:this.calculatedValues.remainingPaymentAmount,counterpartBank:e.counterpartBank||"",paymentTerm:e.paymentTerm||"",totalContractAmount:this.calculatedValues.totalContractPrice}}mapAndCalculateCostDetail(e){return{id:e.id,unitPrice:e.unitPrice||0,totalContractPrice:this.calculatedValues.totalContractPrice,exchangeRate:e.exchangeRate||0,costPerKg:this.calculatedValues.costPerKg,costId:e.costId,customTaxAmount:this.calculatedValues.customTaxAmount,customsTaxRate:e.customsTaxRate||0,customsFee:e.customsFee||0,inspectionFee:e.inspectionFee||0,doCharge:e.doCharge||0,otherCosts:e.otherCosts||0,transferFee:e.transferFee||0}}mapAndCalculateContractAmount(e,t){return{id:t.id,cargoId:t.cargoId,contractorCost:this.calculatedValues.contractorCost,supplyPrice:this.calculatedValues.supplyPrice,contractorProfit:this.calculatedValues.contractorProfit,shippingCost:t.shippingCost||0,laborCost:t.laborCost||0,transportStorageFee:t.transportStorageFee||0,loadingUnloadingFee:t.loadingUnloadingFee||0,usanceInterest:t.usanceInterest||0,gompyoLaborCost:t.gompyoLaborCost||0,gompyoTransportStorageFee:t.gompyoTransportStorageFee||0,gompyoLoadingUnloadingFee:t.gompyoLoadingUnloadingFee||0}}mapAndCalculateExpense(e){return{id:e.id,itemsId:e.itemsId,shipmentId:e.shipmentId,containerCount:e.containerCount,contractTon:e.contractTon,customsClearanceDate:e.customsClearanceDate,quarantineDate:e.quarantineDate,warehouseEntryDate:e.warehouseEntryDate,progressStatus:e.progressStatus,totalCost:this.calculatedValues.totalCost,totalCostPerKg:this.calculatedValues.totalCostPerKg,sellingPrice:e.sellingPrice||0,sellingPriceWholesale:e.sellingPriceWholesale||0,sellingPriceRetail:e.sellingPriceRetail||0,margin:this.calculatedValues.margin,totalProfit:this.calculatedValues.totalProfit,purchaseFeeRate:e.purchaseFeeRate,remark:e.remark,createdAt:e.createdAt,updatedAt:e.updatedAt}}calculate(){return{importer:this.data.importer,contract:this.mapContract(this.data.contract,this.data.shipment,this.data.importer),payment:this.mapPayment(this.data.payment),costDetail:this.mapAndCalculateCostDetail(this.data.costDetail),cost:this.mapAndCalculateContractAmount(this.data.cargo,this.data.cost),cargo:this.mapAndCalculateExpense(this.data.cargo),item:this.mapItem(this.data.item),shipment:this.mapShipment(this.data.shipment)}}constructor(e){this.data=e,this.calculationStrategy=z.createStrategy(e.importer),this.calculatedValues=this.calculateValues()}}let V=(0,I.createServerReference)("705078515c318cd8b75a1ecbadbf3f1f0b142818cd",I.callServer,void 0,I.findSourceMapURL,"createNewShipmentAndUpdateCargo"),H=(0,U.eU)(null),G=(0,U.eU)(null),K=(0,U.eU)(e=>{let t=e(H);return t?new B(t).calculate():null},async(e,t,a)=>{try{let e=await k(a);t(H,e)}catch(e){throw console.error("화물 정보 조회 중 오류 발생:",e),e}}),q=(0,U.eU)(!1),Q=(0,U.eU)(null);(0,U.eU)(null,(e,t)=>{let a=e(H);a&&t(G,JSON.parse(JSON.stringify(a)))});let X=(0,U.eU)(null,(e,t)=>{let a=e(G);a&&(t(H,a),t(G,null))}),J=(0,U.eU)(null,async(e,t,a)=>{let{formData:n,cargoId:r,option:l}=a,i=e(H);if(i)try{let e={};if(e.cargo={...i.cargo,...n},e.costDetail={...i.costDetail,...n},e.cost={...i.cost,...n},e.payment={...i.payment,...n},e.contract={...i.contract,...n},e.item={...i.item,...n},e.importer={...i.importer,...n},n.blNumber&&"single"===l&&n.blNumber!==i.shipment.blNumber){let t=await V(r,n,l);e.shipment={...t},t&&(e.cargo.shipmentId=t.id)}else e.shipment={...i.shipment,...n};e.cargo.contractTon!==i.cargo.contractTon&&(e.cargo.containerCount=Math.ceil(Number(e.cargo.contractTon)/24));let a=await L(r,e);t(H,a)}catch(e){throw e}}),Y=(0,I.createServerReference)("40a858786582038c4c01d03178bc25d002449c9a4d",I.callServer,void 0,I.findSourceMapURL,"addChangeLog"),Z=(0,I.createServerReference)("000820e00a76417c4e99c475037689b341dcaa9f0d",I.callServer,void 0,I.findSourceMapURL,"getUser"),$=(0,U.eU)(null),ee=(0,U.eU)(async e=>{let t=e($);if(t)return t;let a=await Z();return a?{id:a.id,email:a.email,name:a.name,planColumnOrder:a.planColumnOrder||"",shipmentColumnOrder:a.shipmentColumnOrder||""}:null},async(e,t,a)=>{t($,a)});function et(e){let{title:t,fields:a,data:i={},onSave:o,onFieldChange:s,className:d=""}=e,[T,S]=(0,c.useState)(!1),[D,N]=(0,c.useState)({}),[w,R]=(0,c.useState)({}),[,P]=(0,E.fp)(X),[F]=(0,E.fp)(ee),[U]=(0,E.fp)(K);(0,c.useEffect)(()=>{N(Object.entries(i).reduce((e,t)=>{var a;let[n,r]=t;return e[n]=null!==(a=null==r?void 0:r.toString())&&void 0!==a?a:null,e},{}))},[i]);let I=(e,t)=>{if(null===e)return null;switch(t){case"number":return""===e?null:Number(e);case"date":return""===e?null:e;default:return e}},k=e=>{let t=["계약 번호","계약 일자","공급 업체","수입처","품목","품종","포장단위"],a={};return e.forEach(e=>{let n;switch(e.valueType){case"number":n=A.z.string({message:"숫자를 입력해주세요"});break;case"date":n=A.z.coerce.string().min(1,"날짜를 선택해주세요.").default(new Date().toISOString().split("T")[0]);break;default:n=A.z.string({message:"값을 입력해주세요"})}t.includes(e.label)||(n=n.optional()),a[e.name]=n}),A.z.object(a)},L=async(e,t)=>{let n=[];a.forEach(a=>{let r=e[a.name],l=t[a.name];if(r!==(null==l?void 0:l.toString())){var i,o;n.push({field:a.label,from:null!==(i=null==r?void 0:r.toString())&&void 0!==i?i:"",to:null!==(o=null==l?void 0:l.toString())&&void 0!==o?o:""})}}),n.length>0&&(console.log("changes",n),console.log("currentUser",F),await Y({targetId:(null==U?void 0:U.cargo.id)||"",user:(null==F?void 0:F.name)||"",changes:n}))},O=async()=>{let e=k(a).safeParse(D);if(!e.success){let t={};e.error.errors.forEach(e=>{e.path[0]&&(t[e.path[0]]=e.message)}),R(t);return}if(R({}),o){let e=a.reduce((e,t)=>{let a=D[t.name];return e[t.name]=I(a,t.valueType),e},{}),t=Object.entries(i).reduce((e,t)=>{var a;let[n,r]=t;return e[n]=null!==(a=null==r?void 0:r.toString())&&void 0!==a?a:null,e},{});await L(t,e),o(e)}S(!1)},M=e=>t=>{let n=t.target.value||null,r=a.find(t=>t.name===e);(null==r?void 0:r.valueType)==="number"&&n&&(n=n.replace(/[^0-9.-]/g,"")),N(t=>({...t,[e]:n})),s&&s(e,n)},_=e=>{var t;if("select"===e.type&&e.options)return(0,n.jsx)(u.A,{fullWidth:!0,disabled:!T||e.disabled,children:(0,n.jsx)(m.A,{freeSolo:!0,options:e.options,getOptionLabel:e=>"string"==typeof e?e:e.label,value:e.options.find(t=>t.value===D[e.name])||D[e.name]||null,onChange:(t,a)=>{let n="string"==typeof a?a:(null==a?void 0:a.value)||null;N(t=>({...t,[e.name]:n})),s&&s(e.name,n)},onInputChange:(t,a)=>{N(t=>({...t,[e.name]:a})),s&&s(e.name,a)},disabled:!T||e.disabled,renderInput:t=>(0,n.jsx)(p.A,{...t,label:e.label,error:!!w[e.name],helperText:w[e.name],sx:{"& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"rgba(145, 158, 171, 0.2)"},"&.Mui-disabled":{backgroundColor:"rgba(0, 0, 0, 0.02)","& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(0, 0, 0, 0.3)",borderWidth:"1px"},"& .MuiInputBase-input":{color:"rgba(0, 0, 0, 0.6)",WebkitTextFillColor:"rgba(0, 0, 0, 0.6)"}}}}}),renderOption:(e,t)=>{let{key:a,...r}=e;return(0,n.jsx)("li",{...r,children:"string"==typeof t?t:t.label},a)}})});let a=null!==(t=D[e.name])&&void 0!==t?t:"";"number"===e.valueType&&a&&(a=e.removeDecimal?C(a):j(a));let r={fullWidth:!0,label:e.label,variant:"outlined",placeholder:e.placeholder||"입력해주세요.",className:"bg-background-paper",disabled:!T||e.disabled,value:a,type:"textarea"===e.type?void 0:e.type,onChange:M(e.name),error:!!w[e.name],helperText:w[e.name],sx:{"& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"rgba(145, 158, 171, 0.2)"},"&.Mui-disabled":{backgroundColor:"rgba(0, 0, 0, 0.02)","& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(0, 0, 0, 0.3)",borderWidth:"1px"},"& .MuiInputBase-input":{color:"rgba(0, 0, 0, 0.6)",WebkitTextFillColor:"rgba(0, 0, 0, 0.6)"}}}},InputLabelProps:"date"===e.type?{shrink:!0}:void 0,InputProps:e.endAdornment?{endAdornment:(0,n.jsx)(g.A,{sx:{color:"inherit","& .MuiTypography-root":{color:"inherit"}},position:"end",children:e.endAdornment})}:void 0,multiline:"textarea"===e.type,rows:"textarea"===e.type?4:void 0};return(0,n.jsx)(p.A,{...r})};return(0,n.jsxs)(h.A,{className:"bg-background-paper rounded-2xl shadow-[0px_12px_24px_-4px_rgba(145,158,171,0.12)] shadow-[0px_0px_2px_0px_rgba(145,158,171,0.20)] inline-flex flex-col justify-start items-end ".concat(d),children:[(0,n.jsxs)(r.A,{className:"self-stretch pl-6 pr-4 py-6 border-b border-[rgba(145,158,171,0.2)] flex justify-between items-center",children:[(0,n.jsx)(l.A,{variant:"h6",className:"text-text-primary font-semibold",children:t}),(0,n.jsx)(r.A,{children:T?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(x.A,{onClick:O,color:"primary",children:(0,n.jsx)(v.A,{})}),(0,n.jsx)(x.A,{onClick:()=>{N(Object.entries(i).reduce((e,t)=>{var a;let[n,r]=t;return e[n]=null!==(a=null==r?void 0:r.toString())&&void 0!==a?a:null,e},{})),R({}),S(!1),P()},color:"primary",children:(0,n.jsx)(b.A,{})})]}):(0,n.jsx)(x.A,{onClick:()=>S(!0),children:(0,n.jsx)(f.A,{className:"text-action-disabled opacity-80"})})})]}),(0,n.jsx)(r.A,{className:"self-stretch p-6",children:(0,n.jsx)(y.Ay,{container:!0,spacing:3,children:a.map(e=>(0,n.jsx)(y.Ay,{item:!0,xs:e.gridSize||12,children:_(e)},e.name))})})]})}var ea=a(80835),en=a(40309);function er(){let[e,t]=(0,c.useState)(!1),[a,r]=(0,c.useState)({title:"",description:""}),l=()=>{t(!1)};return{toast:e=>{r(e),t(!0)},ToastComponent:()=>(0,n.jsx)(ea.A,{open:e,autoHideDuration:2e3,onClose:l,anchorOrigin:{vertical:"top",horizontal:"right"},children:(0,n.jsxs)(en.A,{onClose:l,severity:"destructive"===a.variant?"error":"success",sx:{width:"100%"},children:[(0,n.jsx)("div",{className:"font-semibold",children:a.title}),(0,n.jsx)("div",{children:a.description})]})})}}var el=a(9285);let ei=e=>{let{open:t,onClose:a,onSelect:i}=e;return(0,n.jsx)(el.A,{open:t,onClose:a,"aria-labelledby":"bl-number-update-modal","aria-describedby":"bl-number-update-modal-description",children:(0,n.jsxs)(r.A,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",boxShadow:24,p:4,borderRadius:2},children:[(0,n.jsx)(l.A,{id:"bl-number-update-modal",variant:"h6",component:"h2",sx:{mb:2},children:"B/L 번호 업데이트"}),(0,n.jsx)(l.A,{id:"bl-number-update-modal-description",sx:{mb:3},children:"B/L 번호를 어떻게 업데이트하시겠습니까?"}),(0,n.jsxs)(r.A,{sx:{display:"flex",gap:2,justifyContent:"center"},children:[(0,n.jsx)(s.A,{variant:"outlined",onClick:()=>i("all"),children:"전체 계약 업데이트"}),(0,n.jsx)(s.A,{variant:"contained",onClick:()=>i("single"),children:"특정 화물 업데이트"})]})]})})};var eo=a(59519);function es(e){var t,a,l;let{cargoId:i}=e,[o,s]=(0,E.fp)(K),[u,m]=(0,E.fp)(q),p=(0,E.Xr)(Q),[,g]=(0,E.fp)(J),{toast:h,ToastComponent:x}=er(),[y,v]=(0,c.useState)(!1),[b,f]=(0,c.useState)(null),[A,j]=(0,c.useState)(""),[C,T]=(0,c.useState)([]);(0,c.useEffect)(()=>{(async()=>{T(await (0,eo.F)())})()},[]),(0,c.useEffect)(()=>{console.log(o)},[o]);let[U,I]=(0,c.useState)(()=>(console.log("Initializing currentPaymentFields"),D));(0,c.useEffect)(()=>{var e,t;console.log("mappedData effect triggered, paymentMethod:",null==o?void 0:null===(e=o.payment)||void 0===e?void 0:e.paymentMethod),(null==o?void 0:null===(t=o.payment)||void 0===t?void 0:t.paymentMethod)&&j(o.payment.paymentMethod)},[null==o?void 0:null===(t=o.payment)||void 0===t?void 0:t.paymentMethod]);let k=e=>{if(console.log("handlePaymentMethodChange called with:",e),j(e),!e){I(D);return}I([...D,...N["L/C at sight"===e?"L/C":"Payment Usance"===e?"Usance":e]||[]])},L={...null==o?void 0:o.payment,paymentMethod:A||(null==o?void 0:null===(a=o.payment)||void 0===a?void 0:a.paymentMethod),exchangeRate:null==o?void 0:null===(l=o.costDetail)||void 0===l?void 0:l.exchangeRate};(0,c.useEffect)(()=>{!async function(){if(o){m(!1);return}try{m(!0),await s(i)}catch(e){p(e instanceof Error?e.message:"데이터를 불러오는 중 오류가 발생했습니다.")}finally{m(!1)}}()},[i,o,s,m,p]);let O=async e=>{if(!o)return;"T/T"===e.paymentMethod&&(e.totalContractAmount=(o.costDetail.unitPrice||0)*(o.costDetail.exchangeRate||0)*(o.cargo.contractTon||0));let t={...e};if(t.blNumber&&t.blNumber!==o.contract.blNumber){f(t),v(!0);return}try{await g({formData:t,cargoId:i}),await s(i),h({title:"성공",description:"데이터가 성공적으로 저장되었습니다."})}catch(e){h({title:"오류",description:e instanceof Error?e.message:"데이터 저장 중 오류가 발생했습니다.",variant:"destructive"})}},M=async e=>{if(v(!1),b){try{await g({formData:b,cargoId:i,option:e}),await s(i),h({title:"성공",description:"데이터가 성공적으로 저장되었습니다."})}catch(e){h({title:"오류",description:e instanceof Error?e.message:"데이터 저장 중 오류가 발생했습니다.",variant:"destructive"})}f(null)}};return u?(0,n.jsx)(r.A,{className:"w-full h-full flex items-center justify-center",children:(0,n.jsx)(d.A,{})}):o?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(x,{}),(0,n.jsx)(ei,{open:y,onClose:()=>v(!1),onSelect:M}),(0,n.jsxs)(r.A,{className:"w-full mx-auto inline-flex justify-start items-start gap-6 flex-wrap content-start",children:[(0,n.jsx)(et,{title:"계약 정보",fields:S(C),className:"w-full",data:{...o.contract,contractTon:o.cargo.contractTon},onSave:e=>O(e)}),(0,n.jsx)(et,{title:"결제 정보",fields:U,className:"w-full",data:L,onSave:e=>{O(e)},onFieldChange:(e,t)=>{"paymentMethod"===e&&k(t)}}),(0,n.jsx)(et,{title:"원가 정보",fields:w,className:"w-full md:w-[calc(50%-12px)]",data:{...o.costDetail,purchaseFeeRate:o.cargo.purchaseFeeRate},onSave:e=>O(e)}),(0,n.jsx)(et,{title:"수입회사 금액 정보",fields:R,className:"w-full md:w-[calc(50%-12px)]",data:o.cost,onSave:e=>O(e)}),(0,n.jsx)(et,{title:"곰표 비용 정보",fields:F,className:"w-full",data:o.cost,onSave:e=>O(e)}),(0,n.jsx)(et,{title:"비용 정보",fields:P,className:"w-full",data:o.cargo,onSave:e=>O(e)})]})]}):(0,n.jsx)("div",{})}let ec=[{name:"itemName",label:"품목명",gridSize:6,valueType:"string"},{name:"itemVariety",label:"품종",gridSize:6,valueType:"string"},{name:"originCountry",label:"원산지",gridSize:12,valueType:"string"},{name:"hsCode",label:"HS Code",gridSize:12,valueType:"string"}],ed=[{name:"packingUnit",label:"포장 단위",gridSize:12,type:"select",valueType:"string",options:[{value:"25kg",label:"25kg"},{value:"1.2ton",label:"1.2ton"},{value:"bulk",label:"bulk"}]},{name:"contractTon",label:"계약 톤수",gridSize:12,endAdornment:"톤",valueType:"number",type:"number"},{name:"containerCount",label:"컨테이너 개수",gridSize:12,endAdornment:"개",valueType:"number",type:"number"}],eu=[{name:"shippingCompany",label:"선사",gridSize:12,valueType:"string"},{name:"customsClearanceDate",label:"통관일",gridSize:12,valueType:"string",type:"date"},{name:"warehouseEntryDate",label:"입고일",gridSize:12,valueType:"string",type:"date"},{name:"quarantineDate",label:"검역일",gridSize:12,valueType:"string",type:"date"},{name:"palletOrderDate",label:"파레트 주문일",gridSize:12,valueType:"string",type:"date"},{name:"palletType",label:"파레트 종류",gridSize:12,valueType:"string"}],em={name:"remark",label:"비고",gridSize:12,valueType:"string",type:"textarea"},ep=e=>e?Object.entries(e).reduce((e,t)=>{let[a,n]=t;return null==n?e[a]="":e[a]=n,e},{}):{},eg=(e,t)=>({packingUnit:(null==e?void 0:e.packingUnit)||null,contractTon:(null==t?void 0:t.contractTon)||null,containerCount:(null==t?void 0:t.containerCount)||null}),eh=(e,t)=>({palletOrderDate:(null==t?void 0:t.palletOrderDate)||null,palletType:(null==t?void 0:t.palletType)||null,shippingCompany:(null==t?void 0:t.shippingCompany)||null,customsClearanceDate:(null==e?void 0:e.customsClearanceDate)||null,warehouseEntryDate:(null==e?void 0:e.warehouseEntryDate)||null,quarantineDate:(null==e?void 0:e.quarantineDate)||null});function ex(e){var t;let{cargoId:a}=e,[l]=(0,E.fp)(K),[i]=(0,E.fp)(q),[,o]=(0,E.fp)(J),{toast:s,ToastComponent:c}=er(),u=async e=>{if(l)try{await o({formData:e,cargoId:a}),s({title:"성공",description:"데이터가 성공적으로 저장되었습니다."})}catch(e){s({title:"오류",description:e instanceof Error?e.message:"데이터 저장 중 오류가 발생했습니다.",variant:"destructive"})}};if(i)return(0,n.jsx)(r.A,{className:"w-full h-full flex items-center justify-center",children:(0,n.jsx)(d.A,{})});if(!l)return(0,n.jsx)("div",{});let m=ep(l.item),p=ep(eg(l.item,l.cargo)),g=ep(eh(l.cargo,l.shipment)),h={remark:(null===(t=l.cargo)||void 0===t?void 0:t.remark)||""};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,n.jsx)(et,{title:"상품 정보",fields:ec,data:m,onSave:e=>u(e)}),(0,n.jsx)(et,{title:"포장 정보",fields:ed,data:p,onSave:e=>u(e)}),(0,n.jsx)(et,{title:"상태 정보",fields:eu,data:g,onSave:e=>u(e)}),(0,n.jsx)(et,{title:"비고",fields:[em],data:h,onSave:e=>u(e)})]}),(0,n.jsx)(c,{})]})}var ey=a(79508);let ev=(0,I.createServerReference)("60cbc01bae5f67ee20fc97879020615a700be729ab",I.callServer,void 0,I.findSourceMapURL,"updateCargoStatusInfo");var eb=a(40017),ef=a(57797),eA=a(89085),ej=a(33096),eC=a(68116),eT=a(83675),eS=a(70006),eD=a(57598),eN=a(40404),ew=a(39390),eR=a(58361),eP=a(43828),eF=a(81143),eE=a(17341),eU=a(73244);let eI=(0,I.createServerReference)("6034e35ff68ef1e6a8adf4c6e719336aaa9dd7cace",I.callServer,void 0,I.findSourceMapURL,"getDocuments"),ek=(0,I.createServerReference)("78952e47810149b8b5c59b0dba085bde08a04d66be",I.callServer,void 0,I.findSourceMapURL,"getUploadPresignedUrl"),eL=(0,I.createServerReference)("401aa32c39ad35a1d3727a094c6ce9877b43cb2003",I.callServer,void 0,I.findSourceMapURL,"saveDocument"),eO=(0,I.createServerReference)("40a01b99a1c3a2a105682d4efd0fa91fb67d72ce29",I.callServer,void 0,I.findSourceMapURL,"getSignedDownloadUrl"),eM=(0,I.createServerReference)("6061aa3e181fb1ac577152544d472e4b785868196b",I.callServer,void 0,I.findSourceMapURL,"deleteDocument"),e_=(0,U.eU)({}),eW=(0,U.eU)(e=>e(e_),(e,t,a)=>{let{relatedId:n,category:r,documents:l,isLoading:i}=a,o=e(e_),s="".concat(n,"-").concat(r);t(e_,{...o,[s]:{documents:l,isLoading:i,lastFetched:Date.now()}})}),ez=(0,U.eU)(e=>{let t=e(e_);return(e,a)=>{var n;return(null===(n=t["".concat(e,"-").concat(a)])||void 0===n?void 0:n.documents)||[]}}),eB=(0,U.eU)(e=>{let t=e(e_);return(e,a)=>{var n;return(null===(n=t["".concat(e,"-").concat(a)])||void 0===n?void 0:n.isLoading)||!1}});function eV(e){let{open:t,onClose:a,onUpload:i,category:o}=e,[d,u]=(0,c.useState)(!1),[m,p]=(0,c.useState)([]),[g,h]=(0,c.useState)(!1),[y,v]=(0,c.useState)({}),b=()=>{p([]),h(!1),v({})},f=(0,c.useCallback)(e=>{e.preventDefault(),u(!0)},[]),A=(0,c.useCallback)(e=>{e.preventDefault(),u(!1)},[]),j=(0,c.useCallback)(e=>{e.preventDefault(),u(!1);let t=Array.from(e.dataTransfer.files);t.length>0&&p(e=>[...e,...t])},[]),C=e=>{p(t=>t.filter((t,a)=>a!==e))},T=()=>{g||(b(),a())};return(0,n.jsxs)(eb.A,{open:t,onClose:T,maxWidth:"sm",fullWidth:!0,children:[(0,n.jsx)(ef.A,{children:"contract"===o?"계약 관련 서류 업로드":"선적 관련 서류 업로드"}),(0,n.jsxs)(eA.A,{children:[(0,n.jsxs)(r.A,{className:"mt-4 p-8 border-2 border-dashed rounded-lg text-center ".concat(d?"border-primary bg-primary/5":"border-gray-300"),onDragOver:f,onDragLeave:A,onDrop:j,children:[(0,n.jsx)(eP.A,{className:"text-4xl text-gray-400 mb-4"}),(0,n.jsx)(l.A,{variant:"body1",sx:{mb:2},children:"파일을 드래그하여 업로드하거나"}),(0,n.jsxs)(s.A,{variant:"outlined",component:"label",disabled:g,children:["파일 선택",(0,n.jsx)("input",{type:"file",multiple:!0,hidden:!0,onChange:e=>{let t=Array.from(e.target.files||[]);t.length>0&&p(e=>[...e,...t])},disabled:g})]})]}),m.length>0&&(0,n.jsxs)(r.A,{className:"mt-4",children:[(0,n.jsx)(l.A,{variant:"subtitle2",className:"mb-2",children:"선택된 파일 목록"}),(0,n.jsx)(ej.A,{className:"max-h-48 overflow-y-auto",children:m.map((e,t)=>(0,n.jsx)(eC.Ay,{secondaryAction:(0,n.jsx)(x.A,{edge:"end","aria-label":"delete",onClick:()=>C(t),disabled:g,children:(0,n.jsx)(eF.A,{})}),children:(0,n.jsx)(eT.A,{primary:e.name,secondary:"".concat((e.size/1024).toFixed(2)," KB")})},t))})]}),g&&m.length>0&&(0,n.jsxs)(r.A,{className:"mt-4",children:[(0,n.jsx)(l.A,{variant:"subtitle2",className:"mb-2",children:"업로드 진행 상태"}),(0,n.jsx)(ej.A,{className:"max-h-48 overflow-y-auto",children:m.map((e,t)=>(0,n.jsx)(eC.Ay,{children:(0,n.jsxs)(r.A,{sx:{width:"100%"},children:[(0,n.jsx)(l.A,{variant:"body2",children:e.name}),(0,n.jsx)(eS.A,{variant:"determinate",value:y[e.name]||0,sx:{mt:1,height:8,borderRadius:4}}),(0,n.jsxs)(l.A,{variant:"caption",sx:{mt:.5,display:"block"},children:[y[e.name]||0,"%"]})]})},t))})]})]}),(0,n.jsxs)(eD.A,{children:[(0,n.jsx)(s.A,{onClick:T,disabled:g,children:"취소"}),(0,n.jsx)(s.A,{variant:"contained",onClick:()=>{m.length>0&&(h(!0),v(m.reduce((e,t)=>(e[t.name]=0,e),{})),i(m,o,(e,t)=>{v(n=>{let r={...n,[e]:t};return 100===t&&Object.values(r).every(e=>100===e)&&setTimeout(()=>{b(),a()},1e3),r})}))},disabled:0===m.length||g,children:g?"업로드 중...":"업로드 (".concat(m.length,")")})]})]})}function eH(e){let{cargoId:t}=e,[a,i]=(0,c.useState)("contract"),[u,m]=(0,c.useState)(!1),[p,g]=(0,c.useState)(!1),[y,v]=(0,c.useState)(null),{toast:b}=er(),[,f]=(0,E.fp)(eW),A=(0,E.md)(ez),j=(0,E.md)(eB),[C]=(0,E.fp)(K),[T,S]=(0,c.useState)(""),[D,N]=(0,c.useState)("");(0,c.useEffect)(()=>{var e,t;if(C){if(S((null===(e=C.contract)||void 0===e?void 0:e.id)||""),N((null===(t=C.shipment)||void 0===t?void 0:t.id)||""),!T&&!D){b({title:"오류",description:"관련 문서를 찾을 수 없습니다.",variant:"destructive"});return}P()}},[C]);let w=A("contract"===a?T:D,a),R=j("contract"===a?T:D,a);(0,c.useEffect)(()=>{P()},[t]);let P=async()=>{for(let a of["contract","shipment"]){var e,t;let n="contract"===a?null==C?void 0:null===(e=C.contract)||void 0===e?void 0:e.id:null==C?void 0:null===(t=C.shipment)||void 0===t?void 0:t.id;if(!n){b({title:"오류",description:"관련 문서를 찾을 수 없습니다.",variant:"destructive"});return}try{f({relatedId:n,category:a,documents:[],isLoading:!0});let e=await eI(n,a);e.success&&e.documents?f({relatedId:n,category:a,documents:e.documents,isLoading:!1}):(console.error("".concat(a," 문서 목록 조회 실패:"),e.error),b({title:"오류",description:e.error||"문서 목록을 불러오는데 실패했습니다.",variant:"destructive"}),f({relatedId:n,category:a,documents:[],isLoading:!1}))}catch(e){console.error("".concat(a," 문서 목록 조회 중 오류 발생:"),e),b({title:"오류",description:"문서 목록을 불러오는 중 오류가 발생했습니다.",variant:"destructive"}),f({relatedId:n,category:a,documents:[],isLoading:!1})}}},F=async(e,t,a)=>{try{var n,r;let l="contract"===t?null==C?void 0:null===(n=C.contract)||void 0===n?void 0:n.id:null==C?void 0:null===(r=C.shipment)||void 0===r?void 0:r.id;if(!l){b({title:"오류",description:"관련 문서를 찾을 수 없습니다.",variant:"destructive"});return}let i=e.map(async e=>{let n=await ek(e.name,e.type,l,t);if(!n.success||!n.url)throw Error("파일 ".concat(e.name,"의 Presigned URL 생성에 실패했습니다."));if(await new Promise((t,r)=>{let l=new XMLHttpRequest;l.upload.addEventListener("progress",t=>{if(t.lengthComputable){let n=Math.round(t.loaded/t.total*100);a(e.name,n)}}),l.open("PUT",n.url),l.setRequestHeader("Content-Type",e.type),l.onload=()=>{l.status>=200&&l.status<300?(a(e.name,100),t()):r(Error("업로드 실패: ".concat(l.statusText)))},l.onerror=()=>r(Error("업로드 중 네트워크 오류 발생")),l.send(e)}),!(await eL({name:e.name,type:e.type,url:n.fileUrl,relatedId:l,category:t})).success)throw Error("파일 ".concat(e.name,"의 정보 저장에 실패했습니다."))});await Promise.all(i),await P(),b({title:"성공",description:"".concat(e.length,"개의 파일이 업로드되었습니다.")}),setTimeout(()=>{m(!1)},1e3)}catch(e){console.error("파일 업로드 중 오류 발생:",e),b({title:"오류",description:e instanceof Error?e.message:"파일 업로드 중 오류가 발생했습니다.",variant:"destructive"})}},U=async e=>{try{let t=await eO(e.id);t.success?window.open(t.url,"_blank"):b({title:"오류",description:t.error||"파일 다운로드에 실패했습니다.",variant:"destructive"})}catch(e){console.error("파일 다운로드 중 오류 발생:",e),b({title:"오류",description:"파일 다운로드 중 오류가 발생했습니다.",variant:"destructive"})}},I=async e=>{v(e),g(!0)},k=async()=>{if(y)try{let e=await eM(y.id,t);e.success?(g(!1),v(null),await P(),b({title:"성공",description:"문서가 삭제되었습니다."})):b({title:"오류",description:e.error||"문서 삭제에 실패했습니다.",variant:"destructive"})}catch(e){console.error("문서 삭제 중 오류 발생:",e),b({title:"오류",description:"문서 삭제 중 오류가 발생했습니다.",variant:"destructive"})}},L=()=>{g(!1),v(null)},O=w.filter(e=>e.documentCategory===a);return R?(0,n.jsx)(r.A,{className:"flex justify-center items-center h-full",children:(0,n.jsx)(d.A,{})}):(0,n.jsxs)(r.A,{className:"space-y-6",children:[(0,n.jsx)(h.A,{className:"p-4",children:(0,n.jsxs)(o.A,{spacing:3,children:[(0,n.jsxs)(o.A,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[(0,n.jsx)(l.A,{variant:"h6",className:"font-bold",children:"서류 관리"}),(0,n.jsx)(s.A,{variant:"contained",startIcon:(0,n.jsx)(eE.A,{}),onClick:()=>m(!0),children:"contract"===a?"계약 관련 서류 업로드":"선적 관련 서류 업로드"})]}),(0,n.jsxs)(eN.A,{value:a,onChange:(e,t)=>i(t),className:"border-b",children:[(0,n.jsx)(ew.A,{label:"계약 관련 서류",value:"contract"}),(0,n.jsx)(ew.A,{label:"선적 관련 서류",value:"shipment"})]}),(0,n.jsx)(ej.A,{children:0===O.length?(0,n.jsx)(eC.Ay,{children:(0,n.jsx)(eT.A,{primary:"등록된 ".concat("contract"===a?"계약":"선적"," 관련 서류가 없습니다.")})}):O.map(e=>(0,n.jsx)(eC.Ay,{divider:!0,secondaryAction:(0,n.jsxs)(o.A,{direction:"row",spacing:1,children:[(0,n.jsx)(x.A,{edge:"end","aria-label":"download",onClick:()=>U(e),children:(0,n.jsx)(eU.A,{})}),(0,n.jsx)(x.A,{edge:"end","aria-label":"delete",onClick:()=>I(e),children:(0,n.jsx)(eF.A,{})})]}),children:(0,n.jsx)(eT.A,{primary:e.documentName,secondary:new Date(e.uploadDate).toLocaleDateString()})},e.id))})]})}),(0,n.jsx)(eV,{open:u,onClose:()=>m(!1),onUpload:F,category:a}),(0,n.jsxs)(eb.A,{open:p,onClose:L,"aria-labelledby":"delete-dialog-title","aria-describedby":"delete-dialog-description",children:[(0,n.jsx)(ef.A,{id:"delete-dialog-title",children:"문서 삭제 확인"}),(0,n.jsx)(eA.A,{children:(0,n.jsxs)(eR.A,{id:"delete-dialog-description",children:[null==y?void 0:y.documentName," 문서를 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다."]})}),(0,n.jsxs)(eD.A,{children:[(0,n.jsx)(s.A,{onClick:L,children:"취소"}),(0,n.jsx)(s.A,{onClick:k,color:"error",autoFocus:!0,children:"삭제"})]})]})]})}var eG=a(67394),eK=a(36429),eq=a(87418),eQ=a(67446),eX=a(45278),eJ=a(48805),eY=a(52511);function eZ(e){let{item:t,onClick:a}=e,i=(0,eG.GP)((0,eK.H)(t.created_at),"yyyy.MM.dd HH:mm",{locale:eq.ko}),o="status"===t.type?"#e8f5e9":"change"===t.type?"#fff8e1":"#e3f2fd",s="status"===t.type?"#c8e6c9":"change"===t.type?"#ffecb3":"#bbdefb",c="status"===t.type?"#43a047":"change"===t.type?"#f57c00":"#1976d2";return(0,n.jsxs)(eQ.A,{elevation:0,sx:{position:"relative",display:"flex",alignItems:"flex-start",padding:2,paddingTop:{xs:2.5,sm:2},paddingLeft:{xs:3,sm:4.5},borderRadius:2,border:"1px solid #e0e0e0",backgroundColor:o,cursor:"pointer",transition:"all 0.2s","&:hover":{boxShadow:"0 2px 4px rgba(0,0,0,0.1)"}},onClick:()=>{a&&a(t)},children:[(0,n.jsx)(r.A,{sx:{position:"absolute",left:{xs:12,sm:16},top:{xs:16,sm:18}},children:(0,n.jsx)(r.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",width:28,height:28,borderRadius:"50%",backgroundColor:s,color:c,boxShadow:"0 1px 2px rgba(0,0,0,0.1)"},children:(0,n.jsx)(eJ.A,{sx:{width:18,height:18}})})}),(0,n.jsxs)(r.A,{sx:{flexGrow:1,minWidth:0,paddingLeft:{xs:1.5,sm:2}},children:["change"===t.type?(0,n.jsx)(e$,{item:t}):"status"===t.type?(0,n.jsx)(e1,{item:t}):(0,n.jsx)(e0,{item:t}),(0,n.jsxs)(r.A,{sx:{mt:1,display:"flex",alignItems:"center",fontSize:"0.75rem",color:"text.secondary"},children:[(0,n.jsx)(eY.A,{sx:{mr:.5,width:12,height:12}}),(0,n.jsx)(l.A,{variant:"caption",children:i})]})]})]})}function e$(e){let{item:t}=e;return(0,n.jsxs)(l.A,{variant:"body2",sx:{lineHeight:1.5},children:[(0,n.jsx)(l.A,{component:"span",sx:{fontWeight:500},children:t.user}),(0,n.jsxs)(l.A,{component:"span",sx:{color:"text.secondary"},children:[" ","님이"," "]}),(0,n.jsx)(l.A,{component:"span",sx:{fontWeight:500},children:t.field}),(0,n.jsxs)(l.A,{component:"span",sx:{color:"text.secondary"},children:["을(를)"," "]}),(0,n.jsx)(l.A,{component:"span",sx:{fontWeight:500,textDecoration:"line-through",color:"grey.500"},children:t.from}),(0,n.jsxs)(l.A,{component:"span",sx:{color:"text.secondary"},children:[" ","→"," "]}),(0,n.jsx)(l.A,{component:"span",sx:{fontWeight:500},children:t.to}),(0,n.jsx)(l.A,{component:"span",sx:{color:"text.secondary"},children:"으로 변경"})]})}function e0(e){let{item:t}=e;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(l.A,{variant:"body2",sx:{lineHeight:1.5,mb:.5},children:[(0,n.jsx)(l.A,{component:"span",sx:{fontWeight:500},children:t.user}),(0,n.jsxs)(l.A,{component:"span",sx:{color:"text.secondary"},children:[" ","님이"," "]}),(0,n.jsxs)(l.A,{component:"span",sx:{fontWeight:500},children:[t.changes.length,"개 항목"]}),(0,n.jsx)(l.A,{component:"span",sx:{color:"text.secondary"},children:"을 동시에 변경"})]}),(0,n.jsx)(r.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mt:.5},children:t.changes.map((e,t)=>(0,n.jsx)(eX.A,{label:e.field,size:"small",variant:"outlined",sx:{fontSize:"0.7rem",height:20,backgroundColor:"rgba(25, 118, 210, 0.08)",borderColor:"rgba(25, 118, 210, 0.3)"}},t))})]})}function e1(e){let{item:t}=e;return(0,n.jsxs)(l.A,{variant:"body2",sx:{lineHeight:1.5},children:[(0,n.jsxs)(l.A,{component:"span",sx:{color:"text.secondary"},children:["화물 상태가"," "]}),(0,n.jsxs)(l.A,{component:"span",sx:{fontWeight:500},children:["'",t.status,"'"]}),(0,n.jsx)(l.A,{component:"span",sx:{color:"text.secondary"},children:"로 변경됨"}),"시스템 처리"!==t.user&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(l.A,{component:"span",sx:{color:"text.secondary"},children:[" ","("]}),(0,n.jsx)(l.A,{component:"span",sx:{fontWeight:500},children:t.user}),(0,n.jsxs)(l.A,{component:"span",sx:{color:"text.secondary"},children:[" ","님)"]})]})]})}var e5=a(18686),e2=a(6309),e6=a(89189);function e8(e){let{date:t}=e,a=(0,eK.H)(t),i=(0,eG.GP)(a,"yyyy년 MM월 dd일",{locale:eq.ko});return(0,e5.c)(a)?i="오늘":(0,e2.P)(a)&&(i="어제"),(0,n.jsxs)(r.A,{sx:{display:"flex",alignItems:"center",py:1.5},children:[(0,n.jsx)(e6.A,{sx:{flexGrow:1}}),(0,n.jsx)(l.A,{variant:"body2",sx:{px:2,fontWeight:500,color:"text.secondary"},children:i}),(0,n.jsx)(e6.A,{sx:{flexGrow:1}})]})}function e4(e){let{item:t,open:a,onOpenChange:i}=e;if(!t)return null;let o=(0,eG.GP)((0,eK.H)(t.created_at),"yyyy년 MM월 dd일 HH시 mm분",{locale:eq.ko}),s="change"===t.type,c="multi-change"===t.type;return(0,n.jsxs)(eb.A,{open:a,onClose:()=>{i(!1)},maxWidth:"sm",fullWidth:!0,children:[(0,n.jsx)(ef.A,{children:s?"변경 이력 상세":c?"다중 변경 이력 상세":"상태 변경 상세"}),(0,n.jsxs)(eA.A,{children:[(0,n.jsxs)(eR.A,{style:{marginBottom:"16px"},children:[o,"에 기록된 이력입니다."]}),(0,n.jsxs)("div",{style:{padding:"16px 0"},children:[(0,n.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 2fr",gap:"8px",marginBottom:"8px"},children:[(0,n.jsx)("span",{style:{color:"#6c757d"},children:"작업자"}),(0,n.jsx)("span",{style:{fontWeight:500},children:t.user})]}),s&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 2fr",gap:"8px",marginBottom:"8px"},children:[(0,n.jsx)("span",{style:{color:"#6c757d"},children:"변경 필드"}),(0,n.jsx)("span",{style:{fontWeight:500},children:t.field})]}),(0,n.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 2fr",gap:"8px",marginBottom:"8px"},children:[(0,n.jsx)("span",{style:{color:"#6c757d"},children:"변경 전"}),(0,n.jsx)("span",{style:{fontWeight:500,color:"#dc3545"},children:t.from})]}),(0,n.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 2fr",gap:"8px",marginBottom:"8px"},children:[(0,n.jsx)("span",{style:{color:"#6c757d"},children:"변경 후"}),(0,n.jsx)("span",{style:{fontWeight:500,color:"#198754"},children:t.to})]})]}),!s&&!c&&(0,n.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 2fr",gap:"8px",marginBottom:"8px"},children:[(0,n.jsx)("span",{style:{color:"#6c757d"},children:"변경된 상태"}),(0,n.jsx)("span",{style:{fontWeight:500},children:t.status})]}),c&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 2fr",gap:"8px",marginBottom:"8px"},children:[(0,n.jsx)("span",{style:{color:"#6c757d"},children:"변경된 항목 수"}),(0,n.jsxs)("span",{style:{fontWeight:500},children:[t.changes.length,"개"]})]}),(0,n.jsxs)(r.A,{sx:{mt:2,mb:1},children:[(0,n.jsx)(l.A,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"변경 상세 내역"}),(0,n.jsx)(ej.A,{disablePadding:!0,children:t.changes.map((e,t)=>(0,n.jsx)(eC.Ay,{sx:{py:1,px:2,mb:1,backgroundColor:"rgba(0, 0, 0, 0.02)",borderRadius:1},children:(0,n.jsx)(eT.A,{primary:(0,n.jsx)(l.A,{variant:"body2",fontWeight:500,children:e.field}),secondary:(0,n.jsxs)(r.A,{sx:{mt:.5},children:[(0,n.jsx)(l.A,{variant:"body2",component:"span",sx:{display:"block",color:"error.main",textDecoration:"line-through"},children:e.from}),(0,n.jsx)(l.A,{variant:"body2",component:"span",sx:{display:"block",color:"success.main"},children:e.to})]})})},t))})]})]}),(0,n.jsx)(e6.A,{style:{margin:"16px 0"}}),(0,n.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 2fr",gap:"8px",marginBottom:"8px"},children:[(0,n.jsx)("span",{style:{color:"#6c757d"},children:"기록 시간"}),(0,n.jsx)("span",{style:{fontWeight:500},children:o})]}),(0,n.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 2fr",gap:"8px",marginBottom:"8px"},children:[(0,n.jsx)("span",{style:{color:"#6c757d"},children:"기록 유형"}),(0,n.jsx)("span",{style:{fontWeight:500},children:s?"변경 이력":c?"다중 변경 이력":"상태 변경"})]})]})]})]})}var e7=a(4906),e3=a(51403),e9=a(42776);function te(e){let{items:t,showFilters:a=!0,showDateGroups:r=!0}=e,[l,i]=(0,c.useState)("all"),[o,d]=(0,c.useState)(null),[u,m]=(0,c.useState)(!1),p=(0,c.useMemo)(()=>"all"===l?t:t.filter(e=>e.type===l),[t,l]),g=(0,c.useMemo)(()=>{let e={};return p.forEach(t=>{let a=(0,e3.x)((0,e9.o)((0,eK.H)(t.created_at)));e[a]||(e[a]=[]),e[a].push(t)}),Object.entries(e).sort((e,t)=>{let[a]=e,[n]=t;return new Date(n).getTime()-new Date(a).getTime()}).map(e=>{let[t,a]=e;return{date:t,items:a.sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime())}})},[p]),h=e=>{d(e),m(!0)};return 0===t.length?(0,n.jsx)("div",{style:{textAlign:"center",padding:"40px 0",color:"#6c757d"},children:"기록된 변경 이력이 없습니다."}):(0,n.jsxs)("div",{style:{width:"100%"},children:[a&&(0,n.jsx)("div",{style:{display:"flex",marginBottom:"16px",position:"sticky",top:0,backgroundColor:"transparent",zIndex:10,padding:"8px"},children:(0,n.jsxs)(e7.A,{size:"small",variant:"outlined",children:[(0,n.jsx)(s.A,{variant:"all"===l?"contained":"outlined",onClick:()=>i("all"),children:"전체"}),(0,n.jsx)(s.A,{variant:"change"===l?"contained":"outlined",onClick:()=>i("change"),children:"단일변경"}),(0,n.jsx)(s.A,{variant:"multi-change"===l?"contained":"outlined",onClick:()=>i("multi-change"),children:"다중변경"}),(0,n.jsx)(s.A,{variant:"status"===l?"contained":"outlined",onClick:()=>i("status"),children:"상태변경"})]})}),(0,n.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:r?g.map(e=>{let{date:t,items:a}=e;return(0,n.jsxs)("div",{children:[(0,n.jsx)(e8,{date:t}),(0,n.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:a.map((e,t)=>(0,n.jsx)(eZ,{item:e,onClick:h},"".concat(e.type,"-").concat(t,"-").concat(e.created_at)))})]},t)}):p.sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime()).map((e,t)=>(0,n.jsx)(eZ,{item:e,onClick:h},"".concat(e.type,"-").concat(t,"-").concat(e.created_at)))}),(0,n.jsx)(e4,{item:o,open:u,onOpenChange:m})]})}let tt=(0,I.createServerReference)("40d62cfb60c38de38a7f1dbf357e9476ee3d32fed4",I.callServer,void 0,I.findSourceMapURL,"getHistoryLogs");function ta(){let[e]=(0,E.fp)(K),[t,a]=(0,c.useState)([]),[r,l]=(0,c.useState)(!0);return((0,c.useEffect)(()=>{(async()=>{if(null==e?void 0:e.cargo.id)try{l(!0);let t=await tt(e.cargo.id);a(t)}catch(e){console.error("히스토리 데이터를 가져오는 중 오류 발생:",e)}finally{l(!1)}})()},[null==e?void 0:e.cargo.id]),r)?(0,n.jsx)("div",{className:"flex justify-center items-center",children:(0,n.jsx)(d.A,{})}):(0,n.jsx)(te,{items:t})}var tn=function(e){return e.REVIEW="검토중",e.CONTRACTING="계약중",e.BEFORE_LC="L/C오픈전",e.BEFORE_ARRIVAL="입항전",e.WAREHOUSE_MOVING="창고 이동중",e.BEFORE_QUARANTINE="검역전",e.QUARANTINING="검역중",e.CUSTOMS_DECLARING="세관신고중",e.DONE_ARRIVAL="입항완료",e.AFTER_CUSTOMS="통관완료",e.SELLING="판매중",e}({});let tr={REVIEW:"검토중",CONTRACTING:"계약중",BEFORE_LC:"L/C오픈전",BEFORE_ARRIVAL:"입항전",WAREHOUSE_MOVING:"창고 이동중",BEFORE_QUARANTINE:"검역전",QUARANTINING:"검역중",CUSTOMS_DECLARING:"세관신고중",DONE_ARRIVAL:"입항완료",AFTER_CUSTOMS:"통관완료",SELLING:"판매중"},tl={검토중:"REVIEW",계약중:"CONTRACTING","L/C오픈전":"BEFORE_LC",입항전:"BEFORE_ARRIVAL","창고 이동중":"WAREHOUSE_MOVING",검역전:"BEFORE_QUARANTINE",검역중:"QUARANTINING",세관신고중:"CUSTOMS_DECLARING",입항완료:"DONE_ARRIVAL",통관완료:"AFTER_CUSTOMS",판매중:"SELLING"},ti=Object.values(tn);function to(){var e;let t=(0,ey.useParams)(),[a,d]=(0,c.useState)("entire"),[u,m]=(0,E.fp)(K),{toast:p,ToastComponent:g}=er(),[h,x]=(0,c.useState)(!0),y=(0,ey.useRouter)();(0,c.useEffect)(()=>{!async function(){try{if(u&&u.cargo.id===t.cargo_id){x(!1);return}await m(t.cargo_id),x(!1)}catch(e){console.error("화물 데이터 가져오기 실패:",e),y.push("/404")}}()},[t.cargo_id]);let v=()=>{var e;if(!(null==u?void 0:null===(e=u.cargo)||void 0===e?void 0:e.progressStatus))return"0%";let t=tr[u.cargo.progressStatus];if(!t)return"0%";let a=ti.indexOf(t),n=ti.length;return"".concat(a/(n-1)*100,"%")},b=()=>{var e;if(!(null==u?void 0:null===(e=u.cargo)||void 0===e?void 0:e.progressStatus))return null;let t=tr[u.cargo.progressStatus];if(!t)return null;let a=ti.indexOf(t);return a===ti.length-1?null:tl[ti[a+1]]||null},f=()=>{var e;if(!(null==u?void 0:null===(e=u.cargo)||void 0===e?void 0:e.progressStatus))return null;let t=tr[u.cargo.progressStatus];if(!t)return null;let a=ti.indexOf(t);return 0===a?null:tl[ti[a-1]]||null},A=async e=>{if((null==u?void 0:u.cargo)&&e)try{var a,n,r;await ev(t.cargo_id,{status:e,customsClearanceDate:u.cargo.customsClearanceDate||"",warehouseEntryDate:u.cargo.warehouseEntryDate||"",quarantineDate:u.cargo.quarantineDate||"",shippingCompany:(null===(a=u.shipment)||void 0===a?void 0:a.shippingCompany)||"",palletOrderDate:(null===(n=u.shipment)||void 0===n?void 0:n.palletOrderDate)||"",palletType:(null===(r=u.shipment)||void 0===r?void 0:r.palletType)||""}),await m(t.cargo_id),p({title:"성공",description:"상태가 성공적으로 변경되었습니다."})}catch(e){console.error("상태 업데이트 중 오류 발생:",e),p({title:"오류",description:"상태 변경 중 오류가 발생했습니다.",variant:"destructive"})}};return(0,n.jsx)(n.Fragment,{children:h||!u?(0,n.jsx)(r.A,{className:"w-full h-screen flex justify-center items-center",children:(0,n.jsx)(l.A,{className:"ml-4 text-lg",children:"로딩 중..."})}):(0,n.jsxs)("div",{className:"min-h-screen bg-background-paper",children:[(0,n.jsx)(r.A,{className:"w-full h-16 px-10 bg-background-default flex justify-between items-center",children:(0,n.jsx)(l.A,{variant:"h4",className:"text-success-darker font-bold font-['Public_Sans']",children:"상세보기"})}),(0,n.jsx)(r.A,{className:"w-full h-24 p-4 relative",children:(0,n.jsx)(i.A,{maxWidth:"xl",className:"progress-container h-full",children:(0,n.jsxs)(r.A,{className:"relative h-full flex items-center",children:[(0,n.jsx)(r.A,{className:"w-full h-2.5 bg-gray-200 rounded-2xl"}),(0,n.jsx)(r.A,{className:"absolute h-2.5 bg-green-200 rounded-2xl transition-all duration-500",style:{width:(()=>{var e;if(!(null==u?void 0:null===(e=u.cargo)||void 0===e?void 0:e.progressStatus))return"0%";let t=tr[u.cargo.progressStatus];if(!t)return"0%";let a=ti.indexOf(t),n=ti.length;return"".concat(a/(n-1)*100,"%")})()}}),(0,n.jsx)(r.A,{className:"absolute transition-all duration-500 ease-in-out",style:{left:"calc(".concat(v(),")"),top:"50%",transform:"translate(-50%, -50%)"},children:(0,n.jsx)(r.A,{className:"w-10 h-10 bg-white rounded-full border-[3px] border-emerald-600 transition-colors duration-300"})}),(0,n.jsx)(l.A,{className:"absolute text-sm font-normal font-['Public_Sans'] text-emerald-600 whitespace-nowrap transition-all duration-500 ease-in-out",style:{left:"calc(".concat(v(),")"),top:"calc(50% + 20px)",transform:"translateX(-50%)"},children:(null==u?void 0:null===(e=u.cargo)||void 0===e?void 0:e.progressStatus)?tr[u.cargo.progressStatus]:""})]})})}),(0,n.jsxs)(i.A,{maxWidth:"xl",className:"mt-8",children:[(0,n.jsx)(r.A,{className:"mb-8",children:(0,n.jsxs)(o.A,{direction:{xs:"column",sm:"row"},spacing:2,justifyContent:"space-between",alignItems:"center",children:[(0,n.jsxs)(o.A,{direction:"row",spacing:2,children:[(0,n.jsx)(s.A,{variant:"contained",color:"entire"===a?"primary":"inherit",onClick:()=>d("entire"),children:"전체정보"}),(0,n.jsx)(s.A,{variant:"contained",color:"document"===a?"primary":"inherit",onClick:()=>d("document"),children:"서류정보"}),(0,n.jsx)(s.A,{variant:"contained",color:"cargo"===a?"primary":"inherit",onClick:()=>d("cargo"),children:"화물 정보"}),(0,n.jsx)(s.A,{variant:"contained",color:"history"===a?"primary":"inherit",onClick:()=>d("history"),children:"히스토리"})]}),(0,n.jsxs)(o.A,{direction:"row",spacing:2,children:[(0,n.jsx)(s.A,{variant:"contained",color:"primary",onClick:()=>A(f()),disabled:!f(),children:"이전 상태로 변경"}),(0,n.jsx)(s.A,{variant:"contained",color:"primary",onClick:()=>A(b()),disabled:!b(),children:"다음 상태로 변경"})]})]})}),(()=>{switch(a){case"entire":return(0,n.jsx)(es,{cargoId:t.cargo_id});case"document":return(0,n.jsx)(eH,{cargoId:t.cargo_id});case"cargo":return(0,n.jsx)(ex,{cargoId:t.cargo_id});case"history":return(0,n.jsx)(ta,{});default:return null}})(),(0,n.jsx)(r.A,{className:"w-[1093px] h-[50px]"})]}),(0,n.jsx)(g,{})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[426,336,69,41,90,59,555,40,20,245,39,77,358],()=>t(55587)),_N_E=e.O()}]);
